var __extends,AngularEj;(function(n){var t=function(){function t(){}return t.RegisterModule=function(i){var r=function(r){var u=n.DynamicDependencyKeys[r];i.factory(u,["$injector",function(n){var i=t._determinedDependencyKeys.Get(u);return n.get(i)}])};for(var u in n.DynamicDependencyKeys)r(u)},t.SwitchToFunnel=function(){t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.SeatMapFlightDataService,"SeatMapFunnelFlightDataService");t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.SeatMapAssociationsService,"Funnel_AssociationsService");t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.SeatMapSameSeatService,"SeatMapSameSeatService");t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.SeatMapHelpingHandSettings,"Sitecore_HelpingHandMessages");t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.SeatMapPassengerService,"SeatMapFunnelPassengerService");t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.SeatMapReadOnlyService,"SeatMapFunnelReadOnlyService");t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.ExtrasService,"Funnel_ExtrasService");t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.LuggageChargesService,"Funnel_LuggageChargesService")},t.SwitchToManageBookingFunnel=function(){t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.SeatMapFlightDataService,"ManageBookings_Funnel_SeatMapFlightDataService");t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.SeatMapAssociationsService,"ManageBookings_Funnel_SeatMapAssociationsService");t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.SeatMapSameSeatService,"ManageBookings_Funnel_SeatMapSameSeatService");t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.SeatMapHelpingHandSettings,"Sitecore_ManageBookingsFunnelHelpingHandSettings");t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.SeatMapPassengerService,"ManageBookings_Funnel_SeatMapPassengerService");t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.SeatMapReadOnlyService,"ManageBookings_Funnel_SeatMapReadOnlyService");t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.ExtrasService,"ManageBookings_Funnel_ExtrasService");t._determinedDependencyKeys.Set(n.DynamicDependencyKeys.LuggageChargesService,"ManageBookings_Funnel_LuggageChargesService")},t._determinedDependencyKeys=new Dictionary,t}();n.DynamicDependency=t})(AngularEj||(AngularEj={})),function(n){var t=function(){function n(){}return n._dynamicInjectionMarker="[#DYNAMIC_INJECTION#]",n.SeatMapFlightDataService=n._dynamicInjectionMarker+"_SeatMapFlightDataService",n.SeatMapAssociationsService=n._dynamicInjectionMarker+"_SeatMapAssociationsService",n.SeatMapSameSeatService=n._dynamicInjectionMarker+"_SeatMapSameSeatService",n.SeatMapHelpingHandSettings=n._dynamicInjectionMarker+"_SeatMapHelpingHandSettings",n.SeatMapPassengerService=n._dynamicInjectionMarker+"_SeatMapPassengerService",n.SeatMapReadOnlyService=n._dynamicInjectionMarker+"_SeatMapReadOnlyService",n.ExtrasService=n._dynamicInjectionMarker+"_ExtrasService",n.LuggageChargesService=n._dynamicInjectionMarker+"_LuggageChargesService",n}();n.DynamicDependencyKeys=t}(AngularEj||(AngularEj={}));__extends=this&&this.__extends||function(n,t){var i,r;try{for(i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);function u(){this.constructor=n}n.prototype=t===null?Object.create(t):(u.prototype=t.prototype,new u)}catch(f){r=function(n){if(n){if(typeof n=="function")return n.name;if(n.toString)return n.toString();if(typeof n=="object")return JSON.stringify(n)}else{if(n==null)return"[null]";if(n==undefined)return"[undefined]"}return"[UNKNOWN]"};throw new Error("Error extending "+r(n)+" from "+r(t));}},function(n){function t(){return typeof angularEjRootScope=="object"}function i(){for(var t="",n=arguments.callee.caller;n;)t=t+n.toString()+"\n",n=n.caller;console.log(t)}n.IsAngularCompatible=t;window.onpageshow=function(t){t.persisted&&n.Events.Fire(n.Events.Names.Page.LoadedFromCache)};$jq(function(){var t=$jq("#page-previously-loaded");t.val()=="yes"?(t.val("no"),n.Events.Fire(n.Events.Names.Page.LoadedFromCache)):t.val("yes");n.Events.Fire(n.Events.Names.Page.DocumentReady)});n.LogStack=i}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{addClass:function(t,i,r){return n.BlindOut(t,r)},removeClass:function(t,i,r){return n.BlindIn(t,r)},leave:function(t,i,r){return n.BlindOut(t,r)},enter:function(t,i,r){return n.BlindIn(t,r)}}},n.BlindOut=function(t,i){return t.show(),t.hide("blind",n.AnimationTime,function(){i();t.removeAttr("style")}),function(n){n&&t.stop(!0,!0)}},n.BlindIn=function(t,i){return t.hide(),t.show("blind",n.AnimationTime,function(){i();t.removeAttr("style")}),function(n){n&&t.stop(!0,!0)}},n.AnimationTime=500,n}();n.Blind=t})(t=n.Animations||(n.Animations={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{addClass:function(t,i,r){return n.FadeOut(t,r)},removeClass:function(t,i,r){return n.FadeIn(t,r)},leave:function(t,i,r){return n.FadeOut(t,r)},enter:function(t,i,r){return n.FadeIn(t,r)}}},n.FadeOut=function(t,i){return t.show(),t.fadeOut(n.GetAnimationTime(t),function(){typeof i=="function"&&i();t.css("display","")}),function(n){n&&t.stop(!0,!0)}},n.FadeIn=function(t,i){return t.hide(),t.fadeIn(n.GetAnimationTime(t),function(){typeof i=="function"&&i();t.css("display","")}),function(n){n&&t.stop(!0,!0)}},n.GetAnimationTime=function(t){var i=parseInt(t.attr("fade-time"));return!i?n.AnimationTime:i},n.AnimationTime=500,n}();n.Fade=t})(t=n.Animations||(n.Animations={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.RightToLeftFactory=function(){return{addClass:function(t,i,r){return n.SlideOut(t,r,n.DirectionLeft)},removeClass:function(t,i,r){return n.SlideIn(t,r,n.DirectionRight)},leave:function(t,i,r){return n.SlideOut(t,r,n.DirectionLeft)},enter:function(t,i,r){return n.SlideIn(t,r,n.DirectionRight)}}},n.RightToRightFactory=function(){return{addClass:function(t,i,r){return n.SlideOut(t,r,n.DirectionRight)},removeClass:function(t,i,r){return n.SlideIn(t,r,n.DirectionRight)},leave:function(t,i,r){return n.SlideOut(t,r,n.DirectionRight)},enter:function(t,i,r){return n.SlideIn(t,r,n.DirectionRight)}}},n.LeftToRightFactory=function(){return{addClass:function(t,i,r){return n.SlideOut(t,r,n.DirectionRight)},removeClass:function(t,i,r){return n.SlideIn(t,r,n.DirectionLeft)},leave:function(t,i,r){return n.SlideOut(t,r,n.DirectionRight)},enter:function(t,i,r){return n.SlideIn(t,r,n.DirectionLeft)}}},n.SlideOut=function(t,i,r){return r=n.ReverseIfNecessary(t,r),t.show(),t.hide("slide",{direction:r},n.AnimationTime,function(){i();t.removeAttr("style")}),function(n){n&&t.stop(!0,!0)}},n.SlideIn=function(t,i,r){return r=n.ReverseIfNecessary(t,r),t.hide(),t.show("slide",{direction:r},n.AnimationTime,function(){i();t.removeAttr("style")}),function(n){n&&t.stop(!0,!0)}},n.ReverseIfNecessary=function(t,i){var r=t.parents(".anim-slide-reverse").length>0;return r&&(i==n.DirectionLeft?i=n.DirectionRight:i==n.DirectionRight&&(i=n.DirectionLeft)),i},n.AnimationTime=500,n.DirectionLeft="left",n.DirectionRight="right",n}();n.Slides=t})(t=n.Animations||(n.Animations={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f,e){this._scope=n;this._searchPodSettings=t;this._combinedRoutesService=i;this._lowestFaresApiService=r;this._lowestFaresDataFlightFinder=u;this._routeDataFlightFinder=f;this._searchPodRouteDatesPreloader=e;this._scope.SubmitFlightSearch=this.SubmitFlightSearch.bind(this);this._scope.RouteDatePickerDrawerTitles=new Main3.RouteDatePicker.ReturnRouteDatePickerViewModel(this._searchPodSettings.DepartureDateDrawerTitle,this._searchPodSettings.ReturnDateDrawerTitle);this.ListenToEvents()}return t.prototype.ListenToEvents=function(){var t=this;this._scope.$on(n.Events.Names.RouteSearch.ChangeMade,this.RouteSearchChangeMade.bind(this));this._scope.$on(n.Events.Names.RouteSearch.SearchValid,this.OnRouteSearchValidation.bind(this,!0));this._scope.$on(n.Events.Names.RouteSearch.SearchInvalid,this.OnRouteSearchValidation.bind(this,!1));this._scope.$on(n.Events.Names.RouteDatePicker.SearchValid,this.ValidateSearchPassengers.bind(this));this._scope.$watch(function(n){return n.SearchPodModel?n.SearchPodModel.IsOneWayFlight:!1},function(n){return t.ResetReturnDate(n)})},t.prototype.ResetReturnDate=function(n){n&&(this._scope.SearchPodModel.ReturnDate=null)},t.prototype.SetSearchPodModel=function(n){var t=this;n===void 0&&(n=null);n||(n=this.BuildInitialSearchPodModel());this.SanitizeModel(n);this._scope.SearchPodModel=n;this._scope.$watch(function(){return t._scope.SearchPodModel.DepartureDate},function(){return t._searchPodRouteDatesPreloader.RouteSearchUpdated(t._scope.SearchPodModel)})},t.prototype.UpdateRoute=function(t,i){this._scope.SearchPodModel.OriginIata=t;this._scope.SearchPodModel.DestinationIata=i;this.SanitizeModel(this._scope.SearchPodModel);this._scope.$broadcast(n.Events.Names.RouteSearch.ResetRoute,this._scope.SearchPodModel.OriginIata,this._scope.SearchPodModel.DestinationIata)},t.prototype.BuildInitialSearchPodModel=function(){return null},t.prototype.FormAction=function(){},t.prototype.SanitizeModel=function(n){n.DestinationIata=this.ValidateDestinationIata(n.OriginIata,n.DestinationIata)},t.prototype.SubmitFlightSearch=function(){this.ValidateRouteSearch();this.ValidateWorldwideSearch();this._scope.searchPodForm.$valid&&this.FormAction()},t.prototype.ValidateWorldwideSearch=function(){this._validateAsWorldwide&&this._routeSearchValid&&(this.ValidateRouteDatePicker(),this.ValidateSearchPassengers())},t.prototype.ValidateDestinationIata=function(n,t){return this.IsValidRoute(n,t)?t:""},t.prototype.RouteSearchChangeMade=function(n,t){var f=this,u;this._scope.SearchPodModel.OriginIata=t.OriginIata;this._scope.SearchPodModel.DestinationIata=this.ValidateDestinationIata(t.OriginIata,t.DestinationIata);var i=this._combinedRoutesService.FindAirportByIata(this._scope.SearchPodModel.OriginIata,this._searchPodSettings.WorldwideMode),r=this._combinedRoutesService.FindAirportByIata(this._scope.SearchPodModel.DestinationIata,this._searchPodSettings.WorldwideMode),e=i&&r&&this._combinedRoutesService.IsWorldwideRoute(i.Iata,r.Iata);this.SetValidationMode(i,r,e,this._searchPodSettings.WorldwideMode);u=this._searchPodRouteDatesPreloader.RouteSearchUpdated(this._scope.SearchPodModel);u&&u.then(function(n){var t=n.length>0?n[0]:null,i=n.length>1?n[1]:null;f.CheckRouteDatesWithinSchedule(t,i)})},t.prototype.IsValidRoute=function(n,t){var i=this._combinedRoutesService.FindAirportByIata(n,this._searchPodSettings.WorldwideMode),r=this._combinedRoutesService.FindAirportByIata(t,this._searchPodSettings.WorldwideMode);return this._searchPodSettings.WorldwideMode&&i&&r?i&&this._combinedRoutesService.IsValidRouteForFilter(r,i,!0):i&&this._combinedRoutesService.IsValidRouteForFilter(i,r,!1)&&this._combinedRoutesService.IsValidRouteForPlatform(n,t,!1)},t.prototype.SetValidationMode=function(t,i,r,u){var f=!!t&&t.IsWorldwide,e=!!i&&i.IsWorldwide;this._validateAsWorldwide=u&&(f||e||r);this._scope.$broadcast(n.Events.Names.SearchPod.ValidateAsWorldwide,this._validateAsWorldwide)},t.prototype.OnRouteSearchValidation=function(n){this._routeSearchValid=n;this.ValidateRouteDatePicker()},t.prototype.ValidateRouteDatePicker=function(){this._scope.$broadcast(n.Events.Names.RouteDatePicker.Validate)},t.prototype.ValidateRouteSearch=function(){this._scope.$broadcast(n.Events.Names.RouteSearch.Validate)},t.prototype.ValidateSearchPassengers=function(){this.AreRouteDatesValid()&&(this._routeSearchValid||this._doesNotUseRouteSearch)&&this._scope.$broadcast(n.Events.Names.SearchPassengers.Validate)},t.prototype.AreRouteDatesValid=function(){return this._scope.SearchPodModel.IsOneWayFlight?this._scope.searchPodForm.DepartureDate.$valid:this._scope.searchPodForm.ReturnDate.$valid&&this._scope.searchPodForm.DepartureDate.$valid},t.prototype.CheckRouteDatesWithinSchedule=function(n,t){var i=n?this._routeDataFlightFinder.FirstAvailableFlight(n):null,r=t?this._routeDataFlightFinder.LastAvailableFlight(t):null;this.ResetDatesIfOutOfRangeOfRoutePair(i,r)},t.prototype.ResetDatesIfOutOfRangeOfRoutePair=function(n,t){if(n&&this._scope.SearchPodModel.DepartureDate&&this._scope.SearchPodModel.DepartureDate.ToSortable()<n.ToSortable()){this.ResetDates();return}if(!this._scope.SearchPodModel.IsOneWayFlight&&this._scope.SearchPodModel.ReturnDate&&(!t||this._scope.SearchPodModel.ReturnDate.ToSortable()>t.ToSortable())){this.ResetDates();return}},t.prototype.ResetDates=function(){this._scope.SearchPodModel.DepartureDate=null;this._scope.SearchPodModel.ReturnDate=null},t.prototype.IsMarketGroup=function(n){return n?n.IsMarketGroup:!0},t}();t.BaseSearchPodController=i})(i=t.SearchPod||(t.SearchPod={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s){o===void 0&&(o=null);s===void 0&&(s=null);var h=this;this.MaxDoRequestIterations=5;this._scope=t;this._availabilityService=i;this._routesService=r;this._syncedRefreshService=u;this._includeDisruptedFlights=f;this._includeLowestFareSeats=e;this._eResLanguageCode=o;this._availabilityCurrencyService=s;this._subscribers=[];this._scope.$on(n.Events.Names.AvailabilityFlightsProvider.RegisterSubscriber,this.AddSubscriber.bind(this));t.$watch(function(n){return n.IncludeFlexiFares},function(n,t){n!=null&&n!=t&&h.HasValidSubscribers()&&h.DoRequest(!0)});this.SetUpRefreshers();this._scope.$on("$destroy",function(){return h.RemoveRefresher()})}return t.prototype.HasValidSubscribers=function(){return this._subscribers&&this._subscribers.filter(function(n){return n.IsValid()}).length>0},t.prototype.SetUpRefreshers=function(){var t=this;this._refresher=new Main3.Refreshing.PeriodicRefresher(this,0,function(){return!t._scope.AutoRefreshDisabled});this._syncedRefreshService.RegisterPeriodicRefresher(this._refresher);this._scope.$on(n.Events.Names.AvailabilityFlightsProvider.ForceRefresh,this.ForceRefresh.bind(this))},t.prototype.ForceRefresh=function(n,t){t===void 0&&(t=!1);this.HasValidSubscribers()&&this.DoRequest(!0,t)},t.prototype.AddSubscriber=function(n,t){this._subscribers.push(t);n.targetScope.$on("$destroy",this.RemoveSubscriber.bind(this,t));t.SetRequestFlightsCallback(this.OnRequestFlights.bind(this));this._latestFlights&&this.LatestQueryAppliesToSubscriber(t)&&this.UpsertRelevantFlights(this._latestFlights,t)},t.prototype.LatestQueryAppliesToSubscriber=function(n){var t=n.CurrentAvailabilityParameters(),i=t.OriginIata,r=t.DestinationIata;t.IsReturnLeg&&(i=t.DestinationIata,r=t.OriginIata);var u=t.IsOneWayJourney===this.LatestQueryIsOneWayJourney(),f=this._routesService.IsIataInMarketGroup(i,this._latestQuery.DepartureIata),e=this._routesService.IsIataInMarketGroup(r,this._latestQuery.ArrivalIata),o=t.IsReturnLeg?this._latestQuery.MinReturnDate:this._latestQuery.MinDepartureDate,s=this.GetDateForQuery(t.IsReturnLeg,!0)===o,h=t.IsReturnLeg?this._latestQuery.MaxReturnDate:this._latestQuery.MaxDepartureDate,c=this.GetDateForQuery(t.IsReturnLeg,!1)===h;return u&&f&&e&&s&&c},t.prototype.LatestQueryIsOneWayJourney=function(){return!this._latestQuery.MinReturnDate&&!this._latestQuery.MaxReturnDate},t.prototype.RemoveSubscriber=function(n){this._subscribers=this._subscribers.filter(function(t){return t!=n})},t.prototype.RemoveRefresher=function(){this._syncedRefreshService.RemovePeriodicRefresher(this._refresher)},t.prototype.DoRequest=function(n,t,i,r){var f=this,u,e;if(t===void 0&&(t=!1),i===void 0&&(i=!1),r===void 0&&(r=1),r>this.MaxDoRequestIterations){console.error("Cancelling availability request due to too many repeated iterations");return}this._subscribers.forEach(function(t){return t.BeginUpsertFlights(n)});u={AdultSeats:this._scope.PassengerComposition.Adults,ChildSeats:this._scope.PassengerComposition.Children,Infants:this._scope.PassengerComposition.Infants,ArrivalIata:this.GetOutboundRoute().DestinationIata,DepartureIata:this.GetOutboundRoute().OriginIata,IncludeFlexiFares:this._scope.IncludeFlexiFares||i,IncludePrices:this._scope.IncludePrices,IsTransfer:!!this._scope.IsFlightTransfer,MinDepartureDate:this.GetDateForQuery(!1,!0),MaxDepartureDate:this.GetDateForQuery(!1,!1),MinReturnDate:this.GetDateForQuery(!0,!0),MaxReturnDate:this.GetDateForQuery(!0,!1),AdditionalSeats:0,IncludeLowestFareSeats:this._includeLowestFareSeats,IncludeAdminFees:this.IncludeAdminFees()};u.FlightNumbers=[];this.GetOutboundSelectedFlightNumber()&&u.FlightNumbers.push(this.GetOutboundSelectedFlightNumber());this.GetReturnSelectedFlightNumber()&&u.FlightNumbers.push(this.GetReturnSelectedFlightNumber());this._scope.IncludePrices&&(u.LanguageCode=this._eResLanguageCode,!this._availabilityCurrencyService||(e=this._availabilityCurrencyService.GetCurrencyCodeForAvailabilityRequest(),!e||(u.CurrencyCode=e)),this.IsAdditionalFlightQuery()&&(u.BaseCurrencyCode=this._availabilityCurrencyService.GetBaseCurrencyCodeForAvailabilityRequest()));this.PreOnAvailabilityQuery();this._availabilityService.FindGridFlights(u,function(e){f.RequestStillValid(u)?f._scope.$applyAsync(function(){f.PreOnAvailabilitySuccess(u,e.Flights,t);f.OnAvailabilitySuccess(u,e)}):(f.OnAvailabilityError(),f.DoRequest(n,t,i,r+1))},this.OnAvailabilityError.bind(this))},t.prototype.RequestStillValid=function(n){return n.FlightNumbers&&(this.GetOutboundSelectedFlightNumber()&&!_(n.FlightNumbers).contains(this.GetOutboundSelectedFlightNumber())||this.GetReturnSelectedFlightNumber()&&!_(n.FlightNumbers).contains(this.GetReturnSelectedFlightNumber()))?!1:!0},t.prototype.Refresh=function(){this.DoRequest(!1)},t.prototype.OnAvailabilitySuccess=function(n,t){var i=this;this._latestQuery=n;!this._availabilityCurrencyService||this._availabilityCurrencyService.GridFlightsRetrieved(t);this._latestFlights=t.Flights;this._subscribers.forEach(function(n){i.UpsertRelevantFlights(t.Flights,n)})},t.prototype.UpsertRelevantFlights=function(n,t){var i=t.CurrentAvailabilityParameters(),r=this.FilterFlights(n,i.OriginIata,i.DestinationIata);t.EndUpsertFlights(r)},t.prototype.FilterFlights=function(n,t,i){var r=this;return!n?[]:n.filter(function(n){return r._routesService.IsIataInMarketGroup(n.DepartureIata,t)&&r._routesService.IsIataInMarketGroup(n.ArrivalIata,i)}).filter(function(n){return r.RemoveDisruptedFlightsIfApplicable(n)})},t.prototype.RemoveDisruptedFlightsIfApplicable=function(n){return!n.IsDisrupted||this._includeDisruptedFlights},t.prototype.GetDateForQuery=function(n,t){var i,r,u;return n?(r=this.GetReturnRoute(),i=r?r.Date:null):i=this.GetOutboundRoute().Date,u=t?-1:1,i?i.AddDays(this._scope.DaysRequiredEachSideOfRouteDate*u).ToIso8601():null},t.prototype.OnRequestFlights=function(){this.DoRequest(!1)},t.prototype.IsAdditionalFlightQuery=function(){return!this.IncludeAdminFees()},t}();t.BaseAvailabilityProvider=i})(i=t.Availability||(t.Availability={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function i(n,t,i,r,u,f,e,o,s){this._$scope=n;this._routeSearchSettings=t;this._analyticsTracker=i;this._directRoutesOnlyService=r;this._isCountryDrawer=u;this._worldwideSettings=f;this._airportListDrawerAllRoutesService=e;this._searchAccessibilityService=o;this._combinedRoutesService=s;this._$parameters=n.Section.Options.Parameters;this._$parameters.FilterAirport=this.EnsureAirportHasWorldwideDataWhenNeeded(this._$parameters.FilterAirport);this._$scope.WorldwideMode=this._combinedRoutesService.WorldwideMode;this._$scope.AnalyticsCategory=this._$parameters.AnalyticsCategory==null?Tracking.EventConstants.Categories.BookingPod:this._$parameters.AnalyticsCategory;this._$scope.AnalyticsAction=this._$parameters.AnalyticsAction==null?"Route Search":this._$parameters.AnalyticsAction;this._$scope.DoAirportSelect=this.SelectAirport.bind(this);this._$scope.DoUnavailableAirportSelect=this.SelectUnavailableAirport.bind(this);this._$scope.IsSelectingOrigin=this._$parameters.IsOriginSelection;this._$scope.ShowDirectRoutesOnly=this._directRoutesOnlyService.GetCurrentShowDirectRoutesOnlyValue(this._$parameters.FilterAirport);this._$scope.ShowDirectRoutesOnlyCheckbox=!!this._$parameters.FilterAirport&&!this._combinedRoutesService.WorldwideMode;this._$scope.ShowAllRoutes=this._airportListDrawerAllRoutesService.GetCurrentShowAllRoutesValue();this._$scope.HasNoDirectRoutes=this.HasNoDirectRoutes.bind(this);this.WatchForDirectRouteOnlyChanges(this._$scope.AnalyticsCategory);this.WatchForAllRoutesChanges(this._$scope.AnalyticsCategory);this._$scope.FilterAirportName=this._$parameters.FilterAirport?this._$parameters.FilterAirport.Name:"";this._$scope.AirportWorldwideText=this._worldwideSettings?this._worldwideSettings.AirportWorldwideText:"";this._$scope.WorldwideMode=this._combinedRoutesService.WorldwideMode;this._$scope.ShowAsWorldwideAirport=this.ShowAsWorldwideAirport.bind(this)}return i.prototype.ShowAsWorldwideAirport=function(n){return this._combinedRoutesService.ShowAsWorldwideAirport(this._$scope.ShowAllRoutes,this._$parameters.FilterAirport,n)},i.prototype.IsExcludedAirport=function(n){return this._$parameters.ExcludedAirports&&_(this._$parameters.ExcludedAirports).any(function(t){return t.Iata===n.Iata})},i.prototype.EnsureAirportHasWorldwideDataWhenNeeded=function(n){return!!n&&this._combinedRoutesService.WorldwideMode?this._combinedRoutesService.FindAirportByIata(n.Iata,!0):n},i.prototype.WatchForDirectRouteOnlyChanges=function(n){var t=this;this._$scope.$watch(function(n){return n.ShowDirectRoutesOnly},function(i,r){i!==r&&(t.TrackChangeRoutesFilterChangeEvent(i,Tracking.EventConstants.Labels.NonValidRoutes,n),t._directRoutesOnlyService.SetShowDirectRoutesOnlyValue(i),t.OnDirectRouteOnlyChanged(i))})},i.prototype.WatchForAllRoutesChanges=function(n){var t=this;this._$scope.$watch(function(n){return n.ShowAllRoutes},function(i,r){i!==r&&(t.TrackChangeRoutesFilterChangeEvent(i,Tracking.EventConstants.Labels.AllRoutes,n),t.ScreenReaderAnnouncement(i),t._airportListDrawerAllRoutesService.SetShowAllRoutesValue(i),t.OnAllRoutesChanged(i))})},i.prototype.ScreenReaderAnnouncement=function(n){this._searchAccessibilityService.WorldwideShowAllIncludingWorlwideByEasyJet(n)},i.prototype.HasNoDirectRoutes=function(){return this._$parameters.FilterAirport?this.GetNumberOfValidAirports()===0:!1},i.prototype.SelectAirport=function(n){var t=this._combinedRoutesService.FindAirportByIata(n,this._$scope.WorldwideMode);(this._$parameters.IsOriginSelection?this._$parameters.SetOriginAirport(t,this._isCountryDrawer):this._$parameters.SetDestinationAirport(t,this._isCountryDrawer),this.AirportSelectionRequiresWorldwideDrawers(t))||this.CloseDrawers()},i.prototype.CloseDrawers=function(){this._$parameters.AfterSelectAction()},i.prototype.AirportSelectionRequiresWorldwideDrawers=function(n){var t=this._$parameters.IsOriginSelection?n:this._$parameters.FilterAirport,i=this._$parameters.IsOriginSelection?this._$parameters.FilterAirport:n;return!!t&&!!i&&this._combinedRoutesService.IsWorldwideRoute(t.Iata,i.Iata)&&(this.ThrowAlternativeRoutesDrawer(n)||this.ThrowWorldwideInformationDrawer(n))?!0:!1},i.prototype.ThrowAlternativeRoutesDrawer=function(n){var t=this._combinedRoutesService.HasNearbyRoutes(n,this._$parameters.FilterAirport,this._$parameters.IsOriginSelection);return t?(this.SelectUnavailableAirport(n.Iata),!0):!1},i.prototype.ThrowWorldwideInformationDrawer=function(t){var i=this._combinedRoutesService.GetConnectionTypeByFilterDirection(this._$parameters.IsOriginSelection,t.Iata,this._$parameters.FilterAirport),r;return n.Data.RouteSearch.ConnectionType.IsWorldwide(i)?(r={ConnectionType:i},n.Events.OpenDrawerWithOptions({SectionKey:"worldwide-information",ShowAfterActionComplete:!0,Parameters:r}),!0):!1},i.prototype.SelectUnavailableAirport=function(i){var r,u;if(this.OnUnavailableAirportSelected(i),r=this._combinedRoutesService.FindAirportByIata(i,this._$scope.WorldwideMode),this.IsExcludedAirport(r)){n.Events.OpenDrawerWithOptions({SectionKey:"routesearch-duplicate"});return}u={IsOriginSelection:this._$parameters.IsOriginSelection,FilterAirport:this._$parameters.FilterAirport,FromCountryDrawer:this._isCountryDrawer,UnavailableAirport:r,ExcludeMarketGroups:this._$parameters.ExcludeMarketGroups,AnalyticsCategory:this._$parameters.AnalyticsCategory,AnalyticsAction:this._$parameters.AnalyticsAction,AfterSelectAction:this._$parameters.AfterSelectAction,SetOriginAirport:this._$parameters.SetOriginAirport,SetDestinationAirport:this._$parameters.SetDestinationAirport};n.Events.OpenDrawerWithOptions({SectionKey:"routesearch-alternate-routes",Parameters:u,TitleOverride:t.AlternateRoutesDrawer.BuildDrawerTitle(this._routeSearchSettings,this._$parameters.FilterAirport,r,this._$parameters.IsOriginSelection)})},i.prototype.TrackChangeRoutesFilterChangeEvent=function(n,t,i){var r=i==null?Tracking.EventConstants.Categories.BookingPod:i,u=n?Tracking.EventConstants.Labels.Hide:Tracking.EventConstants.Labels.Show;this._analyticsTracker.TrackEvent(r,Tracking.EventConstants.Actions.Destination,u+" "+t)},i}();t.BaseAirportListDrawer=i})(i=t.RouteSearch||(t.RouteSearch={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u){this._scope=t;this._extraPanelStrategyService=i;this._analytics=r;this._extrasSmartMessagesService=u;this._scope.HasSelected=this.HasAnySelectedExtras.bind(this);this._scope.HasUnselected=this.HasAnyUnselectedExtras.bind(this);this._scope.IsLoading=this.IsLoading.bind(this);this._scope.RemoveExtraFromAvailablePanels=this.RemoveExtraFromAvailablePanels.bind(this);this._scope.Panels=[];this._validOverride=!1;this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this)}return t.prototype.BeforeFunnelReady=function(){},t.prototype.FunnelReady=function(){this.BeforeFunnelReady();this.GetExtraPanelsToDisplay();this.SetSmartMessages();this.HasNotSelectedAnyExtras()&&this.TrackPanelOrder(this._scope.Panels)},t.prototype.SetSmartMessages=function(){this._scope.TopSmartMessage=this._extrasSmartMessagesService.GetTopRowSmartMessage(this._scope.Panels)},t.prototype.IsValid=function(){return this.HasNoExtras()?!0:this.HasNotSelectedAnyExtras()?!1:this.HasSelectedAllExtras()?!0:(this.ShowSomeExtrasSelectedHelpingHandMessage(),this._validOverride=!0,!1)},t.prototype.ShowSomeExtrasSelectedHelpingHandMessage=function(){if(!this._validOverride){var t={IsALink:!0,Title:this.GetSomeSelectedHelpingHandText(),ButtonText:this.GetSomeSelectedHelpingHandButtonText(),ButtonEvent:this.SkipOverride.bind(this),ButtonEnabledWatch:function(){return!0}};n.Events.Fire(n.Events.Names.HelpingHand.ShowTextWithButton,t)}},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:this._validOverride}},t.prototype.GetExtraPanelsToDisplay=function(){var n=this,t=this.GetExtrasPanelsSettings();this._scope.Panels=t.map(function(t){return n.MapExtraPanelSettingsToExtraPanel(t)}).filter(function(n){return n.IsVisible})},t.prototype.RemoveExtraFromAvailablePanels=function(n){this._scope.Panels=this._scope.Panels.filter(function(t){return t.ExtraType!==n.ExtraType});this.SetSmartMessages()},t.prototype.SkipOverride=function(){this._analytics.TrackEvent(Tracking.EventConstants.Categories.Extras,Tracking.EventConstants.Actions.Skip,this.GetExtrasAsAnalyticsString(function(n){return n.IsSelected}));this._scope.$emit(n.Events.Names.Funnel.Skip)},t.prototype.TrackPanelOrder=function(){this._analytics.TrackEvent(Tracking.EventConstants.Categories.Extras,Tracking.EventConstants.Actions.PanelOrder,this.GetExtrasAsAnalyticsString())},t.prototype.GetExtrasAsAnalyticsString=function(n){n===void 0&&(n=function(){return!0});var t=this._scope.Panels.filter(n).map(function(n){return n.AnalyticsType}).join("|");return"{"+t+"}"},t.prototype.HasNoExtras=function(){return!this._scope.Panels||this._scope.Panels.length==0},t.prototype.HasNotSelectedAnyExtras=function(){return!this.HasAnySelectedExtras()},t.prototype.HasSelectedAllExtras=function(){return!this.HasAnyUnselectedExtras()},t.prototype.HasAnySelectedExtras=function(){return _(this._scope.Panels).some(function(n){return n.IsSelected})},t.prototype.HasAnyUnselectedExtras=function(){return _(this._scope.Panels).some(function(n){return!n.IsSelected})},t.prototype.IsLoading=function(){return _(this._scope.Panels).any(function(n){return n.IsLoading()})},t.prototype.TrackLinkDisplayed=function(n,t,i,r,u,f){t&&(!n||i)&&this._analytics.TrackEvent(r,"Show - "+u+" link",f)},t.prototype.MapExtraPanelSettingsToExtraPanel=function(n){if(!n)return null;var t=this._extraPanelStrategyService.GetStrategy(n.ExtraType),i=t?t.IsSelected():!1,r=t?t.IsVisible():!1,u=t?t.IsCtaVisible():!0,f=Tracking.EventConstants.Categories.Extras,e=i?Tracking.EventConstants.Actions.Change:Tracking.EventConstants.Actions.Add,o=n.AnalyticsType;return this.TrackLinkDisplayed(i,r,u,f,e,o),{Header:n.Header,Description:n.Description,AddButtonText:n.AddButtonText,AddButtonLink:n.AddButtonLink,AddButtonLinkedItemId:n.AddButtonLinkedItemId,SelectedHeader:n.SelectedHeader,SelectedButtonText:n.SelectedButtonText,ShowForFlexi:n.ShowForFlexi,ExtraType:n.ExtraType,ExtraImage:n.ExtraImage,ExtraHoverImage:n.ExtraHoverImage,ExtraImageAlternativeText:n.ExtraImageAlternativeText,IsSelected:i,IsVisible:r,Strategy:t,IsLoading:function(){return!1},AnalyticsType:o,GaCategory:f,GaAction:e,SmartMessageSettings:n.SmartMessageSettings,CtaVisible:u}},t}();t.BaseExtras=i})(i=t.SharedFunnel||(t.SharedFunnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t){this._registeredControls=[];this._baseScope=t;this._baseScope.$on(n.Events.Names.Funnel.RegisterFunnelControl,this.OnRegisterFunnelControl.bind(this))}return t.prototype.OnRegisterFunnelControl=function(n,t){t!=this&&this._registeredControls.indexOf(t)==-1&&(this._registeredControls.push(t),n.stopPropagation())},t.prototype.WatchForValid=function(n){var t=this;this._baseScope.$watch(function(){return t.AllControlsAreValid()},n)},t.prototype.AllControlsAreValid=function(){var n=!0;return this._registeredControls.forEach(function(t){t.IsValid()||(n=!1)}),n},t.$inject=["$scope"],t}();t.BaseFunnelControlContainer=i})(i=t.SharedFunnel||(t.SharedFunnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c){this._qService=t;this._scope=i;this._flightDataService=r;this._associationService=u;this._passengerService=f;this._tracker=e;this._drawerService=o;this._seatMapSettings=s;this._assignmentService=h;this._seatMapSameSeatService=c;this._saveDeferred=this._qService.defer();this._seatMapLoaded=!1;this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this);this._scope.$on(n.SeatMap.Events.SeatAssigned,this.OnSeatAssigned.bind(this));this._scope.$on(n.SeatMap.Events.Skip,this.Skip.bind(this));this._scope.RemoveSeatsFromClientAndServerBasketForFlight=this.RemoveSeatsFromClientAndServerBasketForFlight.bind(this)}return t.prototype.OverridesSaveBehaviour=function(){return this._flightDataService.ShouldLoadNext()},t.prototype.OverridesSkipBehaviour=function(){return!0},t.prototype.FunnelReady=function(){var t=this;this.ShouldExitFunnel()||this._flightDataService.IsLoaded().then(function(){n.Events.Fire(n.SeatMap.Events.UpdateHelpingHand);t.LoadNextSeatMap().then(function(){t._seatMapLoaded=!0;n.Events.Fire(n.Events.Names.HelpingHand.Focus)})})},t.prototype.IsValid=function(){return this._seatMapLoaded&&this._scope.IsValid()},t.prototype.UpdateSeatAssociationsInClientBasket=function(){var t=this.GetCurrentFlightInternalId(),n,i,r;for(this._associationService.ClearSeatsForFlight(t),n=0,i=this._seatAssignments||[];n<i.length;n++)r=i[n],this._associationService.SetSeatAssignment(t,r);this._associationService.AlertSeatsInBasketUpdated(t)},t.prototype.GetCurrentFlightInternalId=function(){return this._flightDataService.GetCurrentFlightData().FlightInternalId},t.prototype.Save=function(){return this.UpdateSeatAssociationsInClientBasket(),!!this._seatAssignments&&this._seatAssignments.length>0&&this._tracker.TrackEvent(Tracking.EventConstants.Categories.Seating,"ShowSeatMap","SelectSeats-Flight"+this._flightDataService.GetCurrentFlightIndex()),this.TrackSameSeatEvent(),this.LoadNextStep(!1),this._saveDeferred.promise},t.prototype.TrackSameSeatEvent=function(){if(this._seatMapSameSeatService.IsReturnFlight()&&this._seatMapSameSeatService.HasOutboundSeatsAssigned()){var n=void 0;n=this._seatMapSameSeatService.CanSelectSameSeats(this._scope.SeatMapRows,this._scope.Passengers)?"Available-"+(this._seatMapSameSeatService.HasSelectedSameSeats()?"Yes":"No"):"NotAvailable";this._tracker.TrackEvent(Tracking.EventConstants.Categories.Seating,"SameForReturn",n)}},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!0}},t.prototype.LoadNextSeatMap=function(){var n,t;return(this._seatMapLoaded=!1,n=this._flightDataService.GetCurrentFlightData(),!!n)?(this._passengers=this._passengerService.GetPassengers(n.FlightInternalId),t=this._associationService.GetFlightAssociationsForFlight(n.FlightInternalId).map(function(n){return{FlightInternalId:n.FlightInternalId,PassengerInternalId:n.PassengerInternalId,SeatNumber:n.Seat?n.Seat.SeatNumber:null}}),this._scope.LoadSeatMap(n,this._passengers,t)):this._qService.when()},t.prototype.LoadNextStep=function(t){var u=this,f=this._flightDataService.GetCurrentFlightData(),i=this._flightDataService.ShouldLoadNext(),e=!i&&t,r;if(e||(r=this.UpdateSeatAssociationsInServerBasket(f)),i){this._flightDataService.LoadNext();this._scope.$emit(n.Events.Names.Funnel.FunnelReady);return}t?this._scope.$emit(n.Events.Names.Funnel.ForceContinue):r.then(function(){u._saveDeferred.resolve()});this.BeforeLeavingStep()},t.prototype.OnSeatAssigned=function(n,t){this._seatAssignments=t;this.UpdateSeatAssociationsInClientBasket()},t.prototype.Skip=function(){return this.ShouldShowYouHaventSelectedAllSeatsDrawerForSkip()?this._drawerService.OpenYouHaventSelectedAllSeatsDrawer(!1,this.TryOpenSkipSeatSelectionDrawer.bind(this)):this.ShouldShowAreYouSureDrawerForSkip()?this._drawerService.OpenAreYouSureDrawer(!1,this.TryOpenSkipSeatSelectionDrawer.bind(this)):this.TryOpenSkipSeatSelectionDrawer(),this._qService.defer().promise},t.prototype.OpenSkipSeatSelectionDrawer=function(){var t=this,i={OnAccept:function(){t.SkipAndLoadNextStep();t._scope.$emit(n.Events.Names.Drawer.Close);t._tracker.TrackEvent(Tracking.EventConstants.Categories.Seating,Tracking.EventConstants.Actions.Click,Tracking.EventConstants.Labels.SeatSelectionSkipCurrent)},OnReject:function(){t._flightDataService.SetSkipAllFlights(!0);t._scope.$emit(n.Events.Names.Funnel.ForceContinue);t._tracker.TrackEvent(Tracking.EventConstants.Categories.Seating,Tracking.EventConstants.Actions.Click,Tracking.EventConstants.Labels.SeatSelectionSkipAll)},StyleSecondButtonAsDismissOption:!1};n.Events.OpenDrawerWithOptions({SectionKey:"skip-seat-selection-drawer",Parameters:i})},t.prototype.ShouldShowSkipSeatSelectionDrawer=function(){return this._flightDataService.GetRemainingFlightDataCount()>1},t.prototype.TryOpenSkipSeatSelectionDrawer=function(){this.ShouldShowSkipSeatSelectionDrawer()?this.OpenSkipSeatSelectionDrawer():(this.SkipAndLoadNextStep(),this._scope.$emit(n.Events.Names.Drawer.Close))},t.prototype.SkipAndLoadNextStep=function(){var n=this._flightDataService.GetCurrentFlightData().FlightInternalId;this._associationService.ClearSeatsForFlight(n);this._assignmentService.Clear();this._tracker.TrackEvent(Tracking.EventConstants.Categories.Seating,"ShowSeatMap","Skip-Flight"+this._flightDataService.GetCurrentFlightIndex());this.LoadNextStep(!0)},t.prototype.RemoveSeatsFromClientAndServerBasketForFlight=function(n){this._associationService.ClearSeatsForFlight(n);var t=this._flightDataService.GetFlightDataForFlightInternalId(n);this.UpdateSeatAssociationsInServerBasket(t)},t}();t.BaseSeatMap=i})(i=t.SharedFunnel||(t.SharedFunnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(t){function i(i,r,u,f,e,o){var s=t.call(this,u)||this;return s._qService=i,s._rootScope=r,s._scope=u,s._funnelJourneyService=f,s._analyticsTracker=e,s._scope.IsLoading=!0,s._scope.$emit(n.Events.Names.HelpingHand.PreventInitialReset),o.ready(s.Initialise.bind(s)),s}return __extends(i,t),i.prototype.Initialise=function(){var t=this;this._scope.$on(n.Events.Names.Funnel.Continue,function(){return t.OnContinue(!1)});this._scope.$on(n.Events.Names.Funnel.ForceContinue,function(){return t.OnContinue(!0)});this._scope.$on(n.Events.Names.Funnel.Skip,this.SkipClick.bind(this,null,!0));this._scope.$on(n.Events.Names.Funnel.FunnelReady,this.OnFunnelReady.bind(this));this._scope.$on(n.Events.Names.Funnel.SetLoading,this.SetLoading.bind(this));this._scope.$on(n.Events.Names.Account.DeprecatedSignInStatusChanged,this.OnSignInStatusChanged.bind(this));this._scope.$on(n.Events.Names.Page.LoadedFromCache,function(){n.Services.Common.ErrorService.IsExiting=!0;window.location.reload()});this.RemoveMarginBottomIfApplicable();this.Initialised()},i.prototype.OnSignInStatusChanged=function(n,t,i){i&&!t&&(this._scope.IsLoading=!0,this.DoExit("Step - Sign out"))},i.prototype.RemoveMarginBottomIfApplicable=function(){var n=this._registeredControls.filter(function(n){return n.GetFunnelControlSettings().EnsureNoMarginBottom}).length>0;n&&(this._scope.FunnelStepAdditionalWrapperCssClass="no-margin-bottom")},i.prototype.ContinueClick=function(){this.OnContinue()},i.prototype.OnContinue=function(n){var i=this,r,t;n===void 0&&(n=!1);(this._isValid||n)&&(r=this.ControlOverridingSaveBehaviour(),t=[],this._registeredControls.forEach(function(n){if(typeof n.Save=="function"){var i=n.Save();!i||t.push(i)}}),r||(this.BeforeContinue(),this._scope.IsLoading=!0,this._qService.all(t).then(function(){return i.ContinueToNextStep()}).catch(function(){return i._scope.IsLoading=!1})))},i.prototype.ControlOverridingSaveBehaviour=function(){return this._registeredControls.filter(function(n){return!!n.OverridesSaveBehaviour&&n.OverridesSaveBehaviour()}).length>0},i.prototype.ContinueToNextStep=function(){window.location.href=this.GetContinueUrl()},i.prototype.SkipClick=function(n,t){var r=this,u,i,f;t===void 0&&(t=!0);u=this.ControlOverridingSkipBehaviour();i=[];this._registeredControls.forEach(function(n){if(typeof n.Skip=="function"){var t=n.Skip();t&&i.push(t)}});u||(f=this.BeforeSkip(),this._scope.IsLoading=!0,this._qService.all(i).then(function(){return f?null:r.SkipToNextStep(t)}).catch(function(){return r._scope.IsLoading=!1}))},i.prototype.ControlOverridingSkipBehaviour=function(){return this._registeredControls.filter(function(n){return!!n.OverridesSkipBehaviour&&n.OverridesSkipBehaviour()}).length>0},i.prototype.SkipToNextStep=function(n){n===void 0&&(n=!0);var t=this.GetSkipUrl();n?this._analyticsTracker.TrackEventAndNavigateToUrl(this._funnelJourneyService.GetCurrentStepInJourney().SkipLinkAnalyticsCategory,Tracking.EventConstants.Actions.Skip,window.location.pathname,t):window.location.href=t},i.prototype.OnFunnelReady=function(){if(this.ShouldExitFunnel()){this.DoExit("Step - ShouldExitFunnel = true");return}var n=this.GetFirstOnLoadRedirect();if(!!n){!n.AdditionalAction||n.AdditionalAction();this._analyticsTracker.TrackEventAndNavigateToUrl(n.EventCategory,n.EventAction,n.EventLabel,n.TargetUrl);return}this.SetBasketOnRegisteredControls();this.WatchForControlsValidity();this.InitializeBasketContinueButtonAndWatchForStateChange();this.FunnelReady();this._scope.IsLoading=!1},i.prototype.SetBasketOnRegisteredControls=function(){this._registeredControls.forEach(function(n){n.FunnelReady()})},i.prototype.WatchForControlsValidity=function(){var t=this,i=function(i){t._isValid=i;t.UpdateHelpingHandForControlsValidity(i);n.Events.Fire(n.Events.Names.Funnel.StepValidityChanged,i)};this.WatchForValid(i)},i.prototype.UpdateHelpingHandForControlsValidity=function(t){var i;this.ShouldUpdateHelpingHand()&&(t?(i={Title:this._funnelJourneyService.GetCurrentStepInJourney().HelpingHandContinueText,ButtonText:this._funnelJourneyService.GetCurrentStepInJourney().HelpingHandContinueButtonText,ButtonEvent:this.ContinueClick.bind(this),ButtonEnabledWatch:this.ContinueButtonEnabled.bind(this)},n.Events.Fire(n.Events.Names.HelpingHand.ShowTextWithButton,i)):!t&&this._funnelJourneyService.GetCurrentStepInJourney().HelpingHandSkipEnabled?(i={Title:this._funnelJourneyService.GetCurrentStepInJourney().HelpingHandSkipText,ButtonText:this._funnelJourneyService.GetCurrentStepInJourney().HelpingHandSkipButtonText,ButtonEvent:this.SkipClick.bind(this),ButtonEnabledWatch:function(){return!0},IsALink:!0},n.Events.Fire(n.Events.Names.HelpingHand.ShowTextWithButton,i)):n.Events.Fire(n.Events.Names.HelpingHand.Reset))},i.prototype.InitializeBasketContinueButtonAndWatchForStateChange=function(){var i=this,t=this._funnelJourneyService.GetCurrentStepInJourney(),r;!t||(r={ControlVisible:t.ShowContinueButtonInBasket,ShowContinueButton:function(){return i.AllControlsAreValid()||!t.AllowSkipButtonInBasket},ShowSkipButton:function(){return!i.AllControlsAreValid()&&t.AllowSkipButtonInBasket},ContinueButtonEnabled:this.ContinueButtonEnabled.bind(this),ContinueButtonEvent:this.ContinueClick.bind(this),SkipButtonEvent:this.SkipClick.bind(this),ContinueButtonText:t.HelpingHandContinueButtonText,SkipButtonText:t.HelpingHandSkipButtonText},n.Events.Fire(n.Events.Names.Basket.InitializeContinueButton,r))},i.prototype.ContinueButtonEnabled=function(){return!this.HasPendingApiRequests()&&this.AllControlsAreValid()},i.prototype.ShouldExitFunnel=function(){return this._registeredControls.filter(function(n){return n.ShouldExitFunnel()}).length>0},i.prototype.GetFirstOnLoadRedirect=function(){for(var i,r,n=0,t=this._registeredControls;n<t.length;n++)if(i=t[n],!!i.GetStepOnLoadRedirect&&(r=i.GetStepOnLoadRedirect(),!!r))return r;return null},i.prototype.ShouldUpdateHelpingHand=function(){var n=this._registeredControls.filter(function(n){return n.GetFunnelControlSettings().PreventHelpingHandUpdateOnValid}).length>0;return!n},i.prototype.SetLoading=function(n,t){this._scope.IsLoading=t},i}(t.BaseFunnelControlContainer);t.BaseStep=i})(i=t.SharedFunnel||(t.SharedFunnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r){this._baseScope=t;this._softLogInCookieService=i;this._navigationService=r;this._baseScope.IsLoading=!0;this._baseScope.$on(n.Events.Names.Page.LoadedFromCache,function(){n.Services.Common.ErrorService.IsExiting=!0;window.location.reload()});this._baseScope.$on(n.Events.Names.Account.SignInStatusChanged,this.OnSignInStatusChanged.bind(this))}return t.prototype.OnSignInStatusChanged=function(t,i,r){if(i===n.Data.Account.SignedInStatus.SignedIn||i===n.Data.Account.SignedInStatus.PassengerSignIn)this.OnSignInConfirmed(i);else if(r===n.Data.Account.SignedInStatus.SignedIn||r===n.Data.Account.SignedInStatus.PassengerSignIn||r===n.Data.Account.SignedInStatus.SoftSignedIn)this._softLogInCookieService.HasCookie()&&this._softLogInCookieService.RemoveCookie(),this.RedirectToHomePage();else{this._baseScope.IsLoading=!0;var u={AfterSignIn:function(){n.Events.Fire(n.Events.Names.Drawer.Close)},UserInitiatedSignIn:!1},f={SectionKey:"sign-in",PreventDismissOverride:!0,Parameters:u};n.Events.QueueDrawerWithOptions(f)}},t.prototype.RedirectToHomePage=function(){this._navigationService.NavigateTo("/")},t}();t.BaseAccountController=i})(i=t.Account||(t.Account={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u){this._scope=t;this._accountService=i;this._clientSettings=r;this._errorService=u;this._scope.SecondsRemaining=this._clientSettings.ExpirySettings.MessageSeconds;this._scope.$on(n.Events.Names.DrawerSection.Shown,this.StartCountdown.bind(this));this._scope.$on(n.Events.Names.DrawerSection.Hidden,this.StopCountdown.bind(this));this._scope.$on(n.Events.Names.Drawer.Dismissed,this.ManualKeepAlive.bind(this));this._scope.DoKeepAlive=this.ManualKeepAlive.bind(this)}return t.prototype.StartCountdown=function(){var n=this;this._scope.SecondsRemaining=this._clientSettings.ExpirySettings.MessageSeconds;this._countdownStart=Utilities.ZonelessDateTime.NowLocal();this._countdownIntervalId=setInterval(function(){n.CountdownInterval()},500)},t.prototype.StopCountdown=function(){this._countdownIntervalId&&clearInterval(this._countdownIntervalId)},t.prototype.ManualKeepAlive=function(){n.Services.Account.AccountService.HasExpiresCookie()?this._accountService.RefreshExpiry(this._clientSettings.SignInSettings.KeepMeSignedInMinutes,this.RefreshExpirySuccess.bind(this),this.RefreshExpiryError.bind(this)):(this._scope.$emit(n.Events.Names.Account.ResetExpiryTimer,!0),this._scope.$emit(n.Events.Names.Drawer.Back))},t.prototype.RefreshExpirySuccess=function(){this._scope.$emit(n.Events.Names.Account.ResetExpiryTimer,!0);this._scope.$emit(n.Events.Names.Drawer.Back)},t.prototype.RefreshExpiryError=function(){this._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Account,Tracking.EventConstants.GenericErrorDrawerLabels.RefreshExpiry)},t.prototype.CountdownInterval=function(){var i=Utilities.ZonelessDateTime.NowLocal().Difference(this._countdownStart,Utilities.ZonelessDateTimePart.Seconds),t=Math.round(this._clientSettings.ExpirySettings.MessageSeconds-i);t<0?(this.StopCountdown(),this._accountService.SignOut(),this._scope.$emit(n.Events.Names.Drawer.Close)):this._scope.$applyAsync(function(n){n.SecondsRemaining=t})},t.ControllerName="Account_Expiry",t.$inject=["$scope","Account_Service","Sitecore_AccountClientSettings","Error_Service"],t}();t.Expiry=i})(i=t.Account||(t.Account={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.ControllerName="Account_ExpiryTimerTrigger",n.$inject=["Account_LoginExpiryTimer"],n}();n.ExpiryTimerTrigger=t})(t=n.Account||(n.Account={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(i,r,u,f,e,o){var s=t.call(this,i,u,o)||this;return s._accountService=f,s._tracker=e,i.DoLinkClick=s.OnLinkClick.bind(s),i.DoSignOutClick=function(){s._tracker.TrackEventAndExecuteCallback(Tracking.EventConstants.Categories.Account,Tracking.EventConstants.Actions.SignInStatus,Tracking.EventConstants.Labels.SignOut,function(){return s._accountService.SignOut(function(){return n.Events.Fire(n.Events.Names.Drawer.Close)})})},s}return __extends(i,t),i.prototype.OnLinkClick=function(t,i,r){var f=this,u;i&&!this._accountService.IsSignedIn()?(u={SectionKey:"sign-in",Parameters:{AfterSignIn:function(){return f.TrackAndNavigateTo(t,r)},UserInitiatedSignIn:!0}},n.Events.OpenDrawerWithOptions(u)):this.TrackAndNavigateTo(t,r)},i.prototype.OnSignInConfirmed=function(){},i.prototype.TrackAndNavigateTo=function(n,t){this._tracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.Navigation,Tracking.EventConstants.Actions.Redirect,t,n)},i.ControllerName="Account_MyAccountDrawer",i.$inject=["$scope","$location","CommercialSoftLogInCookie_Service","Account_Service","IAnalyticsTracker","Common_NavigationService"],i}(t.Account.BaseAccountController);i.MyAccountDrawerController=r})(i=t.Account||(t.Account={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r){this._scope=t;this._navigationService=i;this._accountService=r;this._parameters=this._scope.Section.Options.Parameters||{};t.SignIn=this.SignIn.bind(this);t.$on(n.Events.Names.Account.SignInDrawer.InitializePassengerSignIn,this.InitializeForm.bind(this));this.InitializeForm()}return t.prototype.InitializeForm=function(){this._scope.BookingReference=this._parameters.BookingReference||"";this._scope.Permission=!1;this._scope.ShowErrorMessage=!1;this._scope.Surname=this._parameters.Surname||"";this._scope.PassengerSignInForm&&(this._scope.PassengerSignInForm.$setPristine(),this._scope.PassengerSignInForm.$setUntouched())},t.prototype.ReplaceUrlTokens=function(n){return n.replace(t.BookingReferenceReplacementToken,this._scope.BookingReference).replace(t.SurnameReplacementToken,this._scope.Surname)},t.prototype.SignIn=function(){var n=this;(this._scope.PassengerSignInForm.$setSubmitted(),this._scope.ShowErrorMessage=!1,this._scope.RedirectUrl)&&this._scope.PassengerSignInForm.$valid&&(this._scope.ShowSignInSpinner=!0,this._accountService.PassengerLogin(this._scope.Surname,this._scope.BookingReference).then(function(){n._scope.ShowSignInSpinner=!1;var t=n.ReplaceUrlTokens(n._scope.RedirectUrl);n._navigationService.NavigateTo(t)}).catch(function(){n._scope.ShowSignInSpinner=!1;n._scope.ShowErrorMessage=!0}))},t.ControllerName="Account_PassengerSignIn",t.$inject=["$scope","Common_NavigationService","Account_Service"],t.BookingReferenceReplacementToken="%7Bbooking_reference%7D",t.SurnameReplacementToken="%7Bsurname%7D",t}();t.PassengerSignInController=i})(i=t.Account||(t.Account={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f){this._scope=n;this._window=t;this._formModel=i;this._accountApi=r;this._navigationService=u;this._errorService=f;this._scope.CanSubmit=this.CanSubmit.bind(this);this._scope.Submit=this.Submit.bind(this)}return t.prototype.CanSubmit=function(){return this._scope.RequestResetPasswordForm.$valid},t.prototype.Submit=function(){this.CanSubmit()?this._accountApi.RequestResetPassword(this._scope.Email,this.OnRequestSuccess.bind(this),this.OnRequestFailed.bind(this)):this._scope.$broadcast(n.Events.Names.Validation.Validate)},t.prototype.OnRequestSuccess=function(){var t=this,i={EmailAddress:this._scope.Email,OnButtonClick:function(){t._navigationService.NavigateTo(t._formModel.SuccessUrl)}};n.Events.OpenDrawerWithOptions({SectionKey:"reset-sent",Parameters:i})},t.prototype.OnRequestFailed=function(n,t,i){this._errorService.HandleApiError(n,t,i)},t.ControllerName="Account_RequestResetPasswordForm",t.$inject=["$scope","$window","Sitecore_RequestResetPasswordFormModel","Account_Api","Common_NavigationService","Error_Service"],t}();t.RequestResetPasswordForm=i})(i=t.Account||(t.Account={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f,e){this._scope=n;this._window=t;this._formModel=i;this._accountApi=r;this._navigationService=u;this._errorService=f;this._analytics=e;this._scope.CanSubmit=this.CanSubmit.bind(this);this._scope.Submit=this.Submit.bind(this);this._scope.Cancel=this.Cancel.bind(this)}return t.prototype.CanSubmit=function(){return this._scope.ResetPasswordForm.$valid&&!!this.GetTokenFromQueryString()},t.prototype.Submit=function(){if(this.CanSubmit()){this._analytics.TrackEvent(Tracking.EventConstants.Categories.ResetPassword,Tracking.EventConstants.Actions.ResetPassword,Tracking.EventConstants.Labels.Continue);var t={Token:this.GetTokenFromQueryString(),NewPassword:this._scope.FirstPassword};this._accountApi.ResetPassword(t,this.OnResetSuccess.bind(this),this.OnResetFailed.bind(this))}else this._scope.$broadcast(n.Events.Names.Validation.Validate)},t.prototype.OnResetSuccess=function(){this._navigationService.NavigateTo(this._formModel.SuccessUrl)},t.prototype.OnResetFailed=function(t,i,r){r===n.Data.Rebooking.KnownError.ResetPasswordBadToken?this._navigationService.NavigateTo(this._formModel.BadTokenUrl):this._errorService.HandleApiError(t,i,r)},t.prototype.GetTokenFromQueryString=function(){if(!!this._formModel.TokenQueryStringKey){var n=new Urls.QueryString(this._window.location.href);return n.GetParameter(this._formModel.TokenQueryStringKey,!0)}return null},t.prototype.Cancel=function(){this._analytics.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.ResetPassword,Tracking.EventConstants.Actions.CancelResetPassword,Tracking.EventConstants.Labels.Continue,this._formModel.CancelLinkUrl)},t.ControllerName="Account_ResetPasswordForm",t.$inject=["$scope","$window","Sitecore_ResetPasswordFormModel","Account_Api","Common_NavigationService","Error_Service","IAnalyticsTracker"],t}();t.ResetPasswordForm=i})(i=t.Account||(t.Account={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u){this._scope=n;this._accountApi=t;this._errorService=i;this._analytics=r;this._softLogInCookieService=u;this._scope.CanSubmit=this.CanSubmit.bind(this);this._scope.Submit=this.Submit.bind(this);this._analytics.TrackEvent(Tracking.EventConstants.Categories.ResetPasswordDrawer,Tracking.EventConstants.Actions.ResetPasswordDrawer,Tracking.EventConstants.Labels.DrawerOpened);var f=this._scope.Section.Options.Parameters;this._scope.Email=f.EmailAddress;this.InitializeForm()}return t.prototype.InitializeForm=function(){var n=this._softLogInCookieService.GetCookie();!n||!n.UserName||(this._scope.Email=n.UserName)},t.prototype.CanSubmit=function(){return this._scope.RequestResetPasswordForm.$valid},t.prototype.Submit=function(){this.CanSubmit()?(this._analytics.TrackEvent(Tracking.EventConstants.Categories.ResetPasswordDrawer,Tracking.EventConstants.Actions.ResetPasswordDrawer,Tracking.EventConstants.Labels.Submit),this._accountApi.RequestResetPassword(this._scope.Email,this.OnRequestSuccess.bind(this),this.OnRequestFailed.bind(this))):this._scope.$broadcast(n.Events.Names.Validation.Validate)},t.prototype.OnRequestSuccess=function(){var t={EmailAddress:this._scope.Email,OnButtonClick:function(){n.Events.Fire(n.Events.Names.Drawer.Close)}};n.Events.OpenDrawerWithOptions({SectionKey:"reset-sent-drawer",Parameters:t})},t.prototype.OnRequestFailed=function(n,t,i){this._errorService.HandleApiError(n,t,i)},t.ControllerName="Account_ResetPasswordFormDrawer",t.$inject=["$scope","Account_Api","Error_Service","IAnalyticsTracker","CommercialSoftLogInCookie_Service"],t}();t.ResetPasswordFormDrawer=i})(i=t.Account||(t.Account={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._scope=n;var t=this._scope.Section.Options.Parameters;this._scope.Email=t.EmailAddress;this._scope.ButtonClick=t.OnButtonClick}return n.ControllerName="Account_ResetPasswordSentDrawer",n.$inject=["$scope"],n}();n.ResetPasswordSentDrawer=t})(t=n.Account||(n.Account={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i){var r=this;this._scope=t;this._pageHeaderSettings=i;t.PassengerSignInType=n.Data.Account.SignInType.Passenger;t.RegisteredUserSignInType=n.Data.Account.SignInType.RegisteredUser;t.SignInType=n.Data.Account.SignInType.RegisteredUser;t.ShowSignInSpinner=!0;t.HideExtraDetails=i.HideSignInExtraDetails;t.IsPassengerSignIn=this.IsPassengerSignIn.bind(this);t.IsRegisteredUserSignIn=this.IsRegisteredUserSignIn.bind(this);t.$emit(n.Events.Names.TouchScroll.DisableObserverForScrollHeightChanges);t.HideExtraDetails||t.$watch("SignInType",function(){t.$emit(n.Events.Names.TouchScroll.Reset);r.IsRegisteredUserSignIn()?(t.$emit(n.Events.Names.Account.SignInDrawer.SignInTypeChanged,t.RegisteredSignInDescription),t.$emit(n.Events.Names.Account.SignInDrawer.InitializeRegisteredUserSignIn)):r.IsPassengerSignIn()&&(t.$emit(n.Events.Names.Account.SignInDrawer.SignInTypeChanged,t.PassengerSignInDescription),t.$emit(n.Events.Names.Account.SignInDrawer.InitializePassengerSignIn))})}return t.prototype.IsPassengerSignIn=function(){return this._scope.SignInType===n.Data.Account.SignInType.Passenger},t.prototype.IsRegisteredUserSignIn=function(){return this._scope.SignInType===n.Data.Account.SignInType.RegisteredUser},t.ControllerName="Account_SignInDrawer",t.$inject=["$scope","Sitecore_PageHeaderSettings"],t}();t.SignInDrawerController=i})(i=t.Account||(t.Account={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o){this._rootScope=t;this._scope=i;this._accountService=r;this._tracking=u;this._errorService=f;this._softLogInCookieService=e;this._accountClientSettings=o;this._parameters=this._scope.Section.Options.Parameters||{};this._scope.SignInErrorValues=n.Data.Account.SignInErrorResult;this._scope.DoSignIn=this.OnSignIn.bind(this);this._scope.DoForgottenPassword=this.OnForgottenPassword.bind(this);this._scope.SetAsAutoFilled=this.AutoFilled.bind(this);this._scope.SetAsNotAutoFilled=this.NotAutoFilled.bind(this);this._scope.$on(n.Events.Names.Account.SignInDrawer.InitializeRegisteredUserSignIn,this.InitializeForm.bind(this));this._rootScope.$on(n.Events.Names.Funnel.SignUpMemberExists,this.OnSignUpFailure.bind(this));this.InitializeForm()}return t.prototype.DisplayMemberExistsError=function(t){this._scope.SignInErrorResult=n.Data.Account.SignInErrorResult.AccountAlreadyExists;t&&(this._scope.Username=t)},t.prototype.HandleAccessibleInputValidationErrors=function(){var n=this;this._scope.ShowEmailError=!1;this._scope.ShowPasswordError=!1;setTimeout(function(){n._scope.ShowEmailError=!0;n._scope.ShowPasswordError=!0;n._scope.$apply()})},t.prototype.InitializeForm=function(){if(this._scope.Username="",this._scope.Password="",this._scope.ShowSignInSpinner=!1,this._scope.KeepMeSignedIn=!0,this._scope.SignInErrorResult=n.Data.Account.SignInErrorResult.None,this._scope.FormSubmitted=!1,this._scope.ShowEmailError=!0,this._scope.ShowPasswordError=!0,this._scope.FormAutoFilled=!1,this._parameters.PreFillDynamicMessage&&(this._scope.DynamicErrorMessage=this._parameters.PreFillDynamicMessage),this._parameters.PreFillUsername)this._scope.Username=this._parameters.PreFillUsername;else{var t=this._softLogInCookieService.GetCookie();!t||!t.UserName||(this._scope.Username=t.UserName)}this._parameters.DisplayMemberExistsError&&this.DisplayMemberExistsError()},t.prototype.OnLogInError=function(t,i,r){this._scope.ShowSignInSpinner=!1;this._scope.FormSubmitted=!1;this._scope.Password=null;t==401?this._scope.SignInErrorResult=n.Data.Account.SignInErrorResult.IncorrectPassword:r==n.Data.Rebooking.KnownError.MemberPasswordIncorrect?this._scope.SignInErrorResult=n.Data.Account.SignInErrorResult.IncorrectPassword:r==n.Data.Rebooking.KnownError.MemberEmailDoesNotExist?this._scope.SignInErrorResult=n.Data.Account.SignInErrorResult.IncorrectEmail:r==n.Data.Rebooking.KnownError.MemberAccountLocked?this._scope.SignInErrorResult=n.Data.Account.SignInErrorResult.AccountLocked:this._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Account,Tracking.EventConstants.GenericErrorDrawerLabels.Login)},t.prototype.OnLogInSuccess=function(){this._scope.FormSubmitted=!1;this._scope.ShowSignInSpinner=!1;this._scope.SignInErrorResult=n.Data.Account.SignInErrorResult.None;var t=this._scope.KeepMeSignedIn?"Yes":"No";this._tracking.TrackEvent("DA - Signin","Member","Keep me signed in | "+t);this._parameters.UserInitiatedSignIn&&this._scope.SignInSuccessUrl&&(this._scope.SignInSuccessTarget?window.open(this._scope.SignInSuccessUrl,this._scope.SignInSuccessTarget):window.location.href=this._scope.SignInSuccessUrl);this._parameters.AfterSignIn?this._parameters.AfterSignIn(this._scope):n.Events.Fire(n.Events.Names.Drawer.Close)},t.prototype.OnSignIn=function(){this._scope.FormSubmitted=!0;this._scope.SignInForm.$valid?(this.ResetErrorStates(!0),this._scope.ShowSignInSpinner=!0,this._accountService.LogIn(this._scope.Username,this._scope.Password,this.OnLogInSuccess.bind(this),this.OnLogInError.bind(this),this._scope.KeepMeSignedIn,this._accountClientSettings.SignInSettings.KeepMeSignedInMinutes)):this.HandleAccessibleInputValidationErrors()},t.prototype.OnForgottenPassword=function(){var t={EmailAddress:this._scope.Username};n.Events.OpenDrawerWithOptions({SectionKey:"reset-password-form-drawer",Parameters:t})},t.prototype.OnSignUpFailure=function(n,t){this.ResetErrorStates(!1);this._scope.Password=undefined;this.DisplayMemberExistsError(t)},t.prototype.ResetErrorStates=function(t){this._scope.FormSubmitted=t;this._scope.SignInErrorResult=n.Data.Account.SignInErrorResult.None;this._scope.DynamicErrorMessage=""},t.prototype.AutoFilled=function(){this._scope.FormAutoFilled=!0},t.prototype.NotAutoFilled=function(){this._scope.FormAutoFilled=!1},t.ControllerName="Account_SignInForm",t.$inject=["$rootScope","$scope","Account_Service","IAnalyticsTracker","Error_Service","CommercialSoftLogInCookie_Service","Sitecore_AccountClientSettings"],t}();t.SignInForm=i})(i=t.Account||(t.Account={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r){var f=this,u;this._accountService=r;this._rootScope=t;this._scope=i;this._scope.SignUpNewUser=this.SignUpNewUser.bind(this);this._scope.ShowSignUpSpinner=!1;u=this._scope.Section.Options.Parameters;u.PreFillUsername&&(this._scope.Username=u.PreFillUsername);this._rootScope.$on(n.Events.Names.Funnel.SignUpMemberExists,function(){f._scope.ShowSignUpSpinner=!1})}return t.prototype.SignUpNewUser=function(){this._scope.FormSubmitted=!0;this._scope.SignUpForm.$valid&&(this._scope.ShowSignUpSpinner=!0,this._rootScope.$broadcast(n.Events.Names.Funnel.SignUpContinue,this._scope.Username))},t.ControllerName="Account_SignUpForm",t.$inject=["$rootScope","$scope","Account_Service"],t}();t.SignUpForm=i})(i=t.Account||(t.Account={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f,e,o,s){var h=this;this._scope=n;this._routesData=t;this._navigationService=i;this._browserDetectionService=r;this._tokenReplacementService=u;this._carsService=f;this._carAncillarySettings=e;this._bookingDataService=o;this._carCategoriserService=s;this._passengerAge=26;this._routesService=new Main3.Routes.RoutesService(t);this._scope.ViewCarClass=this.ViewCarClass.bind(this);this._bookingDataService.DataPromise.then(function(n){h._booking=n;h.GetCarList()})}return t.prototype.ViewCarClass=function(n){var t=this._scope.DeeplinkUrl+"&ACRISS="+n.CategoryCode;this._navigationService.NavigateTo(t,!0)},t.prototype.GetCarList=function(){!this._booking||this._booking.AddedAncillaries.indexOf(n.Data.Funnel.AncillaryType.Car)!==-1||(this.SetCarUrl(),this.SetCarList())},t.prototype.SetCarUrl=function(){var t=this,n=this._carAncillarySettings,i=this.GetScreenSizeSpecificDeepLink(this._carAncillarySettings);this._tokenReplacementService.ReplaceDeepLinkUrlTokens(this._booking,i,n.DateFormat,n.TimeFormat).then(function(n){t._scope.DeeplinkUrl=n})},t.prototype.SetCarList=function(){var n=this._carsService.GetCurrentSearchQuery(this._passengerAge,this._booking);this._scope.Destination=n.DropOffLocationName;this._carsService.GetCarList(n).then(this.LoadCarsSuccess.bind(this)).catch(this.LoadCarsError.bind(this))},t.prototype.LoadCarsSuccess=function(n){var r=n.Cars&&n.Cars.length>0,t,i;r&&(t=n.Cars.map(function(n){return{CategoryCode:n.CategoryCode,ImageUrl:n.ImageUrl,Name:n.Name,Price:n.PricePerDay}}),i=t.length>2?3:t.length,this._scope.Cars=this._carCategoriserService.GetTheBestNCarOffers(i,t),this._scope.ShowComponent=!0)},t.prototype.LoadCarsError=function(){this._scope.ShowComponent=!1},t.prototype.GetScreenSizeSpecificDeepLink=function(n){return this._browserDetectionService.IsMobileBrowser()&&!!n.MobileDeeplinkUrl?n.MobileDeeplinkUrl:n.DefaultDeeplinkUrl},t.ControllerName="Ancillaries_EuropcarUpsellComponent",t.$inject=["$scope","Sitecore_RoutesData","Common_NavigationService","Common_BrowserDetectionService","Funnel_AncillaryUpsellTokenReplacementService","Cars_Service","Sitecore_EuropcarAncillarySettings","Controls_BookingDataService","Cars_CategoriserService"],t}();t.EuropcarComponent=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f){var e=this;this._scope=n;this._hotelUpsellSettings=t;this._bookingComApiSettings=i;this._bookingDataService=r;this._ancillariesSettings=u;this._languageSettings=f;this._scope.ChangeCheckInDate=this.ChangeCheckInDate.bind(this);this._scope.ChangeCheckOutDate=this.ChangeCheckOutDate.bind(this);this._bookingDataService.DataPromise.then(function(n){e.SetupInitialValues(n);e._scope.ShowComponent=e.DisableHotelsComponent(n)?!1:!0})}return t.prototype.SetupInitialValues=function(n){var r=this,t=n.FlightPairs[0],i=t.OutboundFlight;this._bookingComApiSettings.GetAirportSettings(i.ArrivalIata).then(function(n){r._scope.Destination=n!=null?n.DisplayName:""});this._scope.CheckInDate=i.LocalArrivalTime.Date();this._scope.CheckOutDate=t.ReturnFlight?t.ReturnFlight.LocalDepartureTime.Date():i.LocalArrivalTime.Date().AddDays(1);this._scope.Language=this._languageSettings.EResLanguageCode;this._scope.Currency=n.CurrencyCode.toUpperCase()},t.prototype.ChangeCheckInDate=function(n){this.SetFocusToEventTarget(n);this.OpenDatePickerDrawer(this._hotelUpsellSettings.CheckInDrawerTitle,!1,this.OnSelectCheckInDate)},t.prototype.ChangeCheckOutDate=function(n){this.SetFocusToEventTarget(n);this.OpenDatePickerDrawer(this._hotelUpsellSettings.CheckOutDrawerTitle,!0,this.OnSelectCheckOutDate)},t.prototype.SetFocusToEventTarget=function(n){angular.element(n.target).focus()},t.prototype.OpenDatePickerDrawer=function(t,i,r){var u={OnSelectDate:r.bind(this),StartDate:i?Utilities.TimeAgnosticDate.TodayLocal().AddDays(1):Utilities.TimeAgnosticDate.TodayLocal(),EndDate:i?Utilities.TimeAgnosticDate.TodayLocal().AddDays(this._hotelUpsellSettings.DaysToShow):Utilities.TimeAgnosticDate.TodayLocal().AddDays(this._hotelUpsellSettings.DaysToShow-1),StartHighlightDate:this._scope.CheckInDate,EndHighlightDate:i?this._scope.CheckOutDate:null,AnalyticsCategory:null,AnalyticsAction:null},f={SectionKey:"genericdatepickerdrawer",Parameters:u,TitleOverride:t};n.Events.OpenDrawerWithOptions(f)},t.prototype.OnSelectCheckInDate=function(n){n.ToSortable()>=this._scope.CheckOutDate.ToSortable()&&(this._scope.CheckOutDate=n.AddDays(1));this._scope.CheckInDate=n},t.prototype.OnSelectCheckOutDate=function(n){n.ToSortable()<=this._scope.CheckInDate.ToSortable()&&(this._scope.CheckInDate=n.SubtractDays(1));this._scope.CheckOutDate=n},t.prototype.DisableHotelsComponent=function(t){var i=t.FlightPairs.filter(function(n){return n.IsPrimaryPair})[0],r=t.Passengers.Adults<1||this.DifferenceBetweenFlightDepartureDatesIsMoreThanXCalendarDays(i)||this.FlightsAreOnTheSameDay(t,i)||this._ancillariesSettings.DisableHotelsStep,u=t.AddedAncillaries.indexOf(n.Data.Funnel.AncillaryType.Hotel)>-1;return u||r},t.prototype.FlightsAreOnTheSameDay=function(n,t){var i=!!t.OutboundFlight,r=!!t.ReturnFlight;return i&&r&&t.OutboundFlight.LocalDepartureTime.Date().Equals(t.ReturnFlight.LocalDepartureTime.Date())},t.prototype.DifferenceBetweenFlightDepartureDatesIsMoreThanXCalendarDays=function(n){if(!!n.OutboundFlight&&!!n.ReturnFlight){var t=n.OutboundFlight.LocalDepartureTime,i=n.ReturnFlight.LocalDepartureTime,r=this._ancillariesSettings.HotelsMaximumNumberOfDaysBetweenFlights;return this.NumberOfDaysDifference(t,i)>r}return!1},t.prototype.NumberOfDaysDifference=function(n,t){var i=n.Date(),r=t.Date();return r.DifferenceInDays(i)},t.ControllerName="Ancillaries_HotelUpsellComponent",t.$inject=["$scope","Funnel_HotelUpsellSettings","CommonApi_BookingComApiService","Controls_BookingDataService","Ancillaries_Settings","Sitecore_LanguageSettings"],t}();t.HotelUpsellComponent=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(t){function i(i,r,u,f,e,o,s,h,c){h===void 0&&(h=null);c===void 0&&(c=null);var l=this;return r.DaysRequiredEachSideOfRouteDate=1,l=t.call(this,r,u,f,e,o,!0,h,c)||this,l._gridScope=r,l.IncludeAdminFeesCallBack=s,l._gridScope.$watch(function(n){return n.DisplayedRoutes?n.DisplayedRoutes.OutboundRoute:null},function(n){n!=null&&l._gridScope.$applyAsync(function(){l.DoRequest(!0)})}),i.$on(n.Events.Names.AvailabilityFlightsProvider.ForceGridRefresh,function(n){return l.ForceRefresh(n,!0)}),l}return __extends(i,t),i.prototype.GetOutboundRoute=function(){return this._gridScope.DisplayedRoutes.OutboundRoute},i.prototype.GetReturnRoute=function(){return this._gridScope.DisplayedRoutes.ReturnRoute},i.prototype.GetOutboundSelectedFlightNumber=function(){return null},i.prototype.GetReturnSelectedFlightNumber=function(){return null},i.prototype.PreOnAvailabilityQuery=function(){},i.prototype.PreOnAvailabilitySuccess=function(){},i.prototype.OnAvailabilityError=function(){},i.prototype.GetDebugName=function(){return"Grid"},i.prototype.IncludeAdminFees=function(){return this.IncludeAdminFeesCallBack()},i}(t.BaseAvailabilityProvider);t.BaseAvailabilityGridProvider=i})(i=t.Availability||(t.Availability={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o){this._scope=t;this._bookerDetailsSettings=i;this._countryDataService=r;this._qService=f;this._analyticsTracker=e;this._funnelAccessibilityService=o;this._scope.DialCodeClicked=this.OnDialCodeClicked.bind(this);this._scope.ResidentOfClicked=this.OnResidentOfClicked.bind(this);this._scope.GetValidTitles=this.GetValidTitles.bind(this);this._scope.MaxKeepMeSignedInMinutes=this._bookerDetailsSettings.SignInSettings.KeepMeSignedInMinutes;this._scope.LanguageCode=u.EResLanguageCode;this._scope.$emit(n.Events.Names.EditableControls.RegisterControl,this)}return t.prototype.SetWatchers=function(){var t=this;this._scope.$watch(function(n){return n.BookerDetails.ResidentOfValue},function(n){t._countryDataService.GetCountryDataModelForCountry(t._scope.LanguageCode,n).then(function(n){t._scope.ResidentOfCountry=n})});this._scope.$watch(function(n){return n.BookerDetails.Telephone.DialingCode},function(n){t._countryDataService.GetCountryDataModelForDialCode(t._scope.LanguageCode,n).then(function(n){t._scope.DialCodeCountry=n})});this._scope.$watch(function(n){return n.BookerDetails.LastName},function(i,r){i!==r&&(t._scope.EjPlusNumberStatus=n.Data.Common.EjPlusCardStatus.Valid)})},t.prototype.GetValidTitles=function(){return this._bookerDetailsSettings.TitleOptions},t.prototype.OnDialCodeClicked=function(){var t=this,i={LanguageCode:this._scope.LanguageCode,OnCountryInfoSelected:function(n){t.SetDialCode(n);var i=t._scope.BookerDetailsForm["dial-code"];i&&(i.$setDirty(),i.$setTouched());t._scope.DialCodeFocus=!1}};this._scope.DialCodeFocus=!0;n.Events.OpenDrawerWithOptions({SectionKey:"dial-code-selector-drawer",Parameters:i})},t.prototype.OnResidentOfClicked=function(){var t=this,i={LanguageCode:this._scope.LanguageCode,OnCountryInfoSelected:function(n){t.SetResidentOf(n);var i=t._scope.BookerDetailsForm.resident;i&&(i.$setDirty(),i.$setTouched());t._scope.ResidentOfFocus=!1}};this._scope.ResidentOfFocus=!0;n.Events.OpenDrawerWithOptions({SectionKey:"resident-of-selector-drawer",Parameters:i})},t.prototype.SetDialCode=function(n){n&&(this._scope.BookerDetails.Telephone.DialingCode=n.DialCode)},t.prototype.SetResidentOf=function(n){n&&(this._scope.BookerDetails.ResidentOfDisplayText=n.Name,this._scope.BookerDetails.ResidentOfValue=n.B2BName,this._scope.BookerDetails.ResidentOfIsoCode=n.ISOCountryCode)},t.$inject=["$scope","Sitecore_BookerDetailsSettings","Data_CountryDataService","Sitecore_LanguageSettings","$q","IAnalyticsTracker","Funnel_AccessibilityService"],t}();t.BaseBookerDetails=i})(i=t.Common||(t.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._scope=n;this._countryDataService=t;this._scope.LanguageCode=i.EResLanguageCode;this._scope.GetDisplayName=this.GetDisplayName.bind(this);this._scope.GetDisplayAddress=this.GetDisplayAddress.bind(this);this._scope.GetFullPhoneNumber=this.GetFullPhoneNumber.bind(this)}return n.prototype.IsValid=function(){return!0},n.prototype.SetCountryWatcher=function(){var n=this;this._scope.$watch(function(n){return n.BookerDetails.ResidentOfValue},function(t){n._countryDataService.GetCountryDataModelForCountry(n._scope.LanguageCode,t).then(function(t){n._scope.ResidentOfCountry=t})})},n.prototype.GetDisplayName=function(){return this._scope.BookerDetails?this._scope.BookerDetails.Title?this._scope.BookerDetails.Title+" "+this._scope.BookerDetails.FirstName+" "+this._scope.BookerDetails.LastName:this._scope.BookerDetails.FirstName+" "+this._scope.BookerDetails.LastName:""},n.prototype.GetFullPhoneNumber=function(){return this._scope.BookerDetails?this._scope.BookerDetails.Telephone.FullPhoneNumber():""},n.prototype.GetDisplayAddress=function(){if(this._scope.BookerDetails){var n="";return this._scope.BookerDetails.Address1&&(n+=this._scope.BookerDetails.Address1+", "),this._scope.BookerDetails.City&&(n+=this._scope.BookerDetails.City+", "),this._scope.BookerDetails.PostalCode&&(n+=this._scope.BookerDetails.PostalCode),n.replace(/,\s*$/,"")}return""},n.$inject=["$scope","Data_CountryDataService","Sitecore_LanguageSettings"],n}();n.BaseBookerDetailsSummary=t})(t=n.Common||(n.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._luggageService=n;this._airportsInformationService=t;this._airportInformationDrawerSettings=i;this._baseScope=r}return t.prototype.BuildLuggageText=function(n,t){var i=this.GetFormattedBags(n.HoldBags),r=this.GetFormattedSportsEquipment(n.SportsEquipment),u=this.GetFormattedCabinBags(t),f=i.concat(r).concat(u);return f.join(", ")},t.prototype.ShowAncillaries=function(){n.Events.Fire(n.Events.Names.Basket.SetupBasket,"ng-templates/panels/ancillaries-content",n.Data.Common.ClientBasketType.AncillariesPanel,!1,"ng-templates/panels/ancillaries-title")},t.prototype.GetFormattedBags=function(t){var i=this,r=_.map(_.groupBy(t,"TotalWeight"),function(t){var i=0;return t.forEach(function(n){i+=n.Quantity}),{Quantity:i,Description:t[0].TotalWeight.toString(),Type:t[0].Type===n.Data.Funnel.BagType.SmallHoldBag?n.Data.Controls.DisplayItemType.SmallBag:n.Data.Controls.DisplayItemType.StandardBag}});return r.map(function(n){return i._luggageService.FormatBag(n)})},t.prototype.GetFormattedSportsEquipment=function(t){var i=this,r=_.map(_.groupBy(t,"Type"),function(t){var i=0;return t.forEach(function(n){i+=n.Quantity}),{Quantity:i,Description:t[0].Type,Type:n.Data.Controls.DisplayItemType.SportsItem}});return r.map(function(n){return i._luggageService.FormatSportsEquipment(n)})},t.prototype.GetFormattedCabinBags=function(n){var i=[],t;return n&&(t=this._luggageService.FormatCabinBags(n),t&&i.push(t)),i},t.prototype.SetAirportsInformation=function(n){var t=this,i=this._airportsInformationService.GetDistinctFlightAirportIatas(n);this._airportsInformationService.GetAirportsInformationFromIataList(i).then(function(n){t._baseScope.AirportsInformation=n}).finally(function(){t._baseScope.IsLoading=!1})},t.prototype.ShowAirportInformation=function(t){var u={AirportInformation:t},i={SectionKey:"airport-information",Parameters:u},r=this._airportInformationDrawerSettings.TitleOverride;!r||(i.TitleOverride=r.replace(/{airport name}/gi,t.Name));n.Events.OpenDrawerWithOptions(i)},t}();t.BaseConfirmationPage=i})(i=t.Common||(t.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(n){function t(t,i,r,u,f,e,o,s){var h=n.call(this,t,i,r,u,f,e,o)||this;return h._bookerDetailsDataService=s,h.Initialise(),h}return __extends(t,n),t.prototype.IsValid=function(){return this._scope.BookerDetailsForm.$valid&&this.ConfirmedAge()},t.prototype.FillInDefaultValues=function(){var n=this;this._scope.BookerDetails=this._bookerDetailsDataService.GetBookerDetails();this._countryDataService.GetCountryDataModelForIsoCode(this._scope.LanguageCode,this._bookerDetailsSettings.DefaultCountryISOCode).then(function(t){n.SetResidentOf(t)});this._countryDataService.GetCountryDataModelForIsoCode(this._scope.LanguageCode,this._bookerDetailsSettings.DefaultDialCodeISOCode).then(function(t){n.SetDialCode(t)})},t.prototype.ConfirmedAge=function(){return this._scope.ConfirmedAge},t.prototype.Initialise=function(){this.FillInDefaultValues();this.SetWatchers();this._scope.ConfirmedAge=!1;this._scope.IsNewUser=!0},t.ControllerName="Common_BookerDetails",t.$inject=["$scope","Sitecore_BookerDetailsSettings","Data_CountryDataService","Sitecore_LanguageSettings","$q","IAnalyticsTracker","Funnel_AccessibilityService","Common_BookerDetailsDataService"],t}(n.BaseBookerDetails);n.BookerDetails=t})(t=n.Common||(n.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(n){function t(t,i,r,u){var f=n.call(this,t,r,u)||this;return f._scope.BookerDetails=i.GetBookerDetails(),f.SetCountryWatcher(),f}return __extends(t,n),t.ControllerName="Common_BookerDetailsSummary",t.$inject=["$scope","Common_BookerDetailsDataService","Data_CountryDataService","Sitecore_LanguageSettings"],t}(n.BaseBookerDetailsSummary);n.BookerDetailsSummary=t})(t=n.Common||(n.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._scope=n;this._scope.BrowserName=t.GetBrowserName();this._scope.BrowserVersion=t.GetBrowserVersion().toString()}return n.ControllerName="Common_BrowserOutOfDate",n.$inject=["$scope","Common_BrowserDetectionService"],n}();n.BrowserOutOfDate=t})(t=n.Common||(n.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._scope=n;this._navigationService=i;this._parameters=this._scope.Section.Options.Parameters||{Surname:"",BookingReference:""};this._scope.Surname=this._parameters.Surname;this._scope.BookingReference=this._parameters.BookingReference;this._scope.IsConfirmed=!1;this._scope.DoToggleConfirmation=this.OnToggleConfirmation.bind(this);this._scope.DoCheckIn=this.DoCheckIn.bind(this);this._scope.DoHandleKeyUp=this.HandleKeyUp.bind(this)}return t.prototype.OnToggleConfirmation=function(){this._scope.IsConfirmed=!this._scope.IsConfirmed},t.prototype.DoCheckIn=function(n){if((n.$setSubmitted(),!n.$pristine)&&n.$valid&&this._scope.IsConfirmed){var t=this._scope.Url.replace("{ref}",this._scope.BookingReference).replace("{surname}",this._scope.Surname);this._navigationService.NavigateTo(t)}},t.prototype.HandleKeyUp=function(t){t.which===n.Keys.Enter&&this.OnToggleConfirmation()},t.ControllerName="Common_CheckIn",t.$inject=["$scope","$location","Common_NavigationService"],t}();t.CheckInDrawerController=i})(i=t.Common||(t.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._scope=n;this._rootScope=t;this._cookiePolicyManager=i;this._scope.DoAcceptCookiePolicy=this.DoAcceptCookiePolicy.bind(this);this._scope.ShouldShowCookieConsentBar=this.ShouldShowCookieConsentBar.bind(this)}return n.prototype.ShouldShowCookieConsentBar=function(){return this._cookiePolicyManager.ShouldShowCookiePolicyPopup()},n.prototype.DoAcceptCookiePolicy=function(){this._cookiePolicyManager.AcceptCookiePolicy()},n.ControllerName="Common_CookieConsent",n.$inject=["$scope","$rootScope","LegacyComponents_CookiePolicyPopup_CookiePolicyCookieManager"],n}();n.CookieConsentController=t})(t=n.Common||(n.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r){var u=this;this._containsFunnelControls=!1;this._initialisedFirstInvalid=!1;this._registeredEditableControls=[];this._scope=i;this._scope.$on(n.Events.Names.EditableControls.RegisterEditableControl,this.OnRegisterEditableControl.bind(this));this._scope.$on(n.Events.Names.Funnel.RegisterFunnelControl,function(){return u._containsFunnelControls=!0});this._scope.$on(n.Events.Names.EditableControls.SetEditingFirstInvalid,this.HandleFirstInvalid.bind(this));this._scope.$on(n.Events.Names.EditableControls.StartEditingReviewSection,this.StartEditingReviewSection.bind(this));this._scope.$emit(n.Events.Names.HelpingHand.PreventInitialReset);r.ready(this.Initialise.bind(this))}return t.prototype.Initialise=function(){var t=this;this._containsFunnelControls?this._scope.$on(n.Events.Names.Funnel.FunnelReady,function(){setTimeout(function(){t._scope.$apply(t.ContainerReady.bind(t))},0)}):this.ContainerReady()},t.prototype.ContainerReady=function(){this.WatchForEditability();this.HandleFirstInvalid()},t.prototype.OnRegisterEditableControl=function(n,t){t!=this&&this._registeredEditableControls.indexOf(t)==-1&&(this._registeredEditableControls.push(t),n.stopPropagation())},t.prototype.WatchForEditability=function(){var n=this;this._scope.$watch(function(){return n._registeredEditableControls.filter(function(n){return n.IsEditing()}).length>0},function(t){return n._registeredEditableControls.forEach(function(n){return n.SetEditable(!t)})})},t.prototype.HandleFirstInvalid=function(){var n=this._registeredEditableControls.filter(function(n){return!n.IsValid()});n.length>0&&n[0].SetEditing(!0)},t.prototype.StartEditingReviewSection=function(n,t){var i=this._registeredEditableControls.filter(function(n){return n.IsEditing()})[0];!!i&&i.SetEditing&&i.SetEditing(!1);t.SetEditing(!0)},t.ControllerName="Common_EditableControlsContainer",t.$inject=["$rootScope","$scope","$document"],t}();t.EditableControlsContainer=i})(i=t.Common||(t.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){var t=n.$watch("EventName",function(){n.$on(n.EventName,function(t,i){n.Content=i});t()})}return n.ControllerName="Common_EventDrivenContent",n.$inject=["$scope"],n}();n.EventDrivenContentController=t})(t=n.Common||(n.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._scope=n;this._parameters=this._scope.Section.Options.Parameters;this._scope.IsRequestedOverride=this.IsRequestedOverride.bind(this);this._scope.DoOverrideConfirm=this.DoOverrideConfirm.bind(this)}return t.prototype.IsRequestedOverride=function(n){var t=n===this._parameters.OverrideId;return this._scope.HasOverride=this._scope.HasOverride||t,t},t.prototype.DoOverrideConfirm=function(){!this._parameters.OverrideDoSubmitAction||this._parameters.OverrideDoSubmitAction();n.Events.Fire(n.Events.Names.Drawer.Close)},t.ControllerName="Common_OverrideMessage",t.$inject=["$scope"],t}();t.OverrideMessageController=i})(i=t.Common||(t.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u,f,e){this._queryStringSettings=n;this._personalisationCookieService=t;this._campaignCookieService=i;this._searchCookieService=r;this._wishlistCookieService=u;this._inspireMeCookieService=f;this._originCookieService=e;this.ProcessQueryStrings()}return n.prototype.ProcessQueryStrings=function(){var n=new Urls.QueryString(document.URL),t=n.GetParameter(this._queryStringSettings.PersonalisationQueryStringKey),i=n.GetParameter(this._queryStringSettings.CampaignQueryStringKey),r=n.GetParameter(this._queryStringSettings.PpcQueryStringKey),u=n.GetParameter(this._queryStringSettings.InspireMeQueryStringKey),f=n.GetParameter(this._queryStringSettings.WishlistQueryStringKey),e,o,s,h,c;t&&(e=Base64.decode(t),this._personalisationCookieService.SetCookie(e));i&&(o=Base64.decode(i),this._campaignCookieService.SetCookie(o));r&&(s=Base64.decode(r),this._searchCookieService.UpdateCookieFromQueryString(s));u&&(h=Base64.decode(u),this._inspireMeCookieService.SetCookie(h));f&&(c=Base64.decode(f),this._wishlistCookieService.SetCookie(c));this._originCookieService.SetCookie()},n.ControllerName="Common_ProcessQueryStrings",n.$inject=["Sitecore_QueryStringSettings","PersonalisationCookie_Service","CampaignCookie_Service","SearchCookie_Service","WishlistCookie_Service","InspireMeCookie_Service","OriginCookie_Service"],n}();n.ProcessQueryStrings=t})(t=n.Common||(n.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._registeredControls=[];this._scope=n;this._qService=t;this._accessibilityService=i;this._timeout=r;this.Initialise()}return t.prototype.IsFormValid=function(){return this._registeredControls.every(function(n){return n.IsValid()})},t.prototype.IsValid=function(){return this._continuePressed&&this.IsFormValid()},t.prototype.IsEditing=function(){return!this._scope.IsSummaryMode},t.prototype.SetEditable=function(n){this._scope.AllowEdit=n},t.prototype.SetEditing=function(t){var f=this,i,r,u;if(this._scope.IsSummaryMode=!t,!this._scope.ReviewSectionSettings||t&&(this._continuePressed=!1,n.Events.Fire(n.Events.Names.HelpingHand.ShowText,this._scope.ReviewSectionSettings.EditingHelpingHandText)),t)for(i=0,r=this._registeredControls;i<r.length;i++)u=r[i],!u.ChangedToEditingMode||u.ChangedToEditingMode();this._timeout(function(){f._scope.$applyAsync()},50)},t.prototype.Initialise=function(){this._scope.TriggerEdit=this.ShowEditingMode.bind(this);this._scope.Continue=this.ShowSummaryMode.bind(this);this._scope.IsValid=this.IsValid.bind(this);this._scope.IsFormValid=this.IsFormValid.bind(this);this._scope.IsSectionLoading=!1;this._scope.$on(n.Events.Names.EditableControls.RegisterControl,this.OnRegisterControl.bind(this));this._scope.$emit(n.Events.Names.EditableControls.RegisterEditableControl,this);this._continuePressed=!0;this.SetEditing(!1)},t.prototype.OnRegisterControl=function(n,t){t!=this&&this._registeredControls.indexOf(t)==-1&&(this._registeredControls.push(t),n.stopPropagation())},t.prototype.ShowEditingMode=function(){var t=this;this.IsEditing()||(this._scope.$emit(n.Events.Names.EditableControls.StartEditingReviewSection,this),this._accessibilityService.QueueAlertReviewEditSelected(this._scope.ReviewSectionSettings.ScreenReaderMessageWhenEditButtonClicked),this._accessibilityService.AlertReviewSectionChangedQueue(),setTimeout(function(){t._scope.SetFocusOnTriggerEdit()},0))},t.prototype.ShowSummaryMode=function(){var i=this,t;this.IsFormValid()?(t=[],this._registeredControls.forEach(function(n){if(!!n.Save){var i=n.Save();t.push(i)}}),this._scope.IsSectionLoading=!0,this._qService.all(t).then(this.OnSaved.bind(this)).finally(function(){i._scope.IsSectionLoading=!1})):this._scope.$broadcast(n.Events.Names.Validation.Validate)},t.prototype.OnSaved=function(){this.SetEditing(!1);this._continuePressed=!0;Utilities.ScreenReader.QueueAlert(this._scope.ReviewSectionSettings.ScreenReaderMessageWhenContinueButtonClicked,"savedThisSectionNow");Utilities.ScreenReader.AlertQueued("savedThisSectionNow");this._scope.$emit(n.Events.Names.EditableControls.SetEditingFirstInvalid);this._scope.SetFocusOnContinue()},t.ControllerName="Common_ReviewSection",t.$inject=["$scope","$q","Common_AccessibilityService","$timeout"],t}();t.ReviewSection=i})(i=t.Common||(t.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){n.EnsureCookie()}return n.ControllerName="Common_EnsureSitecoreLanguageCookie",n.$inject=["Service_SitecoreLanguageCookie"],n}();n.SitecoreLanguageCookie=t})(t=n.Common||(n.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._scope=n;this._tabsScope=n.$parent;this._scope.SetActive=this.SetActive.bind(this);this._scope.IsActive=this.IsActive.bind(this)}return t.prototype.SetActive=function(){this._tabsScope.SetActive(this._scope.Index,this._scope.Title);this._scope.$emit(n.Events.Names.TabbedContainer.TabSelected,[this._scope.Title])},t.prototype.IsActive=function(){return this._tabsScope.IsActive(this._scope.Index)},t.ControllerName="Common_Tab",t.$inject=["$scope"],t}();t.TabController=i})(i=t.Common||(t.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._scope=n;this._tracking=i;this._location=t.location.pathname;this._scope.SetActive=this.SetActive.bind(this);this._scope.IsActive=this.IsActive.bind(this);this._activeTab=0}return n.prototype.SetActive=function(n,t){this._tracking.TrackEvent("TabbedContainer",t,this._location);this._activeTab=n},n.prototype.IsActive=function(n){return this._activeTab===n},n.ControllerName="Common_Tabs",n.$inject=["$scope","$window","IAnalyticsTracker"],n}();n.TabsController=t})(t=n.Common||(n.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s){this._allowDuplicateBooking=!1;this._hasBeenEditable=!1;this.$rootScope=t;this.$scope=i;this.$window=r;this._accountService=u;this._bookerDetailsDataService=f;this._errorService=e;this._registrationSettings=o;this._travelPreferencesSettings=s;i.OriginAirports=[this.EmptyAirport()];i.Register=this.Register.bind(this);i.$emit(n.Events.Names.EditableControls.RegisterEditableControl,this)}return t.prototype.IsEditing=function(){return!1},t.prototype.SetEditable=function(n){var t=this;this.$scope.AllowEdit=n;n&&this.$scope.$applyAsync(function(){t.UpdateHelpingHand()})},t.prototype.SetEditing=function(){},t.prototype.UpdateHelpingHand=function(){this.$scope.$emit(n.Events.Names.HelpingHand.ShowText,this._travelPreferencesSettings.HelpingHandText)},t.prototype.IsValid=function(){return!0},t.prototype.Register=function(){var n=this,t=this.GetRegistrationDetails();t&&(this.$scope.IsProcessing=!0,this._accountService.RegisterUser(t).then(function(){n.LoginUser()},function(){n._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Registration);n.$scope.IsProcessing=!1}))},t.prototype.EmptyAirport=function(){return{Iata:null,Name:null,B2bAreaCode:null,Connections:null,IndirectConnections:null,IndirectPartnerConnections:null,PartnerConnections:null,NearbyAirports:null,IsMarketGroup:null,MarketGroupIatas:null,Flags:null,ShowDirectRoutesByDefault:null,IsWorldwide:!1,PackageHolidayDestinationIds:null,EuropcarStationCode:null}},t.prototype.GetRegistrationDetails=function(){var t=this._bookerDetailsDataService.GetBookerDetails(),i;return t?(i=[],this.$scope.OptInForEasyJetMailing||i.push(n.Data.Account.MarketingType.EasyJet),this.$scope.OptInForMailing||i.push(n.Data.Account.MarketingType.ThirdParty),{PersonalDetails:{Title:t.Title,FirstName:t.FirstName,LastName:t.LastName,PhoneNumber:t.Telephone.FullPhoneNumber(),Email:t.Email,Password:t.Password,Age:null},ContactAddress:{AddressLine1:t.Address1,AddressLine2:t.Address2,City:t.City,StateProvince:t.StateProvince,PostalCode:t.PostalCode,Country:t.ResidentOfIsoCode},CommunicationPreferences:{OptedOutMarketing:i},TravelPreferences:{Destinations:this.$scope.OriginAirports.filter(function(n){return!!n.Iata}).map(function(n){return n.Iata})}}):null},t.prototype.LoginUser=function(){var t=this,n=this._bookerDetailsDataService.GetBookerDetails();if(!n||!n.Email||!n.Password)return null;this._accountService.LogIn(n.Email,n.Password,function(){t._registrationSettings.RedirectLink&&(t.$window.location.href=t._registrationSettings.RedirectLink)},function(){t._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Registration);t.$scope.IsProcessing=!1},n.KeepMeSignedInMinutes>0)},t.ControllerName="Common_TravelPreferences",t.$inject=["$rootScope","$scope","$window","Account_Service","Common_BookerDetailsDataService","Error_Service","Sitecore_RegistrationSettings","Sitecore_TravelPreferencesSettings"],t}();t.TravelPreferences=i})(i=t.Common||(t.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._analyticsTracker=n}return n.prototype.TrackEvent=function(n,t){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.UATPDrawer,n,Utilities.String.StripHtml(t))},n}();n.AirplusDrawer=t})(t=n.Drawers||(n.Drawers={}))})(t=n.Common||(n.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n){this._scope=n;var t=n.Section.Options.Parameters;this._scope.Airport=t.AirportInformation;this._scope.OnConfirm=this.OnConfirm.bind(this)}return t.prototype.OnConfirm=function(){n.Events.Fire(n.Events.Names.Drawer.Close)},t.ControllerName="Common_AirportInformationDrawer",t.$inject=["$scope"],t}();t.AirportInformationDrawer=i})(i=t.Drawers||(t.Drawers={}))})(i=t.Common||(t.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n){this._scope=n;var t=n.Section.Options.Parameters;this._scope.AirportInformation=t.AirportInformation;this._scope.OnConfirm=this.OnConfirm.bind(this)}return t.prototype.OnConfirm=function(){n.Events.Fire(n.Events.Names.Drawer.Close)},t.ControllerName="Common_CombinedAirportInformationDrawer",t.$inject=["$scope"],t}();t.CombinedAirportInformationDrawer=i})(i=t.Drawers||(t.Drawers={}))})(i=t.Common||(t.Common={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f){this.ChangesPlaceholder="{changes}";this._shouldShowCurrencySwitcher=!1;this._scope=n;this._rootScope=t;this._timeoutService=i;this._basketSettings=r;this._priceService=u;this._breakPointService=f;this.PopulateScope(r);this.ListenForEvents()}return t.prototype.PopulateScope=function(n){var t=this;this._scope.IsOpen=!1;this._scope.FocusSettings={FocusTitle:!1,FocusCurrencyChange:!1};this._scope.DoClose=this.OnClose.bind(this);this._scope.DoOpen=this.OnOpen.bind(this);this._scope.DoKeyDown=function(n){return t.OnKeyDown(n.which)};this._scope.DoOnScroll=this.OnScroll.bind(this);this._scope.ChangesText=n.NoChangesText;this._scope.ShowBasketText=n.OpenBasketText;this._scope.ShouldShowCurrencySwitcherInBasket=this.ShouldShowCurrencySwitcherInBasket.bind(this)},t.prototype.ListenForEvents=function(){this._rootScope.$on(n.Events.Names.Basket.SetupBasket,this.OnSetupBasket.bind(this));this._rootScope.$on(n.Events.Names.Basket.SetChanges,this.OnSetChanges.bind(this));this._rootScope.$on(n.Events.Names.Basket.SetPrice,this.OnSetPrice.bind(this));this._rootScope.$on(n.Events.Names.Basket.SetFocusOnTitle,this.OnSetFocus.bind(this));this._rootScope.$on(n.Events.Names.Basket.SetFocusOnChangeCurrency,this.OnSetFocusChangeCurrency.bind(this));this._rootScope.$on(n.Events.Names.Basket.Opened,this.OnOpened.bind(this));this._scope.$on(n.Events.Names.Basket.FunnelBasketUpdating,this.OnFunnelBasketUpdating.bind(this));this._scope.$on(n.Events.Names.Basket.FunnelBasketReady,this.OnFunnelBasketReady.bind(this));this._scope.$on(n.Events.Names.Basket.Show,this.OnOpen.bind(this));this._scope.$on(n.Events.Names.Basket.Hide,this.OnClose.bind(this))},t.prototype.OnFunnelBasketReady=function(){this._scope.FunnelBasketReady=!0},t.prototype.OnFunnelBasketUpdating=function(){this._scope.FunnelBasketReady=!1},t.prototype.OnScroll=function(){this._rootScope.$broadcast(n.Events.Names.Drawer.Scroll)},t.prototype.ShouldShowCurrencySwitcherInBasket=function(){return this._shouldShowCurrencySwitcher&&this._scope.FunnelBasketReady&&this._scope.IsFunnelBasket},t.prototype.OnSetupBasket=function(t,i,r,u,f){u===void 0&&(u=!1);f===void 0&&(f=null);this._scope.ContentUrl=i;this._scope.TitleUrl=f;r===n.Data.Common.ClientBasketType.Funnel?this._scope.IsFunnelBasket=!0:r===n.Data.Common.ClientBasketType.Rebooking?this._scope.IsRebookingBasket=!0:r===n.Data.Common.ClientBasketType.AncillariesPanel&&(this._scope.IsAncillariesPanel=!0);u&&(this._shouldShowCurrencySwitcher=!0);this._scope.BasketReady=!0},t.prototype.OnSetChanges=function(n,t){t===0?this._scope.ChangesText=this._basketSettings.NoChangesText:t===1?this._scope.ChangesText=this._basketSettings.SingleChangeText:t>1&&(this._scope.ChangesText=this._basketSettings.MultipleChangesText.replace(this.ChangesPlaceholder,t.toString()))},t.prototype.OnSetPrice=function(n,t){typeof t=="number"&&(t=this._priceService.NewPrice(t,t,t));this._scope.Price=t},t.prototype.OnSetFocus=function(){this._breakPointService.IsBasketAlwaysVisible()||this._scope.IsOpen?this.FocusTitle():this._scope.IsOpen=!0},t.prototype.OnSetFocusChangeCurrency=function(){this._scope.FocusSettings.FocusCurrencyChange=!0},t.prototype.FocusTitle=function(){this._scope.FocusSettings.FocusTitle=!0},t.prototype.OnOpen=function(n){n.preventDefault();this._scope.IsOpen=!0},t.prototype.OnClose=function(){this._scope.IsOpen=!1},t.prototype.OnOpened=function(){this.FocusTitle()},t.prototype.OnKeyDown=function(n){n===27&&this.OnClose()},t.ControllerName="Controls_Basket",t.$inject=["$scope","$rootScope","$timeout","Sitecore_BasketSettings","Common_PriceService","ejBreakPointService"],t}();t.Basket=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u){var f=this;this._scope=n;this._sitecoreLanguageSettings=t;this._analytics=i;this._bookingDataService=r;this._tokenReplacementService=u;this._scope.IsLoading=!0;this._scope.LinkClicked=this.LinkClicked.bind(this);this._scope.BuildViewModel=this.BuildViewModel.bind(this);this._bookingDataService.DataPromise.then(function(n){f._booking=n;f.BuildViewModel()})}return n.prototype.BuildViewModel=function(){!this._booking||!this._scope.LinkTarget||this.TokenReplace(this._scope.LinkTarget,this._scope.DateFormat,this._scope.TimeFormat)},n.prototype.LinkClicked=function(){this._analytics.TrackEvent(Tracking.EventConstants.Categories.Confirmation,this._scope.TrackingKey,this._booking.BookingReference)},n.prototype.TokenReplace=function(n,t,i){var r=this;if(t===void 0&&(t="YYYY-MM-DD"),i===void 0&&(i="HH:mm"),!this._booking)return"";this._tokenReplacementService.ReplaceDeepLinkUrlTokens(this._booking,n,t,i).then(function(n){r._scope.UrlAfterTokenReplacement=n;r._scope.IsLoading=!1})},n.ControllerName="Controls_BookingLinkBlock",n.$inject=["$scope","Sitecore_SitecoreLanguageSettings","IAnalyticsTracker","Controls_BookingDataService","Funnel_AncillaryUpsellTokenReplacementService"],n}();n.BookingLinkBlock=t})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){n.ButtonBlur=this.ButtonBlur.bind(this);n.ButtonFocus=this.ButtonFocus.bind(this);n.ButtonMouseEnter=this.ButtonMouseEnter.bind(this);n.ButtonMouseLeave=this.ButtonMouseLeave.bind(this);n.ButtonShouldHighlight=this.ButtonShouldHighlight.bind(this)}return n.prototype.ButtonBlur=function(n){n.IsActive=!1;n.FocusOverride=!1},n.prototype.ButtonFocus=function(n){n.FocusOverride||(n.IsActive=!0)},n.prototype.ButtonMouseEnter=function(n){n.IsActive=!0},n.prototype.ButtonMouseLeave=function(n){n.IsActive=!1},n.prototype.ButtonShouldHighlight=function(n){return n.IsActive||n.IsSelected},n.$inject=["$scope"],n}();n.ButtonGrid=t})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._scope=n;this._parameters=n.Section.Options.Parameters;this._scope.PassengerName=this._parameters.PassengerName;this._scope.DoConfirm=this.DoConfirm.bind(this)}return t.prototype.DoConfirm=function(){this._scope.Confirmed?this._parameters.OnAccept():n.Events.Fire(n.Events.Names.Drawer.Close)},t.ControllerName="Controls_CheckboxConfirmationDrawer",t.$inject=["$scope"],t}();t.CheckboxConfirmationDrawer=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function i(n,t,i,r,u){this._sectionHistory=[];this._drawerQueue=[];this._scope=n;this._rootScope=t;this._window=i;this._analyticsTracker=r;this._sectionStore=u;this.PopulateScope();this.ListenForEvents()}return i.prototype.PopulateScope=function(){var n=this;this._scope.CurrentSection=null;this._scope.IsOpen=!1;this._scope.IsOpening=!1;this._scope.IsClosing=!1;this._scope.IsSectionChanging=!1;this._scope.ReverseDirection=!1;this._scope.DoBack=this.OnBack.bind(this);this._scope.DoDismiss=this.OnDismiss.bind(this);this._scope.DoClose=this.OnClose.bind(this);this._scope.DoOnScroll=this.OnScroll.bind(this);this._scope.DoKeyDown=function(t){return n.OnKeyDown(t.which)};this._scope.DoConfirm=this.OnConfirm.bind(this)},i.prototype.ListenForEvents=function(){var t=this;this._rootScope.$on(n.Events.Names.Drawer.Open,function(n,i){t.OnOpen(i)});this._rootScope.$on(n.Events.Names.Drawer.Back,this.OnBack.bind(this));this._rootScope.$on(n.Events.Names.Drawer.Close,this.OnClose.bind(this));this._rootScope.$on(n.Events.Names.Drawer.Dismiss,this.OnDismiss.bind(this));this._rootScope.$on(n.Events.Names.Drawer.Queue,function(n,i){t.OnQueue(i)});this._scope.$on(n.Events.Names.DrawerSectionView.Start,function(){t._scope.IsSectionChanging=!0});this._scope.$on(n.Events.Names.DrawerSectionView.End,function(){t._scope.IsSectionChanging=!1;t._scope.$broadcast(n.Events.Names.Drawer.DoPostponedLoad);t.FocusActiveTitle()});this._scope.$on(n.Events.Names.Drawer.Opened,function(){t._scope.PreventOpenAnimation=!1;t._scope.IsOpening=!1;t._scope.$broadcast(n.Events.Names.Drawer.DoPostponedLoad);t.FocusActiveTitle();t.CheckForActionCompleteOpen()});this._scope.$on(n.Events.Names.Drawer.Closed,function(){t._scope.IsClosing=!1;t.CheckForActionCompleteOpen()});this._rootScope.$on(n.Events.Names.Drawer.ResetTitle,function(n,i){t.UpdateTitleText(i)})},i.prototype.UpdateTitleText=function(n){var t="#drawer-title-"+this._scope.CurrentSection.Key;$jq(t).text(n)},i.prototype.CheckForActionCompleteOpen=function(){if(this._toOpenOnActionComplete){var n=this._toOpenOnActionComplete;this._toOpenOnActionComplete=null;this.OnOpen(n)}},i.prototype.FocusActiveTitle=function(){var n="#drawer-title-"+this._scope.CurrentSection.Key;$jq(n).focus()},i.prototype.IsActing=function(){return this._scope.IsSectionChanging||this._scope.IsOpening||this._scope.IsClosing},i.prototype.OnBack=function(){var n=this._sectionHistory.pop();n?(this._scope.ReverseDirection=!0,this.OnDisplay(n,!1,!0)):this.OnClose()},i.prototype.OnClose=function(){this.OnHide(!0)},i.prototype.OnDismiss=function(){this._onDismissCallback?this._onDismissCallback():(this._scope.CurrentSection&&this._scope.CurrentSection.Scope&&this._scope.CurrentSection.Scope.$broadcast(n.Events.Names.Drawer.Dismissed),this.OnHide(!1))},i.prototype.OnHide=function(i){if(i===void 0&&(i=!1),!this.IsActing()&&this._scope.IsOpen){if(!i&&t.DrawerSection.GetPreventDismiss(this._scope.CurrentSection))return;if(this._sectionHistory=[],this._scope.CurrentSection&&this._scope.CurrentSection.Scope&&this._scope.CurrentSection.Scope.$broadcast(n.Events.Names.DrawerSection.Hidden),this.ShowQueuedDrawers())return;this._scope.IsClosing=!0;this._scope.IsOpen=!1;this._scope.CurrentSection=null}},i.prototype.OnQueue=function(n){this.IsSectionOpen(n.SectionKey)||this.IsLastInDrawerQueue(n.SectionKey)||(this._onConfirmCallback=n.OnConfirmCallback,this._onDismissCallback=n.OnDismissCallback,this._scope.CurrentSection?this._drawerQueue.push(n):this.OnDisplay(n,!1))},i.prototype.IsLastInDrawerQueue=function(n){return this._drawerQueue.length>0?_(this._drawerQueue).last().SectionKey===n:!1},i.prototype.OnOpen=function(t){var i=!1;n.Services.Common.ErrorService.IsExiting||(this.IsActing()?t.ShowAfterActionComplete?this._toOpenOnActionComplete=t:console.warn("Drawer '"+t.SectionKey+"' not shown as another drawer is acting"):i=!0);i&&(this.IsSectionOpen(t.SectionKey)||(this._scope.ReverseDirection=t.ReverseAnimationDirection||!1,this._onConfirmCallback=t.OnConfirmCallback,this._onDismissCallback=t.OnDismissCallback),this.OnDisplay(t,!0))},i.prototype.IsSectionOpen=function(n){return this._scope.CurrentSection?this._scope.CurrentSection.Key==n:!1},i.prototype.OnDisplay=function(t,i,r){if(r===void 0&&(r=!1),!this._sectionStore.Contains(t.SectionKey)){console.warn("Attempting to open drawer that is not registered ("+t.SectionKey+")");return}if(this._scope.CurrentSection){if(this.IsSectionOpen(t.SectionKey)){console.warn("Attempting to open drawer with the same key as is currently open, this is not supported ("+t.SectionKey+")");return}if(i){var u=this._scope.CurrentSection.Options;this._sectionHistory.push(u)}this._scope.CurrentSection&&this._scope.CurrentSection.Scope&&this._scope.CurrentSection.Scope.$broadcast(n.Events.Names.DrawerSection.Hidden)}!r&&t.PreFillHistory&&(this._sectionHistory=this._sectionHistory.concat(t.PreFillHistory));this._scope.CurrentSection=this._sectionStore.Get(t.SectionKey);this._scope.CurrentSection&&(this._scope.CurrentSection.Options=t,this.HandleDrawerOnConfirmCallbackOverride());this._scope.IsOpen||(t.PreventOpenAnimation&&(this._scope.PreventOpenAnimation=!0),this._scope.IsOpening=!0,this._scope.IsOpen=!0);this._scope.CurrentSection.Options.AllowBackOverride==null&&this.HandleDrawerAutoBackOverride();r||this.FireDrawerOpenedAnalytics();this._scope.$broadcast(n.Events.Names.ErrorMessage.Close)},i.prototype.FireDrawerOpenedAnalytics=function(){var n=this._scope.CurrentSection.Options.AnalyticsOptions;if(!n)!this._scope.CurrentSection.AnalyticsCategory||!this._scope.CurrentSection.AnalyticsAction||this._analyticsTracker.TrackEvent(this._scope.CurrentSection.AnalyticsCategory,this._scope.CurrentSection.AnalyticsAction,this._scope.CurrentSection.AnalyticsLabel);else{var t=n.IncludeDrawerIdInLabel?""+this._scope.CurrentSection.Id:"",i=n.IncludePagePathInLabel?""+window.location.pathname:"",r=[n.Label,t,i].filter(Boolean).join("|");this._analyticsTracker.TrackEvent(n.Category,n.Action,r)}},i.prototype.HandleDrawerAutoBackOverride=function(){this._scope.CurrentSection.Options.AllowBackOverride=this.HasAnyHistoryExcludingTheCurrentSection()?n.Data.DrawerBackOverride.AlwaysShow:n.Data.DrawerBackOverride.FromSitecore},i.prototype.HasAnyHistoryExcludingTheCurrentSection=function(){var n=this;return this._sectionHistory.filter(function(t){return t.SectionKey!==n._scope.CurrentSection.Key}).length>0},i.prototype.HandleDrawerOnConfirmCallbackOverride=function(){var n=this;this._scope.CurrentSection.Options.OnConfirmCallback||this._sectionHistory.length>0&&(this._onConfirmCallback=function(){n.OnBack()})},i.prototype.OnScroll=function(){this._rootScope.$broadcast(n.Events.Names.Drawer.Scroll)},i.prototype.OnKeyDown=function(n){n===27&&this.OnDismiss()},i.prototype.ShowQueuedDrawers=function(){var n=this._drawerQueue.shift();return n?(this.OnDisplay(n,!1),!0):!1},i.prototype.OnConfirm=function(){this._onConfirmCallback?this._onConfirmCallback():this.OnClose()},i.ControllerName="Controls_Drawer",i.$inject=["$scope","$rootScope","$window","IAnalyticsTracker","Controls_DrawerSectionStore"],i}();t.Drawer=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){n.TitleText=this.GetTitle(n);n.ScreenReaderTitleText=this.GetScreenReaderTitleText(n);n.SubtitleText=n.Section.Subtitle;n.AllowBack=this.GetAllowBack(n);n.BackButtonOverrideText=n.Section.BackButtonOverrideText;n.PreventDismiss=t.GetPreventDismiss(n.Section)}return t.prototype.GetTitle=function(n){return n.Section.Options&&n.Section.Options.TitleOverride?n.Section.Options.TitleOverride:n.Section.Title},t.prototype.GetScreenReaderTitleText=function(n){return n.Section.Options&&n.Section.Options.AdditionalScreenReaderTitle?n.Section.Options.AdditionalScreenReaderTitle:null},t.prototype.GetAllowBack=function(t){if(t.Section.Options){if(t.Section.Options.AllowBackOverride===n.Data.DrawerBackOverride.AlwaysShow)return!0;if(t.Section.Options.AllowBackOverride===n.Data.DrawerBackOverride.AlwaysHide)return!1;if(t.Section.Options.AllowBackOverride===n.Data.DrawerBackOverride.FromSitecore)return t.Section.AllowBack}return t.Section.AllowBack},t.GetPreventDismiss=function(n){return n.Options&&typeof n.Options.PreventDismissOverride=="boolean"?n.Options.PreventDismissOverride:n.PreventDismiss},t.ControllerName="Controls_DrawerSection",t.$inject=["$scope"],t}();t.DrawerSection=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f){this._scope=n;this._flightCardSettings=i;this._routesService=new Main3.Routes.RoutesService(t);n.ScheduledArrivalDayIsSameAsDepartureDay=this.ScheduledArrivalDayIsSameAsDepartureDay.bind(this);n.LookUpAirportName=this.LookUpAirportName.bind(this);n.GetUpdateText=this.GetUpdateText.bind(this);this._scope.ShowAlternativeOriginLink=this.ShowAlternativeOriginLink.bind(this);this._scope.ShowAlternativeDestinationLink=this.ShowAlternativeDestinationLink.bind(this);this._scope.ShowFlightProgress=this.ShowFlightProgress.bind(this);this._scope.GetStatusTextType=this.GetStatusTextType.bind(this);this._scope.OpenLowFareFinderDrawer=this.OpenLowFareFinderDrawer.bind(this);this._analyticsTracker=r;this._window=u;this._lowestFaresSettings=f;this._scope.OpenAlternativeOriginAirportsDrawer=this.OpenAlternativeOriginAirportsDrawer.bind(this);this._scope.OpenAlternativeDestinationAirportsDrawer=this.OpenAlternativeDestinationAirportsDrawer.bind(this);this._scope.MessageCarouselKey=this.GetMessageCarouselKey()}return t.prototype.OpenAlternativeOriginAirportsDrawer=function(t){t.preventDefault();var i={OnSelect:this.AlternativeOriginAirportChosen.bind(this),OriginIata:this._scope.Route.OriginIata,DestinationIata:this._scope.Route.DestinationIata},r={SectionKey:"routedatepicker-alternativeorigin",Parameters:i};this._analyticsTracker.TrackEvent("Choose Flights","Alternate Origin",this._window.location.pathname);n.Events.OpenDrawerWithOptions(r)},t.prototype.OpenAlternativeDestinationAirportsDrawer=function(t){t.preventDefault();var i={OnSelect:this.AlternativeDestinationAirportChosen.bind(this),OriginIata:this._scope.Route.OriginIata,DestinationIata:this._scope.Route.DestinationIata},r={SectionKey:"routedatepicker-alternativedestination",Parameters:i};this._analyticsTracker.TrackEvent("Choose Flights","Alternate Destination",this._window.location.pathname);n.Events.OpenDrawerWithOptions(r)},t.prototype.AlternativeOriginAirportChosen=function(t){if(n.Events.Fire(n.Events.Names.Drawer.Close),this._scope.FlightGridJourneyChange){var i={};i.OriginIata=t;this._scope.FlightGridJourneyChange(i)}},t.prototype.AlternativeDestinationAirportChosen=function(t){if(n.Events.Fire(n.Events.Names.Drawer.Close),this._scope.FlightGridJourneyChange){var i={};i.DestinationIata=t;this._scope.FlightGridJourneyChange(i)}},t.prototype.ShowAlternativeOriginLink=function(){return this._scope.EnableAlternativeOriginLink?this.HasAlternativeOrigin()&&!this._scope.IsReturnFlightCard:!1},t.prototype.ShowAlternativeDestinationLink=function(){return this._scope.EnableAlternativeDestinationLink?this.HasAlternativeDestination()&&!this._scope.IsReturnFlightCard:!1},t.prototype.HasAlternativeOrigin=function(){if(this._scope.Route){var n=this._routesService.FindAirportByIata(this._scope.Route.OriginIata),t=this._routesService.FindAirportByIata(this._scope.Route.DestinationIata);return this._routesService.HasNearbyOriginsForDestination(t,n)}return!1},t.prototype.HasAlternativeDestination=function(){var n=this._routesService.FindAirportByIata(this._scope.Route.OriginIata);return this._routesService.HasAlternativeDestinationForOrigin(n)},t.prototype.ScheduledArrivalDayIsSameAsDepartureDay=function(n){return n.LocalDepartureTime.Date().Equals(n.LocalArrivalTime.Date())},t.prototype.LookUpAirportName=function(n){var t=this._routesService.FindAirportByIata(n);return t?t.Name:n},t.prototype.GetUpdateText=function(n,t){var f,e;if(n.IsCancelled)return null;var i=t?n.LocalDepartureTime:n.LocalArrivalTime,r=t?n.EstimatedDepartureTime:n.EstimatedArrivalTime,u=t?n.ActualDepartureTime:n.ActualArrivalTime;if(!u){if(!!r&&this.IsLate(i,r))return f=t?this._flightCardSettings.EstimatedDepartureText:this._flightCardSettings.EstimatedArrivalText,e=this.GetDateTimeFormatForDelayed(r,i),this.DateTimeText(f,e,r)}else return this.IsLate(i,u)?(f=t?this._flightCardSettings.DepartedText:this._flightCardSettings.ArrivedText,e=this.GetDateTimeFormatForDelayed(u,i),this.DateTimeText(f,e,u)):t?this._flightCardSettings.DepartedOnTimeText:this._flightCardSettings.ArrivedOnTimeText;return this._flightCardSettings.OnTimeText},t.prototype.GetDateTimeFormatForDelayed=function(n,t){return n.Date().Equals(t.Date())?this._flightCardSettings.DelayedSameDayDateTimeFormat:this._flightCardSettings.DelayedOtherDayDateTimeFormat},t.prototype.IsLate=function(n,t){var i=t.Difference(n,Utilities.ZonelessDateTimePart.Minutes);return i>this._flightCardSettings.OnTimeThresholdMinutes},t.prototype.DateTimeText=function(n,t,i){var r=i.Format(t);return n.replace("{datetime}",r)},t.prototype.OpenLowFareFinderDrawer=function(){var t={OnSelect:this.LowestFareDrawerSelectDate.bind(this),OriginIata:this._scope.Route.OriginIata,DestinationIata:this._scope.Route.DestinationIata,DepartureDate:this._scope.Route.Date,ReturnDate:null,IsReturnDatePicker:!1,StartDate:null},i={SectionKey:"routedatepicker-lowestfares",Parameters:t,TitleOverride:this._scope.IsReturnFlightCard?this._flightCardSettings.LowestFaresReturnDateDrawerTitle:this._flightCardSettings.LowestFaresDepartureDateDrawerTitle,AdditionalScreenReaderTitle:this._lowestFaresSettings.ScreenReaderAlternativeText||null};this._analyticsTracker.TrackEvent("Choose Flights","Lowest Fare",this._window.location.pathname);n.Events.OpenDrawerWithOptions(i)},t.prototype.LowestFareDrawerSelectDate=function(t){if(n.Events.Fire(n.Events.Names.Drawer.Close),this._scope.FlightGridJourneyChange){var i={};this._scope.IsReturnFlightCard?i.ReturnDate=t:i.OutboundDate=t;this._scope.FlightGridJourneyChange(i)}},t.prototype.GetMessageCarouselKey=function(){var n=this._scope.Flight?this._scope.Flight.DepartureIata:this._scope.Route.OriginIata,t=this._scope.Flight?this._scope.Flight.ArrivalIata:this._scope.Route.DestinationIata;return""+n+t},t.prototype.ShowFlightProgress=function(){var n=!!this._scope.Flight&&!!this._scope.Flight.AdditionalStatusText;return!this.GetStatusTextType()&&!n},t.prototype.GetStatusTextType=function(){if(this._scope.Flight){if(this._scope.Flight.IsCancelled)return"cancelled";if(this._scope.Flight.IsFlown)return"flown";if(this._scope.Flight.IsDisrupted)return"disrupted";if(this._scope.Flight.IsCheckInClosed)return"checkinclosed";if(this._scope.Flight.IsStandBy)return"standby"}return null},t.$inject=["$scope","Sitecore_RoutesData","Sitecore_FlightCardSettings","IAnalyticsTracker","$window","Sitecore_RouteDatePickerLowestFaresDrawerSettings"],t}();t.FlightCard=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u){var f=this,e;this._scope=t;this._gridSettings=i;this._rootSettings=r;this._priceService=u;this._scope.GoToPreviousDay=this.GoToPreviousDay.bind(this);this._scope.GoToNextDay=this.GoToNextDay.bind(this);this._scope.SelectFlightFare=this.SelectFlightFare.bind(this);this._scope.IsWithinValidSelection=!0;this._scope.AnimationsEnabled=!1;this._scope.$on(n.Events.Names.FlightGrid.SelectFlightFareRequest,function(n,t){f.RoutesAreTheSame(f._scope.Route,t.Route)&&f.SetSelectedFare(t.ChosenFare)});e=this._scope.$root;e.$on(n.Events.Names.FlightGrid.ShowLoadingSpinners,function(){f._scope.Days.forEach(function(n){n.IsLoading=!0})});this._initialLoadComplete=!1}return t.prototype.RoutesAreTheSame=function(n,t){return n.Date.Equals(t.Date)&&n.OriginIata===t.OriginIata&&n.DestinationIata===t.DestinationIata},t.prototype.RoutesAreDifferent=function(n,t){return!this.RoutesAreTheSame(n,t)},t.prototype.StartUp=function(t){t===void 0&&(t=null);this._allowTitleAnimations=!!t;this._scope.Days=[];var i={Days:this._scope.Days,IncludePastFlights:this._scope.ShowPastFlights,PriceService:this._priceService,RootSettings:this._rootSettings,Upserter:t,GetShowFlexiFares:this.GetShowFlexiFares.bind(this)};this._dayManager=new Main3.FlightGrid.DayManager(i);this._dayManager.OnSelectedFlightFareUpdated.add(this.OnSelectedFlightFareUpdated.bind(this));this._dayManager.OnUpsertCompleted.add(this.OnDayManagerUpsertCompleted.bind(this));this.Initialize();this._dayManager.BeforeQuery();this._scope.$emit(n.Events.Names.AvailabilityFlightsProvider.RegisterSubscriber,this)},t.prototype.GetShowFlexiFares=function(){return this._scope.ShowFlexiFares},t.prototype.OnSelectedFlightFareUpdated=function(t,i){if(t==null)this.SetSelectedFare(null),this._scope.$emit(n.Events.Names.FlightGrid.FlightFareSelected,null);else if(!i.Selected||t.IsOriginalFlight||i.Selectable){if(!t.IsOriginalFlight&&this.FareTypeOrRouteHaveChanged(t,i)){var r={Flight:t,FareType:i.FareType};this._scope.$emit(n.Events.Names.FlightGrid.FlightFareSelected,r)}}else i.Selected=!1,this.SetSelectedFare(null),this._scope.$emit(n.Events.Names.FlightGrid.FlightFareSelected,null)},t.prototype.FareTypeOrRouteHaveChanged=function(n,t){return!(n.SegmentId==this._scope.ChosenFare.FlightSegmentId&&_.isEqual(t.FareType,this._scope.ChosenFare.FareType))},t.prototype.ReInitialize=function(){this._scope.AnimationsEnabled=!1;this.Initialize();Utilities.ScreenReader.Alert(this._gridSettings.OnChangeSearchHelpText,"flightGridChangeRouteAlert")},t.prototype.Initialize=function(){var n=this;this._scope.Route&&(this._dayManager.Initialize(this._scope.Route,function(){return n._scope.FocalDate},this._scope.ChosenFare,this._scope.OriginalFlight,this._scope.IsOneWayJourney,this._scope.IsReturnSegment),this._scope.IsPreviousDayEnabled=this.CheckPreviousEnabled())},t.prototype.OnDayManagerUpsertCompleted=function(){var t=this;this._initialLoadComplete?this.Refreshed():this.InitialLoadCompleted();setTimeout(function(){t._scope.$emit(n.Events.Names.EqualHeight.Refresh);t._allowTitleAnimations&&(t._scope.AnimationsEnabled=!0)},1)},t.prototype.Refreshed=function(){this._scope.$emit(n.Events.Names.FlightGrid.Refreshed)},t.prototype.InitialLoadCompleted=function(){this.WatchForChosenFareChanges();this.SetMinimumDateWatch();this.SetMaximumDateWatch();this.UpdateBoundingDates();this._initialLoadComplete=!0;this._scope.$emit(n.Events.Names.FlightGrid.InitialLoadComplete)},t.prototype.WatchForChosenFareChanges=function(){var n=this;this._scope.$watch(function(n){return n.ChosenFare},function(t,i){n._dayManager&&!n._dayManager.IsInitializing&&(n.ChosenFaresMatch(t,i)||n.SetSelectedFare(t))})},t.prototype.ChosenFaresMatch=function(n,t){var i=!1;return n&&t?i=n.FareType===t.FareType&&n.FlightSegmentId===t.FlightSegmentId:n||t||(i=!0),i},t.prototype.SetSelectedFare=function(n){this._dayManager&&this._dayManager.SetSelectedFlightFare(n)},t.prototype.RemoveSelectedFare=function(){this.SetSelectedFare(null)},t.prototype.SelectFlightFare=function(t,i){if(t.Selectable&&!t.Selected&&this.IsWithinBoundingDates(i)){var r={Flight:i,FareType:t.FareType};this._scope.$emit(n.Events.Names.FlightGrid.FlightFareSelected,r)}else this.ShowSelectionFailedDrawers(t,i)},t.prototype.ShowSelectionFailedDrawers=function(t,i){var r=Main3.FlightGrid.FlightUtilities.GetFlightDateStatus(i,this._scope.MinimumDate,this._scope.MaximumDate);(r===Main3.FlightGrid.Data.FlightDateStatus.OverMaximum||r===Main3.FlightGrid.Data.FlightDateStatus.UnderMinimum)&&t.Selectable?n.Events.OpenDrawer("funnel-return-before-outbound"):r===Main3.FlightGrid.Data.FlightDateStatus.Within2HoursOfOther&&n.Events.OpenDrawer("funnel-flight-times-too-close")},t.prototype.IsWithinBoundingDates=function(n){var t=Main3.FlightGrid.FlightUtilities.GetFlightDateStatus(n,this._scope.MinimumDate,this._scope.MaximumDate);return t===Main3.FlightGrid.Data.FlightDateStatus.Valid},t.prototype.UpdateBoundingDates=function(){this._dayManager&&(this._scope.MaximumDate&&this._scope.MinimumDate?this._dayManager.UpdateBoundingDates(this._scope.MaximumDate,this._scope.MinimumDate):this._scope.MaximumDate?this._dayManager.UpdateBoundingDates(this._scope.MaximumDate,null):this._scope.MinimumDate?this._dayManager.UpdateBoundingDates(null,this._scope.MinimumDate):this._dayManager.UpdateBoundingDates(null,null))},t.prototype.GoToPreviousDay=function(){this.MoveDay(this._scope.FocalDate.AddDays(-1))},t.prototype.GoToNextDay=function(){this.MoveDay(this._scope.FocalDate.AddDays(1))},t.prototype.MoveDay=function(n){var t=this;this._scope.FocalDate=n;setTimeout(function(){return t._requestFlightsCallback()},0)},t.prototype.CheckPreviousEnabled=function(){var t,n=Utilities.TimeAgnosticDate.TodayLocal(),i;return n=this._scope.OriginalFlight?this._scope.OriginalFlight.LocalDepartureTime.Date():this._scope.FocalDate,t=n.ToSortable()<Utilities.TimeAgnosticDate.TodayLocal().ToSortable()?n:Utilities.TimeAgnosticDate.TodayLocal(),i=this._scope.FocalDate,i.ToSortable()>t.ToSortable()},t.prototype.SetMaximumDateWatch=function(){var n=this;this._scope.IsReturnSegment||this._scope.$watch(function(n){return n.MaximumDate},function(t){var i,r,u;t&&(i=t.Date(),r=n._dayManager.GetMinimumVisibleDate().AddDays(Main3.FlightGrid.DayManager.DaysEitherSideToShow*2),!n._scope.ChosenFare&&r.ToSortable()>i.ToSortable()&&(u=i.AddDays(-Main3.FlightGrid.DayManager.DaysEitherSideToShow),n.MoveDay(u)));n.UpdateBoundingDates()})},t.prototype.SetMinimumDateWatch=function(){var n=this;this._scope.IsReturnSegment&&this._scope.$watch(function(n){return n.MinimumDate},function(t){var i,r,u;t&&(i=t.Date(),r=n._dayManager.GetMaximumVisibleDate().AddDays(-(Main3.FlightGrid.DayManager.DaysEitherSideToShow*2)),!n._scope.ChosenFare&&i.ToSortable()>r.ToSortable()&&(u=i.AddDays(Main3.FlightGrid.DayManager.DaysEitherSideToShow),n.MoveDay(u)));n.UpdateBoundingDates()})},t.prototype.BeginUpsertFlights=function(n){this._scope.IsPreviousDayEnabled=this.CheckPreviousEnabled();n&&this.ReInitialize();this._dayManager.BeforeQuery()},t.prototype.EndUpsertFlights=function(n){this._dayManager.OnQuerySuccess(n)},t.prototype.CurrentAvailabilityParameters=function(){return{OriginIata:this._scope.Route.OriginIata,DestinationIata:this._scope.Route.DestinationIata,IsReturnLeg:this._scope.IsReturnSegment,IsOneWayJourney:this._scope.IsOneWayJourney}},t.prototype.SetRequestFlightsCallback=function(n){this._requestFlightsCallback=n},t.prototype.IsValid=function(){return!0},t.$inject=["$scope","Sitecore_FlightGridSettings","Sitecore_FunnelRootSettings","Common_PriceService"],t}();t.FlightGrid=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i){this._rootScope=t;this._scope=i;this._fareStatusCalculator=new Main3.FlightGrid.FareStatusCalculator;this._scope.FareStatus=Main3.FlightGrid.Data.FareStatus;this._scope.IsFlexiFare=this.IsFlexiFare.bind(this);this._scope.SelectFare=this.SelectFare.bind(this);this._scope.ShowGridFareTitle=this.ShowGridFareTitle.bind(this);this._scope.ShowGridFareText=this.ShowGridFareText.bind(this);this._scope.IsGridFareValidForIcon=this.IsGridFareValidForIcon.bind(this);this._scope.IsWithinValidDates=this.IsWithinValidDates.bind(this);this._scope.GetFareDisplayPrice=this.GetFareDisplayPrice.bind(this);this._scope.IsFareSelectable=this.IsFareSelectable.bind(this);this._scope.IsSelectedInAnotherPair=this.IsSelectedInAnotherPair.bind(this);this._scope.IsNotPromotionalFlight=this.IsNotPromotionalFlight.bind(this);this._scope.IsSaleFlight=this.IsSaleFlight.bind(this);this._scope.IsSaveFlight=this.IsSaveFlight.bind(this);this._scope.HandleSkipLinkClick=this.HandleSkipLinkClick.bind(this);this._scope.BasketSkipLinkType=n.Data.Common.PickFlightsSkipLinkTargetType.Basket;this._scope.OutboundSkipLinkType=n.Data.Common.PickFlightsSkipLinkTargetType.Outbound;this._scope.ReturnSkipLinkType=n.Data.Common.PickFlightsSkipLinkTargetType.Return;this._rootScope.$on(n.Events.Names.Funnel.FlightAddedToBasket,this.RefreshCachedFareStatuses.bind(this));this._rootScope.$on(n.Events.Names.FlightGrid.Refreshed,this.RefreshCachedFareStatuses.bind(this))}return t.prototype.RefreshCachedFareStatuses=function(){this._fareStatus=null;this._flexiFareStatus=null},t.prototype.IsSelectedInAnotherPair=function(n){return this.GetFareStatus(n)===Main3.FlightGrid.Data.FareStatus.SelectedInAnotherPair},t.prototype.IsFlexiFare=function(t){return t.FareType===n.Data.Common.FlightFareType.Flexi},t.prototype.SelectFare=function(n){this.IsFareSelectable(n)===!0&&this._scope.OnFareSelect(n,this._scope.Flight)},t.prototype.ShowGridFareTitle=function(n){var t=this.GetFareStatus(n);return this._scope.ShowFareTitles&&t===Main3.FlightGrid.Data.FareStatus.Prices},t.prototype.ShowGridFareText=function(n,t){return this.GetFareStatus(t)===n},t.prototype.GetFareStatus=function(t){return t.FareType==n.Data.Common.FlightFareType.Flexi?(this._flexiFareStatus||(this._flexiFareStatus=this.CalculateUncachedFareStatus(t)),this._flexiFareStatus):(this._fareStatus||(this._fareStatus=this.CalculateUncachedFareStatus(t)),this._fareStatus)},t.prototype.CalculateUncachedFareStatus=function(n){return this._fareStatusCalculator.GetFareStatus(this._scope.Flight,n,this._scope.FlightIsSelectedInOtherPairs)},t.prototype.IsGridFareValidForIcon=function(n){return this.IsFareSelectable(n)&&this.IsWithinValidDates()},t.prototype.IsWithinValidDates=function(){var n=Main3.FlightGrid.FlightUtilities.GetFlightDateStatus(this._scope.Flight,this._scope.MinimumDate,this._scope.MaximumDate);return n===Main3.FlightGrid.Data.FlightDateStatus.Valid},t.prototype.GetFareDisplayPrice=function(n){return this._scope.ShowChildPrices?n.Prices.Child:n.Prices.Adult},t.prototype.IsFareSelectable=function(n){var t=this.GetFareStatus(n);return n.Selectable&&t!==Main3.FlightGrid.Data.FareStatus.SelectedInAnotherPair&&t!==Main3.FlightGrid.Data.FareStatus.OtherFareTypeSelectedInAnotherPair},t.prototype.IsNotPromotionalFlight=function(t){return t.PromotionalFareType==n.Data.Common.PromotionalFareType.None},t.prototype.IsSaleFlight=function(t){return t.PromotionalFareType==n.Data.Common.PromotionalFareType.Sale},t.prototype.IsSaveFlight=function(t){return t.PromotionalFareType==n.Data.Common.PromotionalFareType.Save},t.prototype.HandleSkipLinkClick=function(t,i,r){t.preventDefault();var u=$jq(r);Main3.Common.Scrolling.PreservePageScrollPosition(function(){u.focus()});i!==n.Data.Common.PickFlightsSkipLinkTargetType.Basket&&Main3.Common.Scrolling.ScrollToElement(u)},t.$inject=["$rootScope","$scope"],t}();t.FlightGridFlight=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r){var u=this;this._scope=t;this._rootScope=i;this._timeout=r;this._scope.FlightNumberError=!1;this._rootScope.FindFlight_Scope=this._scope;this._rootScope.$on(n.Events.Names.FlightTracker.FlightNumberFinder.Validate,function(n,t,i){u._flightNumberForm=i;u.CheckInput(t)})}return t.prototype.CheckInput=function(n){var t=this;this._flightNumberForm.removeClass("invalid");this.ToggleInvalidClass(n);this._scope.FlightNumberError=!1;this._scope.$apply();this._timeout(function(){t._scope.FlightNumberError=!n;t._scope.$apply()})},t.prototype.ToggleInvalidClass=function(n){n?this._flightNumberForm.removeClass("invalid"):this._flightNumberForm.addClass("invalid")},t.ControllerName="FlightTracker_FlightNumberFinder",t.$inject=["$scope","$rootScope","$timeout"],t}();t.FlightNumberFinder=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._scope=n;this._rootScope=t;this._flightPassengersSettings=i;n.DoOnPassengerDetailsClick=this.OnPassengerDetailsClick.bind(this);this.UpdatePassengerSummary()}return t.prototype.UpdatePassengerSummary=function(){this._scope.Passengers&&(this._scope.PassengerSummary=this.BuildPassengerSummary(),this._scope.SpecialServiceRequests=this._scope.Passengers.NumberOfPassengersWithSsrs())},t.prototype.BuildPassengerSummary=function(){var t=this._scope.Passengers.PassengerComposition(this._scope.Flight.InternalId),n=[];return n=this.PushPassengerPart(n,t.Adults,this._flightPassengersSettings.OneAdultText,this._flightPassengersSettings.AdultsText),n=this.PushPassengerPart(n,t.Children,this._flightPassengersSettings.OneChildText,this._flightPassengersSettings.ChildrenText),n=this.PushPassengerPart(n,t.Infants,this._flightPassengersSettings.OneInfantText,this._flightPassengersSettings.InfantsText),n.join(", ")},t.prototype.PushPassengerPart=function(n,t,i,r){return t==1?n.push(i):t>1&&n.push(r.replaceAll("{number}",t.toString())),n},t.prototype.OnPassengerDetailsClick=function(t){t.preventDefault();var i={Luggage:this._scope.Luggage,Passengers:this._scope.Passengers,Flight:this._scope.Flight,IgnoreSeatReservations:this._scope.IgnoreSeatReservations,Ancillaries:this._scope.Ancillaries};n.Events.OpenDrawerWithOptions({SectionKey:"passenger-details",Parameters:i})},t.$inject=["$scope","$rootScope","Sitecore_FlightPassengersSettings"],t}();t.FlightPassengers=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i){var r=this;this._scope=t;this._timeout=i;this._scope.OriginIata=this._scope.InitialFlight.DepartureIata;this._scope.DestinationIata=this._scope.InitialFlight.ArrivalIata;this._scope.DatePickerDate=this._scope.InitialFlight.LocalDepartureTime.Date();this._scope.IsFlightSearchVisible=!1;this._scope.DoHide=this.Hide.bind(this);this._scope.DoShow=this.Show.bind(this);this._scope.DoShowFlights=this.ShowFlightsButtonClicked.bind(this);this._scope.$on(n.Events.Names.RouteSearch.SearchValid,this.SearchValid.bind(this));this._scope.$on(n.Events.Names.RouteSearch.SearchInvalid,this.SearchError.bind(this));this._scope.$on(n.Events.Names.RouteSearch.ChangeMade,this.OnRouteSearchChangeMade.bind(this));this._scope.$watch(function(n){return n.IsVisible()},function(n){n||r.Hide()})}return t.prototype.Show=function(){this._scope.IsFlightSearchVisible=!0;this._scope.$emit(n.Events.Names.FlightSearch.SearchStarted)},t.prototype.Hide=function(){this._scope.IsFlightSearchVisible=!1;this._scope.$emit(n.Events.Names.FlightSearch.SearchCancelled)},t.prototype.ShowFlightsButtonClicked=function(){this._buttonHasJustBeenPressed=!0;this._scope.$broadcast(n.Events.Names.RouteSearch.Validate)},t.prototype.SearchValid=function(n,t){this._buttonHasJustBeenPressed&&this.SearchCompleted(t);this._buttonHasJustBeenPressed=!1},t.prototype.SearchCompleted=function(t){this.Hide();t.Date=this._scope.DatePickerDate;this._scope.$emit(n.Events.Names.FlightSearch.SearchCompleted,t)},t.prototype.SearchError=function(){this._buttonHasJustBeenPressed=!1},t.prototype.OnRouteSearchChangeMade=function(n,t){this._scope.OriginIata=t.OriginIata;this._scope.DestinationIata=t.DestinationIata},t.ControllerName="Controls_FlightSearch",t.$inject=["$scope","$timeout"],t}();t.FlightSearch=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._scope=n;this._modelBuilder=new Main3.SimpleTemplate.ModelBuilders.DatePickerDrawerModelBuilder(t.CurrentCultureFirstDayOfWeek);this._parameters=this._scope.CurrentSection.Options.Parameters;this.SetupDrawer()}return n.prototype.SetupDrawer=function(){this._scope.SimpleModel=this._modelBuilder.BuildBasedOnFixedDateRange(this._parameters.StartDate,this._parameters.EndDate);this._scope.OnSelect=this.OnSelect.bind(this);this._scope.StartHighlightDate=this._parameters.StartHighlightDate;this._scope.EndHighlightDate=this._parameters.EndHighlightDate;this._scope.IsReturnDatePicker=this._parameters.StartHighlightDate!=null&&this._parameters.EndHighlightDate!=null},n.prototype.OnSelect=function(n,t,i){var r=Utilities.TimeAgnosticDate.FromParts(n,t,i);this._scope.DoBack();this._parameters.OnSelectDate(r)},n.ControllerName="Controls_GenericDatePickerDrawer",n.$inject=["$scope","Sitecore_SitecoreLanguageSettings"],n}();n.GenericDatePickerDrawer=t})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r){var u=this;this._scope=t;this._window=i;this._tracker=r;this._scope.IsSubDrawerOpen=!1;this._scope.InitialiseDrawerTracking=this.InitialiseDrawerTracking.bind(this);this._scope.OpenSubDrawer=this.OpenSubDrawer.bind(this);this._scope.$on(n.Events.Names.DrawerSection.Shown,function(){u._scope.TrackDrawerOpening&&!u._scope.IsSubDrawerOpen&&u.TrackOpenDrawerEvent(u._scope.AnalyticsCategory,u._scope.AnalyticsAction)});this._scope.$on(n.Events.Names.Drawer.Closing,function(){u._scope.IsSubDrawerOpen=!1})}return t.prototype.InitialiseDrawerTracking=function(n,t,i){this._scope.TrackDrawerOpening=n;this._scope.AnalyticsCategory=t;this._scope.AnalyticsAction=i},t.prototype.OpenSubDrawer=function(t,i,r,u){n.Events.OpenDrawer(t);this._scope.IsSubDrawerOpen=!0;i&&this.TrackOpenDrawerEvent(r,u)},t.prototype.TrackOpenDrawerEvent=function(n,t){var i=this._window.location.pathname;this._tracker.TrackEvent(n,t,i)},t.ControllerName="Controls_ListDrawer",t.$inject=["$scope","$window","IAnalyticsTracker"],t}();t.ListDrawer=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r){this._scope=t;this._settings=i;this._tracker=r;this._easyJetBooleanPropertyName=this._settings.ModelBindingPrefix+"OptInForEasyJetMailing";this._thirdPartyBooleanPropertyName=this._settings.ModelBindingPrefix+"OptInForMailing";this._scope.$watch(this._easyJetBooleanPropertyName,this.EasyJetMailingValueChanged.bind(this));this._settings.ShowThirdPartyMailingPreferences&&this._scope.$watch(this._thirdPartyBooleanPropertyName,this.ThirdPartyMailingValueChanged.bind(this));this._scope.$on(n.Events.Names.Funnel.FunnelReady,this.SetDefaultOptions.bind(this))}return t.prototype.SetDefaultOptions=function(){this._settings.ShowThirdPartyMailingPreferences&&this.SetThirdPartyOptInValue(this.ConvertDefaultSettingToNullableBoolean(this._settings.ThirdPartyMailingDefaultSelection));this.SetEasyJetOptInValue(this.ConvertDefaultSettingToNullableBoolean(this._settings.EasyJetMailingDefaultSelection))},t.prototype.ConvertDefaultSettingToNullableBoolean=function(n){return!!n&&n.toLowerCase()==="yes"?!0:!!n&&n.toLowerCase()==="no"?!1:null},t.prototype.SetEasyJetOptInValue=function(n){this.SetBooleanScopeVariable(this._easyJetBooleanPropertyName,n)},t.prototype.SetThirdPartyOptInValue=function(n){this.SetBooleanScopeVariable(this._thirdPartyBooleanPropertyName,n)},t.prototype.SetBooleanScopeVariable=function(n,t){t===!0?this._scope.$eval(n+" = true;"):t===!1&&this._scope.$eval(n+" = false;")},t.prototype.EasyJetMailingValueChanged=function(n){this._scope.ThirdPartyEnabled=n;n!==!1&&(n!==!0||this._settings.ShowThirdPartyMailingPreferences)||this.SetThirdPartyOptInValue(!1);var t=null;n===!0?(t="Opt in",Utilities.ScreenReader.Alert(this._settings.EasyJetMailingOptionScreenreaderOptIn,"MailingPreferences")):n===!1&&(t="Opt out",Utilities.ScreenReader.Alert(this._settings.EasyJetMailingOptionScreenreaderOptOut,"MailingPreferences"));!t||this._tracker.TrackEvent(Tracking.EventConstants.Categories.BookerDetails,Tracking.EventConstants.Actions.GdprEjRadio,t)},t.prototype.ThirdPartyMailingValueChanged=function(n){var t=null;n===!0?(t="Opt in",Utilities.ScreenReader.Alert(this._settings.ThirdPartyMailingOptionScreenreaderOptIn,"MailingPreferences")):n===!1&&(t="Opt out",Utilities.ScreenReader.Alert(this._settings.ThirdPartyMailingOptionScreenreaderOptOut,"MailingPreferences"));!t||this._tracker.TrackEvent(Tracking.EventConstants.Categories.BookerDetails,Tracking.EventConstants.Actions.Gdpr3pRadio,t)},t.ControllerName="Controls_MailingPreferences",t.$inject=["$scope","Sitecore_MailingPreferences","IAnalyticsTracker"],t}();t.MailingPreferences=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this._scope=n;this._messageCarouselService=t;this._scope.CarouselMessages=new Dictionary;this._scope.ShowCarouselMessages=this.ShowCarouselMessages.bind(this);this.RegisterMessageCarousel()}return t.prototype.RegisterMessageCarousel=function(){var n={Key:this._scope.Key,OnAdd:this.OnMessageAdded.bind(this),OnRemove:this.OnMessageRemoved.bind(this),GetCurrentMessages:this.GetCurrentMessages.bind(this)};this._messageCarouselService.RegisterCarousel(n)},t.prototype.GetCurrentMessages=function(){return this._scope.CarouselMessages.AllValues()},t.prototype.OnMessageAdded=function(n,t){var i,r;this._scope.CarouselMessages.ContainsKey(n)?(i=this._scope.CarouselMessages.Get(n),i.Message=t):(r={Key:n,Message:t},this._scope.CarouselMessages.Set(n,r))},t.prototype.OnMessageRemoved=function(t){this._scope.CarouselMessages.ContainsKey(t)&&this._scope.CarouselMessages.Remove(t);this._scope.CarouselMessages.AllKeys().length===0&&this._scope.$emit(n.Events.Names.EqualHeight.Refresh)},t.prototype.ShowCarouselMessages=function(){return this._scope.CarouselMessages&&this._scope.CarouselMessages.AllKeys().length>0},t.$inject=["$scope","Controls_MessageCarouselService"],t}();t.MessageCarouselController=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t){var i=this;this._scope=t;this._currentYear=(new Date).getFullYear();this._currentMonth=(new Date).getMonth()+1;this._scope.GetValidExpiryMonths=this.GetValidExpiryMonths.bind(this);this._scope.GetValidExpiryYears=this.GetValidExpiryYears.bind(this);this._scope.GetValidStartMonths=this.GetValidStartMonths.bind(this);this._scope.GetValidStartYears=this.GetValidStartYears.bind(this);this._scope.ScrollToDetailsEventName=n.Events.Names.PaymentCard.ScrollToDetails;this._allMonths=this.GetAllMonths();this._scope.$watch(function(n){return n.NewPaymentCardForm.$valid},function(n){return i._scope.NewPaymentCard.Valid=n});this._scope.$watch(function(n){return n.ChosenStartMonth},function(n){return i._scope.NewPaymentCard.StartDateMonth=n?n.Value:null});this._scope.$watch(function(n){return n.ChosenExpiryMonth},function(n){return i._scope.NewPaymentCard.ExpiryDateMonth=n?n.Value:null})}return t.prototype.GetAllMonths=function(){for(var i,r,t=[],n=1;n<=12;n++)i=n<10?"0":"",r={Label:i+n,Value:n},t.push(r);return t},t.prototype.GetValidExpiryMonths=function(){return this.GetValidMonths(this.ExpiryMonthValid.bind(this))},t.prototype.GetValidStartMonths=function(){return this.GetValidMonths(this.StartMonthValid.bind(this))},t.prototype.GetValidMonths=function(n){return _(this._allMonths).select(function(t){return n(t.Value)})},t.prototype.GetValidExpiryYears=function(n){return this.GetValidYears(0,n,this.ExpiryYearValid.bind(this))},t.prototype.GetValidStartYears=function(n){return this.GetValidYears(-n,0,this.StartYearValid.bind(this))},t.prototype.GetValidYears=function(n,t,i){for(var u,f=[],r=n;r<=t;r++)u=this._currentYear+r,i(u)&&f.push(u);return f},t.prototype.ExpiryMonthValid=function(n){return!!this._scope.NewPaymentCard&&this._currentYear==this._scope.NewPaymentCard.ExpiryDateYear?n>=this._currentMonth:!0},t.prototype.StartMonthValid=function(n){return!!this._scope.NewPaymentCard&&this._currentYear==this._scope.NewPaymentCard.StartDateYear?n<=this._currentMonth:!0},t.prototype.ExpiryYearValid=function(n){return!this._scope.NewPaymentCard||!this._scope.NewPaymentCard.ExpiryDateMonth||this._currentMonth<=this._scope.NewPaymentCard.ExpiryDateMonth||this._currentYear!=n},t.prototype.StartYearValid=function(n){return!this._scope.NewPaymentCard||!this._scope.NewPaymentCard.StartDateMonth||this._currentMonth>=this._scope.NewPaymentCard.StartDateMonth||this._currentYear!=n},t.$inject=["$scope"],t}();t.NewPaymentCardDetails=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(t){function i(n,i,r,u,f,e,o,s,h,c,l){var a=t.call(this,u,e,f,s,c,l,h)||this;return a._deepLinksService=n,a._npaxDrawerSettings=i,a._searchPodSubmissionService=r,a._scope.IsOnePassengerIgnoringInfants=a.IsOnePassengerIgnoringInfants.bind(a),a._doesNotUseRouteSearch=!0,a.Initialise(),a}return __extends(i,t),i.prototype.Initialise=function(){var n=this._scope.Section.Options.Parameters;this._deepLink=this._deepLinksService.FromUrl(n.DealLink);this._scope.Route={Date:this._deepLink.DepartureDate,DestinationIata:this._deepLink.DestinationIata,OriginIata:this._deepLink.OriginIata};this.SetSearchPodModel()},i.prototype.BuildInitialSearchPodModel=function(){var n=this._deepLink.ReturnDate?this._deepLink.ReturnDate:this._deepLink.DepartureDate.AddDays(this._npaxDrawerSettings.DefaultTripLength),t={Adults:this._deepLink.Adults,Children:this._deepLink.Children,Infants:this._deepLink.Infants};return{OriginIata:this._deepLink.OriginIata,DestinationIata:this._deepLink.DestinationIata,IsOneWayFlight:!this._deepLink.ReturnDate,DepartureDate:this._deepLink.DepartureDate,ReturnDate:n,Passengers:t,RecentSearches:0}},i.prototype.IsOnePassengerIgnoringInfants=function(){return this._scope.SearchPodModel.Passengers.Adults+this._scope.SearchPodModel.Passengers.Children==1},i.prototype.FormAction=function(){this._deepLink.Adults=this._scope.SearchPodModel.Passengers.Adults;this._deepLink.Children=this._scope.SearchPodModel.Passengers.Children;this._deepLink.Infants=this._scope.SearchPodModel.Passengers.Infants;this._deepLink.DepartureDate=this._scope.SearchPodModel.DepartureDate;this._deepLink.ReturnDate=this._scope.SearchPodModel.IsOneWayFlight?null:this._scope.SearchPodModel.ReturnDate;this._searchPodSubmissionService.ShowInfoDrawersAndSubmitTheForm(this._scope.SearchPodModel,!0,this.DeepLinkRedirect.bind(this))},i.prototype.DeepLinkRedirect=function(){this._deepLink.OpenSearchPanel=!1;this.RedirectTo(this._deepLinksService.ToUrl(this._deepLink))},i.prototype.RedirectTo=function(n){window.location.href=n},i.prototype.ValidateRouteSearch=function(){this._scope.$broadcast(n.Events.Names.RouteDatePicker.Validate)},i.ControllerName="Controls_NpaxDrawer",i.$inject=["Common_DeepLinksService","Sitecore_NpaxDrawerSettings","Controls_SearchPodSubmissionService","$scope","Worldwide_CombinedRoutesService","Sitecore_SearchPodSettings","Sitecore_RoutesData","Controls_LowestFaresApiService","Controls_SearchPodRouteDatesPreloader","Controls_LowestFaresDataFlightFinder","Controls_RouteDataFlightFinder"],i}(n.Controllers.Controls.SearchPod.BaseSearchPodController);t.NpaxDrawer=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this.QuantityPlaceholder="{quantity}";this.WeightPlaceholder="{weight}";this.NamePlaceholder="{name}";this._scope=n;this._scope.IsChildType=this.IsChildType.bind(this);this._scope.HasInfant=this.HasInfant.bind(this);this._scope.GetSeatNumber=this.GetSeatNumber.bind(this);this._scope.FormatNumber=this.FormatNumber.bind(this);this._scope.FormatBag=this.FormatBag.bind(this);this._scope.FormatSportsEquipment=this.FormatSportsEquipment.bind(this);var i=this._scope.Section.Options.Parameters;i.Luggage?(this._scope.Bags=i.Luggage.HoldBags,this._scope.SportsEquipment=i.Luggage.SportsEquipment):(this._scope.Bags=[],this._scope.SportsEquipment=[]);this._scope.Flight=i.Flight;this._scope.Passengers=i.Passengers;this._scope.IgnoreSeatReservations=i.IgnoreSeatReservations;this._scope.Ancillaries=this.GetAncillaries(i.Ancillaries);this._scope.SportsEquipmentNames=t.SportsEquipmentNames.Names;this._scope.BagFormat=t.BagFormat;this._scope.SportsEquipmentFormat=t.SportsEquipmentFormat;this._scope.SeatSelectedText=t.SeatSelectedText;this._scope.EasyJetPlusText=t.EasyJetPlusText}return t.prototype.GetAncillaries=function(n){if(n)return this._scope.HasAncillaries=n.HasCar||n.HasHotelBooking||n.HasTravelInsurance,{HasCarAdded:n.HasCar,HasHotelAdded:n.HasHotelBooking,HasInsuranceAded:n.HasTravelInsurance}},t.prototype.IsChildType=function(t){return t==n.Data.Common.PassengerDataType.Child},t.prototype.HasInfant=function(n){return!!this._scope.Passengers.GetInfantForPassenger(n.InternalId,this._scope.Flight.InternalId)},t.prototype.GetSeatNumber=function(n){return this._scope.Passengers.GetSeatNumberForPassenger(n.InternalId,this._scope.Flight.InternalId)},t.prototype.FormatNumber=function(n,t){return n.replaceAll("{number}",t)},t.prototype.FormatBag=function(n){var t=this._scope.BagFormat;return t=t.replaceAll(this.QuantityPlaceholder,n.Quantity.toString()),t.replaceAll(this.WeightPlaceholder,n.TotalWeight.toString())},t.prototype.FormatSportsEquipment=function(n){var i=this.GetSportsEquipmentName(n),t;return n.Quantity?(t=this._scope.SportsEquipmentFormat,t=t.replaceAll(this.QuantityPlaceholder,n.Quantity.toString()),t.replaceAll(this.NamePlaceholder,i)):i},t.prototype.GetSportsEquipmentName=function(n){var t=this._scope.SportsEquipmentNames.filter(function(t){return t.CodeName==n.Type});return t.length>0?n.Quantity?t[0].SingularText:t[0].UnknownQuantityText:n.Type+(n.Quantity?"":"(s)")},t.ControllerName="Controls_PassengerDetailsDrawer",t.$inject=["$scope","Sitecore_PassengerDetailsDrawerSettings"],t}();t.PassengerDetailsDrawer=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){var i=this;this._scope=n;this._settings=t;this._scope.IncrementQuantity=this.IncrementQuantity.bind(this);this._scope.DecrementQuantity=this.DecrementQuantity.bind(this);this._scope.ResetIfNotANumber=this.ResetIfNotANumber.bind(this);this._scope.ValidQuantity=this.ValidQuantity.bind(this);this._scope.NoQuantitySet=this.NoQuantitySet.bind(this);this._scope.$watch(function(n){return n.Quantity},function(n,t){i.FireAnalyticsEventForQuantityChange(n,t)})}return n.prototype.FireAnalyticsEventForQuantityChange=function(n,t){this._scope.Validation(n)&&(n>t&&this._scope.CanIncrementQuantity(t)?this._scope.FireIncrementAnalyticsEvent(n):n<t&&this._scope.CanDecrementQuantity(t)&&this._scope.FireDecrementAnalyticsEvent(n))},n.prototype.IncrementQuantity=function(){this._scope.CanIncrementQuantity(this._scope.Quantity)?(this._scope.Quantity++,this.AlertScreenReaderToNewQuantity(this._settings.IncrementScreenReaderText)):this._scope.OnInvalidIncrement()},n.prototype.DecrementQuantity=function(){this._scope.CanDecrementQuantity(this._scope.Quantity)?(this._scope.Quantity--,this.AlertScreenReaderToNewQuantity(this._settings.DecrementScreenReaderText)):this._scope.OnInvalidDecrement()},n.prototype.ValidQuantity=function(){return this._scope.Validation(this._scope.Quantity)},n.prototype.NoQuantitySet=function(){return this._scope.Quantity===0},n.prototype.ResetIfNotANumber=function(){var n=this._scope.Quantity;(!n||n<0||n%1!=0)&&(this._scope.Quantity=0)},n.prototype.AlertScreenReaderToNewQuantity=function(n){!n||Utilities.ScreenReader.Alert(n.replace("{value}",this._scope.Quantity.toString()),"updated-quantity")},n.$inject=["$scope","Sitecore_QuantitySelectorSettings"],n}();n.QuantitySelectorController=t})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._scope=n;this._ruleBasedContentService=t;this._scope.Initialise=this.Initialise.bind(this);this._scope.ShowItem=this.ShowItem.bind(this);this.Subscribe()}return n.prototype.Initialise=function(n){this._folderRules=JSON.parse(n)},n.prototype.ShowItem=function(n){return!n||!this._selectedCurentItemId?!1:this._selectedCurentItemId.Equals(new System.Guid(n))},n.prototype.Subscribe=function(){var n=this;this._ruleBasedContentService.Subscribe(function(t){if(!!n._folderRules){var r=new Main3.SitecoreRules.Rules.Pipelines.Args.BookingRulePipelineArgs(t),i=Main3.SitecoreRules.Pipeline.PipelineRunner.RunPipeline(n._folderRules,r);n.HasSingleMatch(i)&&(n._selectedCurentItemId=i.ItemIds()[0])}})},n.prototype.HasSingleMatch=function(n){return n.Matched&&n.ItemIds()&&n.ItemIds().length===1},n.ControllerName="Controls_RuleDrivenHtmlBlock",n.$inject=["$scope","Common_RuleBasedContentService"],n}();n.RuleDrivenHtmlBlock=t})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this._scope=n;this._scope.GetMaskedCardNumber=this.GetMaskedCardNumber.bind(this);this._scope.GetExpirationMonth=this.GetExpirationMonth.bind(this);this._scope.$watch(function(n){return n.SavedPaymentCardForm.$valid},function(n){return t._scope.SavedPaymentCard.Valid=n})}return n.prototype.GetMaskedCardNumber=function(){var n,i,t;if(!!this._scope.SavedPaymentCardData){for(n=this._scope.SavedPaymentCardConfiguration.FormInputMask.split("").reverse(),n.forEach(function(n,t,i){i[t]=n!==" "?"*":" "}),i=this.GetLastFourDigitsAsArray(),t=0;i.length>0;)n[t]==="*"&&(n[t]=i.pop()),t+=1;return n.reverse().join("")}return""},n.prototype.GetLastFourDigitsAsArray=function(){for(var n=this._scope.SavedPaymentCardData.LastFourDigits.split("");n.length>4;)n.shift();return n},n.prototype.GetExpirationMonth=function(){if(!!this._scope.SavedPaymentCardData){var n=this._scope.SavedPaymentCardData.ExpirationMonth.toString();return n.length===1?"0"+n:n}return""},n.$inject=["$scope"],n}();n.SavedPaymentCardDetails=t})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t){var i=this;this._scope=t;this._scope.ScrollToDetailsEventName=n.Events.Names.PaymentCard.ScrollToDetails;this._scope.$watch(function(n){return!!n.SepaPaymentForm&&n.SepaPaymentForm.$valid},function(n){return i._scope.SepaPaymentDetails.Valid=n})}return t.$inject=["$scope"],t}();t.SepaPaymentDetails=i})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){n.Redirect=this.Redirect.bind(this)}return n.prototype.Redirect=function(n){!n||(window.location.href=n)},n.ControllerName="Controls_TwoButtonsWithLinksDrawer",n.$inject=["$scope"],n}();n.TwoButtonsWithLinksDrawer=t})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._prioritisedCountries=i;this._scope=n;this._countryDataService=t;this._parameters=n.Section.Options.Parameters;this._modelBuilder=new Main3.SimpleTemplate.ModelBuilders.DialCodeDrawerDrawerModelBuilder;this._scope.DialCodeSelect=this.OnDialCodeSelect.bind(this);this._countryDataService.GetCountryData(this._parameters.LanguageCode).then(this.ApiDataLoaded.bind(this))}return t.prototype.ApiDataLoaded=function(n){this._scope.SimpleModel=this._modelBuilder.Build(n.CountryData);this._scope.PrioritisedCountriesModel=this.BuildPrioritisedCountriesModel(n.CountryData)},t.prototype.BuildPrioritisedCountriesModel=function(n){var t=this._countryDataService.PrioritiseCountries(n,this._prioritisedCountries.CountryIsoCodes);if(t&&t.length>0)return this._scope.ShowPrioritisedCountries=!0,{DialCodes:t.map(function(n){return{DialCode:n.DialCode,Name:n.Name,IsoCode:n.ISOCountryCode}})}},t.prototype.OnDialCodeSelect=function(t){var i=this;this._countryDataService.GetCountryDataModelForIsoCode(this._parameters.LanguageCode,t).then(function(t){i._parameters.OnCountryInfoSelected(t);i._scope.$emit(n.Events.Names.Drawer.Close)})},t.ControllerName="Controls_DialCodeDrawer",t.$inject=["$scope","Data_CountryDataService","Sitecore_PrioritisedCountryIsoCodes"],t}();t.DialCodeDrawer=i})(i=t.CountryInfo||(t.CountryInfo={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._prioritisedCountries=i;this._scope=n;this._countryDataService=t;this._parameters=n.Section.Options.Parameters;this._scope.ShowPrioritisedCountries=!1;this.SetupDrawer()}return t.prototype.SetupDrawer=function(){var n=this;this._scope.ResidentOfSelect=this.OnResidentOfSelect.bind(this);this._countryDataService.GetCountryData(this._parameters.LanguageCode).then(function(t){n._scope.SimpleModel=n.BuildSimpleModel(t.CountryData);n._scope.PrioritisedCountriesModel=n.BuildPrioritisedCountriesModel(t.CountryData)})},t.prototype.OnResidentOfSelect=function(t){var i=this;this._countryDataService.GetCountryDataModelForIsoCode(this._parameters.LanguageCode,t).then(function(t){i._parameters.OnCountryInfoSelected(t);i._scope.$emit(n.Events.Names.Drawer.Close)})},t.prototype.BuildPrioritisedCountriesModel=function(n){var t=this._countryDataService.PrioritiseCountries(n,this._prioritisedCountries.CountryIsoCodes);if(t&&t.length>0)return this._scope.ShowPrioritisedCountries=!0,{Countries:t.map(function(n){return{Name:n.Name,IsoCode:n.ISOCountryCode}})}},t.prototype.BuildSimpleModel=function(n){return{Countries:n.map(function(n){return{Name:n.Name,IsoCode:n.ISOCountryCode}})}},t.ControllerName="Controls_ResidentOfDrawer",t.$inject=["$scope","Data_CountryDataService","Sitecore_PrioritisedCountryIsoCodes"],t}();t.ResidentOfDrawer=i})(i=t.CountryInfo||(t.CountryInfo={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u){var f=this;this._scope=t;this._rootScope=i;this._compileService=r;this._templateRequestService=u;this.TemplateWithButton="ng-templates/header/helpinghand/withbutton";this._helpingHand=new HelpingHand.HelpingHandSlider;this._accessibleHelpingHand=new HelpingHand.AccessibleHelpingHand;this._currentTemplateKey="";this._currentTemplateScope=null;this._changeQueue=[];this._allowInitialReset=!0;this._scope.FocusToTitle=!1;this.ListenForEvents();n.ready(function(){f._allowInitialReset&&f.OnReset()})}return t.prototype.ListenForEvents=function(){this._rootScope.$on(n.Events.Names.HelpingHand.Reset,this.OnReset.bind(this));this._rootScope.$on(n.Events.Names.HelpingHand.SetOriginalText,this.OnSetOriginalText.bind(this));this._rootScope.$on(n.Events.Names.HelpingHand.SetSubtitle,this.OnSetSubtitle.bind(this));this._rootScope.$on(n.Events.Names.HelpingHand.ShowText,this.OnShowText.bind(this));this._rootScope.$on(n.Events.Names.HelpingHand.ShowObject,this.OnShowObject.bind(this));this._rootScope.$on(n.Events.Names.HelpingHand.ShowTemplate,this.OnShowTemplate.bind(this));this._rootScope.$on(n.Events.Names.HelpingHand.ShowTextWithButton,this.OnShowTextWithButton.bind(this));this._rootScope.$on(n.Events.Names.HelpingHand.PreventInitialReset,this.OnPreventInitialReset.bind(this));this._rootScope.$on(n.Events.Names.HelpingHand.Focus,this.Focus.bind(this))},t.prototype.Focus=function(){this._scope.FocusToTitle=!0},t.prototype.OnReset=function(n){var t=this;n===void 0&&(n=!1);this.AddToQueue(function(){t._scope.OriginalText?(t._helpingHand.ShowText(t._scope.OriginalText,n,t.FinishedCurrentChange.bind(t)),t._accessibleHelpingHand.ShowText(t._scope.OriginalText)):t.FinishedCurrentChange()});this.ProcessNextInQueue()},t.prototype.OnSetOriginalText=function(n,t){this._scope.OriginalText=t},t.prototype.OnSetSubtitle=function(n,t){this._scope.Subtitle=t},t.prototype.OnShowText=function(n,t,i){var r=this;i===void 0&&(i=!1);this.AddToQueue(function(){r._helpingHand.ShowText(t,i,r.FinishedCurrentChange.bind(r));r._accessibleHelpingHand.ShowText(t);r._currentTemplateKey="";r.FinishedCurrentChange()});this.ProcessNextInQueue()},t.prototype.OnShowObject=function(n,t,i){var r=this;this.AddToQueue(function(){r._helpingHand.ShowObject(t,function(){i&&i();r.FinishedCurrentChange.bind(r)});r._accessibleHelpingHand.ShowObject($jq(t[0].outerHTML))});this.ProcessNextInQueue()},t.prototype.OnShowTemplate=function(n,t,i){var r=this;i===void 0&&(i=angularEjRootScope);this.AddToQueue(function(){t!==r._currentTemplateKey||r._currentTemplateScope!==i?(r._currentTemplateKey=t,r._currentTemplateScope=i,r.ShowFromAngularTemplate(t,i)):r.FinishedCurrentChange()});this.ProcessNextInQueue()},t.prototype.OnShowTextWithButton=function(n,t){var i=this;this.AddToQueue(function(){var n=i._rootScope.$new(!0);n.Title=t.Title;n.Subtitle=t.Subtitle||i._scope.Subtitle;n.ButtonText=t.ButtonText;n.ButtonClick=t.ButtonEvent;n.ButtonEnabledWatch=t.ButtonEnabledWatch;n.IsALink=t.IsALink;i._currentTemplateKey="";i.ShowFromAngularTemplate(i.TemplateWithButton,n)});this.ProcessNextInQueue()},t.prototype.OnPreventInitialReset=function(){this._allowInitialReset=!1},t.prototype.ShowFromAngularTemplate=function(n,t){var i=this,r=this._templateRequestService(n).then(function(n){var r=i._compileService(n)(t),u=i._compileService(n)(t);i._rootScope.$applyAsync(function(){i._helpingHand.ShowObject(r,i.FinishedCurrentChange.bind(i));i._accessibleHelpingHand.ShowObject(u)})})},t.prototype.AddToQueue=function(n){this._changeQueue.splice(0,0,n)},t.prototype.ProcessNextInQueue=function(){if(!t.ChangeInProgress&&this._changeQueue.length>0){var n=this._changeQueue.pop();n&&(t.ChangeInProgress=!0,n())}},t.prototype.FinishedCurrentChange=function(){t.ChangeInProgress=!1;this.ProcessNextInQueue()},t.ChangeInProgress=!1,t.ControllerName="Controls_HelpingHand",t.$inject=["$document","$scope","$rootScope","$compile","$templateRequest"],t}();t.AngularHelpingHand=i})(i=t.Headers||(t.Headers={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(i,r,u,f){var e=this;this._scope=i;this._accountService=r;this._navigationService=u;this._softLogInCookieService=f;this._scope.IsSignedIn=this._accountService.IsSignedIn();this._scope.IsSecure=this._accountService.IsSecure();this._scope.ShouldShowLogoLink=!0;this._scope.ShouldRemoveLogoLink=!1;this._scope.$on(n.Events.Names.Funnel.RemoveLinkFromEjLogo,this.DoRemoveEjLinkLogo.bind(this));this._scope.$on(n.Events.Names.Account.DeprecatedSignInStatusChanged,function(n,t){e._scope.$applyAsync(function(n){n.IsSignedIn=t})});this._scope.DoMenuBurgerClick=function(){n.Events.OpenDrawer("navigation-toplevel")};this._scope.DoLanguageClick=function(){n.Events.OpenDrawer("navigation-languageselector")};this._scope.DoHelpClick=function(){n.Events.OpenDrawer("navigation-help")};this._scope.DoSignInClick=function(){t.DoSignIn(e._scope.IsSignedIn,e._scope.IsSecure,e._accountService,!1)};this._scope.$on(n.Events.Names.Header.ShowSignInBeforeRedirect,function(n,t){e.ShowAuthChallengeBeforeRedirect(e._scope.IsSignedIn,e._scope.IsSecure,t,!1,"sign-in")});this._scope.$on(n.Events.Names.Header.ShowCheckInBeforeRedirect,function(n,t){e.ShowAuthChallengeBeforeRedirect(e._scope.IsSignedIn,e._scope.IsSecure,t,!1,"check-in")});this._scope.DoCheckInClick=function(n){t.DoCheckIn(e._scope.IsSignedIn,e._scope.IsSecure,e._accountService,e._navigationService,n,!1)};this._scope.DoMyAccountClick=function(n){t.DoMyAccount(e._scope.IsSignedIn,e._scope.IsSecure,e._accountService,e._navigationService,e._softLogInCookieService,n,!1)}}return t.prototype.DoRemoveEjLinkLogo=function(){this._scope.ShouldShowLogoLink=!1;this._scope.ShouldRemoveLogoLink=!0},t.prototype.ShowAuthChallengeBeforeRedirect=function(n,i,r,u,f){var o=this,e;u===void 0&&(u=!1);i&&(n?this._navigationService.NavigateTo(r):(e=function(){o._navigationService.NavigateTo(r)},t.OpenSignInDrawer(f,e,u)))},t.DoSignIn=function(t,i,r,u){if(u===void 0&&(u=!1),i){var f=function(){n.Events.Fire(n.Events.Names.Drawer.Close)};t?r.SignOut(f):this.OpenSignInDrawer("sign-in",f,u)}},t.DoCheckIn=function(n,t,i,r,u,f){if(f===void 0&&(f=!1),t){var e=function(){r.NavigateTo(u)};n?e():this.OpenSignInDrawer("check-in",e,f)}},t.DoMyAccount=function(n,t,i,r,u,f,e){var s=this,o;e===void 0&&(e=!1);t?n||u.IsSoftLoggedIn()?this.OpenMyAccountDrawer(e):(o=function(){f?r.NavigateTo(f):s.OpenMyAccountDrawer(e)},this.OpenSignInDrawer("sign-in",o,e)):r.NavigateTo(f)},t.OpenMyAccountDrawer=function(t){var i={SectionKey:"my-account"};t&&(i.AllowBackOverride=n.Data.DrawerBackOverride.AlwaysShow);n.Events.OpenDrawerWithOptions(i)},t.OpenSignInDrawer=function(t,i,r){var u={SectionKey:t,Parameters:{AfterSignIn:i,UserInitiatedSignIn:!0}};r&&(u.AllowBackOverride=n.Data.DrawerBackOverride.AlwaysShow);n.Events.OpenDrawerWithOptions(u)},t.ControllerName="Controls_Navigation",t.$inject=["$scope","Account_Service","Common_NavigationService","CommercialSoftLogInCookie_Service"],t}();t.AngularNavigation=i})(i=t.Headers||(t.Headers={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this._scope=n;this._scope.IsButtonEnabled=!1;this._scope.ButtonEnabledWatch!=null&&this._scope.$watch(function(){return t._scope.ButtonEnabledWatch()},function(n){t._scope.IsButtonEnabled=n})}return n.ControllerName="Controls_HelpingHandWithButton",n.$inject=["$scope"],n}();n.HelpingHandWithButton=t})(t=n.Headers||(n.Headers={}))})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._scope=n;var t=this._scope.Section.Options.Parameters;this._scope.Groups=t.ChildGroups}return n.ControllerName="Controls_SecondLevelNavigationDrawer",n.$inject=["$scope"],n}();n.SecondLevelNavigationDrawer=t})(t=n.Headers||(n.Headers={}))})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t){t.DoInfoIconClick=function(){n.Events.OpenDrawer("info-drawer")}}return t.ControllerName="Controls_TitleBar",t.$inject=["$scope"],t}();t.TitleBar=i})(i=t.Headers||(t.Headers={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function i(i,r,u,f,e){var o=this;this._scope=i;this._sce=r;this._accountService=u;this._navigationService=f;this._softLogInCookieService=e;this._scope.PrimaryGroup=this.BuildPrimaryLinkGroup();this._scope.AdditionalGroup=this.BuildAdditionalLinkGroup();this._scope.IsSignedIn=this._accountService.IsSignedIn();this._scope.IsSecure=this._accountService.IsSecure();this._scope.$on(n.Events.Names.Account.DeprecatedSignInStatusChanged,function(n,t){o._scope.IsSignedIn=t});this._scope.GoToSecondLevel=this.GoToSecondLevel.bind(this);this._scope.DoLanguageClick=function(){n.Events.OpenDrawerWithOptions({SectionKey:"navigation-languageselector",AllowBackOverride:n.Data.DrawerBackOverride.AlwaysShow})};this._scope.DoHelpClick=function(){n.Events.OpenDrawerWithOptions({SectionKey:"navigation-help",AllowBackOverride:n.Data.DrawerBackOverride.AlwaysShow})};this._scope.DoSignInClick=function(){t.AngularNavigation.DoSignIn(o._scope.IsSignedIn,o._scope.IsSecure,o._accountService,!0)};this._scope.DoCheckInClick=function(n){t.AngularNavigation.DoCheckIn(o._scope.IsSignedIn,o._scope.IsSecure,o._accountService,o._navigationService,n,!1)};this._scope.DoMyAccountClick=function(n){t.AngularNavigation.DoMyAccount(o._scope.IsSignedIn,o._scope.IsSecure,o._accountService,o._navigationService,o._softLogInCookieService,n,!0)}}return i.prototype.BuildPrimaryLinkGroup=function(){var n=this,t={Links:[]};return $jq(".primary-links .first-level-item > .nav-menu-header > a").each(function(i,r){var u=$jq(r);t.Links.push({Content:n._sce.trustAsHtml(u.html()),Text:u.text(),ChildGroups:n.BuildSecondLevelLinkGroups(u)})}),t},i.prototype.BuildAdditionalLinkGroup=function(){var t=this,n={Links:[]};return $jq(".additional-links .first-level-item > .nav-menu-header > a").each(function(i,r){var u=$jq(r),f=u.clone(!1);f.addClass("list-option-item");n.Links.push({Content:t._sce.trustAsHtml(f[0].outerHTML),Text:u.text(),ChildGroups:[]})}),n},i.prototype.BuildSecondLevelLinkGroups=function(n){var t=this,r=n.parents(".first-level-item"),i=[];return r.find(".main-navigation-section").each(function(n,r){var u=$jq(r).find(".section-image-mobile"),f=[];$jq(r).find(".second-level-item a").each(function(n,i){var r=$jq(i);f.push({Content:t._sce.trustAsHtml(r[0].outerHTML),Text:r.text(),ChildGroups:[]})});i.push({GroupImage:u.length>0?t._sce.trustAsHtml(u[0].outerHTML):"",Links:f})}),i},i.prototype.GoToSecondLevel=function(t){n.Events.OpenDrawerWithOptions({SectionKey:"navigation-secondlevel",Parameters:t,TitleOverride:t.Text})},i.ControllerName="Controls_TopLevelNavigationDrawer",i.$inject=["$scope","$sce","Account_Service","Common_NavigationService","CommercialSoftLogInCookie_Service"],i}();t.TopLevelNavigationDrawer=i})(i=t.Headers||(t.Headers={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){var t=this;this._scope=n;this._scope.$watch(function(n){return n.DepartureDate},function(n){return t.DepartureDateUpdated(n)})}return n.prototype.DepartureDateUpdated=function(){this._scope.ReturnDate&&this._scope.DepartureDate.ToSortable()>this._scope.ReturnDate.ToSortable()&&(this._scope.ReturnDate=null)},n.ControllerName="Controls_ReturnRouteDatePicker",n.$inject=["$scope"],n}();n.ReturnRouteDatePicker=t})(t=n.RouteDatePicker||(n.RouteDatePicker={}))})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f){var e=this;this._scope=t;this._rootScope=i;this._timeout=r;this._combinedRoutesService=u;this._routeDatesService=f;this._validateAsWorldwide=!1;this._scope.Open=this.Open.bind(this);this._scope.Identifier=Math.floor(Math.random()*1e5);this._scope.$on(n.Events.Names.RouteDatePicker.Validate,this.Validate.bind(this));this._scope.$on(n.Events.Names.SearchPod.ValidateAsWorldwide,this.SetValidateAsWorldwide.bind(this));this._scope.$watch(function(n){return n.Date},function(){e.ResetValidation()});this._scope.$on(n.Events.Names.RouteDatePicker.DateChosen,this.DateChosenEvent.bind(this))}return t.prototype.IsPartOfGroup=function(){return!!this._scope.GroupId},t.prototype.ThisDateShouldBeUpdatedAfterUserSelectsDateInPickerDrawer=function(n){return!this.IsPartOfGroup()||this.IsPartOfGroup()&&this._scope.GroupId===n},t.prototype.DateChosenEvent=function(n,t,i,r,u){this.ThisDateShouldBeUpdatedAfterUserSelectsDateInPickerDrawer(u)&&(r&&this._scope.IsReturnDate&&(this._scope.Date=i,this.Validate()),r||this._scope.IsReturnDate||(this._scope.Date=t,this.Validate()))},t.prototype.Open=function(t){var i=this,r,u;t.preventDefault();this._scope.$emit(n.Events.Names.RouteDatePicker.BeforeOpen);r=this._combinedRoutesService.IsWorldwideOnlyAirportIata(!0,this._scope.OriginIata)||this._combinedRoutesService.IsWorldwideOnlyAirportIata(!0,this._scope.DestinationIata);u=this._combinedRoutesService.IsWorldwideRoute(this._scope.OriginIata,this._scope.DestinationIata);this._timeout(function(){var t={OnDateValidation:i.IsValidWorldwideDate.bind(i),OriginIata:i._scope.OriginIata,DestinationIata:i._scope.DestinationIata,DepartureDate:i._scope.StartDate,ReturnDate:i._scope.IsOneWayFlight?null:i._scope.EndDate,IsReturnDatePicker:i._scope.IsReturnDate,LowestFareFinderEnabled:i._scope.LowestFareFinderEnabled&&!u&&!r,AnalyticsCategory:i._scope.AnalyticsCategory,AnalyticsAction:i._scope.AnalyticsAction,IsOneWayFlight:i._scope.IsOneWayFlight,GroupId:i._scope.GroupId},f={SectionKey:"routedatepicker",Parameters:t,TitleOverride:i._scope.DrawerTitleOverride};n.Events.OpenDrawerWithOptions(f)},100)},t.prototype.ResetValidation=function(){this._scope.Invalid=!1},t.prototype.Validate=function(){var t=this;this.ResetValidation();this._timeout(function(){t._scope.Date&&t._scope.Date.IsValid()&&t.IsValidWorldwideDate(t._scope.Date)?t._scope.$emit(n.Events.Names.RouteDatePicker.SearchValid):t._scope.Invalid=!0})},t.prototype.SetValidateAsWorldwide=function(n,t){this._validateAsWorldwide=t},t.prototype.IsValidWorldwideDate=function(t){return this._validateAsWorldwide&&t.Equals(Utilities.TimeAgnosticDate.TodayLocal())?(n.Events.OpenDrawer("worldwide-search-constraints"),!1):!0},t.ControllerName="Controls_RouteDatePicker",t.$inject=["$scope","$rootScope","$timeout","Worldwide_CombinedRoutesService","Controls_RouteDatesService"],t}();t.RouteDatePicker=i})(i=t.RouteDatePicker||(t.RouteDatePicker={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o){var s=this,h;this._timeout=t;this._scope=i;this.languageSettings=r;this.lowestFaresDrawerSettings=u;this._searchPodSettings=f;this._routeDatesService=e;this._analyticsTracker=o;this._outboundTabName="Date Calendar Outbound";this._returnTabName="Date Calendar Return";this._lowFareFinderTabName="Date LowFareFinder";this._modelBuilder=new Main3.SimpleTemplate.ModelBuilders.DatePickerDrawerModelBuilder(r.CurrentCultureFirstDayOfWeek);h=this.RouteDatesDrawerParameters();this._scope.DepartureDate=h.DepartureDate;this._scope.ReturnDate=h.ReturnDate;this._scope.OriginIata=h.OriginIata;this._scope.IsReturnDatePicker=h.IsReturnDatePicker;this._scope.DestinationIata=h.DestinationIata;this._scope.ShowLowestFaresTab=u.Enabled&&h.LowestFareFinderEnabled&&!Main3.Common.BreakPointService.IsDrawerSingleColumn();this._scope.AnalyticsCategory=h.AnalyticsCategory||Tracking.EventConstants.Categories.BookingPod;this._scope.AnalyticsAction=h.AnalyticsAction||"Date Search";this._scope.IsFlightOneWay=h.IsOneWayFlight;this._scope.GroupId=h.GroupId;this.SetupLowestFares(h);this._scope.IsCalendar=!0;this._scope.IsLowestFares=!1;this._scope.OnLoadCalendarClick=function(){s._scope.IsCalendar=!0;s._scope.IsLowestFares=!1;s._analyticsTracker.TrackEvent(s._scope.AnalyticsCategory,s._scope.AnalyticsAction,Tracking.EventConstants.Labels.ViewCalendar)};this._scope.OnLoadLowestFaresClick=function(){s._scope.IsLowestFares=!0;s._scope.IsCalendar=!1;s._analyticsTracker.TrackEvent(s._scope.AnalyticsCategory,s._scope.AnalyticsAction,Tracking.EventConstants.Labels.ViewLowestFaresChart);s.LoadLowestFaresChart()};this._scope.$on(n.Events.Names.DrawerSection.Shown,function(){var t=s._scope.IsReturnDatePicker?s._returnTabName:s._outboundTabName;s._scope.$broadcast(n.Events.Names.Drawer.ActivateTab,t)});this._scope.OnSelect=function(t,i,r){var u=Utilities.TimeAgnosticDate.FromParts(t,i,r);(!h.OnDateValidation||h.OnDateValidation(u))&&(s._scope.IsReturnDatePicker?n.Events.Fire(n.Events.Names.RouteDatePicker.DateChosen,null,u,!0,s._scope.GroupId):n.Events.Fire(n.Events.Names.RouteDatePicker.DateChosen,u,null,!1,s._scope.GroupId),s.HaveSelectedBothDepeartureAndReturnDates(u)||s._scope.IsFlightOneWay||s.BrowserNotSupported()?s._scope.DoBack():s._timeout(function(){s._scope.IsReturnDatePicker?(s._scope.IsReturnDatePicker=!1,s._scope.ReturnDate=u,s._scope.$broadcast(n.Events.Names.Drawer.ActivateTab,s._outboundTabName)):(s._scope.IsReturnDatePicker=!0,s._scope.DepartureDate=u,s._scope.$broadcast(n.Events.Names.Drawer.ActivateTab,s._returnTabName))}))}}return t.prototype.BrowserNotSupported=function(){return bowser.msie&&bowser.version==9},t.prototype.LoadLowestFaresChart=function(){this._scope.LowestFaresParameters.StartDate=this._scope.DepartureDate;this._scope.LowestFaresParameters.DepartureDate=this._scope.DepartureDate;this._scope.LowestFaresParameters.ReturnDate=this._scope.ReturnDate;this._scope.$broadcast(n.Events.Names.LowestFares.LoadGraphs,this._scope.LowestFaresParameters)},t.prototype.HaveSelectedBothDepeartureAndReturnDates=function(n){return this._scope.IsReturnDatePicker?!!this._scope.DepartureDate&&!!n:!!this._scope.ReturnDate&&!!n},t.prototype.RouteDatesDrawerParameters=function(){return this._scope.CurrentSection.Options.Parameters},t.prototype.GotDates=function(n){this._scope.Dates=n;this._scope.EndOfPublishedSchedule=!n.ScheduleUnknown&&!n.ScheduleEnded;this._scope.SimpleModel=this._modelBuilder.BuildBasedOnFlightDates(n);this._scope.HasApiResponse=!0},t.prototype.FailedToGetDates=function(){this._scope.EndOfPublishedSchedule=!1;this._scope.Error=!0;this._scope.SimpleModel=this._modelBuilder.BuildFailure();this._scope.HasApiResponse=!0},t.prototype.StringDepartureDateOrNull=function(){return this._scope.DepartureDate?this._scope.DepartureDate.ToCompressedString():null},t.prototype.StringReturnDateOrNull=function(){return this._scope.ReturnDate?this._scope.ReturnDate.ToCompressedString():null},t.prototype.SetupLowestFares=function(t){var i=!!t.IsReturnDatePicker&&t.IsReturnDatePicker?t.DestinationIata:t.OriginIata,r=!!t.IsReturnDatePicker&&t.IsReturnDatePicker?t.OriginIata:t.DestinationIata;this._scope.LowestFaresParameters={IsReturnDatePicker:!1,StartDate:t.StartDate,OriginIata:i,DestinationIata:r,DepartureDate:t.DepartureDate,ReturnDate:t.ReturnDate};this._scope.$on(n.Events.Names.Drawer.TabChanged,this.TabChanged.bind(this))},t.prototype.TabChanged=function(n,t){t===this._outboundTabName&&(this._scope.IsReturnDatePicker=!1,this._scope.IsLowestFares?this.LoadLowestFaresChart():this.RebuildDrawerModel(this._searchPodSettings.DepartureDateDrawerTitle));t===this._returnTabName&&(this._scope.IsReturnDatePicker=!0,this._scope.IsLowestFares?this.LoadLowestFaresChart():this.RebuildDrawerModel(this._searchPodSettings.ReturnDateDrawerTitle))},t.prototype.RebuildDrawerModel=function(t){var i=this;this._scope.IsFlightOneWay||(Utilities.ScreenReader.Alert(t,"datePickerTabChanged"),n.Events.Fire(n.Events.Names.Drawer.ResetTitle,t));this.GetDatesPromise().then(function(n){return i.GotDates(n)},function(){return i.FailedToGetDates()})},t.prototype.GetDatesPromise=function(){var n=this._scope.IsReturnDatePicker&&this._scope.DepartureDate?this._scope.DepartureDate:null;return this._routeDatesService.GetDates(this._scope.OriginIata,this._scope.DestinationIata,n)},t.ControllerName="Controls_RouteDatePickerDrawer",t.$inject=["$timeout","$scope","Sitecore_SitecoreLanguageSettings","Sitecore_RouteDatePickerLowestFaresDrawerSettings","Sitecore_SearchPodSettings","Controls_RouteDatesService","IAnalyticsTracker"],t}();t.RouteDatePickerDrawer=i})(i=t.RouteDatePicker||(t.RouteDatePicker={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var r,i;(function(n){n[n.Unavailable=0]="Unavailable";n[n.SoldOut=1]="SoldOut";n[n.InStock=2]="InStock"})(r=t.LowestFaresFlightStatus||(t.LowestFaresFlightStatus={}));i=function(){function t(t,i,r,u,f,e,o){this._lowestFaresData=null;this._lowestFaresGraphs=null;this._lowestFaresDataCache=null;this._scope=t;this._timeout=i;this._q=r;this._lowestFaresApiService=u;this._lowestFaresGraphAssembler=f;this._priceService=o;this._scope.LowestFaresSoldOutText=e.SoldOutText;this._scope.LowestFaresAvailableForRoute=!0;this._scope.GetContainerCssClass=this._scope.IsReturn?"return":"departure";this._scope.GraphRendered=!1;e.Enabled&&(this._scope.DelayLoad?this._scope.$on(n.Events.Names.LowestFares.LoadGraphs,this.TriggerLoadLowestFaresGraphs.bind(this)):this.LoadLowestFaresGraphs())}return t.prototype.TriggerLoadLowestFaresGraphs=function(n,t){this.LoadLowestFaresGraphs(t)},t.prototype.LoadLowestFaresGraphs=function(n){var i=this,r,u;this._scope.GraphRendered=!1;var t=n||this._scope.LowestFaresParameters,f=t.OriginIata,e=t.DestinationIata;this._scope.IsReturn&&(t.IsReturnDatePicker=!0,t.OriginIata=e,t.DestinationIata=f);this._scope.HasGotLowestFaresData?!this._lowestFaresGraphs||(this.RemoveDatesBasedOnSelectedDepartureOrReturn(t),this._lowestFaresGraphs=this._lowestFaresGraphAssembler.FromLowestFaresData(this._scope.LowestFaresSoldOutText,this._lowestFaresData,t.DepartureDate,t.ReturnDate),this.DrawLowestFaresGraphs(this._lowestFaresGraphs)):this.HasValidRoute(t)?(r=t.IsReturnDatePicker&&t.StartDate?t.StartDate:null,u=this._lowestFaresApiService.GetLowestFaresPromise(t.OriginIata,t.DestinationIata,r,this._priceService.GetCurrentCurrency().CurrencyId),u.then(function(n){if(i._scope.EndOfPublishedSchedule=!n.data.ScheduleUnknown&&!n.data.ScheduleEnded,i._scope.ScheduleStarted=n.data.ScheduleStarted,i._scope.ScheduleEnded=n.data.ScheduleEnded,i._scope.LowestFaresAvailableForRoute=!n.data.ScheduleUnknown,i._scope.LowestFaresAvailableForRoute){i._lowestFaresData=n.data;i._lowestFaresDataCache=Utilities.Clone(i._lowestFaresData);var r=i._lowestFaresGraphAssembler.FromLowestFaresData(i._scope.LowestFaresSoldOutText,n.data,t.DepartureDate,t.ReturnDate);i.DrawLowestFaresGraphs(r)}},function(){i.FailedToGetLowestFares()})["finally"](function(){i._timeout(function(){i._scope.HasGotLowestFaresData=!0},60)})):(this._scope.LowestFaresAvailableForRoute=!1,this._scope.EndOfPublishedSchedule=!1)},t.prototype.RemoveDatesBasedOnSelectedDepartureOrReturn=function(n){this._lowestFaresData=Utilities.Clone(this._lowestFaresDataCache);!this._lowestFaresData.months||this._scope.IsReturn&&!!n.DepartureDate&&this.RemoveUnselectableDates(n)},t.prototype.RemoveUnselectableDates=function(t){var i=[];this._lowestFaresData.months.forEach(function(r){if(!!r.days){var u=!1;r.days.forEach(function(i){var f=Utilities.TimeAgnosticDate.FromParts(r.year,r.month,i.day);f.ToSortable()<t.DepartureDate.ToSortable()?(i.flightStatus=n.Controllers.Controls.RouteDatePicker.LowestFaresFlightStatus.Unavailable,i.lowestFare=null):u=!0});u&&i.push(r)}});this._lowestFaresData.months=i},t.prototype.HasValidRoute=function(n){return!!n.OriginIata&&!!n.DestinationIata},t.prototype.FailedToGetLowestFares=function(){this._scope.LowestFaresAvailableForRoute=!1;this._scope.EndOfPublishedSchedule=!1;this._scope.Error=!0},t.prototype.DrawLowestFaresGraphs=function(n){var t=this;this._lowestFaresGraphs=n;var u=this._scope.IsReturn?"return":"departure",i=".lowestFaresChartContainer-"+u,f=this._scope.Element.find(i),r=0;this._timeout(function(){angular.forEach(n,function(n){r===0&&t._scope.Element.find(i).html("");n.DrawGraph(t._scope.Element.find(i),t._scope.OnSelect,t._scope.IsReturn);r=r+1});t._scope.GraphRendered=!0},250)},t.ControllerName="Controls_RouteDatePickerLowestFares",t.$inject=["$scope","$timeout","$q","Controls_LowestFaresApiService","Controls_LowestFaresGraphAssembler","Sitecore_RouteDatePickerLowestFaresDrawerSettings","Common_PriceService"],t}();t.RouteDatePickerLowestFares=i})(i=t.RouteDatePicker||(t.RouteDatePicker={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){var i=this,t;this._scope=n;t=this.RouteDatesLowestFaresDrawerParameters();this.SetupLowestFaresParameters(t);this._scope.OnSelect=function(n,r,u){var f=Utilities.TimeAgnosticDate.FromParts(n,r,u);i._scope.DoBack();t.OnSelect(f)}}return n.prototype.RouteDatesLowestFaresDrawerParameters=function(){return this._scope.CurrentSection.Options.Parameters},n.prototype.SetupLowestFaresParameters=function(n){this._scope.LowestFaresParameters={IsReturnDatePicker:n.IsReturnDatePicker,StartDate:n.StartDate,OriginIata:n.OriginIata,DestinationIata:n.DestinationIata,DepartureDate:n.DepartureDate,ReturnDate:n.ReturnDate}},n.ControllerName="Controls_RouteDatePickerLowestFaresDrawer",n.$inject=["$scope"],n}();n.RouteDatePickerLowestFaresDrawer=t})(t=n.RouteDatePicker||(n.RouteDatePicker={}))})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u,f){this._scope=n;this._routeMessagesService=t;this._routeMessagesApi=i;this._errorService=r;this._ruleBasedContentService=u;this._languageSettings=f;this._scope.IsLoading=!0;this._ruleBasedContentService.Subscribe(this.OnRuleBasedContentUpdate.bind(this),this._scope.SubscriberGroup)}return n.prototype.OnRuleBasedContentUpdate=function(t){var u=this;this._scope.IsLoading=!0;var i=this._routeMessagesService.GetMatchingMessageIds(t.RoutePairs),f=i.join("")+this._languageSettings.SitecoreLanguageCode,r=n.ContentCache[f];if(r!=undefined&&r.length>0){this.ContentUpdateComplete(r);return}if(i.length===0){this.ContentUpdateComplete("");return}this._routeMessagesApi.GetHtmlForMessageIds(i,this._languageSettings.SitecoreLanguageCode,function(t){n.ContentCache[f]=t;u.ContentUpdateComplete(t)},function(n,t){u._errorService.HandleApiError(n,t,null)})},n.prototype.ContentUpdateComplete=function(n){this._scope.MessageContent=n;this._scope.IsLoading=!1},n.ControllerName="Controls_RouteMessages",n.$inject=["$scope","Controls_RouteMessagesService","RouteMessages_Api","Error_Service","Common_RuleBasedContentService","Sitecore_SitecoreLanguageSettings"],n.ContentCache=[],n}();n.RouteMessagesContent=t})(t=n.RouteMessages||(n.RouteMessages={}))})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(i){function r(n,t,r,u,f,e,o,s,h,c){var l=i.call(this,n,t,r,u,!1,f,e,o,s)||this;return l._scope=n,l._routeSearchSettings=t,l._analyticsTracker=r,l._directRoutesOnlyService=u,l._worldwideSettings=f,l._allRoutesService=e,l._searchAccessibilityService=o,l._combinedRoutesService=s,l._q=h,l._timeout=c,l._parameters=n.Section.Options.Parameters,l._parameters.FilterAirport=l.EnsureAirportHasWorldwideDataWhenNeeded(l._parameters.FilterAirport),l._scope.InitialTabKey=l._parameters.IsCountryTabActive?"Route Country":"",l.UpdateSimpleModel(),l._scope.DoCountrySelect=l.OnCountrySelect.bind(l),l}return __extends(r,i),r.prototype.OnUnavailableAirportSelected=function(){this._parameters.IsCountryTabActive=!1},r.prototype.OnDirectRouteOnlyChanged=function(){this.UpdateSimpleModel()},r.prototype.OnAllRoutesChanged=function(){this.UpdateSimpleModel()},r.prototype.UpdateSimpleModel=function(){var n=this;this.GetSimpleModel().then(function(t){n._scope.SimpleModel=t})},r.prototype.GetNumberOfValidAirports=function(){return this._scope.SimpleModel&&this._scope.SimpleModel.Airports?this._scope.SimpleModel.Airports.length:0},r.prototype.GetSimpleModel=function(){var t=this,n=this._q.defer();return this._timeout(function(){n.resolve(t.BuildAirportAndCountryModel())}),n.promise},r.prototype.BuildAirportAndCountryModel=function(){var n=new Main3.SimpleTemplate.ModelBuilders.AllAirportsDrawerModelBuilder(this._routeSearchSettings,this._worldwideSettings,this._combinedRoutesService);return n.Build(this._parameters.FilterAirport,this._parameters.IsOriginSelection,this._parameters.ExcludeMarketGroups,this._scope.ShowDirectRoutesOnly,this._scope.ShowAllRoutes,this._parameters.ExcludedAirports)},r.prototype.OnCountrySelect=function(i){this._parameters.IsCountryTabActive=!0;var r=this._combinedRoutesService.FindCountryByCode(i),u={IsOriginSelection:this._parameters.IsOriginSelection,Country:r,FilterAirport:this._parameters.FilterAirport,ExcludeMarketGroups:this._parameters.ExcludeMarketGroups,AnalyticsCategory:this._parameters.AnalyticsCategory,AfterSelectAction:this._parameters.AfterSelectAction,SetOriginAirport:this._parameters.SetOriginAirport,SetDestinationAirport:this._parameters.SetDestinationAirport,ExcludedAirports:this._parameters.ExcludedAirports},f=t.CountryAirportsDrawer.BuildDrawerTitle(this._routeSearchSettings,r,this._parameters.IsOriginSelection);n.Events.OpenDrawerWithOptions({SectionKey:"routesearch-country",Parameters:u,TitleOverride:f})},r.ControllerName="Controls_RouteSearch_AllAirportsDrawer",r.$inject=["$scope","Sitecore_RouteSearchSettings","IAnalyticsTracker","Controls_AirportListDrawerDirectRoutesOnlyService","Sitecore_WorldwideSettings","Controls_AirportListDrawerAllRoutesService","Search_AccessibilityService","Worldwide_CombinedRoutesService","$q","$timeout"],r}(t.BaseAirportListDrawer);t.AllAirportsDrawer=i})(i=t.RouteSearch||(t.RouteSearch={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._scope=n;this._parameters=n.Section.Options.Parameters;this._routesService=new Main3.Routes.RoutesService(t);var i=new Main3.SimpleTemplate.ModelBuilders.AllRoutesDrawerModelBuilder(this._routesService);this._scope.SimpleModel=i.Build(this._parameters.FilterAirport,!this._parameters.IsOriginSelection,this._parameters.ExcludeMarketGroups);this._scope.DoRouteSelect=this.DoRouteSelect.bind(this)}return n.prototype.DoRouteSelect=function(n,t){var i=this._routesService.FindAirportByIata(n),r=this._routesService.FindAirportByIata(t);!i||!r||(this._parameters.SetOriginAirport(i,this._parameters.FromCountryDrawer),this._parameters.SetDestinationAirport(r,this._parameters.FromCountryDrawer),this._parameters.AfterSelectAction())},n.ControllerName="Controls_RouteSearch_AllRoutesDrawer",n.$inject=["$scope","Sitecore_RoutesData"],n}();n.AllRoutesDrawer=t})(t=n.RouteSearch||(n.RouteSearch={}))})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){var u=this;this._scope=n;this._routeSearchSettings=t;this._analyticsTracker=i;this._combinedRoutesService=r;this.WorldwideRouteSelected=function(){return u._scope.WorldwideMode&&u._scope.WorldwideRoute};this._parameters=n.Section.Options.Parameters;this.PopulateScope();this.TrackAlternateRoutesDrawerOpened()}return t.prototype.PopulateScope=function(){this._scope.WorldwideMode=this._combinedRoutesService.WorldwideMode;this._scope.AirportWorldwideText=this._routeSearchSettings.WorldwideText;this._scope.WorldwideRouteSelected=this.WorldwideRouteSelected.bind(this);this._parameters.IsOriginSelection?(this._scope.Origin=this._parameters.UnavailableAirport,this._scope.Destination=this._parameters.FilterAirport):(this._scope.Origin=this._parameters.FilterAirport,this._scope.Destination=this._parameters.UnavailableAirport);this._scope.NearbyRoutes=this._combinedRoutesService.GetAlternateRoutes(this._scope.Origin,this._scope.Destination);this._scope.WorldwideMode&&(this._scope.WorldwideRoute=this._combinedRoutesService.GetWorldwideRoute(this._scope.Origin,this._scope.Destination),this._scope.WorldwideConnectionTypeIsIndirect=this.IsIndirectWorldwideConnection());this._scope.DoRouteSelect=this.DoRouteSelect.bind(this);this._scope.DoWorldwideRouteSelect=this.DoWorldwideRouteSelect.bind(this);this._scope.DoAllRoutesFromClick=this.DoAllRoutesFromClick.bind(this);this._scope.DoAllRoutesToClick=this.DoAllRoutesToClick.bind(this);this._analyticsCategory=this._parameters.AnalyticsCategory==null?Tracking.EventConstants.Categories.BookingPod:this._parameters.AnalyticsCategory},t.prototype.IsIndirectWorldwideConnection=function(){var t=this._combinedRoutesService.GetFilterToAirportConnectionType(this._scope.Origin.Iata,this._scope.Destination,!0);return this._scope.WorldwideMode&&t===n.Data.RouteSearch.ConnectionType.IndirectConnection||t===n.Data.RouteSearch.ConnectionType.IndirectPartnerConnection},t.prototype.DoWorldwideRouteSelect=function(){var t=this._combinedRoutesService.GetFilterToAirportConnectionType(this._scope.Origin.Iata,this._scope.Destination,!0),i={ConnectionType:t};n.Events.OpenDrawerWithOptions({SectionKey:"worldwide-information",ShowAfterActionComplete:!0,Parameters:i});this._parameters.SetOriginAirport(this._scope.Origin,this._parameters.FromCountryDrawer);this._parameters.SetDestinationAirport(this._scope.Destination,this._parameters.FromCountryDrawer)},t.prototype.DoRouteSelect=function(n){var t=this._scope.NearbyRoutes.filter(function(t){return t.RouteKey===n})[0];!t||(this._parameters.SetOriginAirport(t.Origin,this._parameters.FromCountryDrawer),this._parameters.SetDestinationAirport(t.Destination,this._parameters.FromCountryDrawer),this._parameters.AfterSelectAction())},t.prototype.DoAllRoutesFromClick=function(){var t={IsOriginSelection:!1,FilterAirport:this._scope.Origin,FromCountryDrawer:this._parameters.FromCountryDrawer,ExcludeMarketGroups:this._parameters.ExcludeMarketGroups,AnalyticsCategory:this._parameters.AnalyticsCategory,AfterSelectAction:this._parameters.AfterSelectAction,SetOriginAirport:this._parameters.SetOriginAirport,SetDestinationAirport:this._parameters.SetDestinationAirport};n.Events.OpenDrawerWithOptions({SectionKey:"routesearch-all-routes-from",Parameters:t,TitleOverride:this._routeSearchSettings.DrawerSettings.AllRoutesFromTitle.replaceAll("{airport}",this._scope.Origin.Name)})},t.prototype.DoAllRoutesToClick=function(){var t={IsOriginSelection:!0,FilterAirport:this._scope.Destination,FromCountryDrawer:this._parameters.FromCountryDrawer,ExcludeMarketGroups:this._parameters.ExcludeMarketGroups,AnalyticsCategory:this._parameters.AnalyticsCategory,AfterSelectAction:this._parameters.AfterSelectAction,SetOriginAirport:this._parameters.SetOriginAirport,SetDestinationAirport:this._parameters.SetDestinationAirport};n.Events.OpenDrawerWithOptions({SectionKey:"routesearch-all-routes-to",Parameters:t,TitleOverride:this._routeSearchSettings.DrawerSettings.AllRoutesToTitle.replaceAll("{airport}",this._scope.Destination.Name)})},t.prototype.TrackAlternateRoutesDrawerOpened=function(){this._analyticsTracker.TrackEvent(this._analyticsCategory,Tracking.EventConstants.Actions.RouteSearch,Tracking.EventConstants.Labels.AlternativeAirports)},t.BuildDrawerTitle=function(n,t,i,r){return n.DrawerSettings.AlternateRoutesTitle.replaceAll("{origin}",r?i.Name:t.Name).replaceAll("{destination}",r?t.Name:i.Name)},t.ControllerName="Controls_RouteSearch_AlternateRoutes",t.$inject=["$scope","Sitecore_RouteSearchSettings","IAnalyticsTracker","Worldwide_CombinedRoutesService"],t}();t.AlternateRoutesDrawer=i})(i=t.RouteSearch||(t.RouteSearch={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i){this._scope=t;this._rootScope=i;this._scope.$on(n.Events.Names.RouteSearch.Validate,this.ValidateRouteSearch.bind(this));this._scope.Identifier=Math.floor(Math.random()*1e6)}return t.prototype.ValidateRouteSearch=function(){var t,i;this._scope.Validate()?(t={Origin:this._scope.OriginIata(),Destination:this._scope.DestinationIata()},this._scope.$emit(n.Events.Names.RouteSearch.SearchValid,t)):(i={OriginHasError:this._scope.OriginHasError(),DestinationHasError:this._scope.DestinationHasError()},this._scope.$emit(n.Events.Names.RouteSearch.SearchInvalid,i))},t.ControllerName="Controls_RouteSearch",t.$inject=["$scope","$rootScope"],t}();t.AngularRouteSearch=i})(i=t.RouteSearch||(t.RouteSearch={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(n){function t(t,i,r,u,f,e,o,s,h){var c=n.call(this,t,i,u,f,!0,e,o,s,h)||this;return c._scope=t,c._parameters=t.Section.Options.Parameters,c._parameters.FilterAirport=c.EnsureAirportHasWorldwideDataWhenNeeded(c._parameters.FilterAirport),c._scope.Airports=c.GetAirports(),c._scope.IsValidRoute=c.IsValidRoute.bind(c),c._scope.IsAvailableRoute=c.IsAvailableRoute.bind(c),c._scope.UnavailableDestinationHelpText=i.UnavailableDestinationHelpText,c._scope.CountryName=c._parameters.Country.Name,c.TrackCountryAirportDrawerEvent(c._parameters.AnalyticsCategory,c._parameters.AnalyticsAction),c}return __extends(t,n),t.prototype.OnUnavailableAirportSelected=function(){},t.prototype.OnDirectRouteOnlyChanged=function(){},t.prototype.OnAllRoutesChanged=function(){this._scope.Airports=this.GetAirports()},t.prototype.GetNumberOfValidAirports=function(){var n=this,t=this._scope.Airports.filter(function(t){return n.IsValidRoute(t)});return t.length},t.prototype.GetAirports=function(){var n=this._combinedRoutesService.GetAirportsInCountry(this._parameters.Country,this._scope.ShowAllRoutes);return this._parameters.ExcludeMarketGroups&&(n=n.filter(function(n){return!n.IsMarketGroup})),n},t.prototype.IsAvailableRoute=function(n){return this.IsExcludedAirport(n)?!1:this._combinedRoutesService.IsValidRouteForFilter(n,this._parameters.FilterAirport,this._scope.ShowAllRoutes)},t.prototype.IsValidRoute=function(n){var t;return this.IsExcludedAirport(n)?!1:!this._parameters.FilterAirport?!0:this._combinedRoutesService.WorldwideMode?(t=this._combinedRoutesService.IsValidRouteForFilter(n,this._parameters.FilterAirport,this._scope.ShowAllRoutes),this._scope.ShowAllRoutes?t||this._combinedRoutesService.HasNearbyRoutes(n,this._parameters.FilterAirport,this._parameters.IsOriginSelection):t):(t=this._combinedRoutesService.IsValidRouteForFilter(n,this._parameters.FilterAirport,!1),this._scope.ShowDirectRoutesOnly?t:!0)},t.BuildDrawerTitle=function(n,t,i){var r=i?n.DrawerSettings.CountryAirportsOriginTitle:n.DrawerSettings.CountryAirportsDestinationTitle;return r.replace("{country-name}",t.Name)},t.prototype.TrackCountryAirportDrawerEvent=function(n,t){var i=n==null?Tracking.EventConstants.Categories.BookingPod:n,r=t==null?Tracking.EventConstants.Actions.RouteSearch:t;this._analyticsTracker.TrackEvent(i,r,Tracking.EventConstants.Labels.RouteAirport)},t.ControllerName="Controls_RouteSearch_CountryAirportsDrawer",t.$inject=["$scope","Sitecore_RouteSearchSettings","Sitecore_RoutesData","IAnalyticsTracker","Controls_AirportListDrawerDirectRoutesOnlyService","Sitecore_WorldwideSettings","Controls_AirportListDrawerAllRoutesService","Search_AccessibilityService","Worldwide_CombinedRoutesService"],t}(n.BaseAirportListDrawer);n.CountryAirportsDrawer=t})(t=n.RouteSearch||(n.RouteSearch={}))})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function i(n,t,i,r){this._scope=n;this._routesService=new Main3.Routes.RoutesService(t);this._routeSearchSettings=i;this._analyticsTracker=r;this._parameters=n.Section.Options.Parameters;var u=new Main3.SimpleTemplate.ModelBuilders.MarketGroupDrawerModelBuilder(this._routesService);this._scope.SimpleModel=u.Build(this._parameters.MarketGroupCode,this._parameters.FilterIata);this._scope.DoAirportSelect=this.OnAirportSelect.bind(this);this._scope.DoUnavailableAirportSelect=this.OnUnavailableAirportSelect.bind(this);this.TrackMarketGroupDrawerOpen(this._parameters.IsOriginSelection)}return i.prototype.OnAirportSelect=function(n){var t=this._routesService.FindAirportByIata(n);this._parameters.IsOriginSelection?this._parameters.SetOriginAirport(t,!1):this._parameters.SetDestinationAirport(t,!1);this._parameters.AfterSelectAction()},i.prototype.OnUnavailableAirportSelect=function(i){var r=this._routesService.FindAirportByIata(i),u=this._routesService.FindAirportByIata(this._parameters.FilterIata),f={IsOriginSelection:this._parameters.IsOriginSelection,FilterAirport:u,FromCountryDrawer:!1,UnavailableAirport:r,ExcludeMarketGroups:!1,AnalyticsCategory:Tracking.EventConstants.Categories.DeepLink,AfterSelectAction:this._parameters.AfterSelectAction,SetOriginAirport:this._parameters.SetOriginAirport,SetDestinationAirport:this._parameters.SetDestinationAirport};n.Events.OpenDrawerWithOptions({SectionKey:"routesearch-alternate-routes",PreventDismissOverride:!0,Parameters:f,TitleOverride:t.AlternateRoutesDrawer.BuildDrawerTitle(this._routeSearchSettings,u,r,this._parameters.IsOriginSelection)})},i.prototype.TrackMarketGroupDrawerOpen=function(n){var t=n?Tracking.EventConstants.Labels.SelectOrigin:Tracking.EventConstants.Labels.SelectDestination;this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.DeepLink,Tracking.EventConstants.Actions.MobileMarketGroups,t)},i.ControllerName="Controls_RouteSearch_MarketGroupDrawer",i.$inject=["$scope","Sitecore_RoutesData","Sitecore_RouteSearchSettings","IAnalyticsTracker"],i}();t.MarketGroupDrawer=i})(i=t.RouteSearch||(t.RouteSearch={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this.$scope=n;this.$timeout=t;n.AddAirport=this.AddAirport.bind(this);n.DeleteAirport=this.DeleteAirport.bind(this);n.ShouldShowAddAirport=this.ShouldShowAddAirport.bind(this);n.ShowDeleteButton=this.ShowDeleteButton.bind(this)}return n.prototype.AddAirport=function(){this.$scope.Airports.push(this.EmptyAirport());this.$scope.FocusOnOriginAirportChange(this.$scope.Airports.length-1)},n.prototype.DeleteAirport=function(n){if(n){var t=this.$scope.Airports.indexOf(n);this.$scope.Airports.length>1?this.$scope.Airports.splice(t,1):n.Iata&&(this.$scope.Airports[0]=this.EmptyAirport());this.$scope.FocusOnOriginAirportChange(t)}},n.prototype.ShowDeleteButton=function(n){return n!==this.$scope.Airports[0]},n.prototype.ShouldShowAddAirport=function(){var t=this.$scope.AirportLimit,n;return!this.$scope.Airports||this.$scope.Airports.length>=t?!1:(n=this.$scope.Airports[this.$scope.Airports.length-1],!!n&&!!n.Iata)},n.prototype.EmptyAirport=function(){return{Iata:null,Name:null,B2bAreaCode:null,Connections:null,IndirectConnections:null,IndirectPartnerConnections:null,PartnerConnections:null,NearbyAirports:null,IsMarketGroup:null,MarketGroupIatas:null,Flags:null,ShowDirectRoutesByDefault:null,IsWorldwide:!1,PackageHolidayDestinationIds:null,EuropcarStationCode:null}},n.ControllerName="Controls_RouteSearchTextBoxList",n.$inject=["$scope","$timeout"],n}();n.RouteSearchTextBoxList=t})(t=n.RouteSearch||(n.RouteSearch={}))})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this._scope=n;this._packageHolidayDeepLinkService=t;this._analyticsTracker=i;this._window=r;this._scope.OpenSearchHolidaysPage=this.OpenSearchHolidaysPage.bind(this);this._scope.DestinationHasPackageHolidayId=this.DestinationHasPackageHolidayId.bind(this)}return n.prototype.OpenSearchHolidaysPage=function(){var n=this._packageHolidayDeepLinkService.ToUrl(this._scope.SearchPodModel);!n||(this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.LinkClick,Tracking.EventConstants.Actions.Holidays,Tracking.EventConstants.Labels.Show),this._window.open(n,"_blank"))},n.prototype.DestinationHasPackageHolidayId=function(){return this._packageHolidayDeepLinkService.DestinationHasPackageHolidayId(this._scope.SearchPodModel)},n.ControllerName="RuleBasedContent_PackageHolidaysButton",n.$inject=["$scope","PackageHolidayDeepLinkService","IAnalyticsTracker","$window"],n}();n.PackageHolidaysButton=t})(t=n.RuleBasedContent||(n.RuleBasedContent={}))})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._scope=n;this._searchHistoryService=t;this._routesService=new Main3.Routes.RoutesService(i);this._scope.RecentSearches=this.GetRecentSearches();this._scope.FriendlyAirportName=this.FormatAirportData.bind(this);this._scope.GetDisplayDate=this.GetDisplayDate.bind(this);this._scope.IsMarketGroupSearch=this._routesService.IsMarketGroupRoute.bind(this._routesService);this._drawerParameters=this._scope.CurrentSection.Options.Parameters;this._scope.SetSearchPodFlightData=this.SetSearchPodFlightData.bind(this);this._scope.ClearRecentSearches=this.ClearRecentSearches.bind(this);this._scope.MaxNumberOfRecentSearches=this._drawerParameters.MaxNumberOfRecentSearches}return n.prototype.GetRecentSearches=function(){return this._searchHistoryService.GetRecentSearches()},n.prototype.FormatAirportData=function(n){return this._routesService.FindAirportByIata(n).Name},n.prototype.GetDisplayDate=function(n){return n.Date().Format("DD MMM YYYY")},n.prototype.ClearRecentSearches=function(){this._searchHistoryService.ClearSearchHistory();this._drawerParameters.OnClearRecentSearches();this._scope.DoClose()},n.prototype.SetSearchPodFlightData=function(n){this._drawerParameters.OnSelectRecentSearch(n);this._scope.DoClose()},n.ControllerName="Controls_RecentSearches",n.$inject=["$scope","Controls_SearchHistoryService","Sitecore_RoutesData"],n}();n.RecentSearchesController=t})(t=n.SearchPod||(n.SearchPod={}))})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=Main3.SearchPod,i=function(){function n(n,i){this.Passengers={Adults:1,Children:0,Infants:0};this._scope=n;this.Passengers=this._scope.Passengers||this.Passengers;this.PassengersViewModel={Adults:new t.AdultsViewModel(this.Passengers,i),Children:new t.ChildrenViewModel(this.Passengers,i),Infants:new t.InfantsViewModel(this.Passengers)};this._scope.Passengers=this.Passengers}return n.$inject=["$scope","Sitecore_SearchPassengersSettings"],n}();n.SearchPassengersController=i})(t=n.SearchPod||(n.SearchPod={}))})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i){this._scope=t;this._analyticsTracker=i;this._validateAsWorldwide=!1;this._scope.GetLabelLink=this.GetLabelLink.bind(this);this._scope.GenerateQuantitySelectorId=this.GenerateQuantitySelectorId.bind(this);this._scope.IsValidAmount=this.IsValidAmount.bind(this);this._scope.CanIncrement=this.CanIncrement.bind(this);this._scope.CanDecrement=this.CanDecrement.bind(this);this._scope.ShowInvalidPassengerAmountDrawer=this.ShowInvalidPassengerAmountDrawer.bind(this);this._scope.ShowInvalidPassengerAmountDrawerForAdditionalPassenger=this.ShowInvalidPassengerAmountDrawerForAdditionalPassenger.bind(this);this._scope.ShowInvalidPassengerAmountDrawerForRemovedPassenger=this.ShowInvalidPassengerAmountDrawerForRemovedPassenger.bind(this);this._scope.IncrementPassengersAnalyticsEvent=this.IncrementPassengersAnalyticsEvent.bind(this);this._scope.DecrementPassengersAnalyticsEvent=this.DecrementPassengersAnalyticsEvent.bind(this);this._scope.$on(n.Events.Names.SearchPassengers.Validate,this.ValidatePassengers.bind(this));this._scope.$on(n.Events.Names.SearchPod.ValidateAsWorldwide,this.SetValidateAsWorldwide.bind(this))}return t.prototype.GenerateQuantitySelectorId=function(){return this._scope.Type+"-"+this._scope.Identifier},t.prototype.IsValidAmount=function(n){return this.ValidatePassengersAndShowDrawerIfRequired(!1,n)},t.prototype.CanIncrement=function(n){return this.IsValidAmount(n+1)},t.prototype.CanDecrement=function(n){return n>0},t.prototype.ValidatePassengersAndShowDrawerIfRequired=function(n,t){return this.PassengersViewModel.ValidAmount(n,this._validateAsWorldwide,t)},t.prototype.ValidatePassengerCompositionChangeAndShowDrawerIfRequired=function(n,t){var i=this._scope.Passengers[this._scope.Type]+t;return this.PassengersViewModel.ValidAmount(n,this._validateAsWorldwide,i)},t.prototype.GetLabelLink=function(){return this.PassengersViewModel.GetLabelLink()},t.prototype.ValidatePassengers=function(){return this.ValidatePassengersAndShowDrawerIfRequired(!0)},t.prototype.ShowInvalidPassengerAmountDrawer=function(){this.ValidatePassengersAndShowDrawerIfRequired(!0)},t.prototype.ShowInvalidPassengerAmountDrawerForAdditionalPassenger=function(){this.ShowInvalidPassengerAmountDrawerForChangedPassengerComposition(1)},t.prototype.ShowInvalidPassengerAmountDrawerForRemovedPassenger=function(){this.ShowInvalidPassengerAmountDrawerForChangedPassengerComposition(-1)},t.prototype.ShowInvalidPassengerAmountDrawerForChangedPassengerComposition=function(n){this.ValidatePassengerCompositionChangeAndShowDrawerIfRequired(!0,n)},t.prototype.SetValidateAsWorldwide=function(n,t){this._validateAsWorldwide=t},t.prototype.IncrementPassengersAnalyticsEvent=function(n){this.ChangePassengersAnalyticsEvent("Increment",n)},t.prototype.DecrementPassengersAnalyticsEvent=function(n){this.ChangePassengersAnalyticsEvent("Decrement",n)},t.prototype.ChangePassengersAnalyticsEvent=function(n,t){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.ChangeSearch,n+" "+this._scope.Type+" Passenger Count",t.toString())},t.$inject=["$scope","IAnalyticsTracker"],t}();t.SearchPassengerGroupController=i})(i=t.SearchPod||(t.SearchPod={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(t){function i(n,i,r,u,f,e,o,s,h,c,l,a,v,y,p){var w=t.call(this,n,v,y,s,h,c,a)||this;return w._analyticsTracker=i,w._deepLinkService=r,w._worldwideDeepLinkService=u,w._defaultSearchPodValuesService=f,w._searchHistoryService=e,w._searchPodSubmissionService=o,w._searchAccessibilityService=p,w._scope.ShowSpecialAssistance=w.ShowSpecialAssistance.bind(w),w._scope.ShowRecentSearches=w.ShowRecentSearches.bind(w),w._scope.IsSearchForWorldwideRoute=w.IsSearchForWorldwideRoute.bind(w),w._scope.SearchButtonText=w.SearchButtonText.bind(w),w._scope.IsWorldwide=!v.WorldwideMode?!1:v.WorldwideMode,w.SetSearchPodModel(),w}return __extends(i,t),i.prototype.BuildInitialSearchPodModel=function(){var t=this;return this._defaultSearchPodValuesService.GetDefaultFlightSearch().then(function(i){t._scope.$applyAsync(function(){t.SetSearchPodModel(t.BuildSearchPodModelFromSearch(i));t._scope.$broadcast(n.Events.Names.RouteSearch.ResetRoute,t._scope.SearchPodModel.OriginIata,t._scope.SearchPodModel.DestinationIata);t.ResetPassengersModel(i);t._scope.searchPodForm.$rollbackViewValue()})}),this.BuildSearchPodModelFromSearch(this.GetEmptyFlightSearch())},i.prototype.GetEmptyFlightSearch=function(){return{OriginAirportIata:"",DestinationAirportIata:"",OutboundDate:null,ReturnDate:null,IsOneWayFlight:!1,Adults:1,Children:0,Infants:0}},i.prototype.BuildSearchPodModelFromSearch=function(n){var t=this._searchHistoryService.GetRecentSearches();return{OriginIata:n.OriginAirportIata,DestinationIata:n.DestinationAirportIata,IsOneWayFlight:n.IsOneWayFlight,DepartureDate:n.OutboundDate?n.OutboundDate.Date():null,ReturnDate:n.ReturnDate?n.ReturnDate.Date():null,Passengers:this.BuildSearchPassengers(n),RecentSearches:t?Math.min(t.length,this._searchPodSettings.MaxNumberOfRecentSearches):0}},i.prototype.BuildSearchPassengers=function(n){var t=this._scope.SearchPodModel&&this._scope.SearchPodModel.Passengers?this._scope.SearchPodModel.Passengers:{};return t.Adults=n.Adults,t.Children=n.Children,t.Infants=n.Infants,t},i.prototype.FormAction=function(){this.IsSearchForWorldwideRoute()?(this._searchAccessibilityService.OpenNewWindowWorldwideSearch(),this.CreateWorldwideUrlAndNavigate()):this._searchPodSubmissionService.ShowInfoDrawersAndSubmitTheForm(this._scope.SearchPodModel,!0,this.CreateDeepLinkUrlAndNavigate.bind(this))},i.prototype.SearchButtonText=function(){return this.IsSearchForWorldwideRoute()?this._searchPodSettings.ShowWorldwideFlightsButtonText:this._searchPodSettings.ShowFlightsButtonText},i.prototype.IsSearchForWorldwideRoute=function(){return this._combinedRoutesService.IsWorldwideRoute(this._scope.SearchPodModel.OriginIata,this._scope.SearchPodModel.DestinationIata)},i.prototype.CreateWorldwideUrlAndNavigate=function(){var t={OriginIata:this._scope.SearchPodModel.OriginIata,DestinationIata:this._scope.SearchPodModel.DestinationIata,DepartureDate:this._scope.SearchPodModel.DepartureDate,ReturnDate:this._scope.SearchPodModel.ReturnDate,Adults:this._scope.SearchPodModel.Passengers.Adults,Children:this._scope.SearchPodModel.Passengers.Children,Infants:this._scope.SearchPodModel.Passengers.Infants,IsOneWayFlight:this._scope.SearchPodModel.IsOneWayFlight},n=this._worldwideDeepLinkService.ToUrl(t);this._analyticsTracker.TrackEventAndExecuteCallback(Tracking.EventConstants.Categories.LinkClick,Tracking.EventConstants.Actions.External,n,function(){return window.open(n,"_blank")})},i.prototype.CreateDeepLinkUrlAndNavigate=function(){var n={OriginIata:this._scope.SearchPodModel.OriginIata,DestinationIata:this._scope.SearchPodModel.DestinationIata,DepartureDate:this._scope.SearchPodModel.DepartureDate,ReturnDate:this._scope.SearchPodModel.ReturnDate,Adults:this._scope.SearchPodModel.Passengers.Adults,Children:this._scope.SearchPodModel.Passengers.Children,Infants:this._scope.SearchPodModel.Passengers.Infants,OtherParameters:{}},t;n.OtherParameters.isOneWay=this._scope.SearchPodModel.IsOneWayFlight?"on":"off";t=this._deepLinkService.ToUrl(n,this._searchPodSettings.DeepLinkGeneratorSettings);window.location.href=t},i.prototype.ShowSpecialAssistance=function(t){t.preventDefault();n.Events.OpenDrawerWithOptions({SectionKey:"special-assistance"})},i.prototype.ShowRecentSearches=function(t){var i=this,r,u;t.preventDefault();r={OnSelectRecentSearch:function(t){n.Directives.ShowModal.ElementToFocusOnCloseOverride=i._scope.FormElement.find(".recent-searches button").first();i.SetSearchPodModel(i.BuildSearchPodModelFromSearch(t));i.ResetPassengersModel(t);i._scope.searchPodForm.$rollbackViewValue();i._scope.$broadcast(n.Events.Names.RouteSearch.ResetRoute,i._scope.SearchPodModel.OriginIata,i._scope.SearchPodModel.DestinationIata)},OnClearRecentSearches:function(){n.Directives.ShowModal.ElementToFocusOnCloseOverride=i._scope.FormElement.find("input.origin").first();i._scope.SearchPodModel.RecentSearches=0},MaxNumberOfRecentSearches:this._searchPodSettings.MaxNumberOfRecentSearches};u={SectionKey:"recent-searches",Parameters:r};n.Events.OpenDrawerWithOptions(u)},i.prototype.ResetPassengersModel=function(n){this._scope.searchPodForm&&(this._scope.searchPodForm.Adults.$setViewValue(n.Adults.toString()),this._scope.searchPodForm.Adults.$commitViewValue(),this._scope.searchPodForm.Children.$setViewValue(n.Children.toString()),this._scope.searchPodForm.Children.$commitViewValue(),this._scope.searchPodForm.Infants.$setViewValue(n.Infants.toString()),this._scope.searchPodForm.Infants.$commitViewValue())},i.ControllerName="Controls_SearchPodForm",i.$inject=["$scope","IAnalyticsTracker","Common_DeepLinksService","Worldwide_DeepLinkService","Controls_SearchPodDefaultValues","Controls_SearchHistoryService","Controls_SearchPodSubmissionService","Controls_LowestFaresApiService","Controls_LowestFaresDataFlightFinder","Controls_RouteDataFlightFinder","Sitecore_RoutesData","Controls_SearchPodRouteDatesPreloader","Sitecore_SearchPodSettings","Worldwide_CombinedRoutesService","Search_AccessibilityService",],i}(t.BaseSearchPodController);t.SearchPodController=i})(i=t.SearchPod||(t.SearchPod={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._scope=n;this._ruleBasedContentService=t;this._combinedRoutesService=i;!this._scope||this._scope.$watch(this.BuildPackageHolidaysRuleBasedContentKey.bind(this),this.UpdateRuleBasedContent.bind(this))}return t.prototype.UpdateRuleBasedContent=function(){var n=this;!this._ruleBasedContentService||this._ruleBasedContentService.PublishUpdate(function(t){return n.UpdateRulesEventsArgs(t)})},t.prototype.BuildPackageHolidaysRuleBasedContentKey=function(){var n=this._scope.SearchPodModel,t="";return!n||(!n.OriginIata||!n.DestinationIata||(t+=""+n.OriginIata+n.DestinationIata),!n.DepartureDate||(t+=n.DepartureDate.ToCompressedString()),t+=n.IsOneWayFlight,n.IsOneWayFlight||!n.ReturnDate||(t+=n.ReturnDate.ToCompressedString()),t+=""+n.Passengers.Adults+n.Passengers.Children+n.Passengers.Infants),t},t.prototype.UpdateRulesEventsArgs=function(t){var i=[],r,u;return!this._scope.SearchPodModel.OriginIata||!this._scope.SearchPodModel.DestinationIata||(r={From:this._scope.SearchPodModel.OriginIata,To:this._scope.SearchPodModel.DestinationIata,Direction:n.Data.Common.RouteDirection.Outbound},!this._scope.SearchPodModel.DepartureDate||(r.LocalDepartureTime=this._scope.SearchPodModel.DepartureDate.ToZonelessDateTime()),i.push(r),this._scope.SearchPodModel.IsOneWayFlight||(u={To:this._scope.SearchPodModel.OriginIata,From:this._scope.SearchPodModel.DestinationIata,Direction:n.Data.Common.RouteDirection.Return},!this._scope.SearchPodModel.ReturnDate||(u.LocalDepartureTime=this._scope.SearchPodModel.ReturnDate.ToZonelessDateTime()),i.push(u))),t.IsWorldwideRoute=this.IsSearchForWorldwideRoute(),t.NumberOfPassengers={Adults:this._scope.SearchPodModel.Passengers.Adults,Children:this._scope.SearchPodModel.Passengers.Children,Infants:this._scope.SearchPodModel.Passengers.Infants},t.RoutePairs=i,t},t.prototype.IsSearchForWorldwideRoute=function(){return!!this._scope.SearchPodModel.OriginIata&&!!this._scope.SearchPodModel.DestinationIata&&this._combinedRoutesService.IsWorldwideRoute(this._scope.SearchPodModel.OriginIata,this._scope.SearchPodModel.DestinationIata)},t.ControllerName="Controls_SearchPodPackageHolidaysButton",t.$inject=["$scope","Common_RuleBasedContentService","Worldwide_CombinedRoutesService"],t}();t.SearchPodPackageHolidaysButtonController=i})(i=t.SearchPod||(t.SearchPod={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u){this._scope=n;this._tracking=t;this._routeData=i;this._dateCountdownService=r;this._drawerSectionStore=u;this._scope.OnOverlayActionButtonClick=this.OnOverlayActionButtonClick.bind(this);this._scope.ReplaceTokens=this.ReplaceTokens.bind(this);this._tracking.TrackEvent(Tracking.EventConstants.Categories.Personalisation,Tracking.EventConstants.Actions.Load,"Next Best Action")}return t.prototype.ReplaceTokens=function(n,t){t===void 0&&(t=!1);t&&(n=decodeURIComponent(n));var i=new Main3.Content.NextBestActionTokenReplacer(this._dateCountdownService,this._routeData,this._scope.weiner.NextBestAction.PersonalisationData,this._scope.weiner.NextBestAction.DestinationAirportData);return i.ReplaceTokens(n)},t.prototype.OnOverlayActionButtonClick=function(t){if(!t.LinkUrl){if(!!t.Drawer){this._tracking.TrackEvent(Tracking.EventConstants.Categories.NextBest,Tracking.EventConstants.Actions.Click+" - "+this.AnalyticsActionName(t),t.Path);var i=new System.Guid(t.Drawer),r="DrawerActionButton_"+i.ToCleanString();this._drawerSectionStore.Contains(r)||this._drawerSectionStore.Register({Id:i.ToString().toLowerCase(),Key:r,ContentUrl:"?sc_itemid="+i.ToString().toLowerCase(),Title:t.DrawerTitle,AllowBack:!0,DestroyOnDrawerClose:!0});n.Events.OpenDrawer(r)}}else this._tracking.TrackEvent(Tracking.EventConstants.Categories.NextBest,Tracking.EventConstants.Actions.Click+" - "+this.AnalyticsActionName(t),t.Path)},t.prototype.AnalyticsActionName=function(n){if(!!n.Path){var t=n.Path.split("/");if(t.length>1)return t[t.length-1]}return n.Text},t.ControllerName="Controls_NextBestActionOverlay",t.$inject=["$scope","IAnalyticsTracker","Sitecore_RoutesData","Controls_DateCountdownService","Controls_DrawerSectionStore"],t}();t.NextBestActionOverlayController=i})(i=t.UberKahuna||(t.UberKahuna={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c){this._scope=t;this._uberKahunaApiService=i;this._uberKahunaRulesService=r;this._uberKahunaCoordinator=u;this._tracking=f;this._sce=e;this._timeout=o;this._tradingWeinerDataLoader=s;this._pricedOverlayDataLoader=h;this._nextBestActionDataLoader=c;this._isTouchDevice=Device.IsTouchDevice();this._scope.ActiveWeiner=1;this._scope.TotalNumberOfWeiners=1;this._scope.CarouselPaused=this.CarouselPaused.bind(this);this._scope.ShouldUseSingleOverlayPanelStyle=this.ShouldUseSingleOverlayPanelStyle.bind(this);this.InitialiseFocusHoverSettings();this._scope.OnDealClick=this.OnDealClick.bind(this);this._scope.OnPricedOverlayClick=this.OnPricedOverlayClick.bind(this);this._scope.OnStaticOverlayClick=this.OnStaticOverlayClick.bind(this);this._scope.OnWeinerClick=this.OnWeinerClick.bind(this);this.GetKahunaData(this._uberKahunaCoordinator.Tabs[0].Kahuna);this._scope.$on(n.Events.Names.TabbedContainer.TabSelected,this.OnTabChanged.bind(this));this._scope.$on(n.Events.Names.Account.SignInStatusChanged,this.OnSignInStatusChanged.bind(this));this._tracking.TrackEvent(Tracking.EventConstants.Categories.Personalisation,Tracking.EventConstants.Actions.Load,"UberKahuna")}return t.prototype.InitialiseFocusHoverSettings=function(){var n=this,t,i;this._scope.FocusHoverSettings={CarouselFocused:!1,CarouselHovered:!1,SetCarouselFocused:function(i){n._timeout.cancel(t);t=n._timeout(function(){return n._scope.FocusHoverSettings.CarouselFocused=i})},SetCarouselHovered:function(t){n._timeout.cancel(i);i=n._timeout(function(){return n._scope.FocusHoverSettings.CarouselHovered=t})}}},t.prototype.CarouselPaused=function(){return this._scope.IsForcePaused||!this._isTouchDevice&&(this._scope.FocusHoverSettings.CarouselFocused||this._scope.FocusHoverSettings.CarouselHovered)},t.prototype.ShouldUseSingleOverlayPanelStyle=function(n){return!!n&&n.length===1?n[0].ExpandToFullHeight:!1},t.prototype.OnTabChanged=function(n,t){var r=t[0],i;if(r)for(i=0;i<this._uberKahunaCoordinator.Tabs.length;i++)this._uberKahunaCoordinator.Tabs[i].RelatedTab===r&&this.GetKahunaData(this._uberKahunaCoordinator.Tabs[i].Kahuna)},t.prototype.OnSignInStatusChanged=function(t,i,r){if(r!==n.Data.Account.SignedInStatus.Unknown&&this._scope.HasPossiblePersonalisedContent){var u=this._lastKahunaLoaded;this._lastKahunaLoaded=null;this._uberKahunaRulesService.ResetPersonalisation();this.GetKahunaData(u)}},t.prototype.GetKahunaData=function(n){var i=this,t;this.KahunaIsDisplayed(n)||(t=new System.Guid(n),this._scope.IsForcePaused=!0,this._scope.HasPossiblePersonalisedContent=this._uberKahunaRulesService.AnyWeinerInKahunaHasPossiblePersonalisation(t),this._uberKahunaRulesService.ResolveKahunaWeiners(t).then(function(t){i._uberKahunaApiService.GetWeinerContent(n,t).then(function(n){i.FinaliseKahunaData(n)})}))},t.prototype.FinaliseKahunaData=function(t){var i=this;this._scope.Data=this.SanitizeWeinerHtml(t);this._scope.ActiveWeiner=1;this._scope.TotalNumberOfWeiners=this._scope.Data.Weiners.length;this._scope.DisplayTime=this._scope.Data.DisplayTime;this._scope.TransitionTime=this._scope.Data.TransitionTime;this._scope.DefaultWeiner&&this._scope.DefaultWeiner.fadeOut(this._scope.TransitionTime,function(){i._scope.DefaultWeiner.remove();i._scope.DefaultWeiner=null});this.TrackAnalyticsData();this._tradingWeinerDataLoader&&this._tradingWeinerDataLoader.LoadDataForWeiners(this._scope.Data.Weiners);this._pricedOverlayDataLoader&&this._pricedOverlayDataLoader.LoadDataForPricedOverlays(this._scope.Data.Weiners);this._nextBestActionDataLoader?this._nextBestActionDataLoader.LoadDataForNextBestActions(this._scope.Data.Weiners).then(function(){i._scope.$broadcast(n.Events.Names.UberKahuna.RefreshBackgroundImage);i._scope.IsForcePaused=!1}):this._scope.IsForcePaused=!1},t.prototype.TrackAnalyticsData=function(){var n=this._scope.Data.Weiners,t;if(n&&n.length>0)for(t=0;t<n.length;t++)this._tracking.TrackNonInteractionEvent("Adverts","Load",n[t].Path)},t.prototype.OnDealClick=function(n,t,i){if(n.CallToActionLink){n.CallToActionPrice&&this.OpenNpaxDrawer(i,n.CallToActionLink);var r="Click - Slot "+t;this._tracking.TrackEvent("Adverts",r,n.Path)}},t.prototype.OnPricedOverlayClick=function(n,t){n.ButtonLink&&(n.Price&&this.OpenNpaxDrawer(t,n.ButtonLink),this._tracking.TrackEvent(Tracking.EventConstants.Categories.Overlays,Tracking.EventConstants.Actions.Click,n.Path))},t.prototype.OnStaticOverlayClick=function(n){this._tracking.TrackEvent(Tracking.EventConstants.Categories.Overlays,Tracking.EventConstants.Actions.Click,n.Path)},t.prototype.OpenNpaxDrawer=function(t,i){t.preventDefault();var r={SectionKey:"npax",Parameters:{DealLink:i}};n.Events.OpenDrawerWithOptions(r)},t.prototype.OnWeinerClick=function(n,t){if(Main3.Common.BreakPointService.IsMobile()){t.preventDefault();return}n.CarouselLinkTarget&&(this._scope.IsForcePaused=!0,this._tracking.TrackEvent("Adverts","Click - Carousel",n.Path))},t.prototype.KahunaIsDisplayed=function(n){return this._lastKahunaLoaded===n?!0:(this._lastKahunaLoaded=n,!1)},t.prototype.SanitizeWeinerHtml=function(n){if(!n||!n.Weiners||n.Weiners.length===0)return null;for(var t=0;t<n.Weiners.length;t++)n.Weiners[t].DealPanelDisclaimerText=this._sce.trustAsHtml(n.Weiners[t].DealPanelDisclaimerText),n.Weiners[t].DealPanelMobileDisclaimerText=this._sce.trustAsHtml(n.Weiners[t].DealPanelMobileDisclaimerText);return n},t.$inject=["$scope","Controls_UberKahunaApiService","Controls_UberKahunaRulesService","Sitecore_UberKahunaCoordinator","IAnalyticsTracker","$sce","$timeout","Controls_UberKahunaTradingWeinerDataLoader","Controls_UberKahunaPricedOverlayDataLoader","Controls_UberKahunaNextBestActionDataLoader"],t}();t.UberKahunaController=i})(i=t.UberKahuna||(t.UberKahuna={}))})(i=t.Controls||(t.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._scope=n;this._timeout=t;this._scope.PlayPauseButtonClicked=this.PlayPauseButtonClicked.bind(this);this._scope.$watch(function(n){return n.CarouselPaused()},this.ToggleCarousel.bind(this))}return n.prototype.PlayPauseButtonClicked=function(){var n=this;this._timeout(function(){n._scope.IsForcePaused=!n._scope.IsForcePaused})},n.prototype.ControlButtonClicked=function(n){this.PauseCarousel();this.SwitchToCarouselItem(n)},n.prototype.PauseCarousel=function(){var n=this;this._timeout(function(){n._scope.IsForcePaused=!0})},n.prototype.PlayCarousel=function(){var n=this;this._timeout(function(){n._scope.IsForcePaused=!1})},n.prototype.ToggleCarousel=function(n){var t=this;n?clearInterval(this._timeInterval):this._timeInterval=setInterval(function(){t.SwitchToNextCarouselItem()},this._scope.DisplayTime)},n.prototype.SwitchToNextCarouselItem=function(){this._scope.ActiveWeiner===this._scope.TotalNumberOfWeiners?this.SwitchToCarouselItem(1):this.SwitchToCarouselItem(this._scope.ActiveWeiner+1)},n.prototype.SwitchToCarouselItem=function(n){var t=this;this._timeout(function(){t._scope.ActiveWeiner=n})},n.ControllerName="Controls_WeinerCarousel",n.$inject=["$scope","$timeout"],n}();n.WeinerCarouselController=t})(t=n.UberKahuna||(n.UberKahuna={}))})(t=n.Controls||(n.Controls={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this._scope=n;this._rootScope=t;this.ListenForEvents()}return t.prototype.ListenForEvents=function(){var t=this;this._rootScope.$on(n.Events.Names.FlightTracker.FlightUpdated,function(n,i){var r=i;t._scope.FlightTrackerStatus=r.FlightTrackerStatus;t._scope.Flights=t.GetFlightCardFlights(t._scope.FlightTrackerStatus.flights)})},t.prototype.GetFlightCardFlights=function(n){for(var i,r=[],t=0;t<n.length;t++)i=!1,t>0&&(i=!0),r.push(this.ConvertFlightToFlightCardFlight(n[t],i));return r},t.prototype.ConvertFlightToFlightCardFlight=function(n,t){return{CarrierCode:FlightStatus.Tools.GetCarrierCode(n.flightNumber),FlightNumber:parseInt(FlightStatus.Tools.GetDigits(n.flightNumber)),SegmentId:n.segmentId,FlightKey:null,DepartureIata:n.origin.iata,ArrivalIata:n.destination.iata,LocalDepartureTime:n.origin.scheduledTime,LocalArrivalTime:n.destination.scheduledTime,ActualDepartureTime:n.origin.actualTime,ActualArrivalTime:n.destination.actualTime,EstimatedDepartureTime:n.origin.estimatedTime,EstimatedArrivalTime:n.destination.estimatedTime,IsCancelled:n.cancelled,IsDisrupted:!1,IsDiverted:n.diverted,DepTerminalName:n.origin.terminal,ArrTerminalName:n.destination.terminal,ProgressPercent:n.progressPercent,IsAdditionalFlight:t,IsReturnedToOrigin:n.returnedToOrigin,ExtraInformation:n.detailText}},t.ControllerName="FlightTracker_FlightTrackerPanel",t.$inject=["$scope","$rootScope"],t}();t.FlightTrackerPanel=i})(i=t.FlightTracker||(t.FlightTracker={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this.TimetableLinkPlaceholder="{timetable}";this._scope=n;this._element=t;var i=n.Section.Options.Parameters;this._scope.OriginIata=i.OriginIata;this._scope.DestinationIata=i.DestinationIata;this._scope.Initialise=this.Initialise.bind(this)}return n.prototype.Initialise=function(n,t){var i=this._element.html(),r=this.BuildAnchor(n,t);i=i.replaceAll(this.TimetableLinkPlaceholder,r);this._element.html(i)},n.prototype.BuildAnchor=function(n,t){var i=n+"/"+this._scope.OriginIata+"/"+this._scope.DestinationIata,r=$jq("<a>").attr("href",i).html(t);return $jq("<span>").append(r).html()},n.ControllerName="FlightTracker_NoResultsDrawer",n.$inject=["$scope","$element"],n}();n.NoResultsDrawer=t})(t=n.FlightTracker||(n.FlightTracker={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i){var r=this;this._scope=t;this._rootScope=i;this._scope.DoClick=this.OnButtonClick.bind(this);this._rootScope.$on(n.Events.Names.FlightTracker.FlightUpdated,function(n,t){var i=t;r._flightId=i.FlightTrackerStatus.flightId})}return t.prototype.OnButtonClick=function(t){t.preventDefault();var i={FlightId:this._flightId,WasLoggedOut:!1};n.Events.OpenDrawerWithOptions({SectionKey:"hotacc-login",Parameters:i},this._rootScope)},t.ControllerName="FlightTracker_OvernightDisruptionButton",t.$inject=["$scope","$rootScope"],t}();t.OvernightDisruptionButton=i})(i=t.FlightTracker||(t.FlightTracker={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f,e){this._tracking=e;this._flightSegmentId="";this._scope=n;this._rootScope=t;this._clientSettings=i;this._rebookingService=r;this._pickBookingService=u;this._clientApiService=f;this._scope.Visible=!1;this._scope.Enabled=!0;this._scope.DoClick=this.OnClick.bind(this);this.ListenForEvents()}return t.prototype.ListenForEvents=function(){var i=this;this._rootScope.$on(n.Events.Names.FlightTracker.FlightUpdated,function(n,r){var u=r;i._scope.Visible=u.FlightTrackerStatus.isCancelled||t.AlwaysShow;i._flightSegmentId=u.FlightTrackerStatus.flights[0].segmentId})},t.prototype.OnClick=function(n){var i=this,t;this._tracking.TrackEvent(Tracking.EventConstants.Categories.FlightTracker,Tracking.EventConstants.Actions.TransferOrRefund,this._flightSegmentId);this._scope.RebookingPortalOn&&this._scope.Enabled&&(this._scope.Enabled=!1,n.preventDefault(),t=this._clientApiService.GetApiUrlByName("Rebooking"),Utilities.CrossDomain.IsCrossDomainUrl(t)&&!$jq.support.cors?this._pickBookingService.RedirectToRebooking(this._flightSegmentId):this._rebookingService.StartRebookingProcessThenGoToRebookingPage(this._flightSegmentId,function(){i._scope.Enabled=!0}))},t.AlwaysShow=!1,t.ControllerName="FlightTracker_RebookingButton",t.$inject=["$scope","$rootScope","Sitecore_RebookingClientSettings","Rebooking_Service","Rebooking_PickBookingService","ClientApi_Service","IAnalyticsTracker"],t}();t.RebookingButton=i})(i=t.FlightTracker||(t.FlightTracker={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._scope=n;this._routesService=new Main3.Routes.RoutesService(t);var r=this.AlternativeDestinationDrawerParameters();this.SetParameters(r,i);this._scope.OnSelect=function(n){r.OnSelect(n)};this._scope.FilteredFlagsToDisplay=this.FilteredFlagsToDisplay.bind(this)}return n.prototype.AlternativeDestinationDrawerParameters=function(){return this._scope.CurrentSection.Options.Parameters},n.prototype.SetFilterFlagsValue=function(n){var t=[];for(var i in n)t.push(n[i].CookieCode);return t},n.prototype.FilteredFlagsToDisplay=function(n){return this._scope.SimpleModel.FilteredAlternativeAirports[n]?this._scope.SimpleModel.FilteredAlternativeAirports[n].length>0:!1},n.prototype.SetParameters=function(n,t){this._scope.OriginIata=n.OriginIata;this._modelBuilder=new Main3.SimpleTemplate.ModelBuilders.AlternativeDestinationAirportsDrawerModelBuilder(n.OriginIata,n.DestinationIata,this._routesService);this._scope.FilterFlags=this.SetFilterFlagsValue(t);this._scope.SimpleModel=this._modelBuilder.Build(this._scope.FilterFlags);this._scope.FlagsFound=!1;for(var i=0;i<this._scope.FilterFlags.length;i++)this._scope.SimpleModel.FilteredAlternativeAirports[this._scope.FilterFlags[i]]&&this._scope.SimpleModel.FilteredAlternativeAirports[this._scope.FilterFlags[i]].length>0&&(this._scope.FlagsFound=!0)},n.ControllerName="Funnel_AlternativeDestinationAirportsDrawer",n.$inject=["$scope","Sitecore_RoutesData","Sitecore_AlternativeDestinationsDrawerSettings"],n}();n.AlternativeDestinationAirportsDrawer=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this._alternativeAirportsService=r;this._scope=n;this._routesService=new Main3.Routes.RoutesService(t);var u=this.AlternativeOriginDrawerParameters();this.SetupAlternativeOriginParameters(u);this._scope.OnSelect=function(n){i.IgnoreNextRouteChangeEvent(!0);u.OnSelect(n)}}return n.prototype.AlternativeOriginDrawerParameters=function(){return this._scope.CurrentSection.Options.Parameters},n.prototype.SetupAlternativeOriginParameters=function(n){this._scope.OriginIata=n.OriginIata;this._scope.DestinationIata=n.DestinationIata;this._scope.AlternativeOriginAirports=this._alternativeAirportsService.GetAlternativeOriginAirports(this._scope.OriginIata,this._scope.DestinationIata);Main3.Common.BreakPointService.IsMobile()||(this._scope.RegionalAirport=this.GetRegionalAirports())},n.prototype.GetRegionalAirports=function(){var t,i,n,r;if(this._scope.AlternativeOriginAirports.length>=2){for(t=[],n=0;n<this._scope.AlternativeOriginAirports.length;n++)i=this._routesService.GetMarketGroupCodeForIata(this._scope.AlternativeOriginAirports[n].RouteNearbyOrigin.Airport.Iata),i&&(t=this.RegionalAirportCodeBelongToList(t,i));for(n=0;n<t.length;n++)if(r=t[n],r.Count>=2)return{Airport:this._routesService.FindAirportByIata(r.Region),Nearby:null}}return null},n.prototype.RegionalAirportCodeBelongToList=function(n,t){for(var i,u=!1,r=0;r<n.length;r++)i=n[r],i.Region===t&&(i.Count=i.Count+1,u=!0);return u||n.push({Region:t,Count:1}),n},n.ControllerName="Funnel_AlternativeOriginAirportsDrawer",n.$inject=["$scope","Sitecore_RoutesData","SmartMessage_Service","Funnel_AlternativeAirportsService"],n}();n.AlternativeOriginAirportsDrawer=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t){this._scope=t;this._scope.IsLoading=this.IsLoading.bind(this);this._scope.$on(n.Events.Names.Funnel.FunnelReady,this.OnFunnelReady.bind(this));n.Events.Fire(n.Events.Names.Basket.FunnelBasketUpdating);n.Events.Fire(n.Events.Names.Basket.BasketInitialised)}return t.prototype.IsLoading=function(){return!1},t.prototype.OnFunnelReady=function(){n.Events.Fire(n.Events.Names.Basket.HeightModified)},t.ControllerName="Funnel_AncillariesPanel",t.$inject=["$scope"],t}();t.AncillariesPanel=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u){this._scope=n;this._qService=t;this._bookingDataService=i;this._tokenReplacementService=r;this._hotelUpsellSettings=u;this._scope.Initialize=this.Initialize.bind(this);this._scope.PanelIsValid=this.PanelIsValid.bind(this)}return t.prototype.Initialize=function(n){var t=this;this._ancillaryModels=n;this._bookingDataService.DataPromise.then(function(n){t._booking=n;t.BuildViewModelsIfBasketExists()})},t.prototype.PanelIsValid=function(){return this._scope.AncillaryViewModels?this._scope.AncillaryViewModels.length>0:!1},t.prototype.BuildViewModelsIfBasketExists=function(){var f=this,t,n,i,r,u;if(!!this._booking){for(this._scope.AncillaryViewModels=[],t=[],n=0,i=this._ancillaryModels||[];n<i.length;n++)r=i[n],this.AncillaryModelIsValid(r)&&(u=this.BuildViewModel(r),t.push(u));this._qService.all(t).then(function(n){f._scope.AncillaryViewModels=n})}},t.prototype.BuildViewModel=function(t){var r=this,u=this.GetScreenSizeSpecificDeepLink(t),i=new Dictionary;return i.Set(n.Data.Common.UrlTokens.HotelAffiliateId,this._hotelUpsellSettings.AffiliateId),this._tokenReplacementService.ReplaceDeepLinkUrlTokens(this._booking,u,t.DateFormat,t.TimeFormat,i).then(function(n){return{AddedToBasket:r.AddedToBasket(t),AddedToBasketText:t.AlreadyAddedText,IconUrl:t.IconUrl,Text:t.LinkText,Url:n,Sortorder:t.Sortorder}})},t.prototype.AddedToBasket=function(n){return this._booking.AddedAncillaries.indexOf(n.AncillaryType)>-1},t.prototype.GetScreenSizeSpecificDeepLink=function(n){return!Main3.Common.BreakPointService.IsDesktop()&&!!n.MobileScreenDeepLink?n.MobileScreenDeepLink:n.DefaultDeepLink},t.prototype.AncillaryModelIsValid=function(n){return n&&!!n.LinkText&&!!n.DefaultDeepLink},t.ControllerName="Funnel_AncillaryUpsell",t.$inject=["$scope","$q","Controls_BookingDataService","Funnel_AncillaryUpsellTokenReplacementService","Funnel_HotelUpsellSettings"],t}();t.AncillaryUpsell=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(i,r,u,f,e,o,s,h,c,l){var a=this,v,y;return r.IncludePrices=!0,v=new Main3.Routes.RoutesService(h),a=t.call(this,r,u,v,f,!1,!1,s.EResLanguageCode,l)||this,a._basketScope=r,a._rootScope=i,a._funnelBasketService=e,a._funnelJourneyCookieService=o,a._funnelBasketFlightChangeValidator=c,a._basketRoutesService=v,a._basketScope.$on(n.Events.Names.Funnel.JourneyCookieShowFlexiFaresUpdated,function(){a.RefreshBasketFlights();a.SetShowFlexiFaresFromJourneyCookie()}),y=!1,a._rootScope.$on(n.Events.Names.FlightGrid.InitialLoadComplete,function(){a._funnelBasketService.HasAnyFlights()&&!y&&(y=!0,a.RefreshBasketFlights())}),a._rootScope.$on(n.Events.Names.AvailabilityFlightsProvider.ForceBasketRefresh,function(n,t){a.ForceRefresh(n,t)}),a}return __extends(i,t),i.prototype.SetShowFlexiFaresFromJourneyCookie=function(){if(this._funnelJourneyCookieService.HasCookie()){var n=this._funnelJourneyCookieService.ReadCookie();n.ShowFlexiFares&&this.SlotsNeedFlexiFarePrices()&&this.DoRequest(!0,!1,!0)}},i.prototype.RefreshBasketFlights=function(){this.ContextJourneyPairHasAnyFlights()&&this.DoRequest(!1)},i.prototype.ContextJourneyPairHasAnyFlights=function(){return this._funnelBasketService.GetFlightsForJourneyPair(this._basketScope.JourneyPair).length>0},i.prototype.FlightIsOnRoute=function(n,t,i){if(n&&t){var r=i?n.ArrivalIata:n.DepartureIata,u=i?n.DepartureIata:n.ArrivalIata;return this._basketRoutesService.IsIataInMarketGroup(r,t.OriginIata)&&this._basketRoutesService.IsIataInMarketGroup(u,t.DestinationIata)}return!1},i.prototype.SlotsNeedFlexiFarePrices=function(){return this.SlotNeedsFlexiFarePrices(this._basketScope.JourneyPair.OutboundSlot)||this.SlotNeedsFlexiFarePrices(this._basketScope.JourneyPair.ReturnSlot)},i.prototype.SlotNeedsFlexiFarePrices=function(t){return!!t&&!!t.Flight?t.Flight.FlightFares.filter(function(t){return t.FareType===n.Data.Common.FlightFareType.Flexi}).length===0:!1},i.prototype.GetOutboundRoute=function(){return this._basketScope.JourneyPair.OutboundSlot.Route},i.prototype.GetReturnRoute=function(){return this._basketScope.JourneyPair.ReturnSlot?this._basketScope.JourneyPair.ReturnSlot.Route:null},i.prototype.GetOutboundSelectedFlightNumber=function(){return this._basketScope.JourneyPair.OutboundSlot&&this._basketScope.JourneyPair.OutboundSlot.Flight?this._basketScope.JourneyPair.OutboundSlot.Flight.FlightNumber:null},i.prototype.GetReturnSelectedFlightNumber=function(){return this._basketScope.JourneyPair.ReturnSlot&&this._basketScope.JourneyPair.ReturnSlot.Flight?this._basketScope.JourneyPair.ReturnSlot.Flight.FlightNumber:null},i.prototype.PreOnAvailabilityQuery=function(){i._availabilityJourneyPairIdsProcessing.push(this._basketScope.JourneyPair.Id)},i.prototype.PreOnAvailabilitySuccess=function(n,t,r){if(this.RemoveJourneyPairIdFromProcessingIds(),!r){var u=i._availabilityJourneyPairIdsProcessing.length===0;this._funnelBasketFlightChangeValidator.HandleJourneyPairFlightChanges(t,this._basketScope.JourneyPair,u)}},i.prototype.OnAvailabilityError=function(){this.RemoveJourneyPairIdFromProcessingIds()},i.prototype.GetDebugName=function(){return"Basket"},i.prototype.RemoveJourneyPairIdFromProcessingIds=function(){Utilities.Arrays.RemoveFirstOccurrence(i._availabilityJourneyPairIdsProcessing,this._basketScope.JourneyPair.Id)},i.prototype.IncludeAdminFees=function(){return this._basketScope.JourneyPair.IsPrimaryPair},i._availabilityJourneyPairIdsProcessing=[],i.ControllerName="Funnel_AvailabilityBasketProvider",i.$inject=["$rootScope","$scope","Availability_AvailabilityService","Funnel_SyncedRefreshService","Funnel_BasketService","FunnelJourneyCookie_Service","Sitecore_FunnelRootSettings","Sitecore_RoutesData","Funnel_BasketFlightChangeValidator","Funnel_AvailabilityCurrencyService"],i}(t.Availability.BaseAvailabilityProvider);i.AvailabilityBasketProvider=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(n){function t(t,i,r,u,f,e,o,s){var h=this,c,l;return i.IncludePrices=!0,i.AutoRefreshDisabled=!1,c=new Main3.Routes.RoutesService(e),l=function(){return h._activePairService.GetActiveJourneyPair().IsPrimaryPair},h=n.call(this,t,i,r,c,u,!1,l,f.EResLanguageCode,o)||this,h._activePairService=s,h}return __extends(t,n),t.ControllerName="Funnel_AvailabilityGridProvider",t.$inject=["$rootScope","$scope","Availability_AvailabilityService","Funnel_SyncedRefreshService","Sitecore_FunnelRootSettings","Sitecore_RoutesData","Funnel_AvailabilityCurrencyService","Funnel_ActivePairService"],t}(n.Availability.BaseAvailabilityGridProvider);t.AvailabilityGridProvider=i})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c){n.Events.Fire(n.Events.Names.Basket.FunnelBasketUpdating);this._scope=i;this._funnelService=r;this._priceService=u;this._funnelBasketService=f;this._funnelAccessibilityService=e;this._funnelPriceService=o;this._activePairService=s;this._funnelBasketAvailable=!1;this._currencyAvailable=!0;this._currentCurrency=this._priceService.GetCurrentCurrency();this._maximumSegmentsAllowedInBasket=h.MaximumSegmentsAllowedInBasket;this._scope.IsBasketUsingFlexiFares=!1;this._scope.JourneyPairs=[];this._scope.$on(n.Events.Names.Funnel.FunnelReady,this.OnFunnelReady.bind(this));this._scope.$on(n.Events.Names.Funnel.CurrencyIsUpdating,this.OnCurrencyUpdating.bind(this));this._scope.$on(n.Events.Names.Funnel.CurrencyUpdated,this.OnCurrencyUpdated.bind(this));this._scope.$on(n.Events.Names.Funnel.ActiveJourneyPairChanged,this.OnActiveJourneyPairChanged.bind(this));this._scope.IsLoading=this.IsLoading.bind(this);this._scope.ShouldShowPaymentTypePicker=this.ShouldShowPaymentTypePicker.bind(this);this._scope.AddMoreFlightsLinkEnabled=this.AddMoreFlightsLinkEnabled.bind(this);this._scope.AddMoreFlightsLinkClick=this.AddMoreFlightsLinkClick.bind(this);this._scope.HasAnyFlightsSelected=this.HasAnyFlightsSelected.bind(this);this._scope.UpdateCurrentPaymentType=this.UpdateCurrentPaymentType.bind(this);this._scope.IsActivePair=this.IsActivePair.bind(this);this._scope.IsOnlyPair=this.IsOnlyPair.bind(this);this._scope.Icons=c.GetQueries();this.InitializeContinueButtonAndListenForStateChange(t);this.WatchForPaymentTypeChanges();this.WatchForAddMoreFlightsLinkEnabled();n.Events.Fire(n.Events.Names.Basket.BasketInitialised)}return t.prototype.IsLoading=function(){return!this.AllReady()},t.prototype.AllReady=function(){return this._funnelBasketAvailable&&this._currencyAvailable},t.prototype.AddMoreFlightsLinkEnabled=function(){return!this.BasketIsFull()&&this._funnelBasketService.AllPairsHaveFlightsSelected()&&this._funnelService.ShouldShowAddMoreFlightsLink},t.prototype.BasketIsFull=function(){return this._funnelBasketService.FlightSlotsInBasket()>=this._maximumSegmentsAllowedInBasket},t.prototype.AddMoreFlightsLinkClick=function(){n.Events.OpenDrawer("funnel-add-more-flights")},t.prototype.HasAnyFlightsSelected=function(n){return this._funnelBasketService.JourneyPairHasOutboundFlightSelected(n)||this._funnelBasketService.JourneyPairHasReturnFlightSelected(n)},t.prototype.IsActivePair=function(n){var t=this._activePairService.GetActiveJourneyPair();return!!t&&!!t.Id?n.Id===t.Id:!1},t.prototype.IsOnlyPair=function(){return this._funnelBasketService.GetJourneyPairs().length==1},t.prototype.InitializeContinueButtonAndListenForStateChange=function(t){var i=this;t.$on(n.Events.Names.Basket.InitializeContinueButton,function(n,t){i._scope.TransitionControlVisible=t.ControlVisible;i._scope.ShowContinueButton=t.ShowContinueButton;i._scope.ShowSkipButton=t.ShowSkipButton;i._scope.ContinueButtonEnabled=t.ContinueButtonEnabled;i._scope.ContinueButtonClick=t.ContinueButtonEvent;i._scope.SkipButtonClick=t.SkipButtonEvent;i._scope.ContinueButtonText=t.ContinueButtonText;i._scope.SkipButtonText=t.SkipButtonText})},t.prototype.OnCurrencyUpdating=function(){this._currencyAvailable=!1;n.Events.Fire(n.Events.Names.Basket.FunnelBasketUpdating);this._currentCurrency=this._priceService.GetCurrentCurrency()},t.prototype.OnCurrencyUpdated=function(){this._currencyAvailable=!0;this.FireReadyEventIfApplicable()},t.prototype.FireReadyEventIfApplicable=function(){this.AllReady()&&n.Events.Fire(n.Events.Names.Basket.FunnelBasketReady)},t.prototype.UpdateCurrentPaymentType=function(){this._funnelService.SetPaymentType(this._scope.CurrentPaymentType)},t.prototype.WatchForPaymentTypeChanges=function(){var n=this;this._scope.$watch(function(){return n._priceService.GetPaymentType()},function(t){n._scope.CurrentPaymentType=t})},t.prototype.WatchForAddMoreFlightsLinkEnabled=function(){var n=this;this._scope.$watch(function(n){return n.AddMoreFlightsLinkEnabled()},function(t,i){n.AllReady()&&t&&!i&&n._funnelAccessibilityService.QueueAddMoreFlightsLinkAppearanceAlert()})},t.prototype.ShouldShowPaymentTypePicker=function(){return this.IsLoading()?!1:this._funnelService.ShouldShowPaymentTypePickerInBasket},t.prototype.OnFunnelReady=function(){var t=this;this._scope.PassengerComposition=this._funnelBasketService.GetPassengerComposition();this._scope.CurrentPaymentType=this._priceService.GetPaymentType();this._scope.$watch(function(){return t._funnelBasketService.GetFareType()},function(i){t._scope.IsBasketUsingFlexiFares=i===n.Data.Common.FlightFareType.Flexi});this._scope.$watch(function(){return t._funnelPriceService.TotalPrice()},function(i){t._scope.$emit(n.Events.Names.Basket.SetPrice,i)},!0);this._scope.JourneyPairs=this._funnelBasketService.GetJourneyPairs();this._funnelBasketAvailable=!0;this.FireReadyEventIfApplicable();n.Events.Fire(n.Events.Names.Basket.HeightModified)},t.prototype.OnActiveJourneyPairChanged=function(){this._scope.JourneyPairs=this._funnelBasketService.GetJourneyPairs();n.Events.Fire(n.Events.Names.Basket.HeightModified)},t.ControllerName="Funnel_Basket",t.$inject=["$rootScope","$scope","Funnel_Service","Common_PriceService","Funnel_BasketService","Funnel_AccessibilityService","Funnel_PriceService","Funnel_ActivePairService","Sitecore_FunnelRootSettings","Funnel_BasketIconService"],t}();t.Basket=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h){this._scope=t;this._funnelBasketSettings=i;this._funnelBasketService=r;this._accessibilityService=u;this._carsService=f;this._funnelCarsSettings=e;this._funnelBasketExtrasRemovalService=o;this._scope.$on(n.Events.Names.Funnel.FunnelReady,this.OnFunnelReady.bind(this));this._scope.HasValidInsurance=this.HasValidInsurance.bind(this);this._scope.GetInsuranceDisplayText=this.GetInsuranceDisplayText.bind(this);this._scope.GetExtraName=this.GetExtraName.bind(this);this._scope.RemoveCar=this.RemoveCar.bind(this);this._scope.CarsAnalyticsCategory=Tracking.EventConstants.Categories.Cars;this._scope.EditCarUrl=h.GetEditCarUrl();this._scope.Icons=s.GetQueries()}return t.prototype.OnFunnelReady=function(){this._scope.Car=this._funnelBasketService.GetBasket().Car},t.prototype.HasValidInsurance=function(){return!!this._scope.Car&&!!this._scope.Car.SelectedInsuranceOption&&!!this.GetInsuranceDisplayText()},t.prototype.GetInsuranceDisplayText=function(){var t=this,n=this._funnelCarsSettings.InsuranceOptions.InsuranceGroups.filter(function(n){return n.Id==t._scope.Car.SelectedInsuranceOption.GroupId});return n.length>0?n[0].BasketText:""},t.prototype.GetExtraName=function(n){var t=this._funnelBasketSettings.CarsExtraOptions.filter(function(t){return t.Code===n.Code})[0];return!t?this._funnelBasketSettings.CarsChildSeats.filter(function(t){return t.Code===n.Code})[0].Name:n.IsMandatory?t.MandatoryBasketSummaryText:t.BasketSummaryText},t.prototype.RemoveCar=function(){this._carsService.UpdateCarToRemoveFromBasket();this._funnelBasketExtrasRemovalService.RemoveCarFromClientBasket();this._scope.Car=null;this._accessibilityService.AlertCarRemovedFromBasket()},t.ControllerName="Funnel_BasketCarsSummary",t.$inject=["$scope","Sitecore_FunnelBasketSettings","Funnel_BasketService","Funnel_AccessibilityService","Cars_Service","Sitecore_CarsSettingsData","Funnel_BasketExtrasRemovalService","Funnel_BasketIconService","Funnel_JourneyService"],t}();t.BasketCarsSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._scope=n;this._funnelBasketService=t;this._accessibilityService=i;this._funnelFlightSelectionService=r;this._parameters=n.Section.Options.Parameters;this._scope.PassengerComposition=this._funnelBasketService.GetPassengerComposition();this._scope.ReturnToFlightGrid=this.ReturnToFlightGrid.bind(this);this._scope.AcceptPriceChangesButtonClick=this.CloseDrawerAndAlertChanges.bind(this);this._parameters&&(this._scope.AcceptPriceChangesButtonClick=this._parameters.AcceptButtonEvent,this._scope.FarePriceChangedSlots=this._parameters.FarePriceChangedSlot,this._scope.GetFareType=this.GetFareType.bind(this))}return t.prototype.GetFareType=function(n){var i=this._funnelBasketService.GetFareType(),t;return n.Slot.Flight!=null&&(t=_(n.Slot.Flight.FlightFares).select(function(n){return n.FareType===i}),t.length>0)?t[0]:null},t.prototype.ReturnToFlightGrid=function(){for(var r,u,t=0,i=this._scope.FarePriceChangedSlots;t<i.length;t++)r=i[t],u=r.IsOutboundSlot?n.Data.Common.RouteDirection.Outbound:n.Data.Common.RouteDirection.Return,this._funnelFlightSelectionService.RemoveFlightFromSlot(r.Slot,u);this.CloseDrawer()},t.prototype.CloseDrawerAndAlertChanges=function(){this.CloseDrawer();this._accessibilityService.AlertBasketChangedQueue()},t.prototype.CloseDrawer=function(){n.Events.Fire(n.Events.Names.Drawer.Close)},t.ControllerName="Funnel_BasketFarePriceChangedDrawer",t.$inject=["$scope","Funnel_BasketService","Funnel_AccessibilityService","Funnel_BasketFlightSelectionService"],t}();t.BasketFarePriceChangedDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s){this._scope=i;this._analyticsService=r;this._funnelBasketService=u;this._funnelBasketHotelsService=f;this._accessibilityService=e;this._scope.HasHotel=this.HasHotel.bind(this);this._scope.GetNights=this.GetNights.bind(this);this._scope.IsPayNow=this.IsPayNow.bind(this);this._scope.IsSameCurrency=this.IsSameCurrency.bind(this);this._scope.HotelAnalyticsCategory=Tracking.EventConstants.Categories.Hotels;this._scope.EditHotelUrl=s.GetEditHotelUrl();this._scope.HotelLoading=!1;this._scope.RemoveHotel=this.RemoveHotel.bind(this);this._scope.TotalBasketPrice=this.TotalBasketPrice.bind(this);this._scope.TotalLocalPrice=this.TotalLocalPrice.bind(this);this._scope.OpenPayLaterDrawer=this.OpenPayLaterDrawer.bind(this);this._scope.OpenPayNowDrawer=this.OpenPayNowDrawer.bind(this);this._scope.OpenExchangeRateDrawer=this.OpenExchangeRateDrawer.bind(this);this._scope.Icons=o.GetQueries();this._scope.$on(n.Events.Names.Funnel.FunnelReady,this.OnFunnelReady.bind(this));t.$on(n.Events.Names.Funnel.HotelUpdated,this.LoadHotelFromBasket.bind(this));t.$on(n.Events.Names.Funnel.HotelLoading,this.HotelLoading.bind(this))}return t.prototype.GetNights=function(){return this._funnelBasketHotelsService.GetNights()},t.prototype.HasHotel=function(){var n=this._funnelBasketService.GetBasket();return!!n&&!!n.Hotel},t.prototype.HotelLoading=function(){this._scope.HotelLoading=!0},t.prototype.IsPayNow=function(){return this._funnelBasketHotelsService.IsPayNow()},t.prototype.IsSameCurrency=function(){return this._funnelBasketHotelsService.IsSameCurrency()},t.prototype.LoadHotelFromBasket=function(){this._scope.HotelLoading=!1;this._scope.Hotel=this._funnelBasketService.GetBasket().Hotel},t.prototype.OnFunnelReady=function(){this.LoadHotelFromBasket()},t.prototype.OpenPayLaterDrawer=function(){n.Events.OpenDrawer("hotels-book-now-pay-later-drawer")},t.prototype.OpenPayNowDrawer=function(){n.Events.OpenDrawer("hotels-book-now-pay-now-drawer")},t.prototype.OpenExchangeRateDrawer=function(){var t=this._scope.IsPayNow()?"hotels-pay-now-exchange-rate-drawer":"hotels-pay-later-exchange-rate-drawer";n.Events.OpenDrawer(t)},t.prototype.RemoveHotel=function(){n.Events.Fire(n.Events.Names.Funnel.HotelDeleted,this._scope.Hotel);this._funnelBasketHotelsService.RemoveHotelFromClientBasket();this._funnelBasketHotelsService.RemoveHotelFromServer();this._scope.Hotel=null;this._analyticsService.TrackEventWithPagePathLabel(Tracking.EventConstants.Categories.Hotels,Tracking.EventConstants.Actions.Remove);this._accessibilityService.AlertHotelRemovedFromBasket()},t.prototype.TotalBasketPrice=function(){return this._scope.Hotel?this._funnelBasketHotelsService.TotalBasketPrice():0},t.prototype.TotalLocalPrice=function(){return this._scope.Hotel?this._funnelBasketHotelsService.TotalLocalPrice():0},t.ControllerName="Funnel_BasketHotelSummary",t.$inject=["$rootScope","$scope","IAnalyticsTracker","Funnel_BasketService","Funnel_BasketHotelsService","Funnel_AccessibilityService","Funnel_BasketIconService","Funnel_JourneyService"],t}();t.BasketHotelSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c,l,a){var v=this;this._scope=t;this._funnelAccessibilityService=i;this._funnelBasketService=r;this._availabilityApdService=u;this._funnelCurrencyService=f;this._funnelActivePairService=e;this._funnelBasketLuggageService=o;this._funnelBasketIconService=s;this._funnelJourneyService=h;this._basketFlightSelectionService=c;this._funnelJourneyCookieService=l;this._funnelVouchersBasketAssociationService=a;this._scope.OnEditClick=this.OnEditClick.bind(this);this._scope.RemoveFlight=this.RemoveFlight.bind(this);this._scope.EditFlightLink=this._funnelJourneyService.GetEditFlightsStepUrl();this._scope.ChooseFlightAnalyticsCategory=Tracking.EventConstants.Categories.ChooseFlights;this._scope.GetPricesForSelectedFareType=this.GetPricesForSelectedFareType.bind(this);this._scope.FlightHasChildApdSaving=this.FlightHasChildApdSaving.bind(this);this._scope.ShouldShowFlightOptions=this.ShouldShowFlightOptions.bind(this);this._scope.ShouldShowSeatingOptions=this.ShouldShowSeatingOptions.bind(this);this._scope.ShouldShowVoucherOptions=this.ShouldShowVoucherOptions.bind(this);this._scope.Icons=this._funnelBasketIconService.GetQueries();this._scope.$emit(n.Events.Names.AvailabilityFlightsProvider.RegisterSubscriber,this);this._scope.$on(n.Events.Names.Funnel.FlightAddedToBasket,function(){v._scope.FocusTitle=!1});this._scope.$on(n.Events.Names.Basket.ResetFocus,this.FocusToFlightHeading.bind(this))}return t.prototype.ShouldShowFlightOptions=function(){return this.ShouldShowSeatingOptions()||this.ShouldShowVoucherOptions()},t.prototype.ShouldShowSeatingOptions=function(){return this._funnelJourneyCookieService.ReadCookie().HasSeenSeatingPage||this._funnelBasketService.HasAnySeatsAssigned()},t.prototype.ShouldShowVoucherOptions=function(){return this._funnelJourneyCookieService.ReadCookie().HasSeenVouchersPage||this._funnelVouchersBasketAssociationService.ThereAreVouchersInTheBasket()},t.prototype.SetRequestFlightsCallback=function(n){this._requestFlightsCallback=n},t.prototype.BeginUpsertFlights=function(){},t.prototype.EndUpsertFlights=function(n){n.length===1&&this._basketFlightSelectionService.UpdateFlightPriceBySlot(this._scope.Slot,n[0])},t.prototype.CurrentAvailabilityParameters=function(){return{OriginIata:this._scope.Slot.Route.OriginIata,DestinationIata:this._scope.Slot.Route.DestinationIata,IsReturnLeg:this._scope.IsReturnLeg,IsOneWayJourney:this._scope.IsOneWayJourney}},t.prototype.OnEditClick=function(n){var t=this,i=this._funnelBasketIconService.CanDeleteFlights();this._scope.Icons.ShowFlightEditIcon(this._scope.JourneyPairId)&&i?(this.SetNewActiveJourneyPair(),this.ScrollToStart()):n().then(function(){t.SetNewActiveJourneyPair()})},t.prototype.SetNewActiveJourneyPair=function(){var t=this,i=this._funnelBasketService.GetJourneyPairs().filter(function(n){return n.Id===t._scope.JourneyPairId})[0];this._funnelActivePairService.UpdateActiveJourneyPair(i.Id);n.Events.Fire(n.Events.Names.Basket.Hide)},t.prototype.ScrollToStart=function(){this._scope.IsReturnLeg?n.Events.Fire(n.Events.Names.Funnel.ScrollToReturnLeg):n.Events.Fire(n.Events.Names.Funnel.ScrollToOutboundLeg)},t.prototype.RemoveFlight=function(){var i=this._funnelBasketService.GetJourneyPairs(),r=this._scope.IsReturnLeg?n.Data.Common.RouteDirection.Return:n.Data.Common.RouteDirection.Outbound,t;return this._basketFlightSelectionService.RemoveFlightFromSlot(this._scope.Slot,r,!0),t=this._funnelBasketService.GetJourneyPairs(),t<i},t.prototype.GetPricesForSelectedFareType=function(n){var t=this._funnelBasketService.GetFareType();return _(n).select(function(n){return n.FareType==t})[0].Prices},t.prototype.FlightHasChildApdSaving=function(n){return!!this._availabilityApdService.GetApdTaxAmount(n.DepartureIata,n.ArrivalIata)},t.prototype.IsValid=function(){return!!this._scope.Slot.Flight},t.prototype.FocusToFlightHeading=function(n,t){var r=this,i;t?(i=this._funnelBasketService.GetJourneyPairs().filter(function(n){return n.Id===r._scope.JourneyPairId})[0],!i||(this._scope.FocusTitle=i.IsPrimaryPair&&!this._scope.IsReturnLeg)):this._scope.FocusTitle=!0},t.ControllerName="Funnel_BasketLeg",t.$inject=["$scope","Funnel_AccessibilityService","Funnel_BasketService","Availability_ApdService","Funnel_CurrencyService","Funnel_ActivePairService","Funnel_BasketLuggageService","Funnel_BasketIconService","Funnel_JourneyService","Funnel_BasketFlightSelectionService","FunnelJourneyCookie_Service","Funnel_VouchersAssociationsService"],t}();t.BasketLeg=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f){this._scope=t;this._funnelBasketService=i;this._scope.HasBags=this.HasBags.bind(this);this._scope.TotalWeight=this.TotalWeight.bind(this);this._scope.LuggageAnalyticsCategory=Tracking.EventConstants.Categories.Luggage;this._scope.EditLuggageUrl=f.GetEditLuggageUrl();this._scope.Icons=u.GetQueries();this._scope.$on(n.Events.Names.Funnel.FunnelReady,this.OnFunnelReady.bind(this));r.$on(n.Events.Names.Funnel.LuggageUpdated,this.RefreshLuggage.bind(this))}return t.prototype.HasBags=function(){return this._scope.Luggage&&(this._scope.Luggage.HoldBags.length>0||this._scope.Luggage.SportsEquipment.length>0)},t.prototype.TotalWeight=function(){var n=0;return this._scope.Luggage&&this._scope.Luggage.HoldBags&&(n=_(this._scope.Luggage.HoldBags).reduce(function(n,t){return n+t.TotalWeight*t.Quantity},0)),this._scope.Luggage&&this._scope.Luggage.SportsEquipment&&(n+=+this._scope.Luggage.SportsEquipment.reduce(function(n,t){return n+t.TotalWeight*t.Quantity},0)),n},t.prototype.OnFunnelReady=function(){this.RefreshLuggage()},t.prototype.RefreshLuggage=function(){this._scope.Luggage=this._funnelBasketService.GetGroupedLuggage()},t.ControllerName="Funnel_BasketLuggageSummary",t.$inject=["$scope","Funnel_BasketService","$rootScope","Funnel_BasketIconService","Funnel_JourneyService"],t}();t.BasketLuggageSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._scope=n;this._funnelBasketService=t;this._sitecoreLanguageSettings=i;this._scope.ShowPriceBreakdown=this.ShowPriceBreakdown.bind(this);this._scope.ShowBasketPriceBreakdown=this.ShowBasketPriceBreakdown.bind(this)}return t.prototype.ShowBasketPriceBreakdown=function(){var t={SectionKey:"funnel-price-breakdown-drawer",AnalyticsOptions:{Category:Tracking.EventConstants.Categories.DrawerOpen,Action:Tracking.EventConstants.Actions.ClickPriceBreakdown,Label:this._sitecoreLanguageSettings.SitecoreLanguageCode,IncludeDrawerIdInLabel:!1,IncludePagePathInLabel:!1}};n.Events.OpenDrawerWithOptions(t)},t.prototype.ShowPriceBreakdown=function(){return this.BasketHasFlights()},t.prototype.BasketHasFlights=function(){return this._funnelBasketService.AllPairsHaveFlightsSelected()},t.ControllerName="Funnel_BasketPriceBreakdown",t.$inject=["$scope","Funnel_BasketService","Sitecore_SitecoreLanguageSettings"],t}();t.BasketPriceBreakdown=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u){this._scope=n;this._funnelBasketAssociationService=t;this._funnelBasketService=i;this._journeyService=u;this._scope.HasSeats=this.HasSeats.bind(this);this._scope.SeatBands=this.SeatBands.bind(this);this._scope.SeatingAnalyticsCategory=Tracking.EventConstants.Categories.Seating;this._scope.EditSeatingUrl=this._journeyService.GetEditSeatingUrl();this._scope.Icons=r.GetQueries()}return n.prototype.SeatBands=function(){var n=this._funnelBasketAssociationService.GetSeatBandSummaryForFlight(this._scope.FlightInternalId),t=JSON.stringify(n);return t!==this._currentBandsKey&&(this._currentBands=n,this._currentBandsKey=t),this._currentBands},n.prototype.HasSeats=function(){var n=this.SeatBands();return n&&n.length>0},n.ControllerName="Funnel_BasketSeatSummary",n.$inject=["$scope","Funnel_AssociationsService","Funnel_BasketService","Funnel_BasketIconService","Funnel_JourneyService"],n}();n.BasketSeatSummary=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this._scope=n;this._analyticsService=t;this._scope.Delete=this.Delete.bind(this)}return t.prototype.Delete=function(){var t=this,i;this._analyticsService.TrackEventWithPagePathLabel(this._scope.AnalyticsCategory,Tracking.EventConstants.Actions.Remove);i={OnAccept:function(){n.Events.Fire(n.Events.Names.Drawer.Close);var i=t._scope.DeleteAction();i?n.Events.Fire(n.Events.Names.Basket.ResetFocus,!0):t._scope.$emit(n.Events.Names.Basket.ResetFocus,!1)},OnReject:function(){n.Events.Fire(n.Events.Names.Drawer.Close)},StyleSecondButtonAsDismissOption:!0};n.Events.OpenDrawerWithOptions({SectionKey:this._scope.DrawerSectionKey,Parameters:i})},t.ControllerName="Funnel_BasketSummaryDeleteLink",t.$inject=["$scope","IAnalyticsTracker"],t}();t.BasketSummaryDeleteLink=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._qService=n;this._scope=t;this._analyticsService=i;this._window=r;this._scope.Edit=this.Edit.bind(this)}return t.prototype.Edit=function(){this._scope.EditOverride?(this._scope.EditOverride(this.EditInternal.bind(this)),this._scope.$emit(n.Events.Names.Basket.ResetFocus,!1)):this.EditInternal()},t.prototype.EditInternal=function(){var i=this,t=this._qService.defer(),r;return this._analyticsService.TrackEventWithPagePathLabel(this._scope.AnalyticsCategory,Tracking.EventConstants.Actions.Edit),r={OnAccept:function(){t.resolve()},OnReject:function(){t.reject()},StyleSecondButtonAsDismissOption:!0},n.Events.OpenDrawerWithOptions({SectionKey:this._scope.DrawerSectionKey,Parameters:r}),t.promise.then(function(){!i._scope.BeforeRedirectAction||i._scope.BeforeRedirectAction();i._window.location.href=i._scope.RedirectStep}),t.promise.catch(function(){n.Events.Fire(n.Events.Names.Drawer.Close)}),t.promise},t.ControllerName="Funnel_BasketSummaryEditLink",t.$inject=["$q","$scope","IAnalyticsTracker","$window"],t}();t.BasketSummaryEditLink=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r){this._isHotelLoading=!1;this._scope=i;this._funnelBasketService=r;this._scope.ShowCars=this.ShowCars.bind(this);this._scope.ShowHotels=this.ShowHotels.bind(this);this._scope.ShowTravelInsurance=this.ShowTravelInsurance.bind(this);t.$on(n.Events.Names.Funnel.HotelLoading,this.HotelLoading.bind(this));t.$on(n.Events.Names.Funnel.HotelUpdated,this.HotelUpdated.bind(this))}return t.prototype.ShowCars=function(){var n=this._funnelBasketService.GetBasket();return!!n&&!!n.Car},t.prototype.ShowHotels=function(){var n=this._funnelBasketService.GetBasket();return!!n&&!!n.Hotel||this._isHotelLoading},t.prototype.ShowTravelInsurance=function(){var n=this._funnelBasketService.GetBasket();return!!n&&!!n.TravelInsurance&&!!n.TravelInsurance.Policy},t.prototype.HotelLoading=function(){this._isHotelLoading=!0},t.prototype.HotelUpdated=function(){this._isHotelLoading=!1},t.ControllerName="Funnel_BasketTravelExtrasSummary",t.$inject=["$rootScope","$scope","Funnel_BasketService"],t}();t.BasketTravelExtrasSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u){this._scope=n;this._funnelBasketVoucherAssociationService=t;this._funnelBasketService=i;this._journeyService=u;this._scope.HasVouchers=this.HasVouchers.bind(this);this._scope.FlightVouchers=this.FlightVouchers.bind(this);this._scope.VouchersAnalyticsCategory=Tracking.EventConstants.Categories.Vouchers;this._scope.EditVouchersUrl=this._journeyService.GetEditVouchersUrl();this._scope.Icons=r.GetQueries();this._scope.RemoveVouchers=this.RemoveVouchers.bind(this)}return t.prototype.RemoveVouchers=function(){n.Events.Fire(n.Events.Names.Funnel.RemoveVouchersFromBasketForFlight,this._scope.FlightInternalId);n.Events.Fire(n.Events.Names.Funnel.ScrollToVouchers)},t.prototype.FlightVouchers=function(){return this._funnelBasketVoucherAssociationService.GetVouchersSummary(this._scope.FlightInternalId)},t.prototype.HasVouchers=function(){var n=this.FlightVouchers();return n&&n.Quantity>0},t.ControllerName="Funnel_BasketVouchersSummary",t.$inject=["$scope","Funnel_VouchersAssociationsService","Funnel_BasketService","Funnel_BasketIconService","Funnel_JourneyService"],t}();t.BasketVouchersSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(i,r,u,f,e,o,s,h,c,l,a,v,y,p){var w=t.call(this,i,r,u,f,e,o,s)||this;return w._accountService=h,w._deepLinkService=c,w._funnelBasketService=l,w._funnelService=a,w._priceService=v,w._funnelErrorService=y,w._mailingPreferencesSettings=p,w._scope.ChangeEmailAddress=w.ChangeEmailAddress.bind(w),w._scope.IsNewUser=w.IsNewUser(),w._scope.$on(n.Events.Names.Account.DeprecatedSignInStatusChanged,function(){w._scope.IsNewUser=w.IsNewUser()}),w._scope.$on(n.Events.Names.Funnel.SignUpContinue,function(n,t){w._scope.BookerDetails&&(w._scope.BookerDetails.Email=t)}),w._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,w),w}return __extends(i,t),i.prototype.FunnelReady=function(){this._funnelService.ShouldReloadPageOnSignIn=!0;var n=this._funnelBasketService.GetBasket();this._scope.DialCodeCountry={DialCode:n.BookerDetails.Telephone.DialingCode,Name:"",B2BName:"",LanguageCode:"",ISOCountryCode:""};this._scope.ResidentOfCountry={Name:n.BookerDetails.ResidentOfValue,B2BName:"",DialCode:"",ISOCountryCode:"",LanguageCode:""};this._scope.BookerDetails=n.BookerDetails;this.FillInDefaultValues();this.SetWatchers()},i.prototype.Save=function(){var i=this,t=this._qService.defer();return this._scope.BookerDetails.EjPlusNumber?this.VerifyEjPlusNumberValid().then(function(r){r===n.Data.Common.EjPlusCardStatus.Valid?i.UpdateMemberDetails(t):(i._scope.EjPlusNumberStatus=r,t.reject())}).catch(function(){return i.ShowGenericError(t)}):this.UpdateMemberDetails(t),t.promise},i.prototype.VerifyEjPlusNumberValid=function(){var n=this._qService.defer();return this._funnelService.VerifyEjPlusNumber(this._scope.BookerDetails.LastName,this._scope.BookerDetails.EjPlusNumber,function(t){n.resolve(t)},n.reject),n.promise},i.prototype.UpdateMemberDetails=function(n){var t=this;this._funnelService.UpdateMemberDetails(this.IsNewUser()).then(n.resolve).catch(function(){return t.ShowGenericError(n)})},i.prototype.ShowGenericError=function(n){n.reject();this._funnelErrorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.BookerDetails,Tracking.EventConstants.Labels.Error)},i.prototype.ShouldExitFunnel=function(){return!1},i.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!0,CheckEasyJetPlusNumberStatus:!0,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!1}},i.prototype.IsValid=function(){if(this._scope.BookerDetails){var n=(this._scope.BookerDetails.OptInForMailing===!1||this._scope.BookerDetails.OptInForMailing===!0)&&(this._scope.BookerDetails.OptInForEasyJetMailing===!1||this._scope.BookerDetails.OptInForEasyJetMailing===!0),t=!!this._scope.BookerDetails.Password&&!!this._scope.BookerDetails.Email&&(!this._mailingPreferencesSettings.ShowMailingPreferences||n),i=!!this._scope.BookerDetails.Title&&!!this._scope.BookerDetails.FirstName&&!!this._scope.BookerDetails.LastName&&!!this._scope.BookerDetails.ResidentOfValue&&!!this._scope.BookerDetails.Address1&&!!this._scope.BookerDetails.City&&!!this._scope.BookerDetails.PostalCode&&!!this._scope.BookerDetails.Telephone.DialingCode&&!!this._scope.BookerDetails.Telephone.PhoneNumberWithoutDialingCode&&this.FormFieldNgModelIsValid("street-name")&&this.FormFieldNgModelIsValid("ej-plus-number");return(!this.IsNewUser()||t)&&i&&!this.InitialEjPlusNumberInvalidAndUnchanged()}return!1},i.prototype.FormFieldNgModelIsValid=function(n){var t=this._scope.BookerDetailsForm[n];return t&&!t.$valid?!1:!0},i.prototype.InitialEjPlusNumberInvalidAndUnchanged=function(){return this._scope.EjPlusNumberStatus===undefined&&!!this._scope.BookerDetails&&this._scope.BookerDetails.InitialEjPlusNumberStatus!==undefined&&this._scope.BookerDetails.InitialEjPlusNumberStatus!==n.Data.Common.EjPlusCardStatus.Valid},i.prototype.FillInDefaultValues=function(){var n=this;this.IsNewUser()&&(this._scope.BookerDetails.ResidentOfValue||this._countryDataService.GetCountryDataModelForIsoCode(this._scope.LanguageCode,this._bookerDetailsSettings.DefaultCountryISOCode).then(function(t){n.SetResidentOf(t)}),this._scope.BookerDetails.ResidentOfValue||this._countryDataService.GetCountryDataModelForIsoCode(this._scope.LanguageCode,this._bookerDetailsSettings.DefaultDialCodeISOCode).then(function(t){n.SetDialCode(t)}))},i.prototype.ChangeEmailAddress=function(){var t={AfterSignIn:function(){},UserInitiatedSignIn:!1,InitialView:2,PreFillUsername:this._scope.BookerDetails.Email},i={SectionKey:"funnel-sign-in-or-sign-up",PreventDismissOverride:!1,Parameters:t};n.Events.OpenDrawerWithOptions(i)},i.prototype.IsNewUser=function(){return!this._accountService.IsSignedIn()},i.prototype.ChangedToEditingMode=function(){var t=this;this.IsNewUser()||setTimeout(function(){t._scope.EjPlusNumberStatus===undefined&&(t._scope.EjPlusNumberStatus=t._scope.BookerDetails.InitialEjPlusNumberStatus);t._scope.$broadcast(n.Events.Names.Validation.Validate)},100)},i.ControllerName="Funnel_BookerDetails",i.$inject=["$scope","Sitecore_BookerDetailsSettings","Data_CountryDataService","Sitecore_LanguageSettings","$q","IAnalyticsTracker","Funnel_AccessibilityService","Account_Service","Common_DeepLinksService","Funnel_BasketService","Funnel_Service","Common_PriceService","Funnel_ErrorService","Sitecore_MailingPreferences"],i}(t.Common.BaseBookerDetails);i.BookerDetails=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(i,r,u,f){var e=t.call(this,i,r,f)||this;return e._funnelBasketService=u,e._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,e),e}return __extends(i,t),i.prototype.FunnelReady=function(){this._scope.BookerDetails=this._funnelBasketService.GetBasket().BookerDetails;this.SetCountryWatcher()},i.prototype.ShouldExitFunnel=function(){return!1},i.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!0,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!1}},i.ControllerName="Funnel_BookerDetailsSummary",i.$inject=["$scope","Data_CountryDataService","Funnel_BasketService","Sitecore_LanguageSettings"],i}(t.Common.BaseBookerDetailsSummary);i.BookerDetailsSummary=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._scope=n;this._scope.IsValidQuantity=this.IsValidQuantity.bind(this);this._scope.CanIncrement=this.CanIncrement.bind(this);this._scope.CanDecrement=this.CanDecrement.bind(this)}return n.prototype.IsValidQuantity=function(n){var t=n>=0&&n<=this._scope.Maximum;return this._scope.IsValid=t,t},n.prototype.CanIncrement=function(n){return n<this._scope.Maximum},n.prototype.CanDecrement=function(n){return n>0},n.$inject=["$scope"],n}();n.CarChildSeatTypeQuantitySelector=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c,l,a,v){this._scope=t;this._funnelBasketService=i;this._funnelCarsSettings=r;this._funnelJourneyService=u;this._carsService=f;this._errorService=e;this._analyticsTracker=o;this._funnelJourneyCookieService=s;this._funnelReasonCookieService=h;this._carsPromotionsService=c;this._drawerSectionStore=l;this._funnelBasketBookingDataMapper=v;this._updateSearchCount=0;this._carCountryPromotionDrawerKey=null;this._carPromotionButtonEnabled=!1;this._titleBarInstance=Title.TitleBar.Instance;this._scope.ShowSearchForm=!1;this._scope.ToggleSearchForm=this.ToggleSearchForm.bind(this);this._scope.ToggleMoreInformation=this.ShowMoreInformationDrawer.bind(this);this._scope.UpdateSearch=this.UpdateSearch.bind(this);this._scope.LoadCars=this.LoadCars.bind(this);this._scope.OpenCarsStationSelectorDrawer=this.OnCarsStationClicked.bind(this);this._scope.OpenCarsDatePickerDrawer=this.OnCarsDatePicker.bind(this);this._scope.SelectCar=this.SelectCar.bind(this);this._scope.ShouldShowDiscount=this.ShouldShowDiscount.bind(this);this._scope.OpenCarDiscountInformation=this.OpenCarDiscountInformation.bind(this);this._scope.Hours=this.BuildTimeDropdownValues(23,1);this._scope.Minutes=this.BuildTimeDropdownValues(55,5);this._defaultDriverAge=this._funnelCarsSettings.LeadDriverAgeOptions[0].DropDownOptionData.Value;this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this);this._isLoadingCars=!1;this._loadCarsQueryQueue=[];a.AllowDeleteCars()}return t.prototype.BuildTimeDropdownValues=function(n,t){for(var u,r=[],i=0;i<=n;i+=t)u=i<10?"0":"",r.push({DisplayText:u+i,Value:i});return r},t.prototype.IsValid=function(){return!1},t.prototype.FunnelReady=function(){this._scope.Query=this._carsService.GetCurrentSearchQuery(this._defaultDriverAge,this.GetBookingDataFromBasket());this.SetPageTitle(this._carsService.GetPickUpLocationDisplayName(this._scope.Query,this._scope.Stations));this.LoadStations();this.LoadPromotions()},t.prototype.ShowMoreInformationDrawer=function(t){var i={OnSelect:this.SelectCar.bind(this),Query:this._scope.Query,Car:t},r={SectionKey:"cars-vehicle-information",Parameters:i,TitleOverride:t.Name,AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Cars,Action:Tracking.EventConstants.Actions.MoreDetails,IncludePagePathInLabel:!0}};n.Events.OpenDrawerWithOptions(r)},t.prototype.ShouldExitFunnel=function(){return!this._funnelBasketService.HasAnyFlights()},t.prototype.GetStepOnLoadRedirect=function(){return this._funnelJourneyService.GetStepOnLoadInvalidFlightRedirect(Tracking.EventConstants.Categories.Cars)||this.GetStepOnLoadUnavailableStepRedirect()},t.prototype.GetStepOnLoadUnavailableStepRedirect=function(){var t=this,n=this._funnelJourneyService.GetNextStepUrlIfOnLoadRedirectRequired();return!n?null:{TargetUrl:n,EventCategory:Tracking.EventConstants.Categories.Cars,EventAction:Tracking.EventConstants.Actions.Skip,EventLabel:Tracking.EventConstants.Labels.Unavailable,AdditionalAction:function(){t._funnelReasonCookieService.UpdateCookie(function(n){return n.CarsRedirectReason=Constants.Redirect.Reasons.Funnel.Step.OnLoadRedirect})}}},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!1}},t.prototype.LoadCars=function(){this._scope.IsLoading=!0;this._loadCarsQueryQueue.push(Utilities.Clone(this._scope.Query));this.LoadCarsInternal()},t.prototype.LoadCarsInternal=function(){if(!this._isLoadingCars&&this._loadCarsQueryQueue.length>0){this._isLoadingCars=!0;var n=this._loadCarsQueryQueue.pop();return this._loadCarsQueryQueue=[],this._carsService.GetCarList(n).then(this.LoadCarsSuccess.bind(this)).catch(this.LoadCarsError.bind(this)),!0}return!1},t.prototype.LoadCarsSuccess=function(n){if(this._isLoadingCars=!1,!this.LoadCarsInternal()){if(!n.Cars||n.Cars.length==0){this.LoadCarsError(this.GetNoCarsErrorData());return}this._scope.Cars=n.Cars;this._scope.Equipment=n.Equipment;this._scope.Query.DropOffStationCode=n.DropOffStationCode;this._scope.Query.DropOffLocationName=this._carsService.GetDropOffLocationDisplayName(this._scope.Query,this._scope.Stations);this._scope.Query.PickUpStationCode=n.PickUpStationCode;this._scope.Query.PickUpLocationName=this._carsService.GetPickUpLocationDisplayName(this._scope.Query,this._scope.Stations);this.SetPageTitle(this.GetPageTitle());this.SetCarsSearchFromQuery();this._scope.IsLoading=!1}},t.prototype.GetPageTitle=function(){return this._scope.Query.IsDefault?this._carsService.GetLocationDisplayNameByIata(this._scope.Query.PickUpIata):this._carsService.GetPickUpLocationDisplayName(this._scope.Query,this._scope.Stations)},t.prototype.LoadStations=function(){this._scope.IsLoading=!0;this._carsService.GetStationsList(this._scope.Query.PickUpIata).then(this.LoadStationsSuccess.bind(this)).catch(this.LoadStationsError.bind(this))},t.prototype.LoadStationsSuccess=function(n){this._scope.Stations=n;this.LoadCars()},t.prototype.SetCarsSearchFromQuery=function(){this._scope.CarsSearch={PickUp:this.BuildCarHandoverAppointment(this._scope.Query.PickUpStationCode,this._scope.Query.PickUpLocationName,this._scope.Query.PickUpDateTime),DropOff:this.BuildCarHandoverAppointment(this._scope.Query.DropOffStationCode,this._scope.Query.DropOffLocationName,this._scope.Query.DropOffDateTime)}},t.prototype.BuildCarHandoverAppointment=function(n,t,i){return{Location:{Code:n,Name:t},Date:i.Date(),Time:{Hour:this._scope.Hours.filter(function(n){return n.DisplayText===i.Format("HH")})[0].Value,Minute:this._scope.Minutes.filter(function(n){return n.DisplayText===i.Format("mm")})[0].Value}}},t.prototype.LoadStationsError=function(){this.RedirectToNextStepDueToApiUnavailable(Constants.Redirect.Reasons.Funnel.Cars.GetStationListApiError)},t.prototype.LoadCarsError=function(n){var t=this;(this._isLoadingCars=!1,this.LoadCarsInternal())||(this._scope.Query.IsDefault?this.RedirectToNextStepDueToApiUnavailable(Constants.Redirect.Reasons.Funnel.Cars.GetCarListApiError):(n.KnownErrorCallback=function(){t._carsService.SetDefaultSearchQuery(t._defaultDriverAge,t.GetBookingDataFromBasket());t.LoadCars()},this._errorService.HandleApiError(n.HttpCode,n.StatusText,n.KnownError,n.KnownErrorJson,n.KnownErrorCallback)))},t.prototype.RedirectToNextStepDueToApiUnavailable=function(t){this._funnelReasonCookieService.UpdateCookie(function(n){return n.CarsRedirectReason=t});n.Services.Common.ErrorService.IsExiting=!0;this._analyticsTracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.Cars,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.Error+" | "+Utilities.ZonelessDateTime.NowUtc(),this._funnelJourneyService.GetBypassNextStepUrl())},t.prototype.SelectCar=function(n){var t=this,i=this._carsService.GetCurrentSearchQuery(this._defaultDriverAge,this.GetBookingDataFromBasket());this._funnelJourneyCookieService.UpdateCookie(function(r){r.LeadDriverPassengerInternalId=t._carsService.GetCurrentSelectedLeadDriverInternalId();r.CarSearchQuery=i;r.CarSearchEquipment=t._scope.Equipment;r.SelectedCar={RateId:n.RateId,SelectedCategory:n.CategoryCode}});this._analyticsTracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.Cars,Tracking.EventConstants.Actions.Select,"More Details "+n.CategoryCode,this._funnelJourneyService.GetContinueToNextStepUrl())},t.prototype.ToggleSearchForm=function(){this._scope.ShowSearchForm=!this._scope.ShowSearchForm},t.prototype.UpdateSearch=function(){var n=this.BuildQueryDateTimeFromSearchDateAndTime(this._scope.CarsSearch.PickUp),t=this.BuildQueryDateTimeFromSearchDateAndTime(this._scope.CarsSearch.DropOff);this.SearchIsValid(n,t)&&(this._updateSearchCount+=1,this._scope.Query.PickUpStationCode=this._scope.CarsSearch.PickUp.Location.Code,this._scope.Query.PickUpDateTime=n,this._scope.Query.DropOffStationCode=this._scope.CarsSearch.DropOff.Location.Code,this._scope.Query.DropOffDateTime=t,this._scope.Query.IsDefault=!1,this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Cars,Tracking.EventConstants.Actions.ChangeSearch,this._updateSearchCount.toString()),this.LoadCars())},t.prototype.BuildQueryDateTimeFromSearchDateAndTime=function(n){return n.Date.ToZonelessDateTime(n.Time.Hour,n.Time.Minute)},t.prototype.SearchIsValid=function(n,t){var i=this._funnelBasketService.GetPrimaryJourneyPair();return this._scope.IsPickUpDateTimeInvalid=this.IsPickUpTimeBeforeOutboundFlightArrivalTime(n,i),this._scope.IsDropOffDateTimeInvalid=this.IsDropOffTimeAfterReturnFlightDepartureTime(t,i),!this._scope.IsPickUpDateTimeInvalid&&!this._scope.IsDropOffDateTimeInvalid},t.prototype.IsPickUpTimeBeforeOutboundFlightArrivalTime=function(n,t){var i=t.OutboundSlot.Flight.LocalArrivalTime;return n.Difference(i,Utilities.ZonelessDateTimePart.Minutes)<0},t.prototype.IsDropOffTimeAfterReturnFlightDepartureTime=function(n,t){if(this._scope.Query.IsOneWayFlight)return!1;var i=t.ReturnSlot.Flight.LocalDepartureTime;return n.Difference(i,Utilities.ZonelessDateTimePart.Minutes)>0},t.prototype.SetPageTitle=function(n){var t=this._funnelCarsSettings.HeaderText.replace("{location}",n);this._titleBarInstance.UpdateHeaderTitle(t)},t.prototype.OnCarsDatePicker=function(t){var r=this,i=this._carsService.GetDefaultSearchQuery(this._defaultDriverAge,this.GetBookingDataFromBasket()),u=i.IsOneWayFlight?i.PickUpDateTime.Date().AddDays(28):i.DropOffDateTime.Date(),f={IsReturnDatePicker:t,MinimumDate:i.PickUpDateTime.Date(),MaximumDate:u,SelectedStartDate:this._scope.CarsSearch.PickUp.Date,SelectedEndDate:this._scope.CarsSearch.DropOff.Date,OnSelectDate:function(n){r.SetDate(n,t);r.SetDateFocus(t,!1)}};this.SetDateFocus(t,!0);n.Events.OpenDrawerWithOptions({SectionKey:"cars-date-picker",Parameters:f})},t.prototype.SetDate=function(n,t){!n||(t?(this._scope.CarsSearch.DropOff.Date=n,this._scope.CarsSearch.DropOff.Date.DifferenceInDays(this._scope.CarsSearch.PickUp.Date)<0&&(this._scope.CarsSearch.PickUp.Date=n)):(this._scope.CarsSearch.PickUp.Date=n,this._scope.CarsSearch.PickUp.Date.DifferenceInDays(this._scope.CarsSearch.DropOff.Date)>0&&(this._scope.CarsSearch.DropOff.Date=n)))},t.prototype.SetDateFocus=function(n,t){n?this._scope.DropOffDateFocus=t:this._scope.PickUpDateFocus=t},t.prototype.OnCarsStationClicked=function(t){var i=this,r={Stations:this._scope.Stations,OnSelectStation:function(n){i.SetStation(n,t);i.SetStationFocus(t,!1)}};this.SetStationFocus(t,!0);n.Events.OpenDrawerWithOptions({SectionKey:"cars-station-selector",Parameters:r})},t.prototype.SetStation=function(n,t){!n||(t?this._scope.CarsSearch.DropOff.Location=n:this._scope.CarsSearch.PickUp.Location=n)},t.prototype.SetStationFocus=function(n,t){n?this._scope.DropOffLocationFocus=t:this._scope.PickUpLocationFocus=t},t.prototype.GetNoCarsErrorData=function(){return{HttpCode:200,StatusText:"No cars available",KnownError:n.Data.Rebooking.KnownError.CarAvailability,KnownErrorJson:JSON.stringify({EiErrorDescription:"mamba.noCarsAvailable"})}},t.prototype.LoadPromotions=function(){this._carsPromotionsService.GetPromotions(this._funnelBasketService.GetPrimaryPairOutboundDestinationCountryCode()).then(this.LoadPromotionsSuccess.bind(this))},t.prototype.LoadPromotionsSuccess=function(n){this._scope.CarsPromotions=n.CarsPromotions;this._carCountryPromotionDrawerKey=n.CarPromotionDrawerKey;this._carPromotionButtonEnabled=n.CarPromotionButtonEnabled;this.RegisterDrawers(n.DrawersToRegister)},t.prototype.RegisterDrawers=function(n){var t=this;n.forEach(function(n){t._drawerSectionStore.Contains(n.Key)||t._drawerSectionStore.Register(n)})},t.prototype.GetBookingDataFromBasket=function(){return this._funnelBasketBookingDataMapper.Map(this._funnelBasketService.GetBasket())},t.prototype.ShouldShowDiscount=function(n){return!!this._carPromotionButtonEnabled&&!isNaN(n.DiscountRateValue)&&n.DiscountRateValue>=this._funnelCarsSettings.CarDiscountThreshold},t.prototype.OpenCarDiscountInformation=function(){if(!!this._carCountryPromotionDrawerKey){var t=this._funnelBasketService.GetPrimaryPairOutboundDestinationCountryCode()+"_PerCarPromo";this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Cars,Tracking.EventConstants.Actions.ClickCarPromo,t);n.Events.OpenDrawer(this._carCountryPromotionDrawerKey)}},t.ControllerName="Funnel_Cars",t.$inject=["$scope","Funnel_BasketService","Sitecore_CarsSettingsData","Funnel_JourneyService","Cars_Service","Cars_ErrorService","IAnalyticsTracker","FunnelJourneyCookie_Service","FunnelReasonCookie_Service","CommonApi_CarsPromotionsApiService","Controls_DrawerSectionStore","Funnel_BasketIconService","Controls_FunnelBasketBookingDataMapper"],t}();t.Cars=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._scope=n;this._parameters=n.Section.Options.Parameters;this._scope.SeatTypes=this.BuildSeatTypesMap(this._parameters.ChildSeatOptions);this._scope.SaveSelectedSeats=this.SaveSelectedSeats.bind(this);this._scope.GetPriceForType=this.GetPriceForType.bind(this);this._scope.IsValidSeatType=this.IsValidSeatType.bind(this);this._scope.IsValid=this.AreAllValid.bind(this)}return t.prototype.BuildSeatTypesMap=function(n){for(var i,r={},t=0,u=n;t<u.length;t++)i=u[t],r[i.Code]={Quantity:i.Quantity,IsValid:!0};return r},t.prototype.IsValidSeatType=function(n){var t=this._scope.SeatTypes[n];return t!=undefined},t.prototype.GetPriceForType=function(n){return this._parameters.ChildSeatOptions.filter(function(t){return t.Code===n})[0].PricePerDay},t.prototype.SaveSelectedSeats=function(){var t,i,r;if(this._scope.IsValid()){for(t=0,i=this._parameters.ChildSeatOptions;t<i.length;t++)r=i[t],r.Quantity=this._scope.SeatTypes[r.Code].Quantity;this._parameters.OnSeatsSelected();n.Events.Fire(n.Events.Names.Drawer.Close)}},t.prototype.AreAllValid=function(){var n=!0;for(var t in this._scope.SeatTypes)if(!this._scope.SeatTypes[t].IsValid){n=!1;break}return n},t.ControllerName="Funnel_CarsChildSeatDrawer",t.$inject=["$scope"],t}();t.CarsChildSeatDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){var i=this;this._scope=n;this._modelBuilder=new Main3.SimpleTemplate.ModelBuilders.DatePickerDrawerModelBuilder(t.CurrentCultureFirstDayOfWeek);this._parameters=this._scope.CurrentSection.Options.Parameters;this._scope.SimpleModel=this._modelBuilder.BuildBasedOnFixedDateRange(this._parameters.MinimumDate,this._parameters.MaximumDate);this._scope.OnSelect=function(n,t,r){var u=Utilities.TimeAgnosticDate.FromParts(n,t,r);i._scope.DoBack();i._parameters.OnSelectDate(u)};this._scope.StartHighlightDate=this._parameters.SelectedStartDate;this._scope.EndHighlightDate=this._parameters.SelectedEndDate;this._scope.IsReturnDatePicker=this._parameters.IsReturnDatePicker}return n.ControllerName="Funnel_CarsDatePickerDrawer",n.$inject=["$scope","Sitecore_SitecoreLanguageSettings"],n}();n.CarsDatePickerDrawer=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._scope=n;this._parameters=n.CurrentSection.Options.Parameters;this._scope.IsCurrentlySelectedInsurance=this.CurrentlySelectedIndexMatchesDrawerOption();this._scope.SelectInsuranceOption=this.SelectInsuranceOption.bind(this);this._scope.Excess=this._parameters.InsuranceGroup.Options[0].Excess;this._scope.PolicyIncludesDetails=this.GetPolicyIncludesDetails();this._scope.ShouldShowPolicyIncludesSection=this.PolicyIncludesDetailsExists()}return t.prototype.CurrentlySelectedIndexMatchesDrawerOption=function(){return this._parameters.InsuranceGroup.Index===this._parameters.SelectedInsuranceIndex},t.prototype.SelectInsuranceOption=function(){var t=this._parameters.InsuranceGroup.Index;this._parameters.OnSelectInsurance(t);n.Events.Fire(n.Events.Names.Drawer.Close)},t.prototype.GetPolicyIncludesDetails=function(){var n=this;return this._parameters.InsuranceGroup.Options.map(function(t){return n.MapInsuranceOptionToPolicyIncludesDetails(t)}).filter(function(n){return!!n.IncludesText})},t.prototype.MapInsuranceOptionToPolicyIncludesDetails=function(n){return{Excess:n.Excess,IncludesText:n.InsuranceSummaryDrawerPolicyIncludesText}},t.prototype.PolicyIncludesDetailsExists=function(){return this._scope.PolicyIncludesDetails.length>0},t.$inject=["$scope"],t.ControllerName="Funnel_CarsInsuranceSummaryDrawer",t}();t.CarsInsuranceSummaryDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t){var i=this;this._scope=t;this._parameters=t.Section.Options.Parameters;this._scope.SimpleModel=this._parameters.Stations;this._scope.SelectItem=function(t){var r=i._parameters.Stations.filter(function(n){return n.Code===t});r&&r.length>0&&i._parameters.OnSelectStation(r[0]);i._parameters.OnSelectStation(null);i._scope.$emit(n.Events.Names.Drawer.Close)}}return t.ControllerName="Funnel_CarsStationSelectorDrawer",t.$inject=["$scope"],t}();t.CarsStationSelectorDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u){this._scope=n;this._carsService=t;this._errorService=i;this._carsInsuranceService=r;this._scope.IsLoading=!0;this._parameters=this._scope.CurrentSection.Options.Parameters;this._scope.SelectCar=this.SelectCar.bind(this);this._scope.HasAnyInsuranceInformation=this.HasAnyInsuranceInformation.bind(this);this._scope.Car=this._parameters.Car;var f=new Main3.Routes.RoutesService(u);this._pickUpCountry=f.FindCountryByIata(this._parameters.Query.PickUpIata);this.GetCarQuote()}return t.prototype.GetCarQuote=function(){var t=this,n=Utilities.Clone(this._parameters.Query);n.RateId=this._parameters.Car.RateId;n.SelectedCategory=this._parameters.Car.CategoryCode;n.SelectedEquipment=[];this._carsService.GetQuote(n).then(function(n){t.GotCar(n)}).catch(function(n){t.LoadInformationError(n)})},t.prototype.SelectCar=function(){this._parameters.OnSelect(this._parameters.Car)},t.prototype.GotCar=function(n){this._scope.Quote=n;this._scope.Quote.Car.RateId=n.RateId;var t=this._carsInsuranceService.BuildInsuranceOptions(n,this._pickUpCountry);t.Basic&&(this._scope.BasicInsuranceOptions=t.Basic.Options);this._scope.IsLoading=!1},t.prototype.HasAnyInsuranceInformation=function(){return!this._scope.BasicInsuranceOptions?!1:this._scope.BasicInsuranceOptions.filter(function(n){return!!n.VehicleInformationDrawerDescription}).length>0},t.prototype.LoadInformationError=function(){this._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.GetCarsQuote,n.Data.DrawerBackOverride.AlwaysHide)},t.ControllerName="Funnel_CarsVehicleInformationDrawer",t.$inject=["$scope","Cars_Service","Cars_ErrorService","Cars_InsuranceService","Sitecore_RoutesData"],t}();t.CarsVehicleInformationDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this._scope=n;this._funnelBasketService=t;this._funnelPassengerService=i;this._funnelCarsSettings=r;this._parameters=this._scope.CurrentSection.Options.Parameters;this._scope.BookingReference=this._parameters.BookingReference;this.GetCarFromBasket()}return n.prototype.GetExtras=function(n){var i=this,t=[];return n.forEach(function(n){var r,u,f;!n||(r=i._parameters.ExtrasOptions.filter(function(t){return t.Code===n.Code})[0],!r||(u=n.IsMandatory?r.MandatoryCarDetailsSummaryText:r.CarDetailsSummaryText,f=!n.Quantity?"":n.Quantity.toString(),t=t.concat(u.replace("{quantity}",f))))}),t},n.prototype.GetInsurance=function(n){var u=[],i,f,t,r,e;if(!!n&&(i=this._funnelCarsSettings.InsuranceOptions.InsuranceGroups.filter(function(t){return t.Id===n.GroupId}),i.length>0))for(f=i[0].InsuranceTypes.filter(function(t){return n.Codes.indexOf(t.Code)>-1}),t=0,r=f;t<r.length;t++)e=r[t],u.push(e.ConfirmationCarDetailsDrawerDescription);return u},n.prototype.GetCarFromBasket=function(){var n=this._funnelBasketService.GetBasket();!n||!n.Car||(this._scope.Car=n.Car,this._scope.ExtrasText=this.GetExtras(n.Car.SelectedExtras),this._scope.InsuranceText=this.GetInsurance(n.Car.SelectedInsuranceOption),this._scope.LeadDriverAgeDropDownValue=this.GetLeadDriverAgeDropDownValue(),this._scope.LeadDriverName=this._funnelPassengerService.GetDisplayName(n.Car.LeadDriverPassengerInternalId))},n.prototype.GetLeadDriverAgeDropDownValue=function(){var n=this,t=this.GetAgeOptions(this._funnelCarsSettings.LeadDriverAgeOptions),i=t.filter(function(t){return t.Value===n._scope.Car.LeadDriverAge})[0];return i.DisplayText},n.prototype.GetAgeOptions=function(n){return n.map(function(n){return n.DropDownOptionData})},n.ControllerName="Funnel_ConfirmationCarDetailsDrawer",n.$inject=["$scope","Funnel_BasketService","Funnel_PassengerService","Sitecore_CarsSettingsData"],n}();n.ConfirmationCarDetailsDrawer=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._scope=n;this._funnelPassengerService=t;this._confirmationPageSettings=i;this._analyticsTracker=r;this._scope.OpenCarDetailsDrawer=this.OpenCarDetailsDrawer.bind(this);this._scope.GetLeadDriverName=this.GetLeadDriverName.bind(this)}return t.prototype.OpenCarDetailsDrawer=function(){var t={BookingReference:this._scope.Booking.BookingReference,ExtrasOptions:this.GetExtrasOptions()},i={SectionKey:"confirmation-car-details-drawer",Parameters:t};n.Events.OpenDrawerWithOptions(i);this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Confirmation,Tracking.EventConstants.Actions.Drawer,Tracking.EventConstants.Labels.CarDetails)},t.prototype.GetExtrasOptions=function(){return this._confirmationPageSettings.ExtraOptions},t.prototype.GetLeadDriverName=function(){return this._funnelPassengerService.GetDisplayName(this._scope.Car.LeadDriverPassengerInternalId)},t.ControllerName="Funnel_ConfirmationCarsSummary",t.$inject=["$scope","Funnel_PassengerService","Sitecore_FunnelConfirmationPageSettings","IAnalyticsTracker"],t}();t.ConfirmationCarsSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u){this._scope=n;this._funnelBasketService=t;this._funnelPassengerService=i;this._funnelHotelsSettings=r;this._hotelsDataMapper=u;this._parameters=this._scope.CurrentSection.Options.Parameters;this._scope.BookingNumber=this._parameters.BookingNumber;this._scope.PinCode=this._parameters.PinCode;this._scope.IsPayLaterHotel=this.IsPayLaterHotel.bind(this);this.PopulateScopeFromBasket()}return t.prototype.PopulateScopeFromBasket=function(){var n=this._funnelBasketService.GetBasket();!n||!n.Hotel||(this._scope.Hotel=this._hotelsDataMapper.FromHotelDataToHotel(n.Hotel),this._scope.LeadGuestName=this._funnelPassengerService.GetDisplayName(n.Hotel.HotelLeadGuestInternalId),this._scope.NumberOfGuests=this.CalculateNumberOfGuests(this._scope.Hotel.Rooms,this._funnelPassengerService.GetPassengersFromBasket().length),this._scope.AffiliateId=this._funnelHotelsSettings.AffiliateId,this._scope.BookingNumber=this._parameters.BookingNumber,this._scope.PinCode=this._parameters.PinCode,this._scope.LanguageCode=this._funnelBasketService.GetEResLanguageCode())},t.prototype.CalculateNumberOfGuests=function(n,t){var i=0;return n.forEach(function(n){i+=n.GuestLimit*n.Quantity}),Math.min(i,t)},t.prototype.IsPayLaterHotel=function(){return this._scope.Hotel?this._scope.Hotel.BookingType===n.Data.Common.HotelBookingType.BookNowPayLater:!1},t.ControllerName="Funnel_ConfirmationHotelDetailsDrawer",t.$inject=["$scope","Funnel_BasketService","Funnel_PassengerService","Sitecore_HotelsSettingsData","Funnel_HotelsDataMapper"],t}();t.ConfirmationHotelDetailsDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._scope=n;this._funnelPassengerService=t;this._analyticsTracker=i;this._scope.GetLeadGuestName=this.GetLeadGuestName.bind(this);this._scope.GetDurationOfStay=this.GetDurationOfStay.bind(this);this._scope.OpenHotelDetailsDrawer=this.OpenHotelDetailsDrawer.bind(this)}return t.prototype.GetLeadGuestName=function(){return this._funnelPassengerService.GetDisplayName(this._scope.Hotel.HotelLeadGuestInternalId)},t.prototype.GetDurationOfStay=function(){var n=this._scope.Hotel.CheckInDateTime.Date(),t=this._scope.Hotel.CheckOutDateTime.Date();return t.DifferenceInDays(n)},t.prototype.OpenHotelDetailsDrawer=function(){var t={BookingNumber:this._scope.BookingNumber,PinCode:this._scope.PinCode},i={SectionKey:"confirmation-hotel-details-drawer",Parameters:t};n.Events.OpenDrawerWithOptions(i);this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Confirmation,Tracking.EventConstants.Actions.Drawer,Tracking.EventConstants.Labels.HotelDetails)},t.ControllerName="Funnel_ConfirmationHotelsSummary",t.$inject=["$scope","Funnel_PassengerService","IAnalyticsTracker"],t}();t.ConfirmationHotelsSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt){var ut=t.call(this,r,v,y,i)||this;return ut._scope=i,ut._funnelStartUpService=u,ut._funnelBasketService=f,ut._funnelBookingService=e,ut._pageSettings=o,ut._funnelBasketAssociationService=s,ut._$interpolate=h,ut._errorService=c,ut._analyticsTracker=l,ut._ecommerceAnalytics=a,ut._flightConfirmationCookieService=p,ut._paymentSettingsService=w,ut._lookAndBookService=b,ut._manageBookingsSkipPageService=k,ut._personalisationDataService=d,ut._bookingDataService=g,ut._flightTaxCalculator=nt,ut._sitecoreLanguageSettings=tt,ut._airPlusCookieService=it,ut._funnelBookingDataMapper=rt,ut._scope.IsLoading=!0,ut._scope.AirportsInformation=[],ut._scope.ShowAirportInformation=ut.ShowAirportInformation.bind(ut),ut._scope.HasSeats=ut.HasSeats.bind(ut),ut._scope.ShowManageSeats=ut.ShowManageSeats.bind(ut),ut._scope.GetSeatsText=ut.GetSeatsText.bind(ut),ut._scope.HasAnyExtras=ut.HasAnyExtras.bind(ut),ut._scope.HasPayNowHotel=ut.HasPayNowHotel.bind(ut),ut._scope.ShowAncillariesPanel=ut.ShowAncillariesPanel.bind(ut),ut._scope.HasCar=ut.HasCar.bind(ut),ut._scope.HasHotel=ut.HasHotel.bind(ut),ut._scope.HasTravelInsurance=ut.HasTravelInsurance.bind(ut),ut._scope.HasVouchers=ut.HasVouchers.bind(ut),ut._scope.FireAddLuggageAnalyticsEventAndNavigateToUrl=ut.FireAddLuggageAnalyticsEventAndNavigateToUrl.bind(ut),ut._scope.FireAddMoreLuggageAnalyticsEventAndNavigateToUrl=ut.FireAddMoreLuggageAnalyticsEventAndNavigateToUrl.bind(ut),ut._scope.FlightsTotalTax=ut.FlightsTotalTax.bind(ut),ut._scope.OpenPriceBreakdownDrawer=ut.OpenPriceBreakdownDrawer.bind(ut),ut._scope.$on(n.Events.Names.Funnel.FunnelReady,ut.OnFunnelReady.bind(ut)),ut._scope.$on(n.Events.Names.Account.DeprecatedSignInStatusChanged,ut.OnSignInStatusChanged.bind(ut)),ut._bookingDataService.Expecting(n.Services.Controls.BookingData.BookingDataSource.FunnelBooking),ut._funnelStartUpService.StartUp(!1,!1,!1,!0,null),ut._personalisationDataService.ResetPersonalisation(),ut}return __extends(i,t),i.prototype.OpenPriceBreakdownDrawer=function(){var t={SectionKey:"basket-price-breakdown-drawer",AnalyticsOptions:{Category:Tracking.EventConstants.Categories.DrawerOpen,Action:Tracking.EventConstants.Actions.ClickPriceBreakdown,Label:this._sitecoreLanguageSettings.SitecoreLanguageCode,IncludeDrawerIdInLabel:!1,IncludePagePathInLabel:!1}};n.Events.OpenDrawerWithOptions(t)},i.prototype.OnFunnelReady=function(){var t=this;this._funnelBookingService.GetBooking(function(i){var r=t._funnelBasketService.GetBasket(),u=t.GetPageTitle(r.BookingReference);t.SetPageTitle(u);i?(t.SetFlightAndCarConfirmationCookies(r),t._ecommerceAnalytics.SendAnalytics(r,i),t._scope.ClientBooking=i,t._scope.BookingPassengers=Main3.Common.BookingPassengers.CreateFromBasket(i),t._scope.Luggage=i.Luggage,t._scope.CanCheckIn=t.CanCheckIn(i.Flights),t.CompareBasketAndBookingLuggageAndLogInconsistencies(r.Luggage,i.Luggage),t.SetAirportsInformation(i.Flights),t._scope.HasLuggage=r.Luggage.HoldBags.length>0||r.Luggage.SportsEquipment.length>0,t._scope.LuggageText=t.BuildLuggageText(r.Luggage,r.Passengers),t._scope.PaymentVendorName=t._paymentSettingsService.GetPaymentVendorName(i.CardVendorCode),t._scope.CardLastFourDigits=i.CardLastFourDigits,t._scope.Flights=i.Flights,t._scope.Car=r.Car,t._scope.Hotel=r.Hotel,t._scope.MemberId=r.BookerDetails.MemberId,t._scope.TravelInsurance=r.TravelInsurance,t._scope.Vouchers=t.GetBookingVouchers(i.Vouchers),t.ShowHelpingHand(),t.ShowAncillaryErrorDrawers(),t.SetupAncillariesPanel(),t.CallLookAndBookService(),t.SetFunnelBooking(i),t._airPlusCookieService.CookieExsists()&&!i.AirPlusSupplementaryDataSupplied&&t.ShowAirPlusDrawer(i.CardVendorCode)):(n.Events.Fire(n.Events.Names.Basket.Hide),n.Events.OpenDrawerWithOptions({SectionKey:"funnel-booking-details-unavailable",TitleOverride:u}))})},i.prototype.SetFunnelBooking=function(t){var i=this._funnelBookingDataMapper.Map(t);this._bookingDataService.Received(n.Services.Controls.BookingData.BookingDataSource.FunnelBooking,i)},i.prototype.ShowAirPlusDrawer=function(t){var i=this._paymentSettingsService.GetPaymentCardWithVendorCode(t),r={BookingReference:this._scope.ClientBooking.BookingReference,FormInputMask:i.FormInputMask,RequireValidChecksum:i.RequireValidChecksum},u={SectionKey:"airplus-request-account-drawer",Parameters:r};n.Events.QueueDrawerWithOptions(u)},i.prototype.GetBookingVouchers=function(n){return!n?n:n.filter(function(n){return n.Quantity>0})},i.prototype.SetFlightAndCarConfirmationCookies=function(n){var i=n.JourneyPairs[0].OutboundSlot.Flight,r=i.LocalDepartureTime.Date(),u=null,t;!n.JourneyPairs[0].ReturnSlot||!n.JourneyPairs[0].OutboundSlot.Flight||(u=n.JourneyPairs[0].ReturnSlot.Flight.LocalDepartureTime.Date());t=Main3.Common.BookingPassengers.CreateFromBasket(n).PassengerComposition();this._flightConfirmationCookieService.SetFlightConfirmationCookie(n.BookingReference,i.DepartureIata,i.ArrivalIata,t.Adults,t.Children,t.Infants,r,u);!n.Car||this._flightConfirmationCookieService.SetCarConfirmationCookie(n.BookingReference,r)},i.prototype.CompareBasketAndBookingLuggageAndLogInconsistencies=function(n,t){n.HoldBags.length!==t.HoldBags.length?this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Confirmation,Tracking.EventConstants.Actions.LuggageMismatch,Tracking.EventConstants.Labels.HoldBagCountMismatch):n.SportsEquipment.length!==t.SportsEquipment.length?this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Confirmation,Tracking.EventConstants.Actions.LuggageMismatch,Tracking.EventConstants.Labels.SportingEquipmentCountMismatch):this.GetTotalLuggageWeight(n.HoldBags)!==this.GetTotalLuggageWeight(t.HoldBags)&&this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Confirmation,Tracking.EventConstants.Actions.LuggageMismatch,Tracking.EventConstants.Labels.HoldBagWeightMismatch)},i.prototype.GetTotalLuggageWeight=function(n){var t=0;return n.forEach(function(n){t+=n.TotalWeight}),t},i.prototype.CanCheckIn=function(n){return n.filter(function(n){return n.CanCheckIn}).length>0},i.prototype.GetPageTitle=function(n){return this._pageSettings.HeaderText.replace("{booking reference}",n)},i.prototype.SetPageTitle=function(n){Title.TitleBar.Instance.HideAndThenShowText(n)},i.prototype.ShowHelpingHand=function(){this._scope.$emit(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/funnel/check-in",this._scope)},i.prototype.HasSeats=function(n){return this._funnelBasketAssociationService.GetSeatBandSummaryFromBooking(n.InternalId,!1,this._scope.ClientBooking).length>0},i.prototype.ShowManageSeats=function(){return!this._manageBookingsSkipPageService.ShouldDisableSeatingDueToMaxPassengers(this._scope.BookingPassengers.PassengerComposition())},i.prototype.GetSeatsText=function(n){return this._funnelBookingService.GetSeatNumbersForFlight(n.InternalId).join(", ")},i.prototype.OnSignInStatusChanged=function(n,t,i){!t&&i&&(this._scope.IsLoading=!0,this._errorService.Exit("Confirmation - Sign out"))},i.prototype.HasAnyExtras=function(){return this.HasCar()||this.HasHotel()||this.HasTravelInsurance()||this.HasVouchers()},i.prototype.HasCar=function(){return!!this._scope.Car&&!this.CarBookingHasError()},i.prototype.HasHotel=function(){return!!this._scope.Hotel&&!this.HotelBookingHasError()},i.prototype.HasTravelInsurance=function(){return!!this._scope.TravelInsurance&&!this.TravelInsuranceHasError()},i.prototype.HasVouchers=function(){return!!this._scope.Vouchers},i.prototype.HasPayNowHotel=function(){return!!this._scope.Hotel&&this._scope.Hotel.BookingType===n.Data.Common.HotelBookingType.BookNowPayNow&&!this.HotelBookingHasError()},i.prototype.HotelBookingHasError=function(){return!!this._scope.Hotel&&!(this._scope.ClientBooking.HotelBooking&&this._scope.ClientBooking.HotelBooking.BookingNumber)},i.prototype.CarBookingHasError=function(){return!!this._scope.Car&&!(this._scope.ClientBooking.CarBooking&&this._scope.ClientBooking.CarBooking.BookingReference)},i.prototype.TravelInsuranceHasError=function(){return!!this._scope.TravelInsurance&&!(this._scope.ClientBooking.TravelInsuranceBooking&&this._scope.ClientBooking.TravelInsuranceBooking.PolicyNumber)},i.prototype.ShowAncillaryErrorDrawers=function(){this.HotelBookingHasError()&&this.OpenAncillaryErrorDrawer("confirmation-hotel-error-drawer",[this._scope.ClientBooking.HotelBooking]);this.CarBookingHasError()&&this.OpenAncillaryErrorDrawer("confirmation-car-error-drawer",[this._scope.ClientBooking.CarBooking]);this.TravelInsuranceHasError()&&this.OpenAncillaryErrorDrawer("confirmation-travel-insurance-error-drawer",[this._scope.ClientBooking.TravelInsuranceBooking])},i.prototype.OpenAncillaryErrorDrawer=function(t,i){var r={SectionKey:t,AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Confirmation,Action:Tracking.EventConstants.Actions.Drawer,IncludeDrawerIdInLabel:!0,IncludePagePathInLabel:!0,Label:this.GetAncillaryErrorDrawerAnalyticsLabel(i)}};n.Events.QueueDrawerWithOptions(r)},i.prototype.GetAncillaryErrorDrawerAnalyticsLabel=function(n){var t="",i="";return n.forEach(function(n){t=""+t+i+n.StatusCode+"|"+n.ErrorMessage;i="_"}),t},i.prototype.SetupAncillariesPanel=function(){n.Events.Fire(n.Events.Names.Basket.SetupBasket,"ng-templates/panels/ancillaries-content",n.Data.Common.ClientBasketType.AncillariesPanel,!1,"ng-templates/panels/ancillaries-title")},i.prototype.ShowAncillariesPanel=function(){n.Events.Fire(n.Events.Names.Basket.Show)},i.prototype.CallLookAndBookService=function(){if(this._scope.Flights&&this._scope.ClientBooking&&this._scope.BookingPassengers&&this._scope.MemberId){var n={MemberID:this._scope.MemberId,BookingRef:this._scope.ClientBooking.BookingReference,Flights:this.GetFlightString(this._scope.Flights),SeatsSold:this.GetSeatsSoldFromPassengers(this._scope.BookingPassengers)};this._lookAndBookService.StoreBooking(n)}},i.prototype.GetFlightString=function(n){var t=n.map(function(n){return n.LocalDepartureTime.Date().Format("YYYYMMDD")+n.DepartureIata+n.ArrivalIata+n.FlightNumber.toString()});return t.join("-")},i.prototype.GetSeatsSoldFromPassengers=function(n){return n.GetPassengers().length},i.prototype.FireAddLuggageAnalyticsEventAndNavigateToUrl=function(n){this.FireManageHoldLuggageAndSportsEquipmentAnalyticsEvent(Tracking.EventConstants.Labels.AddHoldLuggage,n)},i.prototype.FireAddMoreLuggageAnalyticsEventAndNavigateToUrl=function(n){this.FireManageHoldLuggageAndSportsEquipmentAnalyticsEvent(Tracking.EventConstants.Labels.AddOrChangeHoldLuggage,n)},i.prototype.FireManageHoldLuggageAndSportsEquipmentAnalyticsEvent=function(n,t){this._analyticsTracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.Confirmation,Tracking.EventConstants.Actions.ManageHoldLuggageAndSportsEquipment,n,t)},i.prototype.FlightsTotalTax=function(){return this._flightTaxCalculator.GetBasketTaxes()},i.ControllerName="Funnel_ConfirmationPage",i.$inject=["$scope","Controls_LuggageService","Funnel_StartupService","Funnel_BasketService","Funnel_BookingService","Sitecore_FunnelConfirmationPageSettings","Funnel_AssociationsService","$interpolate","Funnel_ErrorService","IAnalyticsTracker","Funnel_ECommerceAnalyticsService","Common_AirportsInformationService","Sitecore_AirportInformationDrawer","FlightConfirmationCookie_Service","Sitecore_PaymentSettingsService","LookAndBookService","ManageBookings_SkipPageService","Personalisation_DataService","Controls_BookingDataService","Funnel_FlightTaxCalculator","Sitecore_SitecoreLanguageSettings","AirPlusCookie_Service","Controls_FunnelBookingDataMapper"],i}(t.Common.BaseConfirmationPage);i.ConfirmationPage=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._scope=n;this._scope.Parameters=this._scope.CurrentSection.Options.Parameters;this._scope.HasOptionalExtras=this.HasOptionalExtras.bind(this)}return n.prototype.HasOptionalExtras=function(){return this._scope.Parameters.OptionalExtras&&this._scope.Parameters.OptionalExtras.length>0},n.ControllerName="Funnel_ConfirmationTravelInsuranceDetailsDrawer",n.$inject=["$scope"],n}();n.ConfirmationTravelInsuranceDetailsDrawer=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f,e){var o=this;this._scope=n;this._analytics=t;this._passengerService=i;this._bookingService=r;this._priceService=u;this._travelInsurancePriceService=f;this._travelInsuranceDrawerSettings=e;this._bookingService.GetBooking(function(n){o._booking=n});this._scope.OpenDetailsDrawer=this.OpenDetailsDrawer.bind(this)}return t.prototype.OpenDetailsDrawer=function(){var t=_(this._scope.TravelInsurance.InsuredPassengers).find(function(t){return t.Type===n.Data.Funnel.TravelInsurance.TravelInsurancePassengerType.Adult||t.Type===n.Data.Funnel.TravelInsurance.TravelInsurancePassengerType.Over64}).InternalPassengerId,i={PolicyNumber:this._scope.PolicyNumber,PolicyName:this._scope.TravelInsurance.Policy.ProductName,PolicyHolder:this._passengerService.GetDisplayName(t),InsuranceStartDate:this._scope.TravelInsurance.Policy.StartDate,InsuranceEndDate:this._scope.TravelInsurance.Policy.EndDate,IssueDate:Utilities.ZonelessDateTime.NowLocal(),Premium:this._travelInsurancePriceService.GetTotalPrice(this._scope.TravelInsurance.Policy),InsuredPersons:this.GetInsuredPersonsNames(),OptionalExtras:this._scope.TravelInsurance.Policy.SelectedExtras.map(function(n){return n.Name})},r={TitleOverride:this._travelInsuranceDrawerSettings.Title.replace("{policyName}",this._scope.TravelInsurance.Policy.ProductName),SectionKey:"confirmation-travel-insurance-details-drawer",Parameters:i,AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Confirmation,Label:Tracking.EventConstants.Labels.TravelInsuranceConfirmationDetails,Action:Tracking.EventConstants.Actions.Drawer}};n.Events.OpenDrawerWithOptions(r)},t.prototype.GetInsuredPersonsNames=function(){for(var r,u,t=[],n=0,i=this._scope.TravelInsurance.InsuredPassengers;n<i.length;n++)r=i[n],u=this._passengerService.GetDisplayName(r.InternalPassengerId),t.push(u);return t},t.$inject=["$scope","IAnalyticsTracker","Funnel_PassengerService","Funnel_BookingService","Common_PriceService","Funnel_TravelInsurancePriceService","Sitecore_ConfirmationTravelInsuranceDrawerSettings"],t}();t.ConfirmationTravelInsuranceSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u){this.routesData=t;this._priceService=i;this._bookingVoucherAssociationsService=r;this._passengerDisplayService=u;this._scope=n;this._routesService=new Main3.Routes.RoutesService(t);this._parameters=this._scope.CurrentSection.Options.Parameters;this._scope.Flights=this.GetAllFlightsWithVouchers();this._scope.RedeemableAmount=this._parameters.RedeemableValue;this._scope.VoucherTotalCount=this._parameters.VoucherTotalCount;this._scope.VoucherCost=this._parameters.VoucherCost;this._scope.GetAllPassengersWithVouchersForFlight=this.GetAllPassengersWithVouchersForFlight.bind(this);this._scope.GetAirportName=this.GetAirportName.bind(this);this._scope.GetPassengerName=this.GetPassengerName.bind(this);this._scope.GetPassengerVoucherQuantity=this.GetPassengerVoucherQuantity.bind(this);this._scope.GetTotalVoucherCostForBooking=this.GetTotalVoucherCostForBooking.bind(this)}return t.prototype.GetPassengerName=function(n){return this.GetDisplayNameForPassengerWithVouchers(n)},t.prototype.GetDisplayNameForPassengerWithVouchers=function(t){var r=this._parameters.Booking,i;return r.Passengers&&(i=r.Passengers.filter(function(n){return n.InternalId===t})[0],!!i&&i.Type!==n.Data.Common.PassengerDataType.Infant)?this._passengerDisplayService.GetNonInfantPassengerSuppliedDisplayNameWithTitle(i):""},t.prototype.GetAirportName=function(n){return this._routesService.FindAirportByIata(n).Name},t.prototype.GetAllFlightsWithVouchers=function(){var n=this,t=this._parameters.Booking.Associations.filter(function(t){return n._bookingVoucherAssociationsService.AssociationHasValidVouchers(t)}).map(function(n){return n.FlightInternalId});return this._parameters.Booking.Flights.filter(function(n){return t.indexOf(n.InternalId)!==-1})},t.prototype.GetAllPassengersWithVouchersForFlight=function(n){return this._bookingVoucherAssociationsService.GetPassengersWithVouchersForFlight(n,this._parameters.Booking)},t.prototype.GetPassengerVoucherQuantity=function(n,t){var i=Utilities.Arrays.FirstOrDefault(this._parameters.Booking.Associations,function(i){return i.FlightInternalId===n&&i.PassengerInternalId===t});return!i.Vouchers?null:i.Vouchers.Quantity},t.prototype.GetTotalVoucherCostForBooking=function(){return this._priceService.Multiply(this._scope.VoucherCost,this._scope.VoucherTotalCount)},t.ControllerName="Funnel_ConfirmationVoucherDetailsDrawer",t.$inject=["$scope","Sitecore_RoutesData","Common_PriceService","Funnel_BookingVouchersAssociationsService","Common_PassengerDisplayService"],t}();t.ConfirmationVoucherDetailsDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){var u=this;this._scope=n;this._bookingService=t;this._priceService=i;this._bookingVouchersAssociationsService=r;this._bookingService.GetBooking(function(n){u._scope.Booking=n});this._scope.RedeemableValue=this.GetBookingRedeemableValue();this._scope.VoucherTotalCount=this.GetBookingTotalVouchers();this._scope.VoucherCost=this.GetVoucherCost();this._scope.OpenDetailsDrawer=this.OpenDetailsDrawer.bind(this)}return t.prototype.OpenDetailsDrawer=function(){var t={VoucherTotalCount:this._scope.VoucherTotalCount,RedeemableValue:this._scope.RedeemableValue,VoucherCost:this._scope.VoucherCost,Booking:this._scope.Booking},i={SectionKey:"confirmation-voucher-details-drawer",Parameters:t,AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Confirmation,Action:Tracking.EventConstants.Actions.Drawer,Label:Tracking.EventConstants.Labels.VoucherConfirmationDetails}};n.Events.OpenDrawerWithOptions(i)},t.prototype.GetBookingRedeemableValue=function(){return this._priceService.NewPrice(this._bookingVouchersAssociationsService.GetFirstAssociationWithVouchers(this._scope.Booking).Vouchers.RedeemableAmount)},t.prototype.GetVoucherCost=function(){return this._priceService.NewPrice(this._bookingVouchersAssociationsService.GetFirstAssociationWithVouchers(this._scope.Booking).Vouchers.Cost)},t.prototype.GetBookingTotalVouchers=function(){return this._bookingVouchersAssociationsService.GetBookingTotalVouchers(this._scope.Booking)},t.$inject=["$scope","Funnel_BookingService","Common_PriceService","Funnel_BookingVouchersAssociationsService"],t}();t.ConfirmationVoucherSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._scope=n;this._scope.SelectCurrency=this.SelectCurrency.bind(this)}return t.prototype.SelectCurrency=function(){var t=this,i={OnCurrencyUpdateComplete:function(){setTimeout(function(){t._scope.$emit(n.Events.Names.Basket.SetFocusOnChangeCurrency)},1)}};n.Events.OpenDrawerWithOptions({SectionKey:"currency-selector-drawer",Parameters:i})},t.ControllerName="Funnel_CurrencySelector",t.$inject=["$scope"],t}();t.CurrencySelector=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f,e,o,s,h){this._scope=n;this._funnelService=t;this._moneySettings=i;this._priceService=r;this._dataApi=u;this._tracker=f;this._funnelCurrencyService=e;this._funnelBasketService=o;this._accessibilityService=s;this._errorService=h;this._scope.IsLoading=!0;this._scope.CurrentCurrency=this._priceService.GetCurrentCurrency();this._parameters=this._scope.Section.Options.Parameters;this.SetValidCurrencies();this._scope.SelectCurrency=this.SelectCurrency.bind(this)}return t.prototype.SelectCurrency=function(t){if(t.CurrencyCode!==this._scope.CurrentCurrency.CurrencyCode){this.SendAnalyticsEvent(this._scope.CurrentCurrency.CurrencyCode,t.CurrencyCode);this.CreateCurrencyChangeAlerts(t);var i=null;!this._parameters||(i=this._parameters.OnCurrencyUpdateComplete);this._funnelCurrencyService.SetCurrency(t.CurrencyCode,5,!1,null,i);this._scope.CurrentCurrency=t}n.Events.Fire(n.Events.Names.Drawer.Close)},t.prototype.SendAnalyticsEvent=function(n,t){var i=n+"-"+t+" | "+window.location.pathname;this._tracker.TrackEvent("Funnel","Change Currency",i)},t.prototype.SetValidCurrencies=function(){this._dataApi.GetAvailableCurrencies(this.AvailableCurrenciesRetrieved.bind(this),this.OnError.bind(this))},t.prototype.AvailableCurrenciesRetrieved=function(n){var t=this._moneySettings.Currencies,i=t.filter(function(t){return n.Currencies.filter(function(n){return n.CurrencyCode===t.CurrencyCode}).length>0});this._scope.Currencies=i;this._scope.IsLoading=!1},t.prototype.OnError=function(){this._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.GetAvailableCurrencies)},t.prototype.CreateCurrencyChangeAlerts=function(n){this._accessibilityService.QueueAlertCurrencyChangedAlert(n);this._funnelBasketService.BasketContainsExtras()&&this._accessibilityService.QueueExtrasRemovedFromBasketAlert();this._accessibilityService.AlertBasketChangedQueue()},t.ControllerName="Funnel_CurrencySelectorDrawer",t.$inject=["$scope","Funnel_Service","Sitecore_MoneySettings","Common_PriceService","Data_Api","IAnalyticsTracker","Funnel_CurrencyService","Funnel_BasketService","Funnel_AccessibilityService","Funnel_ErrorService"],t}();t.CurrencySelectorDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._scope=n;this._funnelService=t;this._scope.AllowDuplicateBooking=this.HandleDuplicateBooking.bind(this,!0);this._scope.RejectDuplicateBooking=this.HandleDuplicateBooking.bind(this,!1)}return n.prototype.HandleDuplicateBooking=function(n){this._funnelService.HandlePotentialDuplicateBooking(n)},n.ControllerName="Funnel_DuplicateBookingDrawer",n.$inject=["$scope","Funnel_Service"],n}();n.DuplicateBookingDrawer=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u){var f=this;this._scope=t;this._funnelService=i;this._ejPlusService=r;this._analyticsTracker=u;this._scope.HasValidLastName=this.HasValidLastName.bind(this);this._scope.EjPlusNumberChanged=this.EjPlusNumberChanged.bind(this);this._scope.OnSubmit=this.OnSubmit.bind(this);this._scope.IsValidFormat=this.IsValidFormat.bind(this);this._scope.IsStaffCard=this.IsStaffCard.bind(this);this._scope.$on(n.Events.Names.DrawerSection.Shown,function(){f._parameters=f._scope.CurrentSection.Options.Parameters;f._scope.FormSubmitted=!1;f._scope.PassengerName=f._parameters.PassengerName;f._scope.EjPlusNumber="";var t=f.HasValidLastName()?"membership-info":"no-name";f._scope.$broadcast(n.Events.Names.Drawer.ActivateTab,t)})}return t.prototype.HasValidLastName=function(){return this._parameters?!!this._parameters.PassengerLastName:!1},t.prototype.IsValidFormat=function(){return this._scope.CardNumberForm.$valid},t.prototype.EjPlusNumberChanged=function(){this.DisplayValidationError(null)},t.prototype.OnSubmit=function(){if(this._scope.FormSubmitted=!0,this.DisplayValidationError(null),this.IsValidFormat()&&!this.IsStaffCard()){var t=this._parameters.IsEjPlusNumberUsedByOtherPassenger(this._scope.EjPlusNumber);t?this.DisplayValidationError(n.Data.Common.EjPlusCardStatus.Duplicate):this.VerifyCard()}},t.prototype.IsStaffCard=function(){return!this._scope.EjPlusNumber?!1:this._ejPlusService.IsStaffCard(this._scope.EjPlusNumber)},t.prototype.VerifyCard=function(){this._scope.VerifyingInProgress=!0;this._funnelService.VerifyEjPlusNumber(this._parameters.PassengerLastName,this._scope.EjPlusNumber,this.VerificationComplete.bind(this))},t.prototype.VerificationComplete=function(t){this._scope.VerifyingInProgress=!1;t===n.Data.Common.EjPlusCardStatus.Valid?(this._parameters.SetCardNumber(this._scope.EjPlusNumber),this._scope.$emit(n.Events.Names.Drawer.Close)):this.DisplayValidationError(t)},t.prototype.DisplayValidationError=function(t){this._scope.DuplicateCard=t===n.Data.Common.EjPlusCardStatus.Duplicate;this._scope.CardExpired=t===n.Data.Common.EjPlusCardStatus.Expired;this._scope.NameIncorrect=t===n.Data.Common.EjPlusCardStatus.IncorrectName;this._scope.CardNumberInvalid=t===n.Data.Common.EjPlusCardStatus.InvalidNumber;!t||this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.PassengerDetails,Tracking.EventConstants.Actions.ValidationError,"easyjet-plus-"+n.Data.Common.EjPlusCardStatus.ToString(t).toLowerCase())},t.ControllerName="Funnel_EjPlusDrawer",t.$inject=["$scope","Funnel_Service","Funnel_EjPlusService","IAnalyticsTracker"],t}();t.EjPlusDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._scope=n;this._qService=t;this.priceIsLoading=!0;this.imageIsLoading=!0;this._scope.Extra.IsLoading=this.IsLoading.bind(this);this.LoadPrice();this.LoadImage()}return n.prototype.LoadPrice=function(){var n=this;this._scope.Extra&&this._scope.Extra.Strategy&&(this.priceIsLoading=!0,this._scope.Extra.Strategy.GetPrice().then(function(t){n._scope.Extra.Price=t;n.priceIsLoading=!1},function(){n.priceIsLoading=!1;n._scope.RemoveExtraFromAvailablePanels(n._scope.Extra)}))},n.prototype.LoadImage=function(){var n=this;this._scope.Extra&&this._scope.Extra.Strategy&&(this.imageIsLoading=!0,this._scope.Extra.Strategy.GetImageSettings(this._scope.Extra).then(function(t){n._scope.Extra.ExtraImage=t.ExtraImage;n._scope.Extra.ExtraHoverImage=t.ExtraHoverImage;n._scope.Extra.ExtraImageAlternativeText=t.ExtraImageAlternativeText;n.imageIsLoading=!1},function(){n._scope.RemoveExtraFromAvailablePanels(n._scope.Extra);n.imageIsLoading=!1}))},n.prototype.IsLoading=function(){return this.priceIsLoading||this.imageIsLoading},n.ControllerName="Funnel_ExtraPanel",n.$inject=["$scope","$q"],n}();n.ExtraPanel=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(n,i,r,u,f,e,o,s){var h=t.call(this,n,e,o,s)||this;return h._funnelJourneyService=i,h._funnelExtrasService=r,h._funnelBasketService=u,h._helpingHandMessages=f,h}return __extends(i,t),i.prototype.GetExtrasPanelsSettings=function(){return this._funnelExtrasService.GetExtraPanelsToDisplay()},i.prototype.ShouldExitFunnel=function(){return!this._funnelBasketService.HasAnyFlights()},i.prototype.GetStepOnLoadRedirect=function(){return this._funnelJourneyService.GetStepOnLoadInvalidFlightRedirect(Tracking.EventConstants.Categories.Extras)},i.prototype.GetSomeSelectedHelpingHandText=function(){return this._helpingHandMessages.SomeExtrasSelectedText},i.prototype.GetSomeSelectedHelpingHandButtonText=function(){return this._helpingHandMessages.SomeExtrasSelectedButtonText},i.ControllerName="Funnel_Extras",i.$inject=["$scope","Funnel_JourneyService",n.DynamicDependencyKeys.ExtrasService,"Funnel_BasketService","Sitecore_HelpingHandMessages","Funnel_ExtraPanelStrategyService","IAnalyticsTracker","Funnel_ExtrasSmartMessagesService"],i}(t.SharedFunnel.BaseExtras);i.Extras=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u,f,e,o,s,h){this._scope=n;this._pageSettings=t;this._analyticsTracker=i;this._basketFlightSelectionService=r;this._basketService=u;this._activePairService=f;this._priceService=e;this._funnelPriceService=o;this._errorService=s;this._funnelFinaliseTravelInsuranceService=h;this._parameters=this._scope.CurrentSection.Options.Parameters;this.UpdatePrices();this._scope.FlightPriceChanges=this.BuildFlightPriceChanges(this._parameters.FlightPriceChanges);this._scope.Accept=this.Accept.bind(this);this._scope.SelectNewFlights=this.SelectNewFlights.bind(this);this._scope.ShowSpinner=!1}return n.prototype.UpdatePrices=function(){var n=this,t;this._scope.CurrentSection.Scope.DrawerContentIsReady=!1;t=this._funnelPriceService.TotalPrice();this._basketFlightSelectionService.UpdateFlightPricesBySegmentId(this._parameters.FlightPriceChanges).then(function(){n.SetScopePrices(t);n._scope.CurrentSection.Scope.DrawerContentIsReady=!0},function(){return n._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.GenericErrorDrawerLabels.FlightPriceChangeError)})},n.prototype.SetScopePrices=function(n){var t=this._funnelPriceService.TotalPrice(),i=this._priceService.Difference(t,n);this._scope.TotalPrice=t;this._scope.ChangeInPrice=Math.abs(i);this._scope.IsIncrease=i>=0},n.prototype.BuildFlightPriceChanges=function(n){var t=this,i=[];return n.forEach(function(n){var r=t.FindBasketFlightFromSegmentId(n.SegmentId);if(!r)return t._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.FlightPriceChangeNoMatchingFlight),[];t._basketService.GetPassengerComposition().Adults>=1&&i.push({IsChild:!1,Date:r.LocalDepartureTime,Origin:r.DepartureIata,Destination:r.ArrivalIata,NewPrice:n.NewPrices.Adult,OriginalPrice:n.OldPrices.Adult});t._basketService.GetPassengerComposition().Children>=1&&i.push({IsChild:!0,Date:r.LocalDepartureTime,Origin:r.DepartureIata,Destination:r.ArrivalIata,NewPrice:n.NewPrices.Child,OriginalPrice:n.OldPrices.Child})}),i},n.prototype.FindBasketFlightFromSegmentId=function(n){return _(this._basketService.GetFlights()).select(function(t){return t.SegmentId==n})[0]},n.prototype.Accept=function(){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Checkout,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.FareChangeAccept);this._scope.ShowSpinner=!0;this._funnelFinaliseTravelInsuranceService.HandlePriceChange()},n.prototype.SelectNewFlights=function(){var n=this;this.RemoveAllAffectedFlights().then(function(){n._activePairService.SetFirstIncompleteAsActivePair();n._analyticsTracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.Checkout,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.FareChangeSelectNew,n._pageSettings.SelectNewFlightsButtonTargetUrl)})},n.prototype.RemoveAllAffectedFlights=function(){var n=this,t=this._parameters.FlightPriceChanges.map(function(t){return n.FindBasketFlightFromSegmentId(t.SegmentId)});return this._basketFlightSelectionService.RemoveFlights(t)},n.ControllerName="Funnel_FinaliseFlightPricesChanged",n.$inject=["$scope","Payment_PageSettings","IAnalyticsTracker","Funnel_BasketFlightSelectionService","Funnel_BasketService","Funnel_ActivePairService","Common_PriceService","Funnel_PriceService","Error_Service","Funnel_FunnelFinaliseTravelInsuranceService"],n}();n.FinaliseFlightPricesChangedDrawer=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s){this._qService=t;this._scope=i;this._travelInsuranceBasketService=r;this._analyticsTracker=u;this._funnelJourneyService=f;this._funnelFinaliseTravelInsuranceService=e;this._priceService=o;this._funnelAccessibilityService=s;this._parameters=this._scope.CurrentSection.Options.Parameters;this._scope.IsInUpdatedPriceState=this._parameters.DrawerState===n.Data.Common.Drawers.TravelInsuranceThresholdBreachedDrawerStates.UpdatedPrice;this._scope.IsInRequiresRequoteState=this._parameters.DrawerState===n.Data.Common.Drawers.TravelInsuranceThresholdBreachedDrawerStates.RequiresRequote;this._scope.IsInErrorState=this._parameters.DrawerState===n.Data.Common.Drawers.TravelInsuranceThresholdBreachedDrawerStates.Error;this._scope.AcceptNewPrice=this.AcceptNewPrice.bind(this);this._scope.CancelInsurancePolicy=this.CancelInsurancePolicy.bind(this);this._scope.GetRequote=this.GetRequote.bind(this);this._scope.OriginalPolicy=this._travelInsuranceBasketService.GetTravelInsuranceFromClientBasket().Policy;this._scope.OriginalExtras=this._scope.OriginalPolicy.SelectedExtras;this._scope.OriginalPrice=this.GetUpdatedPolicyTotalPrice(this._scope.OriginalPolicy.TotalPrice,this._scope.OriginalExtras.map(function(n){return n.Price}));!this._parameters.UpdatedPolicy||(this._scope.UpdatedPolicyName=this._parameters.UpdatedPolicy.Name,this._scope.UpdatedPolicyBasePrice=this._parameters.UpdatedPolicy.Premium,this._scope.UpdatedExtras=this.GetMatchedExtras(),this._scope.UpdatedPrice=this.GetUpdatedPolicyTotalPrice(this._parameters.UpdatedPolicy.Premium,this._scope.UpdatedExtras.map(function(n){return n.Price})));this._scope.Passengers=this._parameters.Passengers}return t.prototype.AcceptNewPrice=function(){var n=this;this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Checkout,Tracking.EventConstants.Actions.Click,Tracking.EventConstants.Labels.TravelInsurancePriceChangeAccept);this.RemoveOriginalPolicy().then(function(){return n.SaveUpdatedPolicyToBasket()}).then(function(){return n.Finalise()})},t.prototype.SaveUpdatedPolicyToBasket=function(){var t=this,n=this._qService.defer();return this._travelInsuranceBasketService.SaveToClientBasket(this._parameters.UpdatedPolicy,this._parameters.Passengers,this._parameters.FirstProductTermsLink,this._parameters.SecondProductTermsLink,this._priceService.GetNumericValue(this._scope.OriginalPrice)),this._funnelAccessibilityService.TravelInsuranceProductAddedAlert(this._parameters.UpdatedPolicy),this.GetMatchedExtras().forEach(function(n){return t.SaveExtraToClientBasket(n)}),this._travelInsuranceBasketService.SaveInsuranceToServerBasket(this._parameters.TravelInsuranceLanguageCode),n.resolve(),n.promise},t.prototype.SaveExtraToClientBasket=function(n){this._travelInsuranceBasketService.SaveExtraToClientBasket(n);this._funnelAccessibilityService.TravelInsuranceOptionalExtraAddedAlert(n)},t.prototype.GetMatchedExtras=function(){var n=this,t=this._parameters.UpdatedPolicy.OptionalExtras;return t.filter(function(t){return n.IsSelectedExtra(t,n._scope.OriginalExtras)})},t.prototype.IsSelectedExtra=function(n,t){return t.some(function(t){return t.Name===n.Name})},t.prototype.GetUpdatedPolicyTotalPrice=function(n,t){var r=this,i=n;return t.forEach(function(n){return i=r._priceService.Add(i,n)}),i},t.prototype.CancelInsurancePolicy=function(){var n=this;this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Checkout,Tracking.EventConstants.Actions.Click,Tracking.EventConstants.Labels.TravelInsurancePriceChangeRemovePolicy);this.RemoveOriginalPolicy().then(function(){return n.Finalise()})},t.prototype.Finalise=function(){return this._scope.DoClose(),n.Events.Fire(n.Events.Names.Funnel.ReFinalise),this._qService.now()},t.prototype.GetRequote=function(){var t=this,n=this._funnelJourneyService.GetEditTravelInsuranceStepUrl();if(!n)throw new Error("Travel Insurance Journey not configured correctly.");else this.RemoveOriginalPolicy().then(function(){return t._analyticsTracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.Checkout,Tracking.EventConstants.Actions.Click,Tracking.EventConstants.Labels.TravelInsurancePriceChangeGetRequote,n)})},t.prototype.RemoveOriginalPolicy=function(){var n=this._qService.defer();return this._travelInsuranceBasketService.RemoveSelectedPolicy().then(function(){return n.resolve()}),n.promise},t.ControllerName="Funnel_FinaliseInsuranceThresholdBreached",t.$inject=["$q","$scope","Funnel_TravelInsuranceBasketService","IAnalyticsTracker","Funnel_JourneyService","Funnel_FunnelFinaliseTravelInsuranceService","Common_PriceService","Funnel_AccessibilityService"],t}();t.FinaliseInsuranceThresholdBreachedDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this._scope=n;this._funnelService=t;this._scope.Acknowledge=this.Acknowledge.bind(this)}return t.prototype.Acknowledge=function(){n.Events.Fire(n.Events.Names.Drawer.Close)},t.ControllerName="Funnel_FlightTimesTooCloseDrawer",t.$inject=["$scope","Funnel_Service"],t}();t.FlightTimesTooCloseDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){this._scope=i;this._timeout=r;this._window=u;this._analyticsService=f;this._funnelBasketService=e;this._funnelJourneyService=o;this._funnelReasonCookieService=s;this._hotelsDataMapper=h;this._hotelsSettings=c;this._accessibilityService=a;this._funnelPassengerService=v;this._funnelBasketHotelsService=y;this._routesService=new Main3.Routes.RoutesService(l);this._titleBarInstance=Title.TitleBar.Instance;this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this);t.$on(n.Events.Names.Funnel.HotelDeleted,this.OnHotelDeleted.bind(this));this._scope.OnContentLoaded=this.OnContentLoaded.bind(this);this._scope.OnError=this.OnError.bind(this);this._scope.SelectedHotel=null;p.AllowDeleteHotels()}return t.prototype.IsValid=function(){return this._scope.SelectedHotel!==null},t.prototype.FunnelReady=function(){this.SetFlightInformation();this.SetPageTitle();this.SetLocale();this.SetPassengerComposition();this._scope.AffiliateId=this._hotelsSettings.AffiliateId;this._scope.Debug=this._hotelsSettings.Debug;this._scope.FocusIFrameAfterDrawerClosed=!1;this._scope.HostName=this._hotelsSettings.Hostname;this._scope.SelectedHotel=this._hotelsDataMapper.FromHotelDataToHotel(this._funnelBasketService.GetBasket().Hotel);this._loadContentTimeout||(this._loadContentTimeout=this._timeout(this.OnTimeout.bind(this),this._hotelsSettings.LoadExternalContentTimeout));this._scope.OnHotelsReady()},t.prototype.Save=function(){return this._analyticsService.TrackEvent(Tracking.EventConstants.Categories.Hotels,Tracking.EventConstants.Actions.Add,this._window.location.pathname),this._funnelBasketHotelsService.SaveHotel()},t.prototype.Skip=function(){return this._funnelBasketHotelsService.SaveHotel()},t.prototype.ShouldExitFunnel=function(){return!this._funnelBasketService.HasAnyFlights()},t.prototype.GetStepOnLoadRedirect=function(){return this._funnelJourneyService.GetStepOnLoadInvalidFlightRedirect(Tracking.EventConstants.Categories.Hotels)||this.GetStepOnLoadUnavailableStepRedirect()},t.prototype.GetStepOnLoadUnavailableStepRedirect=function(){var t=this,n=this._funnelJourneyService.GetNextStepUrlIfOnLoadRedirectRequired();return!n?null:{TargetUrl:n,EventCategory:Tracking.EventConstants.Categories.Hotels,EventAction:Tracking.EventConstants.Actions.Skip,EventLabel:Tracking.EventConstants.Labels.Unavailable,AdditionalAction:function(){t._funnelReasonCookieService.UpdateCookie(function(n){return n.HotelsRedirectReason=Constants.Redirect.Reasons.Funnel.Step.OnLoadRedirect})}}},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!1}},t.prototype.GetOutboundFlight=function(){var n,t=this._funnelBasketService.GetPrimaryJourneyPair();return!t||(n=t.OutboundSlot.Flight),n},t.prototype.GetReturnFlight=function(){var t,n=this._funnelBasketService.GetPrimaryJourneyPair();return!n||!n.ReturnSlot||(t=n.ReturnSlot.Flight),t},t.prototype.OnContentLoaded=function(){this._scope.booking.inpath.on("error",this.OnError.bind(this));this._scope.booking.inpath.on("book",this.OnHotelSelected.bind(this));this._scope.booking.inpath.on("loadingBook",this.OnHotelLoading.bind(this));this._scope.booking.inpath.on("ready",this.OnHotelReady.bind(this));this._timeout.cancel(this._loadContentTimeout);this._scope.DisplayContent()},t.prototype.OnError=function(){this._funnelReasonCookieService.UpdateCookie(function(n){return n.HotelsRedirectReason=Constants.Redirect.Reasons.Error});this._analyticsService.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.Hotels,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.Error+" | "+Utilities.ZonelessDateTime.NowUtc(),this._funnelJourneyService.GetBypassNextStepUrl())},t.prototype.OnTimeout=function(){this._funnelReasonCookieService.UpdateCookie(function(n){return n.HotelsRedirectReason=Constants.Redirect.Reasons.Timeout});this._analyticsService.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.Hotels,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.Timeout+" | "+Utilities.ZonelessDateTime.NowUtc(),this._funnelJourneyService.GetBypassNextStepUrl())},t.prototype.OnHotelDeleted=function(n,t){var i=this;t&&(t.Rooms.forEach(function(n){return i._scope.booking.inpath.deleteRoom(n.Id)}),this._scope.SelectedHotel=null,this._scope.OnHotelsReady(),this._hotelDeleting=!0)},t.prototype.OnHotelLoading=function(){this._scope.$apply(function(){n.Events.Fire(n.Events.Names.Funnel.HotelLoading)})},t.prototype.OnHotelSelected=function(t){var i=this;this._hotelDeleting||this._scope.$apply(function(){i.BookingCallbackContainsError(t)?i.OpenHotelErrorDrawer(t):i.BookingCallbackContainsMixedRoomTypes(t)?i.OpenMixedRoomTypeErrorDrawer():(i._scope.SelectedHotel=i._hotelsDataMapper.ToHotel(t),!i._scope.SelectedHotel||(i._scope.SelectedHotel.HotelLeadGuestInternalId=i.GetDefaultLeadGuestId()),i.UpdateClientBasket(i._scope.SelectedHotel));n.Events.Fire(n.Events.Names.Funnel.HotelUpdated)})},t.prototype.BookingCallbackContainsMixedRoomTypes=function(n){if(!n||!n.hotelRes||n.hotelRes.length===0)return!1;var t=n.hotelRes[0].deposit_required;return!t||t.length===0?!1:t.indexOf("0")!==-1&&t.indexOf("1")!==-1},t.prototype.GetDefaultLeadGuestId=function(){var n=this._funnelPassengerService.GetAdultPassengers();return!!n&&n.length>0?n[0].InternalId:null},t.prototype.OnHotelReady=function(){this._hotelDeleting=!1},t.prototype.SetFlightInformation=function(){var n=this.GetOutboundFlight(),t;if(n){if(this._scope.ArrivalIata=n.ArrivalIata,this._scope.ArrivalTime=n.LocalArrivalTime.Format("HH:mm:ss"),this._scope.CheckinDate=n.LocalArrivalTime.Format("YYYY-MM-DD"),this._scope.DepartureIata=n.DepartureIata,this._scope.DepartureDate=n.LocalDepartureTime.Format("YYYY-MM-DD"),this._scope.DepartureTime=n.LocalDepartureTime.Format("HH:mm:ss"),t=this.GetReturnFlight(),!t){this._scope.CheckoutDate=n.LocalArrivalTime.Date().AddDays(1).Format("YYYY-MM-DD");return}this._scope.CheckoutDate=t.LocalDepartureTime.Format("YYYY-MM-DD")}},t.prototype.SetLocale=function(){this._scope.Currency=this._funnelBasketService.GetCurrencyCode();this._scope.Language=this._hotelsSettings.LanguageCode},t.prototype.SetPageTitle=function(){var r=this._funnelBasketService.GetPrimaryJourneyPair(),i,f;if(!!r){var n=r.OutboundSlot.Flight.ArrivalIata,u=this._routesService.FindCityByIata(n),t="";u?t=u.Name:(i=this._routesService.FindAirportByIata(n),t=i?i.Name:n.toUpperCase());f=this._hotelsSettings.HeaderText.replace("{location}",t);this._titleBarInstance.UpdateHeaderTitle(f)}},t.prototype.SetPassengerComposition=function(){var n=this._funnelBasketService.GetPassengerComposition();this._scope.NumberOfAdults=n.Adults;this._scope.NumberOfChildren=n.Children+n.Infants;this._scope.NumberOfRooms=1},t.prototype.UpdateClientBasket=function(n){var t=this._funnelBasketService.GetBasket(),i=this._hotelsDataMapper.FromHotelToHotelData(n),r=t.Hotel===null&&!!i,u=t.Hotel&&i&&i.Name!==t.Hotel.Name;t.Hotel=i;this._scope.HotelsBasketScreenReader.focus();t.Hotel?r?this._accessibilityService.AlertHotelAddedToBasket(t.Hotel):u?this._accessibilityService.AlertHotelReplacedInBasket(t.Hotel):this._accessibilityService.AlertHotelRoomSelectionChanged(t.Hotel):this._accessibilityService.AlertHotelRemovedFromBasket();this._scope.BookingInpathIframe.contentWindow.focus()},t.prototype.BookingCallbackContainsError=function(n){if(!n||!n.hotelRes||n.hotelRes.length===0)return!1;var t=n.hotelRes[0];return t.error==="1"},t.prototype.OpenHotelErrorDrawer=function(n){var t=n.hotelRes[0].error_message,i={ButtonPlaceholderText:null,OnSelect:function(){},PlaceholderMessage:t},r={SectionKey:"hotel-error-drawer",Parameters:i,AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Hotels,Action:Tracking.EventConstants.Actions.Drawer,IncludeDrawerIdInLabel:!0,IncludePagePathInLabel:!0}};this.OpenDrawerWithOptionsAfterHotelsIFrameAction(r)},t.prototype.OpenMixedRoomTypeErrorDrawer=function(){var n={SectionKey:"hotels-mixed-room-types",AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Hotels,Action:Tracking.EventConstants.Actions.Drawer,IncludeDrawerIdInLabel:!0,IncludePagePathInLabel:!0}};this.OpenDrawerWithOptionsAfterHotelsIFrameAction(n)},t.prototype.OpenDrawerWithOptionsAfterHotelsIFrameAction=function(t){this._scope.FocusIFrameAfterDrawerClosed=!0;this._scope.HotelsBasketScreenReader.focus(0,function(){Utilities.WindowActive.ForceWindowActiveFocus();n.Events.OpenDrawerWithOptions(t)})},t.ControllerName="Funnel_Hotels",t.$inject=["$rootScope","$scope","$timeout","$window","IAnalyticsTracker","Funnel_BasketService","Funnel_JourneyService","FunnelReasonCookie_Service","Funnel_HotelsDataMapper","Sitecore_HotelsSettings","Sitecore_RoutesData","Funnel_AccessibilityService","Funnel_PassengerService","Funnel_BasketHotelsService","Funnel_BasketIconService"],t}();t.Hotels=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this._scope=n;this._scope.HotelCurrency=t.HotelCurrency();this._scope.HotelPrice=t.TotalLocalPrice();this._scope.BasketCurrency=i.GetCurrencyCode();this._scope.BasketHotelPrice=t.TotalBasketPrice();this._scope.AnalyticsAction&&r.TrackEventWithPagePathLabel(Tracking.EventConstants.Categories.Hotels,"Drawer",this._scope.AnalyticsAction+"|")}return n.ControllerName="Funnel_HotelsMessageDrawer",n.$inject=["$scope","Funnel_BasketHotelsService","Funnel_BasketService","IAnalyticsTracker"],n}();n.HotelsMessageDrawer=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._scope=n;this._parameters=n.Section.Options.Parameters;this._funnelBasketService=t;this._funnelPassengerService=i;this._passengerDisplayService=r;this._funnelPassengerService.EnsureAssociations();this._scope.Adults=this._parameters.Adults;this._scope.Infant=this._parameters.Infant;this._scope.InfantDescription=this.InfantDescription.bind(this);this._scope.AdultDescription=this.AdultDescription.bind(this);this._scope.AdultAlreadyHasInfant=this.AdultAlreadyHasInfant.bind(this);this._scope.AdultHasRestrictedSeat=this.AdultHasRestrictedSeat.bind(this);this._scope.AdultAlreadySittingWithThisInfant=this.AdultAlreadySittingWithThisInfant.bind(this);this._scope.SelectAdultForInfant=this.SelectAdultForInfant.bind(this)}return t.prototype.InfantDescription=function(){return this._passengerDisplayService.GetInfantDisplayName(this._scope.Infant,this._parameters.InfantDetailsNumber)},t.prototype.AdultDescription=function(n,t){return this._passengerDisplayService.GetAdultDisplayName(n,t)},t.prototype.AdultAlreadyHasInfant=function(n){var t=this,i=this.GetAssociationsForAdult(n.InternalId).filter(function(n){return n.CarriedInfantId&&n.CarriedInfantId!=t._scope.Infant.InternalId});return i.length>0},t.prototype.AdultHasRestrictedSeat=function(n){return this.GetAssociationsForAdult(n.InternalId).some(function(n){return n.Seat&&n.Seat.IsRestricted})},t.prototype.AdultAlreadySittingWithThisInfant=function(n){var t=this.GetAssociationsForInfant(this._scope.Infant.InternalId);return t.every(function(t){return t.PassengerInternalId==n.InternalId})},t.prototype.SelectAdultForInfant=function(t){var u=this,i=this.GetAssociationsForInfant(this._scope.Infant.InternalId),r;if(i.length==0){console.error("No associations found for infant '"+this._scope.Infant.InternalId+"'. Unable to select the infant.");return}if(this.AdultAlreadySittingWithThisInfant(t)){n.Events.Fire(n.Events.Names.Drawer.Close);return}r=this.GetAssociationsForAdult(t.InternalId);r.forEach(function(n){var t=null;n.CarriedInfantId&&(t=n.CarriedInfantId);i.forEach(function(n){n.CarriedInfantId=t});n.CarriedInfantId=u._scope.Infant.InternalId});n.Events.Fire(n.Events.Names.Drawer.Close)},t.prototype.GetAssociationsForAdult=function(n){return this.GetFilteredAssociations(function(t){return t.PassengerInternalId==n})},t.prototype.GetAssociationsForInfant=function(n){return this.GetFilteredAssociations(function(t){return t.CarriedInfantId==n})},t.prototype.GetFilteredAssociations=function(n){var t=this._funnelBasketService.GetBasket();return t.Associations.filter(n)},t.ControllerName="Funnel_InfantLapPickerDrawer",t.$inject=["$scope","Funnel_BasketService","Funnel_PassengerService","Common_PassengerDisplayService"],t}();t.InfantLapPickerDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c){this._scope=t;this._funnelCarsSettings=i;this._funnelRootSettings=r;this._funnelService=u;this._passengerService=f;this._carService=e;this._tracker=s;this._funnelBasketService=h;this._funnelBasketBookingDataMapper=c;this._routesService=new Main3.Routes.RoutesService(o);this._scope.UpdateLeadDriverInternalPassengerId=this.UpdateCurrentSelectedPassengerInternalId.bind(this);this._scope.UpdateCarList=this.UpdateCarList.bind(this);this._scope.OpenWhyDriverDetailsDrawer=this.OpenWhyDriverDetailsDrawer.bind(this);this._defaultDriverAge=this._funnelCarsSettings.LeadDriverAgeOptions[0].DropDownOptionData.Value;this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this)}return t.prototype.FunnelReady=function(){var n=this;this._scope.LeadDriverAgeOptions=this.GetAgeOptions(this._funnelCarsSettings.LeadDriverAgeOptions);this._scope.LeadDriverPassengerOptions=this.GetValidPassengers();this.FillInDefaultValues();this._scope.$watch(function(){return n._carService.GetCurrentSearchQuery(n._defaultDriverAge,n.GetBookingDataFromBasket()).AgeOfDriver},function(t){n._scope.LeadDriverDetails.AgeValue=t})},t.prototype.UpdateCarList=function(){this.UpdateCarSearchQuery();this._scope.LoadCars();this.FireChangeLeadDriverTrackingEvent()},t.prototype.UpdateCarSearchQuery=function(){var n=this._carService.GetCurrentSearchQuery(this._defaultDriverAge,this.GetBookingDataFromBasket());n.AgeOfDriver=this._scope.LeadDriverDetails.AgeValue;n.AgeOfDriver!=this._defaultDriverAge&&(n.IsDefault=!1)},t.prototype.FillInDefaultValues=function(){this.InitialiseLeadDriverDetailsIfNull();this.UpdateCurrentSelectedPassengerInternalId()},t.prototype.UpdateCurrentSelectedPassengerInternalId=function(){this._carService.UpdateCurrentSelectedLeadDriverInternalId(this._scope.LeadDriverDetails.PassengerValue.InternalId);this.FireChangeLeadDriverTrackingEvent()},t.prototype.FireChangeLeadDriverTrackingEvent=function(){this._tracker.TrackEvent(Tracking.EventConstants.Categories.Cars,Tracking.EventConstants.Actions.LeadDriver,Tracking.EventConstants.Labels.DriverDetailsChanged)},t.prototype.InitialiseLeadDriverDetailsIfNull=function(){if(!this._scope.LeadDriverDetails){var n=this._carService.GetCurrentSearchQuery(this._defaultDriverAge,this.GetBookingDataFromBasket()),t=this._scope.LeadDriverAgeOptions;this._scope.LeadDriverDetails={PassengerValue:this._scope.LeadDriverPassengerOptions[0].Value,AgeValue:n.AgeOfDriver}}},t.prototype.GetAgeOptions=function(n){return n.map(function(n){return n.DropDownOptionData})},t.prototype.GetValidPassengers=function(){var t=this,i=this._passengerService.GetAdultPassengers(),n=[];return i.forEach(function(i){n.push({DisplayText:t._passengerService.GetDisplayName(i.InternalId),Value:i})}),n},t.prototype.IsValid=function(){return!0},t.prototype.ShouldExitFunnel=function(){return!1},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!1}},t.prototype.OpenWhyDriverDetailsDrawer=function(){n.Events.OpenDrawer("cars-why-driver-details")},t.prototype.GetBookingDataFromBasket=function(){return this._funnelBasketBookingDataMapper.Map(this._funnelBasketService.GetBasket())},t.ControllerName="Funnel_LeadDriverDetails",t.$inject=["$scope","Sitecore_CarsSettingsData","Sitecore_FunnelRootSettings","Funnel_Service","Funnel_PassengerService","Cars_Service","Sitecore_RoutesData","IAnalyticsTracker","Funnel_BasketService","Controls_FunnelBasketBookingDataMapper"],t}();t.LeadDriverDetails=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e){var o=this;this._scope=t;this._funnelPassengerService=i;this._funnelBasketHotelsService=r;this._accessibilityService=u;this._tracker=f;this._window=e;this._scope.GetAdultPassengers=this.GetAdultPassengers.bind(this);this._scope.GetDisplayName=this.GetDisplayName.bind(this);this._scope.GetPassengerAge=this.GetPassengerAge.bind(this);this._scope.OnSelect=this.OnSelect.bind(this);this._scope.$on(n.Events.Names.DrawerSection.Shown,function(){o.TrackOpenDrawerEvent()})}return t.prototype.TrackOpenDrawerEvent=function(){this._tracker.TrackEvent(Tracking.EventConstants.Categories.Hotels,Tracking.EventConstants.Actions.Drawer,this._scope.SitecoreDrawerKey+"|"+this._window.location.pathname)},t.prototype.GetDisplayName=function(n){return this._funnelPassengerService.GetDisplayName(n)},t.prototype.GetPassengerAge=function(n){return this._funnelPassengerService.GetPassengerAge(n)},t.prototype.GetAdultPassengers=function(){return this._funnelPassengerService.GetAdultPassengers()},t.prototype.OnSelect=function(t){var i=this._scope.GetAdultPassengers()[t].InternalId;this._funnelBasketHotelsService.UpdateHotelLeadGuestInternalId(i);this._accessibilityService.QueueAlertLeadHotelGuestUpdated(this.GetDisplayName(i));this._accessibilityService.AlertReviewSectionChangedQueue();this._scope.$emit(n.Events.Names.Drawer.Close)},t.ControllerName="Funnel_LeadGuestDrawer",t.$inject=["$scope","Funnel_PassengerService","Funnel_BasketHotelsService","Funnel_AccessibilityService","IAnalyticsTracker","$window"],t}();t.LeadGuestDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._scope=n;var t=n.CurrentSection.Options.Parameters;this._scope.OldPrice=t.OldPrice;this._scope.NewPrice=t.NewPrice}return n.ControllerName="Funnel_LuggagePriceIncreaseDrawer",n.$inject=["$scope"],n}();n.LuggagePriceIncreaseDrawer=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this._funnelBasketExtrasRemovalService=t;this._scope=n;this._parameters=n.Section.Options.Parameters;this._scope.SelectStandardFares=this.SelectStandardFares.bind(this);this._scope.SelectFlexiFares=this.SelectFlexiFares.bind(this)}return t.prototype.SelectStandardFares=function(){this.CloseDrawerWithUpdatedFareType(n.Data.Common.FlightFareType.Standard)},t.prototype.SelectFlexiFares=function(){this.CloseDrawerWithUpdatedFareType(n.Data.Common.FlightFareType.Flexi);this._funnelBasketExtrasRemovalService.RemoveAllVouchersFromClientBasket()},t.prototype.CloseDrawerWithUpdatedFareType=function(t){this._parameters.FlightFareProperties.FareType=t;this._parameters.Callback(this._parameters.FlightFareProperties);n.Events.Fire(n.Events.Names.Drawer.Close)},t.ControllerName="Funnel_MixedFareTypesDrawer",t.$inject=["$scope","Funnel_BasketExtrasRemovalService"],t}();t.MixedFareTypesDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r){var u=this;this._scope=t;this._funnelService=i;this._funnelBasketService=r;this._scope.NifNumberChanged=this.NifNumberChanged.bind(this);this._scope.OnSubmit=this.OnSubmit.bind(this);this._scope.$on(n.Events.Names.DrawerSection.Shown,function(){u._parameters=u._scope.CurrentSection.Options.Parameters;u._scope.FormSubmitted=!1;u._scope.NifNumber=""})}return t.prototype.NifNumberChanged=function(){this.DisplayValidationError(!1)},t.prototype.OnSubmit=function(){if(this._scope.FormSubmitted=!0,this.DisplayValidationError(!1),this._scope.NifNumberForm.nifNumber.$valid){var t=this.CheckPassengersForDuplicateNumber(this._scope.NifNumber);t?this.DisplayValidationError(!0):(this._parameters.SetNifNumber(this._scope.NifNumber),this._scope.$emit(n.Events.Names.Drawer.Close))}},t.prototype.CheckPassengersForDuplicateNumber=function(n){var t=this._funnelBasketService.GetBasket().Passengers;return t.some(function(t){return t.NifNumber===n})},t.prototype.DisplayValidationError=function(n){this._scope.IsDuplicateNumber=n},t.ControllerName="Funnel_NifNumberDrawer",t.$inject=["$scope","Funnel_Service","Funnel_BasketService"],t}();t.NifNumberDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c,l,a,v){this._qService=t;this._scope=i;this._accessibilityService=r;this._analyticsTracker=u;this._funnelBasketHotelsService=f;this._funnelTravelInsuranceBasketService=e;this._funnelBasketService=o;this._funnelJourneyCookieService=s;this._funnelPassengerService=h;this._funnelService=c;this._passengerSettings=l;this._priceService=a;this._funnelBasketUpdateService=v;this._scope.AcceptedChildOnlyBookingConditions=!1;this._scope.IsChildOnlyBooking=this.IsChildOnlyBooking.bind(this);this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this);this._scope.$emit(n.Events.Names.EditableControls.RegisterControl,this)}return t.prototype.FunnelReady=function(){this.SetScopeBasedOnBasket()},t.prototype.IsValid=function(){var n=this.AdultsAreValid()&&this.ChildrenAreValid()&&this.InfantsAreValid();return this.IsChildOnlyBooking()?n&&this._scope.AcceptedChildOnlyBookingConditions:n},t.prototype.Save=function(){var n=this,t,i;return this.PricesChangedFromAChildBeingMadeAnAdult()?(t=this.InsuredChildWithTravelInsurancePolicyHasChangedToAdult(),i=this.FlightPriceChangedFromAChildBeingMadeAnAdult(),t&&this._funnelTravelInsuranceBasketService.RemoveSelectedPolicy(),this.SavePassengerDetails().then(function(){return n.SaveSeatAssignments()}).then(function(){return n.SaveHotel()}).finally(function(){return n.QueueChildToAdultChangeDrawers(i,t)})):this.SavePassengerDetails().then(function(){return n.SaveSeatAssignments()}).then(function(){return n.SaveHotel()})},t.prototype.ShouldExitFunnel=function(){return!1},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!1}},t.prototype.SetScopeBasedOnBasket=function(){var n=this._funnelBasketService.GetBasket();this._scope.AdultPassengers=n.Passengers.filter(this.IsAdult);this._scope.ChildPassengers=n.Passengers.filter(this.IsChild);this._scope.CarriedInfants=n.CarriedInfants;this._scope.Associations=n.Associations},t.prototype.QueueChildToAdultPriceChangeDrawer=function(){var t=this,i={SectionKey:"child-changed-to-adult-price-change-drawer",OnConfirmCallback:function(){t.SetFocusAfterChildToAdultDrawerClose();n.Events.Fire(n.Events.Names.Drawer.Close)}};n.Events.QueueDrawerWithOptions(i)},t.prototype.QueueChildToAdultChangeDrawers=function(n,t){n&&this.QueueChildToAdultPriceChangeDrawer();t&&this.QueueChildToAdultTravelInsuranceChangeDrawer()},t.prototype.QueueChildToAdultTravelInsuranceChangeDrawer=function(){var t=this,i={OnAccept:function(){},OnReject:function(){t.SetFocusAfterChildToAdultDrawerClose();n.Events.Fire(n.Events.Names.Drawer.Close)},StyleSecondButtonAsDismissOption:!0},r={SectionKey:"child-changed-to-adult-travel-insurance-change-drawer",Parameters:i,AnalyticsOptions:{Category:Tracking.EventConstants.Categories.TravelInsurance,Action:Tracking.EventConstants.Actions.Change,Label:Tracking.EventConstants.Labels.ChangeChildToAdult}};n.Events.QueueDrawerWithOptions(r)},t.prototype.PricesChangedFromAChildBeingMadeAnAdult=function(){return this.AnyChildHasAdultAge()&&(this.FlightPriceChangedFromAChildBeingMadeAnAdult()||this.ChildrenWithTravelInsuranceInBasket())},t.prototype.FlightPriceChangedFromAChildBeingMadeAnAdult=function(){return this._funnelBasketService.AnyFlightsHaveHigherAdultPriceThanChildPrice()},t.prototype.ChildrenWithTravelInsuranceInBasket=function(){var n=this,t=this.GetChildrenWithAdultAges();return t.some(function(t){return n._funnelTravelInsuranceBasketService.PassengerHasTravelInsurance(t)})},t.prototype.InsuredChildWithTravelInsurancePolicyHasChangedToAdult=function(){var t=!1,i=this.GetChildrenWithAdultAges().map(function(n){return n.InternalId}),n=this._funnelTravelInsuranceBasketService.GetTravelInsuranceFromClientBasket();return!n||!n.InsuredPassengers||i.forEach(function(i){n.InsuredPassengers.some(function(n){return n.InternalPassengerId===i})&&(t=!0)}),t},t.prototype.AnyChildHasAdultAge=function(){var n=this;return this._scope.ChildPassengers.some(function(t){return n._funnelPassengerService.PassengerShouldBeAnAdultBasedOnAge(t.Age)})},t.prototype.GetChildrenWithAdultAges=function(){var n=this;return this._scope.ChildPassengers.filter(function(t){return n._funnelPassengerService.PassengerShouldBeAnAdultBasedOnAge(t.Age)})},t.prototype.SavePassengerDetails=function(){this.UpdatePassengerTypesBasedOnAge();var n=this._scope.CarriedInfants.concat(this._scope.ChildPassengers).concat(this._scope.AdultPassengers);return this._funnelService.UpdatePassengerDetails(n)},t.prototype.UpdatePassengerTypesBasedOnAge=function(){var i=this,t=this.GetChildrenWithAdultAges();t.length>0&&(t.forEach(function(t){t.Type=n.Data.Common.PassengerDataType.Adult;i._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.PassengerDetails,Tracking.EventConstants.Actions.AgeChange,Tracking.EventConstants.Labels.ChangeChildToAdult)}),this._funnelPassengerService.OrderPassengers(),this.SetScopeBasedOnBasket(),this._funnelBasketUpdateService.UpdatePassengerCompositionInJourneyCookie(),Utilities.ScreenReader.QueueAlert(this._passengerSettings.ChildChangedToAdultScreenreaderText,"savedThisSectionNow"))},t.prototype.SaveSeatAssignments=function(){return this._funnelService.UpdateSeatAssignments(this._scope.Associations)},t.prototype.SaveHotel=function(){return this._funnelBasketHotelsService.SaveHotel()},t.prototype.AdultsAreValid=function(){return this._scope.AdultPassengers&&this._scope.AdultPassengers.every(function(n){return!!n.Age&&!!n.FirstName&&!!n.LastName&&!!n.Title})},t.prototype.ChildrenAreValid=function(){return this._scope.ChildPassengers&&this._scope.ChildPassengers.every(function(n){return!!n.Age&&!!n.FirstName&&!!n.LastName&&!!n.Title})},t.prototype.InfantsAreValid=function(){return this._scope.CarriedInfants&&this._scope.CarriedInfants.every(function(n){return!!n.Age&&!!n.FirstName&&!!n.LastName&&!!n.Title})},t.prototype.IsAdult=function(t){return t.Type===n.Data.Common.PassengerDataType.Adult},t.prototype.IsChild=function(t){return t.Type===n.Data.Common.PassengerDataType.Child},t.prototype.IsChildOnlyBooking=function(){var n=this;return this._scope.ChildPassengers&&this._scope.AdultPassengers?this._scope.ChildPassengers.length>0&&this._scope.ChildPassengers.every(function(t){return!t.Age||!n._funnelPassengerService.PassengerShouldBeAnAdultBasedOnAge(t.Age)})&&this._scope.AdultPassengers.length===0:!1},t.prototype.SetFocusAfterChildToAdultDrawerClose=function(){var n=this._scope.$parent;n.SetFocusOnContinue()},t.ControllerName="Funnel_PassengerDetails",t.$inject=["$q","$scope","Funnel_AccessibilityService","IAnalyticsTracker","Funnel_BasketHotelsService","Funnel_TravelInsuranceBasketService","Funnel_BasketService","FunnelJourneyCookie_Service","Funnel_PassengerService","Funnel_Service","Sitecore_PassengerSettings","Common_PriceService","Funnel_BasketUpdateService"],t}();t.PassengerDetails=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f,e){this._scope=n;this._passengerDisplayService=t;this._funnelPassengerService=i;this._funnelBasketService=r;this._funnelBasketHotelsService=u;this._funnelVouchersAssociationsService=f;this._analyticsTracker=e;this._suppressEjPlusResetNextTimeLastNameChanges=!1;this._scope.GetAdultNameForInfant=this.GetAdultNameForInfant.bind(this);this._scope.GetInputId=this.GetInputId.bind(this);this._scope.GetTitleDropDownOptions=this.GetTitleDropDownOptions.bind(this);this._scope.GetAgeDropDownOptions=this.GetAgeDropDownOptions.bind(this);this._scope.SelectLapForInfant=this.SelectLapForInfant.bind(this);this._scope.IsSelectLapForInfantEnabled=this.IsSelectLapForInfantEnabled.bind(this);this._scope.IsCopyFromBookersDetailsEnabled=this.IsCopyFromBookersDetailsEnabled.bind(this);this._scope.CopyPassengerDetails=this.CopyPassengerDetails.bind(this);this._scope.IsCarLeadDriver=this.IsCarLeadDriver.bind(this);this._scope.AddEjPlus=this.AddEjPlus.bind(this);this._scope.RemoveEjPlus=this.RemoveEjPlus.bind(this);this._scope.NifNumberEnabled=this.ShouldShowNifNumber();this._scope.AddNifNumber=this.AddNifNumber.bind(this);this._scope.RemoveNifNumber=this.RemoveNifNumber.bind(this);this.GetCarName();this._scope.IsHotelLeadGuest=this.IsHotelLeadGuest.bind(this);this._scope.PassengerHasTravelInsurance=this.PassengerHasTravelInsurance.bind(this);this._scope.PassengerHasInFlightVouchers=this.PassengerHasInFlightVouchers.bind(this);this.WatchForLastNameChanges()}return t.prototype.WatchForLastNameChanges=function(){var n=this;this._scope.$watch(function(n){return n.Passenger.LastName},function(t,i){t===i||n._suppressEjPlusResetNextTimeLastNameChanges||(n._scope.Passenger.EjPlusNumber=null);n._suppressEjPlusResetNextTimeLastNameChanges=!1})},t.prototype.IsHotelLeadGuest=function(n){return this._funnelBasketHotelsService.IsHotelLeadGuest(n)},t.prototype.GetAdultNameForInfant=function(){var n=this._funnelPassengerService.GetAdultForInfant(this._scope.Passenger.InternalId);return n?this._funnelPassengerService.GetDisplayName(n.InternalId):""},t.prototype.GetInputId=function(n){var t=this._scope.IsAdult?"adult":this._scope.IsChild?"child":this._scope.IsInfant?"infant":"";return n+"-"+t+"-"+this._scope.PassengerDetailsNumber},t.prototype.GetTitleDropDownOptions=function(){var n=[],t;return this._scope.IsAdult&&(n=this._passengerDisplayService.GetAdultTitleDropDownOptions()),this._scope.IsChild&&(n=this._passengerDisplayService.GetChildTitleDropDownOptions()),this._scope.IsInfant&&(n=this._passengerDisplayService.GetInfantTitleDropDownOptions()),t=n.length===1,t&&(this._scope.Passenger.Title=n[0].Value),this._scope.AreTitleOptionsDisabled=t,n},t.prototype.GetAgeDropDownOptions=function(){var n=[];return this._scope.IsAdult?n=this._passengerDisplayService.GetAdultAgeOptions():this._scope.IsChild?n=this._passengerDisplayService.GetChildAgeOptions():this._scope.IsInfant&&(n=this._passengerDisplayService.GetInfantAgeOptions()),this._scope.AreAgeOptionsDisabled=n.length===1,this._scope.AreAgeOptionsDisabled&&(this._scope.Passenger.Age=n[0].Value),n},t.prototype.IsSelectLapForInfantEnabled=function(){return this._scope.Adults.length>1},t.prototype.SelectLapForInfant=function(){var t={Adults:this._scope.Adults,Infant:this._scope.Passenger,InfantDetailsNumber:this._scope.PassengerDetailsNumber};n.Events.OpenDrawerWithOptions({SectionKey:"funnel-infant-lap-picker-drawer",Parameters:t})},t.prototype.IsCopyFromBookersDetailsEnabled=function(){return this.HasBookerDetails()&&(this.IsFirstAdult()||this.IsFirstChildWithNoAdults())},t.prototype.PassengerHasTravelInsurance=function(n){return this._funnelPassengerService.PassengerHasTravelInsurance(n)},t.prototype.PassengerHasInFlightVouchers=function(n){return this._funnelVouchersAssociationsService.PassengerHasInFlightVouchers(n.InternalId)},t.prototype.CopyPassengerDetails=function(n){n.preventDefault();var t=this.GetBookerDetails(),i=this._scope.$parent.PassengerDetailsForm,r=i[this.GetInputId("title-dropdown")],u=i[this.GetInputId("firstname-textbox")],f=i[this.GetInputId("lastname-textbox")],e=this._scope.Passenger.LastName!==t.LastName;r.$setViewValue(t.Title);r.$setTouched();r.$render();u.$setViewValue(t.FirstName);u.$setTouched();u.$render();f.$setViewValue(t.LastName);f.$setTouched();f.$render();this.ShouldAssignEjPlusNumberToPassenger(t.EjPlusNumber)&&(this._scope.Passenger.EjPlusNumber=t.EjPlusNumber,e&&(this._suppressEjPlusResetNextTimeLastNameChanges=!0));this._scope.ShowAgeSmartMessage();this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.Actions.PassengerDetails,Tracking.EventConstants.Labels.UseMemberDetails)},t.prototype.ShouldAssignEjPlusNumberToPassenger=function(n){return!!n&&!this.IsEjPlusNumberUsedByOtherPassenger(n)},t.prototype.IsEjPlusNumberUsedByOtherPassenger=function(n){var t=this._funnelBasketService.GetBasket().Passengers;return t.some(function(t){return t.EjPlusNumber===n})},t.prototype.IsCarLeadDriver=function(){var n=this._funnelBasketService.GetBasket();return!!n&&!!n.Car?this._scope.Passenger.InternalId===n.Car.LeadDriverPassengerInternalId:!1},t.prototype.GetCarName=function(){var n=this._funnelBasketService.GetBasket();!n||!n.Car||(this._scope.CarName=n.Car.CarName)},t.prototype.HasBookerDetails=function(){var n=this.GetBookerDetails();return n&&n.FirstName&&n.LastName&&n.Title?!0:!1},t.prototype.GetBookerDetails=function(){var n=this._funnelBasketService.GetBasket();return n.BookerDetails},t.prototype.IsFirstAdult=function(){return this._scope.IsAdult&&this._scope.PassengerDetailsNumber===1},t.prototype.IsFirstChildWithNoAdults=function(){var n=this._funnelBasketService.GetPassengerComposition();return n.Adults===0?this._scope.IsChild&&this._scope.PassengerDetailsNumber===1:!1},t.prototype.AddEjPlus=function(){var t=this,i;this._scope.EjPlusNumberSetFocusDelete=!1;this._scope.EjPlusNumberSetFocusAdd=!1;i={PassengerName:this._funnelPassengerService.GetDisplayName(this._scope.Passenger.InternalId),PassengerLastName:this._scope.Passenger.LastName,IsEjPlusNumberUsedByOtherPassenger:this.IsEjPlusNumberUsedByOtherPassenger.bind(this),SetCardNumber:function(n){t._scope.Passenger.EjPlusNumber=n;t._scope.EjPlusNumberSetFocusDelete=!0}};n.Events.OpenDrawerWithOptions({SectionKey:"passenger-details-ej-plus-drawer",Parameters:i})},t.prototype.RemoveEjPlus=function(){this._scope.Passenger.EjPlusNumber=null;this._scope.EjPlusNumberSetFocusAdd=!0},t.prototype.ShouldShowNifNumber=function(){return this._scope.Passenger.Type!==n.Data.Common.PassengerDataType.Infant&&this.RouteIsValidForNifNumber()},t.prototype.RouteIsValidForNifNumber=function(){var t=this._funnelBasketService.GetFlights(),n=!1,i=this._passengerDisplayService.NifSettings().ValidRoutes.split(",").map(function(n){return n.toUpperCase().trim()});return t.forEach(function(t){var r=t.DepartureIata.toUpperCase()+"-"+t.ArrivalIata.toUpperCase();i.indexOf(r)>-1&&(n=!0)}),n},t.prototype.AddNifNumber=function(){var t=this,i;this._scope.NifNumberSetFocusDelete=!1;this._scope.NifNumberSetFocusAdd=!1;i={SetNifNumber:function(n){t._scope.Passenger.NifNumber=n;t._scope.NifNumberSetFocusDelete=!0}};n.Events.OpenDrawerWithOptions({SectionKey:"passenger-details-nif-drawer",Parameters:i})},t.prototype.RemoveNifNumber=function(){this._scope.Passenger.NifNumber=null;this._scope.NifNumberSetFocusAdd=!0},t.$inject=["$scope","Common_PassengerDisplayService","Funnel_PassengerService","Funnel_BasketService","Funnel_BasketHotelsService","Funnel_VouchersAssociationsService","IAnalyticsTracker"],t}();t.PassengerDetailsPerson=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f){var e=this;this._funnelBasketService=i;this._funnelPassengerService=r;this._funnelBasketHotelService=u;this._funnelVouchersAssociationService=f;this._scope=t;this._scope.GetPassengerAge=this.GetPassengerAge.bind(this);this._scope.GetDisplayName=this.GetDisplayName.bind(this);this._scope.HasSpecialServiceRequest=this.HasSpecialServiceRequest.bind(this);this._scope.IsCarLeadDriver=this.IsCarLeadDriver.bind(this);this._scope.IsHotelLeadGuest=this.IsHotelLeadGuest.bind(this);this._scope.PassengerHasTravelInsurance=this.PassengerHasTravelInsurance.bind(this);this._scope.PassengerHasInFlightVouchers=this.PassengerHasInFlightVouchers.bind(this);this._scope.ShouldShowAncillarySummary=this.ShouldShowAncillarySummary.bind(this);this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this);this._scope.$watch(function(){return e._funnelBasketHotelService.GetHotelFromBasket()},this.TriggerReviewSectionEditOnHotelChange.bind(this),!0)}return t.prototype.FunnelReady=function(){var t=this;this.SetBasketPassengers();this.GetCarName();this._scope.$on(n.Events.Names.Basket.PassengersOrdered,function(){t.SetBasketPassengers()})},t.prototype.IsValid=function(){return!0},t.prototype.ShouldExitFunnel=function(){return!1},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!1}},t.prototype.ShouldShowAncillarySummary=function(n){return!!n.EjPlusNumber||this.HasSpecialServiceRequest(n)||this.IsHotelLeadGuest(n)||this.IsCarLeadDriver(n)||this.PassengerHasTravelInsurance(n)||this.PassengerHasInFlightVouchers(n)},t.prototype.TriggerReviewSectionEditOnHotelChange=function(n,t){if(!!t&&!!n){var i=this._scope.$parent;!i||!i.TriggerEdit||i.TriggerEdit()}},t.prototype.GetPassengerAge=function(n){return this._funnelPassengerService.GetPassengerAge(n)},t.prototype.GetDisplayName=function(n){return this._funnelPassengerService.GetDisplayName(n)},t.prototype.PassengerHasTravelInsurance=function(n){return this._funnelPassengerService.PassengerHasTravelInsurance(n)},t.prototype.PassengerHasInFlightVouchers=function(n){return this._funnelVouchersAssociationService.PassengerHasInFlightVouchers(n.InternalId)},t.prototype.IsCarLeadDriver=function(n){var t=this._funnelBasketService.GetBasket();return!!t&&!!t.Car?n.InternalId===t.Car.LeadDriverPassengerInternalId:!1},t.prototype.GetCarName=function(){var n=this._funnelBasketService.GetBasket();!n||!n.Car||(this._scope.CarName=n.Car.CarName)},t.prototype.IsHotelLeadGuest=function(n){return this._funnelBasketHotelService.IsHotelLeadGuest(n)},t.prototype.HasSpecialServiceRequest=function(n){return(n.SpecialServiceRequestCodes||[]).length>0},t.prototype.SetBasketPassengers=function(){var n=this._funnelBasketService.GetBasket();this._scope.BasketPassengers=n.Passengers;this._scope.BasketInfants=n.CarriedInfants},t.ControllerName="Funnel_PassengerDetailsSummary",t.$inject=["$scope","Funnel_BasketService","Funnel_PassengerService","Funnel_BasketHotelsService","Funnel_VouchersAssociationsService"],t}();t.PassengerDetailsSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._scope=n;this._timeout=t;this._passengerService=i;this._passengerSsrOptions=r;this._scope.ShowEditView=!1;this._scope.Passenger.SpecialServiceRequestCodes=this._scope.Passenger.SpecialServiceRequestCodes||[];this._scope.HasSsrCodes=this.HasSsrCodes.bind(this);this._scope.SwitchToEditView=this.SwitchToEditView.bind(this);this._scope.PassengerHasSsrCode=this.PassengerHasSsrCode.bind(this);this._scope.ToggleSsrCode=this.ToggleSsrCode.bind(this);this._scope.ToggleWheelchairCode=this.ToggleWheelchairCode.bind(this);this._scope.ConfirmClick=this.ConfirmClick.bind(this);this._scope.CancelClick=this.CancelClick.bind(this)}return t.prototype.HasSsrCodes=function(){return this._scope.Passenger.SpecialServiceRequestCodes.length>0},t.prototype.SwitchToEditView=function(){this.ChangeView(!0,this._scope.SetFocusOnEdit)},t.prototype.PassengerHasSsrCode=function(){for(var t,r=this,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];return t=!1,i.forEach(function(n){r._scope.Passenger.SpecialServiceRequestCodes.indexOf(n)>-1&&(t=!0)}),t},t.prototype.ToggleSsrCode=function(n,t,i){n.stopPropagation();$jq(n.target).focus();this.PassengerDoesntHaveSsrCodeAndConfirmationDrawerRequired(t,i)?(n.preventDefault(),this.OpenConfirmationDrawer(t,i)):this.UpdateSsrCode(t)},t.prototype.ToggleWheelchairCode=function(t,i,r,u){var e=this,f;t.stopPropagation();$jq(t.target).focus();this.PassengerHasSsrCode(i,r,u)?(this.RemoveSsrRequestFromPassenger(i),this.RemoveSsrRequestFromPassenger(r),this.RemoveSsrRequestFromPassenger(u)):(t.preventDefault(),f={PassengerName:this._passengerService.GetDisplayName(this._scope.Passenger.InternalId),ApiValueCabinCapable:i,ApiValueStairsCapable:r,ApiValueWithCompanion:u,OnSetSsrCodeAndAccept:function(t){e.AddSsrRequestForPassenger(t);n.Events.Fire(n.Events.Names.Drawer.Close)},OnReject:function(){n.Events.OpenDrawer("ssr-failed")}},n.Events.OpenDrawerWithOptions({SectionKey:"ssr-wheelchair",Parameters:f}))},t.prototype.PassengerDoesntHaveSsrCodeAndConfirmationDrawerRequired=function(n,t){return!this.PassengerHasSsrCode(n)&&t?!0:!1},t.prototype.OpenConfirmationDrawer=function(t,i){var r=this,u={PassengerName:this._passengerService.GetDisplayName(this._scope.Passenger.InternalId),OnAccept:function(){r.AddSsrRequestForPassenger(t);n.Events.Fire(n.Events.Names.Drawer.Close)},OnReject:function(){n.Events.OpenDrawer("ssr-failed")}};n.Events.OpenDrawerWithOptions({SectionKey:i,Parameters:u})},t.prototype.UpdateSsrCode=function(n){this.PassengerHasSsrCode(n)?this.RemoveSsrRequestFromPassenger(n):this.AddSsrRequestForPassenger(n)},t.prototype.RemoveSsrRequestFromPassenger=function(n){var t=this._scope.Passenger.SpecialServiceRequestCodes.indexOf(n);t>-1&&this._scope.Passenger.SpecialServiceRequestCodes.splice(t,1)},t.prototype.AddSsrRequestForPassenger=function(n){this._scope.Passenger.SpecialServiceRequestCodes.push(n)},t.prototype.CancelClick=function(){this._scope.Passenger.SpecialServiceRequestCodes=[];this.ChangeView(!1,this._scope.SetFocusOnConfirmOrCancel);this.NoSsrsAttachedAccessibilityAlert()},t.prototype.NoSsrsAttachedAccessibilityAlert=function(){if(!!this._passengerSsrOptions.NoSsrScreenReaderTextForPassenger){var n=this.GetPassengerName(),t=this._passengerSsrOptions.NoSsrScreenReaderTextForPassenger.replace("{passenger}",n);Utilities.ScreenReader.Alert(t,"passengerNoSsrAlert")}},t.prototype.GetPassengerName=function(){return this._passengerService.GetDisplayName(this._scope.Passenger.InternalId)},t.prototype.ConfirmClick=function(){this.ChangeView(!1,this._scope.SetFocusOnConfirmOrCancel);this.ConfirmClickAccessibilityAlert()},t.prototype.ConfirmClickAccessibilityAlert=function(){var n=this.CreateListOfPassengerSsrs(),t,i;n?!this._passengerSsrOptions.SsrScreenReaderTextForPassenger||(t=this.GetPassengerName(),i=this._passengerSsrOptions.SsrScreenReaderTextForPassenger.replace("{passenger}",t).replace("{ssrs}",n),Utilities.ScreenReader.Alert(i,"passengerUpdateSsrAlert")):this.NoSsrsAttachedAccessibilityAlert()},t.prototype.CreateListOfPassengerSsrs=function(){for(var n,i=[],t=0,r=this._passengerSsrOptions.Options;t<r.length;t++)n=r[t],(this._scope.PassengerHasSsrCode(n.ApiValue)||this.PassengerHasAssociatedWheelchairApiValues(n))&&i.push(n.Text);return i.join(", ")},t.prototype.PassengerHasAssociatedWheelchairApiValues=function(n){return this._scope.PassengerHasSsrCode(n.ApiValueStairsCapable)||this._scope.PassengerHasSsrCode(n.ApiValueCabinCapable)||this._scope.PassengerHasSsrCode(n.ApiValueWithCompanion)},t.prototype.ChangeView=function(n,t){this._scope.ShowEditView=n;this._timeout(function(){t()})},t.$inject=["$scope","$timeout","Funnel_PassengerService","Sitecore_FunnelPassengerSsrOptions"],t}();t.PassengerSsrOptions=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut){this._rootScope=t;this._scope=i;this._timeout=r;this._accountService=u;this._funnelBasketService=f;this._funnelService=e;this._paymentCardSettings=o;this._paymentMethodSettings=s;this._paymentPageSettings=h;this._smartMessageService=c;this._analyticsTracker=l;this._sepaPaymentService=a;this._errorService=v;this._paymentHotelsService=p;this._funnelTravelInsuranceBasketService=w;this._funnelRootSettings=b;this._funnelJourneyService=k;this._navigationService=d;this._popUnderService=g;this._confirmationPageSettings=nt;this._flightTaxCalculator=tt;this._funnelHotelsBasketService=it;this._airPlusCookieService=rt;this._airPlusSettings=ut;this._allowDuplicateBooking=!1;this._hasBeenEditable=!1;this._allowedPaymentMethods=[];this._scope.NewPaymentCard=this.CreateEmptyPaymentCard();this._scope.SavedPaymentCard=this.CreateEmptyPaymentCard();this._scope.SepaPaymentDetails=this.CreateEmptySepaPayment();this._scope.IsPaymentProcessing=!1;this._scope.CanFinalise=this.CanFinalise.bind(this);this._scope.Finalise=this.Finalise.bind(this);this._scope.GovernmentTaxesTotalPrice=this.GovernmentTaxesTotalPrice.bind(this);this._scope.ShowSecurityNumberSmartMessageForSavedCard=this.ShowSecurityNumberSmartMessageForSavedCard.bind(this);this._scope.ShowSecurityNumberSmartMessageForNewCard=this.ShowSecurityNumberSmartMessageForNewCard.bind(this);this._scope.HideSecurityNumberSmartMessage=this.HideSecurityNumberSmartMessage.bind(this);this._scope.BasketContainsTravelInsurance=this.BasketContainsTravelInsurance.bind(this);this._scope.OnlyOnePaymentMethod=this.OnlyOnePaymentMethod.bind(this);this._scope.PaymentMethods=n.Data.Funnel.PaymentMethod;this._rootScope.$on(n.Events.Names.Basket.SetPrice,this.PriceUpdated.bind(this));this._scope.$emit(n.Events.Names.EditableControls.RegisterEditableControl,this);this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this);y.HideAllIcons()}return t.prototype.FunnelReady=function(){var i=this,t;this.InitialisePaymentSelection();this.InitialiseHotelPaymentsDrawer();this._rootScope.$on(n.Events.Names.Funnel.ReFinalise,function(){i.ReFinalise()});this._rootScope.$on(n.Events.Names.Funnel.ReFinaliseAllowDuplicateBooking,function(){i._allowDuplicateBooking=!0;i.ReFinalise()});this._scope.$on(n.Events.Names.Funnel.SecurePaymentSuccess,this.FinalizeSecurePaymentComplete.bind(this));this._funnelTravelInsuranceBasketService.HasTravelInsuranceInClientBasket()&&(t=this._funnelTravelInsuranceBasketService.GetTravelInsuranceFromClientBasket().Policy,t?(this._scope.TravelInsuranceFirstTermsConditionsLink=t.FirstProductTermsLink,this._scope.TravelInsuranceSecondTermsConditionsLink=t.SecondProductTermsLink):(this._scope.TravelInsuranceFirstTermsConditionsLink="",this._scope.TravelInsuranceSecondTermsConditionsLink=""))},t.prototype.IsValid=function(){return!1},t.prototype.ShouldExitFunnel=function(){var n=this._funnelBasketService.GetBasket(),t=n&&n.Passengers.length>0&&this._funnelBasketService.GetFlights().length>0;return!t},t.prototype.GetStepOnLoadRedirect=function(){return this._funnelJourneyService.GetStepOnLoadInvalidFlightRedirect(Tracking.EventConstants.Categories.Checkout)},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!1}},t.prototype.IsEditing=function(){return!1},t.prototype.BasketContainsTravelInsurance=function(){return this._funnelTravelInsuranceBasketService.HasTravelInsuranceInClientBasket()},t.prototype.SetEditable=function(n){var t=this;this._scope.AllowEdit=n;n&&(this._scope.$applyAsync(function(){t.UpdateHelpingHand()}),this._hasBeenEditable||(this._hasBeenEditable=!0,this.UpdateFunnelPaymentType()))},t.prototype.SetEditing=function(){},t.prototype.UpdateHelpingHand=function(){if(Main3.Common.BreakPointService.IsBasketAlwaysVisible())this._scope.$emit(n.Events.Names.HelpingHand.ShowText,this._paymentPageSettings.HelpingHandMessage);else{var t=this._paymentPageSettings.HelpingHandWithHiddenBasketMessage;t=t.replace("[",'<button type="button" class="button-link" onclick="AngularEj.Events.Fire(AngularEj.Events.Names.Basket.Show);">');t=t.replace("]","<\/button>");this._scope.$emit(n.Events.Names.HelpingHand.ShowText,t)}},t.prototype.CreateEmptyPaymentCard=function(){return{CardHoldersName:"",CardNumber:"",ExpiryDateMonth:null,ExpiryDateYear:null,IssueNumber:null,SecurityNumber:"",StartDateMonth:null,StartDateYear:null,SavePaymentCard:null,Valid:!1}},t.prototype.CreateEmptySepaPayment=function(){return{AccountHoldersName:"",IBAN:"",AcceptedTermsAndConditions:!1,Valid:!1}},t.prototype.InitialisePaymentSelection=function(){this.SetupSavedPaymentCard();this.InitialiseAllowedPaymentMethods();this.InitialiseSelectedPaymentMethod();this.InitialisePaymentButtons();this.InitialisePaymentButtonActions()},t.prototype.InitialiseHotelPaymentsDrawer=function(){var n=this;this._paymentHotelsService.CheckForHotelPaymentTypes();this._scope.$watch(function(n){return n.EditSectionIsVisible&&!!n.SelectedPaymentMethod},function(t){n.ShowHotelPaymentsDrawer(t)});this._scope.$watch(function(n){return n.NewPaymentCardConfiguration},function(t){n.ShowHotelPaymentsDrawer(!!t,!0)})},t.prototype.ShowHotelPaymentsDrawer=function(t,i){var r=this,u;(i===void 0&&(i=!1),t)&&(u=this.GetCurrentPaymentMethod(),this._paymentHotelsService.ShouldShowHotelPaymentsDrawer(u).then(function(t){t?r._paymentHotelsService.OpenHotelPaymentsDrawer(function(){return r.DeselectPaymentTypes()}):i&&r._scope.$broadcast(n.Events.Names.PaymentCard.ScrollToDetails)}))},t.prototype.GetCurrentPaymentMethod=function(){var i=n.Data.Common.PaymentMethodType.Unknown,t;if(this._scope.SelectedPaymentMethod===n.Data.Funnel.PaymentMethod.SavedCard||this._scope.SelectedPaymentMethod===n.Data.Funnel.PaymentMethod.NewCard){if(t=this._scope.SelectedPaymentMethod===n.Data.Funnel.PaymentMethod.SavedCard?this._scope.SavedPaymentCardConfiguration:this._scope.NewPaymentCardConfiguration,!t)return null;i=t.PaymentMethodType}return i},t.prototype.DeselectPaymentTypes=function(){_(this._scope.NewPaymentCardButtons).filter(function(n){return n.IsSelected}).forEach(function(n){n.IsSelected=!1;n.FocusOverride=!0});this._scope.SelectedPaymentMethod!==n.Data.Funnel.PaymentMethod.NewCard&&(this._scope.SelectedPaymentMethod=n.Data.Funnel.PaymentMethod.None);this._scope.NewPaymentCardConfiguration=null},t.prototype.SetupSavedPaymentCard=function(){var t=this,n=this._funnelBasketService.GetBasket().BookerDetails.SavedPaymentCard;!!n&&this.SavedCardApplicableForRegionAndCurrency(n)&&(this._scope.SavedPaymentCardData=n,this._scope.SavedPaymentCardConfiguration=this._paymentCardSettings.PaymentCards.filter(function(n){return n.B2BCardCode===t._scope.SavedPaymentCardData.CardVendorCode})[0])},t.prototype.InitialisePaymentButtons=function(){this._scope.PaymentMethodButtons=this.GeneratePaymentMethodButtons();this._scope.NewPaymentCardButtons=this.GenerateNewPaymentCardButtons()},t.prototype.InitialisePaymentButtonActions=function(){this._scope.SelectPaymentMethod=this.SelectPaymentMethod.bind(this);this._scope.SelectNewPaymentCard=this.SelectNewPaymentCard.bind(this);this._scope.ShowPaymentMethods=this.ShowPaymentMethods.bind(this)},t.prototype.InitialiseAllowedPaymentMethods=function(){this._allowedPaymentMethods=[n.Data.Funnel.PaymentMethod.NewCard];this._sepaPaymentService.SepaPaymentApplicableForBooking()&&this._allowedPaymentMethods.push(n.Data.Funnel.PaymentMethod.SEPA);!this._scope.SavedPaymentCardData||this._allowedPaymentMethods.push(n.Data.Funnel.PaymentMethod.SavedCard)},t.prototype.InitialiseSelectedPaymentMethod=function(){this._scope.SelectedPaymentMethod=n.Data.Funnel.PaymentMethod.None;this._scope.SavedPaymentCardData?this._scope.SelectedPaymentMethod=n.Data.Funnel.PaymentMethod.SavedCard:this._scope.OnlyOnePaymentMethod()&&(this._scope.SelectedPaymentMethod=n.Data.Funnel.PaymentMethod.NewCard)},t.prototype.ShowSecurityNumberSmartMessageForSavedCard=function(){this._smartMessageService.ShowSmartMessage("security-number-smart-message-saved-card")},t.prototype.ShowSecurityNumberSmartMessageForNewCard=function(){this._smartMessageService.ShowSmartMessage("security-number-smart-message-new-card")},t.prototype.HideSecurityNumberSmartMessage=function(){this._scope.$emit(n.Events.Names.SmartMessaging.Hide)},t.prototype.GeneratePaymentMethodButtons=function(){var t=[],i=this._allowedPaymentMethods.indexOf(n.Data.Funnel.PaymentMethod.SavedCard)>-1,r=this._allowedPaymentMethods.indexOf(n.Data.Funnel.PaymentMethod.NewCard)>-1,u=this._allowedPaymentMethods.indexOf(n.Data.Funnel.PaymentMethod.SEPA)>-1;return i&&t.push(this.BuildPaymentMethodButton(n.Data.Funnel.PaymentMethod.SavedCard,this._paymentMethodSettings.SavedCardText,this._paymentMethodSettings.SavedCardImageUrl,this._paymentMethodSettings.SavedCardActiveImageUrl)),r&&t.push(this.BuildPaymentMethodButton(n.Data.Funnel.PaymentMethod.NewCard,this._paymentMethodSettings.NewCardText,this._paymentMethodSettings.NewCardImageUrl,this._paymentMethodSettings.NewCardActiveImageUrl)),u&&t.push(this.BuildPaymentMethodButton(n.Data.Funnel.PaymentMethod.SEPA,this._paymentMethodSettings.Sepa.ButtonText,this._paymentMethodSettings.Sepa.ButtonImageUrl,this._paymentMethodSettings.Sepa.ButtonActiveImageUrl)),t},t.prototype.BuildPaymentMethodButton=function(t,i,r,u){return{Id:n.Data.Funnel.PaymentMethod.ToString(t),DisplayText:i,ImageUrl:r,ActiveImageUrl:u,IsActive:!1,IsSelected:!1,IsVisible:!0,EqualHeightGroupName:"PaymentMethods",FocusOverride:!1}},t.prototype.GenerateNewPaymentCardButtons=function(){var t=this,n=[];return this._paymentCardSettings.PaymentCards.forEach(function(i){var r={Id:i.B2BCardCode,DisplayText:i.PaymentCardDisplayName,ImageUrl:i.CardBrandImageUrl,ActiveImageUrl:i.CardBrandSelectedImageUrl,IsActive:!1,IsSelected:!1,IsVisible:!!i.B2BCardCode&&t.CardApplicableForRegionAndCurrency(i),EqualHeightGroupName:"NewPaymentCards",FocusOverride:!1};n.push(r)}),n},t.prototype.CardApplicableForRegionAndCurrency=function(n){var t=this,i=n.EnablePaymentCardForCurrencies.length===0||n.EnablePaymentCardForCurrencies.some(function(n){return n===t._funnelBasketService.GetCurrencyCode()});return i&&n.EnabledForRegionalSite},t.prototype.SavedCardApplicableForRegionAndCurrency=function(n){var t=this._paymentCardSettings.PaymentCards.filter(function(t){return t.B2BCardCode===n.CardVendorCode})[0];return this.CardApplicableForRegionAndCurrency(t)},t.prototype.SelectPaymentMethod=function(t,i){this._scope.SelectedPaymentMethod=n.Data.Funnel.PaymentMethod.Parse(i.Id);this.UpdateFunnelPaymentType();this._scope.ResetFocusToTitle=!0},t.prototype.UpdateFunnelPaymentType=function(){var t,i;this._scope.SelectedPaymentMethod===n.Data.Funnel.PaymentMethod.SEPA?this._funnelService.SetPaymentType(n.Data.Common.PaymentType.DebitCard):(t=this._scope.SelectedPaymentMethod===n.Data.Funnel.PaymentMethod.SavedCard?this._scope.SavedPaymentCardConfiguration:this._scope.NewPaymentCardConfiguration,!t||(i=t.CreditCardFeesApply?n.Data.Common.PaymentType.CreditCard:n.Data.Common.PaymentType.DebitCard,this._funnelService.SetPaymentType(i)))},t.prototype.SelectNewPaymentCard=function(n,t){this._scope.NewPaymentCardConfiguration=this._paymentCardSettings.PaymentCards.filter(function(n){return n.B2BCardCode===t.Id})[0];this._scope.NewPaymentCardButtons.forEach(function(n){n.IsSelected=n.Id===t.Id});this.UpdateFunnelPaymentType()},t.prototype.ShowPaymentMethods=function(){this._scope.SelectedPaymentMethod=n.Data.Funnel.PaymentMethod.None;this._scope.ResetFocusToTitle=!0},t.prototype.ReFinalise=function(){var n=this;this._timeout(function(){n.Finalise()},550)},t.prototype.Finalise=function(t){if(t===void 0&&(t=null),this.CanFinalise()){this._scope.IsPaymentProcessing=!0;var u=this._funnelBasketService.GetBasket(),i=!this._accountService.IsSignedIn(),r=this._scope.SelectedPaymentMethod===n.Data.Funnel.PaymentMethod.SavedCard;this._funnelService.FinaliseBasket(this._scope.SelectedPaymentMethod,r?this._scope.SavedPaymentCardConfiguration:this._scope.NewPaymentCardConfiguration,r?this._scope.SavedPaymentCard:this._scope.NewPaymentCard,this._scope.SepaPaymentDetails,this._allowDuplicateBooking,i,i?u.BookerDetails.Password:null,this._funnelRootSettings.SitecoreLanguageCode,t,this.FinaliseErrorCallback.bind(this),this.FinalizeSecurePaymentRequired.bind(this),this.SuccessfullPaymentCallback.bind(this))}else this._scope.$broadcast(n.Events.Names.Validation.Validate)},t.prototype.SuccessfullPaymentCallback=function(){this._airPlusCookieService.RemoveCookie();this.IsUsingAirPlusCard()&&this._airPlusCookieService.SetCookie(!0);this.ShowPopUnderOnConfirmation()?this._funnelJourneyService.RenderPopUnder():this._navigationService.NavigateTo(this._funnelJourneyService.GetContinueToNextStepUrl())},t.prototype.IsUsingAirPlusCard=function(){var t=this._scope.SelectedPaymentMethod===n.Data.Funnel.PaymentMethod.SavedCard,i=t?this._scope.SavedPaymentCard:this._scope.NewPaymentCard,r=this._airPlusSettings.CardDomains.split(",");return t?this._scope.SavedPaymentCardConfiguration.PaymentMethodType===n.Data.Common.PaymentMethodType.UatpAirPlus:r.some(function(n){return i.CardNumber.substr(0,n.length)===n})},t.prototype.ShowPopUnderOnConfirmation=function(){var n=this._funnelHotelsBasketService.HasHotel();return!n&&this._confirmationPageSettings.EnablePopUnderOnPageLoad&&this._popUnderService.ShouldShowPopUnder()},t.prototype.CanFinalise=function(){return!this._scope.IsPaymentProcessing&&this._scope.AcceptedTermsAndConditions&&this.CurrentPaymentFormIsValid()&&!this._funnelService.HasAnyRequestsPending()&&!this._funnelService.CurrencyChangeInProgress()},t.prototype.CurrentPaymentFormIsValid=function(){return this._scope.SelectedPaymentMethod===n.Data.Funnel.PaymentMethod.SavedCard?this._scope.SavedPaymentCard.Valid:this._scope.SelectedPaymentMethod===n.Data.Funnel.PaymentMethod.NewCard?this._scope.NewPaymentCard.Valid:this._scope.SelectedPaymentMethod===n.Data.Funnel.PaymentMethod.SEPA?this._scope.SepaPaymentDetails.Valid:!1},t.prototype.FinaliseErrorCallback=function(t,i,r){this._scope.IsPaymentProcessing=!1;r===n.Data.Rebooking.KnownError.MemberAlreadyExists?this.OpenSignInDrawerWithCurrentEmail("funnel-sign-in-or-sign-up",!1,!0):r===n.Data.Rebooking.KnownError.UserCreationError?this._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.UserCreationKnownError):r===n.Data.Rebooking.KnownError.FailedLoginAfterSuccessfulAddNewMember?this.OpenSignInDrawerWithCurrentEmail("sign-in",!0,!1):n.Services.Account.AccountService.IsSignedIn=n.Data.Account.SignedInStatus.SignedIn},t.prototype.FinalizeSecurePaymentRequired=function(t){this._scope.IsPaymentProcessing=!1;this._scope.SelectedPaymentMethod===n.Data.Funnel.PaymentMethod.SavedCard?this.TriggerSecurePayment(t,this._scope.SavedPaymentCardConfiguration.PaymentCardDisplayName):this._scope.SelectedPaymentMethod===n.Data.Funnel.PaymentMethod.NewCard?this.TriggerSecurePayment(t,this._scope.NewPaymentCardConfiguration.PaymentCardDisplayName):n.Events.OpenDrawerWithOptions({SectionKey:"rebooking-error-drawer"})},t.prototype.TriggerSecurePayment=function(t,i){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Payment,Tracking.EventConstants.Actions.SecurePayment,i);n.Events.Fire(n.Events.Names.Funnel.SecurePaymentStart,t)},t.prototype.FinalizeSecurePaymentComplete=function(n,t){this.Finalise(t)},t.prototype.OpenSignInDrawerWithCurrentEmail=function(t,i,r){var u=this._funnelBasketService.GetBasket(),f={AfterSignIn:function(){n.Events.Fire(n.Events.Names.Drawer.Close)},UserInitiatedSignIn:!1,DisplayMemberExistsError:r,PreFillUsername:u.BookerDetails.Email},e={SectionKey:t,PreventDismissOverride:i,Parameters:f};n.Events.OpenDrawerWithOptions(e);r&&n.Events.Fire(n.Events.Names.Funnel.SignUpMemberExists,u.BookerDetails.Email)},t.prototype.PriceUpdated=function(n,t){this._scope.TotalPrice=t},t.prototype.GovernmentTaxesTotalPrice=function(){return this._flightTaxCalculator.GetBasketTaxes()},t.prototype.OnlyOnePaymentMethod=function(){return this._allowedPaymentMethods.length===1},t.ControllerName="Funnel_Payment",t.$inject=["$rootScope","$scope","$timeout","Account_Service","Funnel_BasketService","Funnel_Service","Sitecore_PaymentCardSettings","Sitecore_PaymentMethodSettings","Payment_PageSettings","SmartMessage_Service","IAnalyticsTracker","Funnel_SepaPaymentService","Funnel_ErrorService","Funnel_BasketIconService","Funnel_PaymentHotelsService","Funnel_TravelInsuranceBasketService","Sitecore_FunnelRootSettings","Funnel_JourneyService","Common_NavigationService","Funnel_PopUnderService","Sitecore_FunnelConfirmationPageSettings","Funnel_FlightTaxCalculator","Funnel_BasketHotelsService","AirPlusCookie_Service","Sitecore_AirPlusSettings"],t}();t.Payment=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e){this._rootScope=t;this._scope=i;this._paymentPageSettings=r;this._priceService=u;this._funnelPriceService=f;this._funnelBasketService=e;this._scope.GetTypeClass=this.GetTypeClass.bind(this);this._scope.OnApproximatePriceClick=this.OnApproximatePriceClick.bind(this);this._rootScope.$on(n.Events.Names.Basket.SetPrice,this.PriceUpdated.bind(this))}return t.prototype.PriceUpdated=function(){this.SetChargeBreakdowns()},t.prototype.GetTypeClass=function(n){return n.Type===0?"easyJet-charge-icon":"hotel-charge-icon"},t.prototype.OnApproximatePriceClick=function(){this._scope.IsIncludedChargeList?n.Events.OpenDrawer("hotels-pay-now-exchange-rate-drawer"):n.Events.OpenDrawer("hotels-pay-later-exchange-rate-drawer")},t.prototype.SetChargeBreakdowns=function(){this._scope.Charges=[];this.ShouldShowAnyCharges()&&(this.AddEasyJetCharges(),this.AddHotelCharges())},t.prototype.ShouldShowAnyCharges=function(){return!!this._funnelBasketService.GetBasket().Hotel},t.prototype.AddEasyJetCharges=function(){if(this._scope.IsIncludedChargeList){var n=this._funnelPriceService.TotalPriceExcludingHotels();this._scope.Charges.push({ApproximatePriceInBasketCurrency:null,Description:this._paymentPageSettings.EasyJetChargesText,LocalCurrencyCode:"",PriceInLocalCurrency:n,Type:0})}},t.prototype.AddHotelCharges=function(){var i=this._funnelBasketService.GetBasket().Hotel,r=this._funnelPriceService.GetPriceOfHotelInBasketCurrency(),u=this._funnelPriceService.GetPriceOfHotelInLocalCurrency(),t={ApproximatePriceInBasketCurrency:this._priceService.Compare(r,u)===0?null:r,Description:"",LocalCurrencyCode:i.LocalCurrencyCode,PriceInLocalCurrency:u,Type:1};i.BookingType!==n.Data.Common.HotelBookingType.BookNowPayLater||this._scope.IsIncludedChargeList?i.BookingType===n.Data.Common.HotelBookingType.BookNowPayNow&&this._scope.IsIncludedChargeList&&(t.Description=this._paymentPageSettings.IncludedHotelChargesText,this._scope.Charges.push(t)):(t.Description=this._paymentPageSettings.ExcludedHotelChargesText,this._scope.Charges.push(t))},t.$inject=["$rootScope","$scope","Payment_PageSettings","Common_PriceService","Funnel_PriceService","Funnel_BasketService"],t}();t.PaymentChargeBreakdown=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f){this._scope=n;this._basketFlightSelectionService=t;this._pageSettings=i;this._analyticsTracker=r;this._basketService=u;this._activePairService=f;var e=this.GetDrawerParameters();this._scope.UnavailableFlights=this.GetUnavailableBasketFlights(e.UnavailableFlights);this._scope.SelectNewFlightsButtonClick=this.SelectNewFlightsButtonClick.bind(this)}return t.prototype.GetDrawerParameters=function(){return this._scope.CurrentSection.Options.Parameters},t.prototype.GetUnavailableBasketFlights=function(n){var i=this,t=[];return!n||this._basketService.GetFlights().forEach(function(r){i.BasketFlightIsUnavailable(r,n)&&t.push(r)}),t},t.prototype.BasketFlightIsUnavailable=function(n,t){return _(t).filter(function(t){return t.ArrivalAirport===n.ArrivalIata&&t.DepartureAirport===n.DepartureIata&&t.FlightNumber===n.FlightNumber&&t.DepartureDateTime.ToSortable()===n.LocalDepartureTime.ToSortable()&&t.ArrivalDateTime.ToSortable()===n.LocalArrivalTime.ToSortable()}).length>0},t.prototype.SelectNewFlightsButtonClick=function(){var t=this,i;i=!!this._scope.UnavailableFlights&&this._scope.UnavailableFlights.length>0?this._basketFlightSelectionService.RemoveFlights(this._scope.UnavailableFlights):this._basketFlightSelectionService.RemoveAllFlights();i.then(function(){t._activePairService.SetFirstIncompleteAsActivePair();t._analyticsTracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.Checkout,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.SoldOutSelectNew,t._pageSettings.SelectNewFlightsButtonTargetUrl)});n.Events.Fire(n.Events.Names.Drawer.Close)},t.ControllerName="Payment_FlightNoLongerAvailableDrawer",t.$inject=["$scope","Funnel_BasketFlightSelectionService","Payment_PageSettings","IAnalyticsTracker","Funnel_BasketService","Funnel_ActivePairService"],t}();t.PaymentFlightNoLongerAvailableDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u,f,e,o){var s,c,h,l;this._funnelFinaliseTravelInsuranceService=e;this._travelInsuranceBasketService=o;this._scope=n;this._funnelService=t;this._pageSettings=i;this._basketService=r;this._priceService=u;this._funnelPriceService=f;this._scope.ShowSpinner=!1;s=this.GetDrawerParameters();s.IsInfantClash?this._funnelService.RemoveAllSeatsFromAllSegments():(this._scope.FlightsAffected=this.BuildAffectedFlightData(s.UnavailableSeats),c=this._funnelPriceService.TotalPrice(),this.RemoveSeatsThatAreUnavailable(),h=this._funnelPriceService.TotalPrice(),l=this._priceService.GetPaymentType(),this._scope.TotalPrice=h[l],this._scope.PriceDecrease=this._priceService.Difference(c,h));this._scope.ContinueBookingButtonClick=this.ContinueBookingButtonClick.bind(this);this._scope.SelectNewSeatsButtonClick=this.SelectNewSeatsButtonClick.bind(this)}return n.prototype.GetDrawerParameters=function(){return this._scope.CurrentSection.Options.Parameters},n.prototype.BuildAffectedFlightData=function(n){var i=this,t=[];return!n||this._basketService.GetFlights().forEach(function(r){var u=i.GetAffectedFlight(r,n),f;!u||(f={BasketFlightAffected:r,Seats:u.Seats},t.push(f))}),t},n.prototype.GetAffectedFlight=function(n,t){return _(t).find(function(t){return t.Flight.ArrivalAirport===n.ArrivalIata&&t.Flight.DepartureAirport===n.DepartureIata&&t.Flight.FlightNumber===n.FlightNumber&&t.Flight.DepartureDateTime.ToSortable()===n.LocalDepartureTime.ToSortable()&&t.Flight.ArrivalDateTime.ToSortable()===n.LocalArrivalTime.ToSortable()})},n.prototype.RemoveSeatsThatAreUnavailable=function(){var n=this.GetAffectedFlightAssociations();n.forEach(function(n){n.Seat=null});this._funnelService.UpdateSeatAssignments(n)},n.prototype.GetAffectedFlightAssociations=function(){var t=this,i=this._basketService.GetBasket().Associations,n=[];return i.forEach(function(i){t._scope.FlightsAffected.forEach(function(t){!i.Seat||i.FlightInternalId===t.BasketFlightAffected.InternalId&&t.Seats.forEach(function(t){i.Seat.SeatNumber===t&&n.push(i)})})}),n},n.prototype.ContinueBookingButtonClick=function(){this._scope.ShowSpinner=!0;this._funnelFinaliseTravelInsuranceService.HandlePriceChange()},n.prototype.SelectNewSeatsButtonClick=function(){this._travelInsuranceBasketService.RemoveSelectedPolicy();window.location.href=this._pageSettings.SelectNewSeatsButtonTargetUrl},n.ControllerName="Payment_SeatNoLongerAvailableDrawer",n.$inject=["$scope","Funnel_Service","Payment_PageSettings","Funnel_BasketService","Common_PriceService","Funnel_PriceService","Funnel_FunnelFinaliseTravelInsuranceService","Funnel_TravelInsuranceBasketService"],n}();n.PaymentSeatNoLongerAvailableDrawer=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._scope=n;this._routesService=new Main3.Routes.RoutesService(t);this._scope.ExpandRoutes=this.ExpandRoutes.bind(this)}return n.prototype.ExpandRoutes=function(n,t){if(this._lastExpandedRoute!==n){var i=this._routesService.GetValidRoutesForMarketGroups(n.OriginIata,n.DestinationIata,n.Date);return i=this.SortRoutes(i,t),this._lastExpandedRoute=n,this._lastExpandedRouteResult=i,i}return this._lastExpandedRouteResult},n.prototype.SortRoutes=function(n,t){var i=this;return n.sort(function(n,r){return i.CompareRoutes(n,r,t)})},n.prototype.CompareRoutes=function(n,t,i){var r=i?n.DestinationIata+":"+n.OriginIata:n.OriginIata+":"+n.DestinationIata,u=i?t.DestinationIata+":"+t.OriginIata:t.OriginIata+":"+t.DestinationIata;return r>u?-1:r<u?1:0},n.ControllerName="Funnel_PickFlightLeg",n.$inject=["$scope","Sitecore_RoutesData"],n}();n.PickFlightLeg=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e){var o=this;this._scope=t;this._funnelService=i;this._funnelJourneyCookieService=r;this._funnelBasketService=u;this._lookAndBookService=f;this._currencyService=e;this.SetBoundingDates();this.SetChosenFlightFares();this._scope.$on(n.Events.Names.Funnel.JourneyCookieRouteUpdated,function(){o.SetChosenFlightFares()});this._scope.$watch(function(n){return n.JourneyPair},function(){o.SetChosenFlightFares()},!0);this._scope.$watch(function(){return o._funnelBasketService.GetFareType()},function(){o.SetChosenFlightFares()});this.WatchForDisplayedRouteChanges();this.WatchForFlexiFareChanges();this.ListenForCurrencyChanges();this.ListenForScrollToEvents();this.SendAnalytics();this.CallLookAndBookService();this._scope.GetSelectedFlightSkipLinkType=this.GetSelectedFlightSkipLinkType.bind(this)}return t.prototype.GetSelectedFlightSkipLinkType=function(){if(!!this._scope.JourneyPair.ReturnSlot){if(!this._scope.JourneyPair.OutboundSlot.Flight)return n.Data.Common.PickFlightsSkipLinkTargetType.Outbound;if(!this._scope.JourneyPair.ReturnSlot.Flight)return n.Data.Common.PickFlightsSkipLinkTargetType.Return}return n.Data.Common.PickFlightsSkipLinkTargetType.Basket},t.prototype.SetChosenFlightFares=function(){var n=null,t=null;this.DisplayedRouteTypeMatchesChosenJourneyPairRouteType()&&(n=this.CreateFareFromSegmentId(this.GetFlightIdFromSlot(this._scope.JourneyPair.OutboundSlot)),t=this.CreateFareFromSegmentId(this.GetFlightIdFromSlot(this._scope.JourneyPair.ReturnSlot)));this._scope.ChosenFlights={OutboundFare:n,ReturnFare:t}},t.prototype.CreateFareFromSegmentId=function(n){var t=this._funnelBasketService.GetFareType();return n!=null&&t!=null?{FareType:t,FlightSegmentId:n}:null},t.prototype.DisplayedRouteTypeMatchesChosenJourneyPairRouteType=function(){return!!this._scope.DisplayedRoutes.ReturnRoute==!!this._scope.JourneyPair.ReturnSlot},t.prototype.GetFlightIdFromSlot=function(n){return n&&n.Flight?n.Flight.SegmentId:null},t.prototype.WatchForDisplayedRouteChanges=function(){this.AddRouteWatch(function(n){return n.DisplayedRoutes.OutboundRoute},!0);this.AddRouteWatch(function(n){return n.DisplayedRoutes.ReturnRoute});this.AddRouteDateWatch(function(n){return n.DisplayedRoutes.OutboundRoute.Date});this.AddRouteDateWatch(function(n){return n.DisplayedRoutes.ReturnRoute?n.DisplayedRoutes.ReturnRoute.Date:null})},t.prototype.WatchForFlexiFareChanges=function(){var n=this;this._scope.$watch(function(n){return n.ShowFlexiFares},function(){n.CallLookAndBookService()})},t.prototype.ListenForCurrencyChanges=function(){var t=this;this._scope.$on(n.Events.Names.Funnel.CurrencyUpdated,function(){t.CallLookAndBookService()})},t.prototype.SetBoundingDates=function(){var n=this;this._scope.JourneyPair.OutboundSlot.Flight&&(this._scope.MinimumDate=this._scope.JourneyPair.OutboundSlot.Flight.LocalDepartureTime);this._scope.JourneyPair.ReturnSlot&&this._scope.JourneyPair.ReturnSlot.Flight&&(this._scope.MaximumDate=this._scope.JourneyPair.ReturnSlot.Flight.LocalArrivalTime);this._scope.$watch(function(n){return n.JourneyPair.OutboundSlot.Flight?n.JourneyPair.OutboundSlot.Flight.LocalArrivalTime:null},function(t){n._scope.MinimumDate=t});this._scope.$watch(function(n){return n.JourneyPair.ReturnSlot&&n.JourneyPair.ReturnSlot.Flight?n.JourneyPair.ReturnSlot.Flight.LocalDepartureTime:null},function(t){n._scope.MaximumDate=t})},t.prototype.AddRouteWatch=function(n,t){var i=this;t===void 0&&(t=!1);this._scope.$watch(n,function(n,r){i.SetChosenFlightFares();(!i.DisplayedRouteTypeMatchesChosenJourneyPairRouteType()||r&&n&&!i.AreSameRoutes(n,r))&&(i._scope.MinimumDate=null,i._scope.MaximumDate=null,t&&i.SendAnalytics())})},t.prototype.AddRouteDateWatch=function(n){var t=this;this._scope.$watch(n,function(n){n&&t.CallLookAndBookService()})},t.prototype.AreSameRoutes=function(n,t){return n.DestinationIata==t.DestinationIata&&n.OriginIata==t.OriginIata},t.prototype.SendAnalytics=function(){this._funnelService.SendSiteSearchAnalytics(this._scope.DisplayedRoutes.OutboundRoute,this._scope.DisplayedRoutes.OutboundRoute.Date,this._scope.DisplayedRoutes.ReturnRoute?this._scope.DisplayedRoutes.ReturnRoute.Date:null)},t.prototype.CallLookAndBookService=function(){if(this._scope.DisplayedRoutes&&this._scope.PassengerComposition){var n={From:this._scope.DisplayedRoutes.OutboundRoute.OriginIata,To:this._scope.DisplayedRoutes.OutboundRoute.DestinationIata,OutboundDate:this._scope.DisplayedRoutes.OutboundRoute.Date,ReturnDate:this._scope.DisplayedRoutes.ReturnRoute?this._scope.DisplayedRoutes.ReturnRoute.Date:this._scope.DisplayedRoutes.OutboundRoute.Date,NumberOfAdults:this._scope.PassengerComposition.Adults,NumberOfChildren:this._scope.PassengerComposition.Children,NumberOfInfants:this._scope.PassengerComposition.Infants,FlexibleOnDates:this._scope.ShowFlexiFares,Language:this.EResLanguageCode(),Currency:this._currencyService.GetCurrency(),IsOneWayJourney:this._scope.DisplayedRoutes.ReturnRoute?!1:!0};this._lookAndBookService.StoreSearch(n)}},t.prototype.EResLanguageCode=function(){if(this._funnelBasketService){var n=this._funnelBasketService.GetEResLanguageCode();if(n)return n.toUpperCase()}return"EN"},t.prototype.ListenForScrollToEvents=function(){this._scope.$on(n.Events.Names.Funnel.ScrollToOutboundLeg,this.SetScrollToOutboundLeg.bind(this));this._scope.$on(n.Events.Names.Funnel.ScrollToReturnLeg,this.SetScrollToReturnLeg.bind(this));var t=_.debounce(this.ScrollToNowGridsHaveLoaded.bind(this),150);this._scope.$on(n.Events.Names.FlightGrid.InitialLoadComplete,t.bind(this));this._scope.$on(n.Events.Names.ScrollTo.PageScrolled,this.ResetScroll.bind(this))},t.prototype.SetScrollToOutboundLeg=function(n,t){this._scrollToOutboundLeg=!0;this._scope.ScrollToOutboundLeg=t},t.prototype.SetScrollToReturnLeg=function(n,t){this._scrollToReturnLeg=!0;this._scope.ScrollToReturnLeg=t},t.prototype.ScrollToNowGridsHaveLoaded=function(){Main3.Common.BreakPointService.IsMobile()?this._scrollToOutboundLeg?this._scope.ScrollToOutboundLeg=!0:this._scrollToReturnLeg&&(this._scope.ScrollToReturnLeg=!0):n.Events.Fire(n.Events.Names.ScrollTo.Top)},t.prototype.ResetScroll=function(){this._scrollToOutboundLeg=!1;this._scrollToReturnLeg=!1;this._scope.ScrollToOutboundLeg=!1;this._scope.ScrollToReturnLeg=!1},t.ControllerName="Funnel_PickFlightPair",t.$inject=["$scope","Funnel_Service","FunnelJourneyCookie_Service","Funnel_BasketService","LookAndBookService","Funnel_CurrencyService"],t}();t.PickFlightPair=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c,l,a,v){var y=this;this._scope=t;this._funnelBasketService=r;this._funnelActivePairService=u;this._funnelAccessibilityService=f;this._funnelPickFlightsJourneyChangeService=e;this._funnelCurrencyService=o;this._funnelBasketLuggageService=s;this._funnelFlightTemporalProximityService=h;this._funnelService=c;this._funnelDataMapper=l;this._basketFlightSelectionService=a;this._ruleBasedContentService=v;this._routesService=new Main3.Routes.RoutesService(i);this._scope.ShowAlternativeOriginLink=this.ShowAlternativeOriginLink.bind(this);this._scope.FlightIsSelectedInOtherPairs=this._funnelActivePairService.FlightIsSelectedInOtherPairs.bind(this._funnelActivePairService);this._scope.IsTemporarilyDisabled=this._basketFlightSelectionService.HasUpdateInProgress.bind(this._basketFlightSelectionService);this._scope.FlightCardHeaderId=this._scope.PanelInLegIndex===0?(this._scope.IsReturnSegment?"return":"outbound")+"-flight-panel":undefined;this._scope.$on(n.Events.Names.FlightGrid.FlightFareSelected,this.OnFlightGridFlightFareSelected.bind(this));this._scope.$on(n.Events.Names.FlightGrid.Refreshed,this.OnFlightGridRefreshed.bind(this));this._scope.$watch(function(n){return n.Route},function(n,t){y.RouteDatesAreTheSame(n,t)||y._scope.$applyAsync(function(){var i=n,t;y._scope.Route=i;t=y.GetFlightFareForReinitialisation(n);y._scope.ChosenFare=t})});this._pendingFlexiFlightFareSelection=null;this._scope.$on(n.Events.Names.Funnel.ActiveJourneyPairChanged,this.OnUpdateActiveJourneyPair.bind(this))}return t.prototype.OnUpdateActiveJourneyPair=function(){var n=this._funnelActivePairService.GetActiveJourneyPair(),t=this._funnelBasketService.GetPassengerComposition(),i={OriginIata:n.OutboundSlot.Route.OriginIata,DestinationIata:n.OutboundSlot.Route.DestinationIata,OutboundDate:n.OutboundSlot.Route.Date,ReturnDate:n.ReturnSlot?n.ReturnSlot.Route.Date:null,IsOneWayFlight:!n.ReturnSlot,Adults:t.Adults,Children:t.Children,Infants:t.Infants};this._funnelPickFlightsJourneyChangeService.UpdateGrid(i)},t.prototype.ShowAlternativeOriginLink=function(){return!this._routesService.IsMarketGroup(this._scope.ContainingLegRoute.OriginIata)},t.prototype.RouteDatesAreTheSame=function(n,t){return n.Date.Equals(t.Date)&&n.OriginIata===t.OriginIata&&n.DestinationIata===t.DestinationIata},t.prototype.OnFlightGridRefreshed=function(){this.TryPendingFlexiFlightFareSelection()},t.prototype.TryPendingFlexiFlightFareSelection=function(){if(!!this._pendingFlexiFlightFareSelection){var t=this.BuildChosenFlightFare(this._pendingFlexiFlightFareSelection),i={Route:this._scope.Route,ChosenFare:t};this._scope.$broadcast(n.Events.Names.FlightGrid.SelectFlightFareRequest,i);this._pendingFlexiFlightFareSelection=null}},t.prototype.GetFlightFareForReinitialisation=function(n){return this._scope.JourneySlot&&this._scope.JourneySlot.Flight&&this._scope.JourneySlot.Flight.DepartureIata==n.OriginIata&&this._scope.JourneySlot.Flight.ArrivalIata==n.DestinationIata&&this._scope.IsOneWayJourney!==this._funnelActivePairService.ActivePairHasReturnLeg()?{FlightSegmentId:this._scope.JourneySlot.Flight.SegmentId,FareType:this._funnelBasketService.GetFareType()}:null},t.prototype.OnFlightGridFlightFareSelected=function(n,t){!!t&&t.Flight&&(this.UserHasSelectedMixedFareTypes(t)?this.OpenMixedFareTypesDrawer(t):this.SelectFlight(t))},t.prototype.UserHasSelectedMixedFareTypes=function(n){var t=this.ShouldCheckMixedFareTypesDueToInactivePairFlights(),i=this.ShouldCheckMixedFareTypesDueToActivePair();return t||i?n.FareType!==this._funnelBasketService.GetFareType():!1},t.prototype.ShouldCheckMixedFareTypesDueToInactivePairFlights=function(){return this._funnelActivePairService.GetInactiveJourneyPairFlights().length>0},t.prototype.ShouldCheckMixedFareTypesDueToActivePair=function(){var n=this._funnelActivePairService.GetActiveJourneyPair(),t,i;return!!n&&this.FlightPanelRouteMatchesActiveJourneyPairRoute(n)&&!!n.ReturnSlot?(t=this._scope.IsReturnSegment&&!!n.OutboundSlot.Flight,i=!this._scope.IsReturnSegment&&!!n.ReturnSlot.Flight,t||i):!1},t.prototype.FlightPanelRouteMatchesActiveJourneyPairRoute=function(n){var t=this._scope.JourneySlot?this._scope.JourneySlot.Route.OriginIata:null,i=this._scope.JourneySlot?this._scope.JourneySlot.Route.DestinationIata:null,r=this._routesService.IsIataInMarketGroup(this._scope.Route.OriginIata,t),u=this._routesService.IsIataInMarketGroup(this._scope.Route.DestinationIata,i),f=this._scope.IsOneWayJourney===!n.ReturnSlot;return r&&u&&f},t.prototype.OpenMixedFareTypesDrawer=function(t){var i={FlightFareProperties:t,Callback:this.SelectFlight.bind(this)};n.Events.OpenDrawerWithOptions({SectionKey:"funnel-mixed-fare-types",Parameters:i})},t.prototype.SelectFlight=function(t){this._basketFlightSelectionService.HasUpdateInProgress()||(this.IsFareSelectable(t)?(this.IsCurrentlySelectedFare(t)||this.SelectFareOnGrid(t),this.SetActiveFlightInBasket(t)):t.FareType!==n.Data.Common.FlightFareType.Flexi||this._scope.ShowFlexiFares?(this.RemoveActiveFlight(),this._funnelAccessibilityService.AlertSelectedFareUnavailable(t.FareType)):(this._pendingFlexiFlightFareSelection=t,this.RaiseShowFlexiFaresRequest()))},t.prototype.SetActiveFlightInBasket=function(t){var i=this._funnelDataMapper.ClientBasketFlightFromGridFlight(t.Flight),r=this._scope.IsReturnSegment?n.Data.Common.RouteDirection.Return:n.Data.Common.RouteDirection.Outbound;this._basketFlightSelectionService.SetFlightForActivePair(i,t.FareType,r,this._scope.IsOneWayJourney)},t.prototype.RemoveActiveFlight=function(){var t=this._scope.IsReturnSegment?n.Data.Common.RouteDirection.Return:n.Data.Common.RouteDirection.Outbound;this._basketFlightSelectionService.RemoveFlightFromSlot(this._scope.JourneySlot,t,!1)},t.prototype.SelectFareOnGrid=function(n){this._scope.ChosenFare=this.BuildChosenFlightFare(n)},t.prototype.IsCurrentlySelectedFare=function(n){return!!this._scope.ChosenFare&&n.Flight.SegmentId===this._scope.ChosenFare.FlightSegmentId&&n.FareType===this._scope.ChosenFare.FareType},t.prototype.IsFareSelectable=function(n){var t=_(n.Flight.FlightFares).select(function(t){return t.FareType===n.FareType})[0];return!!t&&t.Selectable},t.prototype.RaiseShowFlexiFaresRequest=function(){n.Events.Fire(n.Events.Names.PickFlightsOptions.ShowFlexiFaresRequest)},t.prototype.BuildChosenFlightFare=function(n){return{FlightSegmentId:n.Flight.SegmentId,FareType:n.FareType}},t.prototype.FlightGridJourneyChange=function(n){var t=this,i=this._scope.IsReturnSegment?this._scope.ContainingLegRoute.DestinationIata:this._scope.ContainingLegRoute.OriginIata,r=this._scope.IsReturnSegment?this._scope.ContainingLegRoute.OriginIata:this._scope.ContainingLegRoute.DestinationIata,u={OriginIata:n.OriginIata||i,DestinationIata:n.DestinationIata||r,OutboundDate:n.OutboundDate,ReturnDate:n.ReturnDate,IsOneWayFlight:this._scope.IsOneWayJourney,Adults:this._scope.PassengerComposition.Adults,Children:this._scope.PassengerComposition.Children,Infants:this._scope.PassengerComposition.Infants};this._funnelPickFlightsJourneyChangeService.UpdateGrid(u);setTimeout(function(){t._scope.ResetGridFocus()},0)},t.ControllerName="Funnel_PickFlightPanel",t.$inject=["$scope","Sitecore_RoutesData","Funnel_BasketService","Funnel_ActivePairService","Funnel_AccessibilityService","Funnel_PickFlightsJourneyChangeService","Funnel_CurrencyService","Funnel_BasketLuggageService","Funnel_FlightTemporalProximityService","Funnel_Service","Funnel_FunnelDataMapper","Funnel_BasketFlightSelectionService","Common_RuleBasedContentService"],t}();t.PickFlightPanel=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){var d=this;this._rootScope=t;this._scope=i;this._qService=r;this._serverFlightChangeService=u;this._funnelBasketService=f;this._funnelActivePairService=e;this._helpingHandMessages=o;this._helpingHandService=s;this._funnelJourneyCookieService=h;this._analyticsTracker=c;this._funnelBasketIconService=l;this._basketFlightSelectionService=a;this._funnelBasketTravelInsuranceService=v;this._ruleBasedContentService=y;this._sessionExpirySettings=b;this._sessionCookieExpiryService=k;this._preventHelpingHandStepUpdate=!0;this._isSkipping=!1;this._userHasSeenPolicyWarning=!1;this._routesService=new Main3.Routes.RoutesService(w);this._scope.OutboundFlightGridAccessibleHeader=o.NonMobileHelpingHandPageLoadText;this._scope.ReturnFlightGridAccessibleHeader=o.OutboundFlightSelectedText;this._scope.SkipLinkAction=this.SkipLinkAction.bind(this);this._scope.EditAdditionalFlights=this.EditAdditionalFlights.bind(this);this._scope.PleaseSelectAdditionalFlightsHelpingHandTitle=p.GetCurrentStepInJourney().HelpingHandSkipText;this._scope.PleaseSelectAdditionalFlightsHelpingHandSkipLink=p.GetCurrentStepInJourney().HelpingHandSkipButtonText;this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this);this.KeepContentInSyncWithJourneyPairs(this._rootScope);this.SetShowFlexiFaresFromJourneyCookie();this._scope.$on(n.Events.Names.Funnel.JourneyCookieShowFlexiFaresUpdated,function(){return d.SetShowFlexiFaresFromJourneyCookie()});this._scope.$on(n.Events.Names.Funnel.ActiveJourneyPairChanged,this.ActiveJourneyPairChanged.bind(this));this._funnelBasketIconService.AllowDeleteFlights()}return t.prototype.SetDisplayedRoutes=function(n,t){var r,i;n===void 0&&(n=!1);t===void 0&&(t=!1);r=this._funnelJourneyCookieService.ReadCookie();(this.JourneyCookieHasChangedRoute(r)||n)&&(i=this.BuildDisplayedRoutes(r),t&&(this.IatasMatch(i.OutboundRoute,this._scope.JourneyPair.OutboundSlot)&&(i.OutboundRoute.Date=this._scope.JourneyPair.OutboundSlot.Flight.LocalDepartureTime.Date()),this.IatasMatch(i.ReturnRoute,this._scope.JourneyPair.ReturnSlot)&&(i.ReturnRoute.Date=this._scope.JourneyPair.ReturnSlot.Flight.LocalDepartureTime.Date())),this._scope.DisplayedRoutes=i,this.UpdateRuleBasedContentGroupRoutes())},t.prototype.IatasMatch=function(n,t){return t&&t.Flight&&n?t.Flight.DepartureIata===n.OriginIata&&t.Flight.ArrivalIata===n.DestinationIata:!1},t.prototype.BuildDisplayedRoutes=function(n){var i={Date:n.OutboundDate,OriginIata:n.OriginIata,DestinationIata:n.DestinationIata},t=null;return n.ReturnDate&&(t={Date:n.ReturnDate,OriginIata:n.DestinationIata,DestinationIata:n.OriginIata}),{OutboundRoute:i,ReturnRoute:t}},t.prototype.UpdateRuleBasedContentGroupRoutes=function(){var t=[];this.BuildRuleBasedContentRoutes(t,this._scope.DisplayedRoutes.OutboundRoute,n.Data.Common.RouteDirection.Outbound);this.BuildRuleBasedContentRoutes(t,this._scope.DisplayedRoutes.ReturnRoute,n.Data.Common.RouteDirection.Return);this._ruleBasedContentService.PublishUpdate(function(n){return n.RoutePairs=t,n},n.Services.Common.RuleBasedContentService.SubscriberGroups.FlightGrid)},t.prototype.BuildRuleBasedContentRoutes=function(n,t,i){var e,r,u,f;if(!!t)for(e=this._routesService.GetValidRoutesForMarketGroups(t.OriginIata,t.DestinationIata,t.Date),r=0,u=e;r<u.length;r++)f=u[r],n.push({From:f.OriginIata,To:f.DestinationIata,Direction:i})},t.prototype.JourneyCookieHasChangedRoute=function(n){if(!this._scope.DisplayedRoutes)return!0;var t=!!n.ReturnDate&&!this._scope.DisplayedRoutes.ReturnRoute,i=n.OriginIata!=this._scope.DisplayedRoutes.OutboundRoute.OriginIata,r=n.DestinationIata!=this._scope.DisplayedRoutes.OutboundRoute.DestinationIata,u=n.OutboundDate.ToIso8601()!=this._scope.DisplayedRoutes.OutboundRoute.Date.ToIso8601(),f=(n.ReturnDate?n.ReturnDate.ToIso8601():null)!=(this._scope.DisplayedRoutes.ReturnRoute?this._scope.DisplayedRoutes.ReturnRoute.Date.ToIso8601():null);return t||i||r||u||f},t.prototype.SetShowFlexiFaresFromJourneyCookie=function(){if(this._funnelJourneyCookieService.HasCookie()){var n=this._funnelJourneyCookieService.ReadCookie();this._scope.ShowFlexiFares=n.ShowFlexiFares}},t.prototype.KeepContentInSyncWithJourneyPairs=function(n){var t=this;n.$watch(function(){return t._funnelBasketService.GetJourneyPairs()},function(){t.UpdateAccessibleHeaders();t.UpdateHelpingHand()},!0)},t.prototype.UpdateAccessibleHeaders=function(){this._scope.OutboundFlightGridAccessibleHeader=this._funnelBasketService.PrimaryJourneyPairHasAnyFlightsSelected()&&this._funnelBasketService.HasAnyFlights()?this._helpingHandMessages.ReturnFlightSelectedFirstText:this._helpingHandMessages.NonMobileHelpingHandPageLoadText},t.prototype.UpdateHelpingHand=function(){var n=this._funnelActivePairService.GetActiveJourneyPair();!n||(n.IsPrimaryPair?this.UpdateHelpingHandForPrimaryPair():this.UpdateHelpingHandForAdditionalPair())},t.prototype.UpdateHelpingHandForPrimaryPair=function(){this._funnelBasketService.PrimaryJourneyPairHasAnyFlightsSelected()?this._funnelBasketService.HasAnyFlights()?this._funnelActivePairService.HasReturnSlotButOnlyOutboundFlightSelected()?(this._helpingHandService.PickFlightsHelpingHandForBasketWithReturnSlotThatContainsOnlyOutboundFlight(),this._scope.OutboundFlightGridAccessibleHeader=this._helpingHandMessages.ReturnFlightSelectedFirstText):this._funnelActivePairService.OnlyContainsReturnFlight()?(this._helpingHandService.PickFlightsHelpingHandForBasketThatContainsOnlyReturnFlight(),this._scope.OutboundFlightGridAccessibleHeader=this._helpingHandMessages.ReturnFlightSelectedFirstText):this._funnelBasketService.AllPairsHaveFlightsSelected()?this._isSkipping||(this._preventHelpingHandStepUpdate=!1):this.PickFlightsHelpingHandForWhenAdditionalFlightPairsNeedToBeSelectedBeforeContinue(this.SkipLinkAction.bind(this)):(this._helpingHandService.PickFlightsHelpingHandForEmptyBasket(),this._scope.OutboundFlightGridAccessibleHeader=this._helpingHandMessages.NonMobileHelpingHandPageLoadText):(this._helpingHandService.PickFlightsHelpingHandForEmptyBasket(),this._scope.OutboundFlightGridAccessibleHeader=this._helpingHandMessages.NonMobileHelpingHandPageLoadText)},t.prototype.UpdateHelpingHandForAdditionalPair=function(){if(this._funnelBasketService.AllPairsHaveFlightsSelected())this._isSkipping||(this._preventHelpingHandStepUpdate=!1);else{var n=this._funnelActivePairService.GetActiveJourneyPair();this._funnelBasketService.JourneyPairHasFlightsSelected(n)?this.PickFlightsHelpingHandForWhenAdditionalFlightPairsNeedToBeSelectedBeforeContinue(this.SkipLinkAction.bind(this)):this._helpingHandService.PickFlightsHelpingHandForInvalidAdditionalFlightPairs(this.SkipLinkAction.bind(this))}},t.prototype.PickFlightsHelpingHandForWhenAdditionalFlightPairsNeedToBeSelectedBeforeContinue=function(){n.Events.Fire(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/header/helpinghand/pick-flights-pick-additional-flights",this._scope)},t.prototype.SkipLinkAction=function(){var t={OnAccept:function(){n.Events.Fire(n.Events.Names.Funnel.Skip)},OnReject:function(){n.Events.Fire(n.Events.Names.Drawer.Close)},StyleSecondButtonAsDismissOption:!0};n.Events.OpenDrawerWithOptions({SectionKey:"funnel-just-checking",Parameters:t})},t.prototype.EditAdditionalFlights=function(){this._funnelActivePairService.SetFirstIncompleteAsActivePair();n.Events.Fire(n.Events.Names.Funnel.ScrollToOutboundLeg)},t.prototype.Skip=function(){var n=this;return this._isSkipping=!0,this._basketFlightSelectionService.RemoveIncompletePairs().then(function(){return n.Save()})},t.prototype.ActiveJourneyPairChanged=function(){this._scope.JourneyPair=this._funnelActivePairService.GetActiveJourneyPair()},t.prototype.FunnelReady=function(){var t=this;this._scope.JourneyPair=this._funnelActivePairService.GetActiveJourneyPair();this._scope.PassengerComposition=this._funnelBasketService.GetPassengerComposition();this.SetDisplayedRoutes(!1,!0);this._scope.$on(n.Events.Names.Funnel.JourneyCookieRouteUpdated,function(){t.SetDisplayedRoutes(!0)});this._helpingHandService.PickFlightsInitialise();this.SetSessionTimeout()},t.prototype.IsValid=function(){return this._funnelBasketService.AllPairsHaveFlightsSelected()},t.prototype.OverridesSaveBehaviour=function(){if(this._funnelBasketTravelInsuranceService.HasTravelInsuranceInClientBasket()){var t=this._funnelBasketTravelInsuranceService.GetTravelInsuranceFromClientBasket();if(this.OutboundDateChangedSinceInsuranceAdded(t)||this.ReturnDateChangedSinceInsuranceAdded(t))return this._userHasSeenPolicyWarning||n.Events.OpenDrawerWithOptions({SectionKey:"policy-invalidated-warning",OnConfirmCallback:this.ContinueFromPolicyWarningDrawer.bind(this)}),!this._userHasSeenPolicyWarning}return!1},t.prototype.ContinueFromPolicyWarningDrawer=function(){this._userHasSeenPolicyWarning=!0;n.Events.Fire(n.Events.Names.Funnel.Continue)},t.prototype.Save=function(){return this.OverridesSaveBehaviour()||(this._funnelBasketService.HasMultipleJourneyPairs()&&this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.ChooseFlights,Tracking.EventConstants.Actions.AddMore,this._funnelBasketService.GetJourneyPairs().length.toString()),this._funnelActivePairService.SetPrimaryJourneyPairAsActivePair()),this._qService.now()},t.prototype.OutboundDateChangedSinceInsuranceAdded=function(n){var t=n.QuoteOutboundRoute.Date,i=this._funnelBasketService.GetPrimaryJourneyPair().OutboundSlot.Route.Date;return!!n.QuoteOutboundRoute&&!t.Equals(i)},t.prototype.ReturnDateChangedSinceInsuranceAdded=function(n){if(!!this._funnelBasketService.GetPrimaryJourneyPair().ReturnSlot&&!!n.QuoteReturnRoute){var t=n.QuoteReturnRoute.Date,i=this._funnelBasketService.GetPrimaryJourneyPair().ReturnSlot.Route.Date;return!t.Equals(i)}return!1},t.prototype.ShouldExitFunnel=function(){return!1},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!0,PreventHelpingHandUpdateOnValid:this._preventHelpingHandStepUpdate,CheckFunnelJourneyRulesOnContinue:!0}},t.prototype.SetSessionTimeout=function(){var t=this;this._sessionTimer=new Utilities.ExpiryTimer(this._sessionExpirySettings.MessageSeconds*1e3,this.TimeLeftUntilSessionExpires.bind(this),6e4);this._sessionTimer.AddExpiredCallback(this.OnExpiredSessionTimeout.bind(this));this._rootScope.$on(n.Events.Names.PickFlightsOptions.ResetExpiryTimer,function(n,i){t._sessionTimer.Reset(i||!1)});this._rootScope.$on(n.Events.Names.Drawer.Scroll,function(){t._sessionTimer.ActivityReset()});this._sessionTimer.Reset(!1)},t.prototype.OnExpiredSessionTimeout=function(){n.Events.OpenDrawer("session-expiry")},t.prototype.TimeLeftUntilSessionExpires=function(n){if(this._sessionCookieExpiryService.CookieExists()){var i=this._sessionCookieExpiryService.GetCookieValue(),r=moment.utc().toDate().getTime(),u=parseInt(i),t=u-r;return t-=this._sessionExpirySettings.MessageSeconds*1e3,t-n}return null},t.ControllerName="Funnel_PickFlights",t.$inject=["$rootScope","$scope","$q","Funnel_BasketFlightSelectionService","Funnel_BasketService","Funnel_ActivePairService","Sitecore_HelpingHandMessages","PickFlightsHelpingHand_Service","FunnelJourneyCookie_Service","IAnalyticsTracker","Funnel_BasketIconService","Funnel_BasketFlightSelectionService","Funnel_TravelInsuranceBasketService","Common_RuleBasedContentService","Funnel_JourneyService","Sitecore_RoutesData","Sitecore_SessionExpirySettings","SessionCookieExpiry_Service"],t}();t.PickFlight=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s){var h=this;this._scope=t;this._searchPodSettings=i;this._flexiFareSettings=r;this._funnelBasketService=u;this._funnelJourneyCookieService=f;this._funnelPickFlightsJourneyChangeService=e;this._searchHistoryService=o;this._analyticsTracker=s;this._scope.ShowChangeSearch=this.ShowChangeSearch.bind(this);this._scope.ShowRecentSearches=this.ShowRecentSearches.bind(this);this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this);this._scope.$on(n.Events.Names.PickFlightsOptions.ShowFlexiFaresRequest,this.OnShowFlexiFaresRequest.bind(this));this._scope.$watch(function(){return h._searchHistoryService.GetRecentSearchesCount()},this.OnNumberOfRecentSearchedChanged.bind(this))}return t.prototype.FunnelReady=function(){var n=this._funnelJourneyCookieService.ReadCookie();this._scope.ShowFlexiFares=n.ShowFlexiFares;this.ValidateFlexiFares();this._scope.$watch(function(n){return n.ShowFlexiFares},this.OnShowFlexiFaresChanged.bind(this));!n.OpenChangeSearch||(this._funnelJourneyCookieService.UpdateCookie(function(n){return n.OpenChangeSearch=!1}),this.ShowChangeSearch(!0))},t.prototype.IsValid=function(){return!0},t.prototype.ShouldExitFunnel=function(){return!1},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!1}},t.prototype.ShowChangeSearch=function(t){t===void 0&&(t=!1);this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.ChooseFlights,Tracking.EventConstants.Actions.ChangeSearch,Tracking.EventConstants.Labels.DrawerOpened);n.Events.OpenDrawerWithOptions({SectionKey:"funnel-change-search",PreventOpenAnimation:t})},t.prototype.ShowRecentSearches=function(){var t=this,i=this._searchPodSettings.MaxNumberOfRecentSearches,r={OnSelectRecentSearch:function(n){t.OnRecentSearchSelected(n)},OnClearRecentSearches:function(){},MaxNumberOfRecentSearches:i},u={SectionKey:"recent-searches",Parameters:r};n.Events.OpenDrawerWithOptions(u)},t.prototype.OnNumberOfRecentSearchedChanged=function(){this._scope.NumberOfRecentSearches=Math.min(this._searchHistoryService.GetRecentSearchesCount(),this._searchPodSettings.MaxNumberOfRecentSearches)},t.prototype.OnRecentSearchSelected=function(n){var t={OriginIata:n.OriginAirportIata,DestinationIata:n.DestinationAirportIata,OutboundDate:this.GetOutboundDateForRecentSearch(n),ReturnDate:this.GetReturnDateForRecentSearch(n),IsOneWayFlight:n.IsOneWayFlight,Adults:n.Adults,Children:n.Children,Infants:n.Infants};this._funnelPickFlightsJourneyChangeService.UpdateGrid(t)},t.prototype.OnShowFlexiFaresChanged=function(){this.ValidateFlexiFares();this.SetJourneyCookieForFlexiFaresIfChanged()},t.prototype.OnShowFlexiFaresRequest=function(){this._scope.ShowFlexiFares=!0},t.prototype.GetOutboundDateForRecentSearch=function(n){return this.DateIsTodayOrInTheFuture(n.OutboundDate.Date())?n.OutboundDate.Date():this._funnelJourneyCookieService.ReadCookie().OutboundDate},t.prototype.GetReturnDateForRecentSearch=function(n){return!n.IsOneWayFlight&&!!n.ReturnDate?this.DateIsTodayOrInTheFuture(n.OutboundDate.Date())&&this.DateIsTodayOrInTheFuture(n.ReturnDate.Date())?n.ReturnDate.Date():!this._funnelJourneyCookieService.ReadCookie().ReturnDate?this._funnelJourneyCookieService.ReadCookie().OutboundDate:this._funnelJourneyCookieService.ReadCookie().ReturnDate:undefined},t.prototype.DateIsTodayOrInTheFuture=function(n){return n.ToSortable()>=Utilities.TimeAgnosticDate.TodayLocal().ToSortable()},t.prototype.ValidateFlexiFares=function(){this._scope.ShowFlexiFares&&this.ShouldNotAllowFlexiFares()&&this.FlexiFaresNotAllowed()},t.prototype.ShouldNotAllowFlexiFares=function(){var n=this._funnelBasketService.GetPassengerComposition(),t=n.Adults+n.Children;return t>this._flexiFareSettings.PassengerGroupLimit},t.prototype.FlexiFaresNotAllowed=function(){this._scope.ShowFlexiFares=!1;n.Events.OpenDrawer("funnel-flexi-fare-groups")},t.prototype.SetJourneyCookieForFlexiFaresIfChanged=function(){var t=this._funnelJourneyCookieService.ReadCookie();t.ShowFlexiFares!==this._scope.ShowFlexiFares&&(t.ShowFlexiFares=this._scope.ShowFlexiFares,this._funnelJourneyCookieService.WriteCookie(t),n.Events.Fire(n.Events.Names.Funnel.JourneyCookieShowFlexiFaresUpdated))},t.ControllerName="Funnel_PickFlightsOptions",t.$inject=["$scope","Sitecore_SearchPodSettings","Sitecore_FunnelFlexiFareSettings","Funnel_BasketService","FunnelJourneyCookie_Service","Funnel_PickFlightsJourneyChangeService","Controls_SearchHistoryService","IAnalyticsTracker"],t}();t.PickFlightsOptions=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._scope=n;this._parameters=this._scope.CurrentSection.Options.Parameters;this._scope.ButtonPlaceholderText=this._parameters.ButtonPlaceholderText;this._scope.PlaceholderMessage=this._parameters.PlaceholderMessage;this._scope.OnSelect=this.OnSelect.bind(this)}return t.prototype.OnSelect=function(){this._parameters.OnSelect();this._scope.$emit(n.Events.Names.Drawer.Close)},t.ControllerName="Funnel_PlaceholderMessageDrawer",t.$inject=["$scope"],t}();t.PlaceholderMessageDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._scope=n;this._parameters=this._scope.CurrentSection.Options.Parameters;this._scope.OptionItems=this._parameters.OptionItems;this._scope.GetPriceForOption=this.GetPriceForOption.bind(this);this._scope.OnSelect=this.OnSelect.bind(this)}return t.prototype.GetPriceForOption=function(n){var t=this.GetOptionItemForKey(n);return t?t.Price:null},t.prototype.GetItemForOption=function(n){var t=this.GetOptionItemForKey(n);return t?t.Item:null},t.prototype.OnSelect=function(t){if(t){var i=this.GetItemForOption(t);this._parameters.OnSelect(t,i);this._scope.$emit(n.Events.Names.Drawer.Close)}},t.prototype.GetOptionItemForKey=function(n){return!this._scope.OptionItems||!n?null:_(this._scope.OptionItems).find(function(t){return t.Reference===n})},t.ControllerName="Funnel_PriceOptionDrawer",t.$inject=["$scope"],t}();t.PriceOptionDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u){this._scope=t;this._funnelService=i;this._funnelBasketService=r;this._funnelBasketUpdateService=u;this._scope.$emit(n.Events.Names.EditableControls.RegisterControl,this);this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this)}return t.prototype.FunnelReady=function(){var n=this;this._scope.Reason=this._funnelBasketService.GetBasket().ReasonForTravelCode;this._scope.$watch(function(n){return n.Reason},function(t){n._funnelBasketUpdateService.SetReasonForTravelCode(t)})},t.prototype.IsValid=function(){return!!this._scope.Reason},t.prototype.Save=function(){return this._funnelService.SetReasonForTravelServer(this._scope.Reason)},t.prototype.ShouldExitFunnel=function(){return!1},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!1}},t.ControllerName="Funnel_ReasonForTravel",t.$inject=["$scope","Funnel_Service","Funnel_BasketService","Funnel_BasketUpdateService"],t}();t.ReasonForTravel=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this._scope=n;this._funnelService=t;this._scope.Acknowledge=this.Acknowledge.bind(this)}return t.prototype.Acknowledge=function(){n.Events.Fire(n.Events.Names.Drawer.Close)},t.ControllerName="Funnel_ReturnBeforeOutboundFlight",t.$inject=["$scope","Funnel_Service"],t}();t.ReturnBeforeOutboundFlightDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c,l,a,v){this._scope=t;this._funnelBasketService=i;this._funnelCarsSettings=r;this._funnelJourneyService=u;this._carsService=f;this._funnelJourneyCookieService=e;this._analyticsTracker=s;this._carsExtrasService=h;this._carsInsuranceService=c;this._carsPriceService=l;this._funnelReasonCookieService=a;this._routesService=new Main3.Routes.RoutesService(o);this._titleBarInstance=Title.TitleBar.Instance;this._scope.ExtrasOptions=[];this._scope.ChildSeatOptions=[];this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this);this._scope.ChangeInsuranceSelection=this.ChangeInsuranceSelection.bind(this);this._scope.OnExtraCheckBoxChange=this.OnExtraCheckBoxChange.bind(this);this._scope.OnExtraDrawerLinkClick=this.OnExtraDrawerLinkClick.bind(this);this._scope.OpenChildSeatsDrawer=this.OpenChildSeatsDrawer.bind(this);this._scope.HasAnySelectedChildSeats=this.HasAnySelectedChildSeats.bind(this);this._scope.HasChildSeatsAvailableForSelection=this.HasChildSeatsAvailableForSelection.bind(this);this._scope.NumberOfSelectedChildSeatsForCode=this.NumberOfSelectedChildSeatsForCode.bind(this);this._scope.GetSelectedInsuranceGroup=this.GetSelectedInsuranceGroup.bind(this);this._scope.GetInsuranceGroupPricePerDay=this.GetInsuranceGroupPricePerDay.bind(this);this._scope.GetInsuranceGroupTotalPrice=this.GetInsuranceGroupTotalPrice.bind(this);this._scope.ShowInsuranceDrawerForGroup=this.ShowInsuranceDrawerForGroup.bind(this);this._scope.GetTotalCost=this.GetTotalCost.bind(this);this._scope.GetTotalCostPerDay=this.GetTotalCostPerDay.bind(this);v.AllowDeleteCars()}return t.prototype.GetTotalCost=function(){return this._carsPriceService.GetTotalCost(this._scope.Quote,this.GetSelectedInsuranceOptions(),this._scope.ExtrasOptions,this._scope.ChildSeatOptions)},t.prototype.GetTotalCostPerDay=function(){return this._carsPriceService.GetTotalCostPerDay(this._scope.Quote,this.GetSelectedInsuranceOptions(),this._scope.ExtrasOptions,this._scope.ChildSeatOptions)},t.prototype.IsValid=function(){return!0},t.prototype.FunnelReady=function(){this._scope.ExtrasOptions=this._carsExtrasService.BuildExtrasOptions();this._scope.ChildSeatOptions=this._carsExtrasService.BuildChildSeatOptions();this._scope.ListQuery=this.GetListQuery();this.SetPageTitle();this._pickUpCountry=this._routesService.FindCountryByIata(this._scope.ListQuery.PickUpIata);this.LoadCarQuote();this.LoadStations()},t.prototype.GetListQuery=function(){var t=this._funnelJourneyCookieService.ReadCookie(),n;if(!!t&&(n=t.CarSearchQuery,!!n))return n;this.RedirectToNextStepDueToApiUnavailable(Constants.Redirect.Reasons.Funnel.Cars.NoListQueryFound)},t.prototype.GetSelectedInsuranceGroup=function(){switch(this._scope.SelectedInsuranceIndex){case n.Data.Funnel.Cars.CarInsuranceTypeIndex.Basic:return this._scope.InsuranceOptions.Basic;case n.Data.Funnel.Cars.CarInsuranceTypeIndex.Medium:return this._scope.InsuranceOptions.Medium;case n.Data.Funnel.Cars.CarInsuranceTypeIndex.Premium:return this._scope.InsuranceOptions.Premium;default:return null}},t.prototype.GetSelectedInsuranceOptions=function(){var n=this.GetSelectedInsuranceGroup();return!n?[]:n.Options},t.prototype.ChangeInsuranceSelection=function(n){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Cars,Tracking.EventConstants.Actions.Change,n)},t.prototype.ShowInsuranceDrawerForGroup=function(t){var i=this,r={InsuranceGroup:t,SelectedInsuranceIndex:this._scope.SelectedInsuranceIndex,OnSelectInsurance:function(t){i.UpdateInsuranceOption(t,n.Data.Funnel.Cars.CarInsuranceTypeIndex.ToString(t))}},u={SectionKey:"cars-insurance-details-"+t.Id,Parameters:r};n.Events.OpenDrawerWithOptions(u)},t.prototype.GetInsuranceGroupPricePerDay=function(n){return!!n&&n.Options.length>0?n.Options[0].PricePerDay:null},t.prototype.GetInsuranceGroupTotalPrice=function(n){return!!n&&n.Options.length>0?n.Options[0].TotalPrice:null},t.prototype.LoadCarQuote=function(){this._scope.IsLoadingQuote=!0;var n=this.BuildQuoteQuery();this._carsService.GetQuote(n).then(this.OnLoadQuoteSuccess.bind(this)).catch(this.OnLoadQuoteError.bind(this))},t.prototype.BuildQuoteQuery=function(n){n===void 0&&(n=!0);var i=this._funnelJourneyCookieService.ReadCookie().SelectedCar,t=Utilities.Clone(this._scope.ListQuery);return t.RateId=i.RateId,t.SelectedCategory=i.SelectedCategory,t.SelectedEquipment=this.GetSelectedEquipment(),n&&(t.SelectedInsurance=this.GetSelectedInsuranceOptionCodes(!0)),t},t.prototype.GetSelectedInsuranceOptionCodes=function(t){return t===void 0&&(t=!0),this.GetSelectedInsuranceOptions().filter(function(i){return!t||i.TypeIndex!==n.Data.Funnel.Cars.CarInsuranceTypeIndex.Basic}).map(function(n){return n.Code})},t.prototype.GetSelectedEquipment=function(){return[].concat(this._carsExtrasService.GetSelectedExtraOptionsForQuote(this._scope.ExtrasOptions),this._carsExtrasService.GetSelectedChildSeatOptionsForQuote(this._scope.ChildSeatOptions))},t.prototype.OnLoadQuoteSuccess=function(n){this._scope.Quote=n;this._scope.InsuranceOptions=this._carsInsuranceService.BuildInsuranceOptions(n,this._pickUpCountry);this.SetHelpingHand();this._scope.SelectedInsuranceIndex=this._scope.InsuranceOptions.Basic.Index;this.UpdateExtraDescriptions(n.Car);this._scope.IsLoadingQuote=!1},t.prototype.UpdateExtraDescriptions=function(n){this._scope.ExtrasOptions.forEach(function(t){t.Description=t.Description.replaceAll("{minimum-age}",n.MinimumHireAge.toString())})},t.prototype.UpdateInsuranceOption=function(n,t){this._scope.SelectedInsuranceIndex=n;this.ChangeInsuranceSelection(t)},t.prototype.SetHelpingHand=function(){var t=this;this._scope.HelpingHandContinueButtonText=this._funnelJourneyService.GetCurrentStepInJourney().HelpingHandContinueButtonText;this._scope.HelpingHandContinueClick=function(){t._scope.$emit(n.Events.Names.Funnel.Continue)};n.Events.Fire(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/header/helpinghand/funnel-selected-car",this._scope)},t.prototype.OnLoadQuoteError=function(){this.RedirectToNextStepDueToApiUnavailable(Constants.Redirect.Reasons.Funnel.Cars.GetQuoteApiError)},t.prototype.RedirectToNextStepDueToApiUnavailable=function(n){this._funnelReasonCookieService.UpdateCookie(function(t){return t.CarsRedirectReason=n});this._analyticsTracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.Cars,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.Error+" | "+Utilities.ZonelessDateTime.NowUtc(),this._funnelJourneyService.GetBypassNextStepUrl())},t.prototype.LoadStations=function(){this._scope.IsLoadingStations=!0;this._carsService.GetStationsList(this._scope.ListQuery.PickUpIata).then(this.LoadStationsSuccess.bind(this)).catch(this.RedirectToNextStepDueToApiUnavailable.bind(this))},t.prototype.LoadStationsSuccess=function(n){this._scope.Stations=n;this._scope.IsLoadingStations=!1},t.prototype.Save=function(){var i=this,t=this._carsService.UpdateCar(this.BuildQuoteQuery(!1),this._funnelJourneyCookieService.ReadCookie().LeadDriverPassengerInternalId,this._scope.SelectedInsuranceIndex===n.Data.Funnel.Cars.CarInsuranceTypeIndex.Basic,this.GetSelectedInsuranceOptionCodes(!1),this.GetSelectedInsuranceGroup().Id,this.GetExtraDisplayInformation(),this.GetTotalCost());return t.then(function(){i._analyticsTracker.TrackEventWithPagePathLabel(Tracking.EventConstants.Categories.Cars,Tracking.EventConstants.Actions.Add)}),t},t.prototype.GetExtraDisplayInformation=function(){for(var n,t,f,i,r=[],u=0,e=this._scope.ExtrasOptions;u<e.length;u++)n=e[u],n.Quantity>0&&r.push({ExtraCode:n.Code,MultipleItemsAllowed:n.UsesQuantitySelection,Quantity:n.Quantity,IsMandatory:n.IsMandatory});for(t=0,f=this._scope.ChildSeatOptions;t<f.length;t++)i=f[t],i.Quantity>0&&r.push({ExtraCode:i.Code,MultipleItemsAllowed:!0,Quantity:i.Quantity,IsMandatory:!1});return r},t.prototype.ShouldExitFunnel=function(){return!this._funnelBasketService.HasAnyFlights()},t.prototype.GetStepOnLoadRedirect=function(){return this._funnelJourneyService.GetStepOnLoadInvalidFlightRedirect(Tracking.EventConstants.Categories.Cars)||this.GetStepOnLoadUnavailableStepRedirect()},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!0}},t.prototype.GetStepOnLoadUnavailableStepRedirect=function(){var t=this,n=this._funnelJourneyService.GetNextStepUrlIfOnLoadRedirectRequired();return!n?null:{TargetUrl:n,EventCategory:Tracking.EventConstants.Categories.Cars,EventAction:Tracking.EventConstants.Actions.Skip,EventLabel:Tracking.EventConstants.Labels.Unavailable,AdditionalAction:function(){t._funnelReasonCookieService.UpdateCookie(function(n){return n.CarsRedirectReason=Constants.Redirect.Reasons.Funnel.Step.OnLoadRedirect})}}},t.prototype.SetPageTitle=function(){var n=this._scope.ListQuery.PickUpLocationName,t;this._scope.ListQuery.IsDefault&&(n=this._carsService.GetLocationDisplayNameByIata(this._scope.ListQuery.PickUpIata));t=this._funnelCarsSettings.HeaderText.replace("{location}",n);this._titleBarInstance.UpdateHeaderTitle(t)},t.prototype.OnExtraCheckBoxChange=function(t){t.IsMandatory&&t.HasMandatoryDrawer&&t.Quantity===0&&n.Events.OpenDrawer("cars-extra-mandatory-"+t.Code.toLowerCase())},t.prototype.OnExtraDrawerLinkClick=function(t){t.IsMandatory&&t.HasMandatoryDrawer&&n.Events.OpenDrawer("cars-extra-mandatory-"+t.Code.toLowerCase())},t.prototype.OpenChildSeatsDrawer=function(){var t=this,i={ChildSeatOptions:this._scope.ChildSeatOptions,OnSeatsSelected:function(){t._scope.TotalChildSeatPricePerDay=t._carsPriceService.GetTotalCostOfEquipment(t._scope.ChildSeatOptions,function(n){return n.PricePerDay})}};n.Events.OpenDrawerWithOptions({SectionKey:"car-child-seats",Parameters:i})},t.prototype.HasAnySelectedChildSeats=function(){if(this.HasChildSeatsAvailableForSelection()){var n=this._scope.ChildSeatOptions.map(function(n){return n.Quantity}).reduce(function(n,t){return n+t});return n>0}return!1},t.prototype.HasChildSeatsAvailableForSelection=function(){return this._scope.ChildSeatOptions.length>0},t.prototype.NumberOfSelectedChildSeatsForCode=function(n){return this._carsExtrasService.NumberOfSelectedChildSeatsForCode(this._scope.ChildSeatOptions,n)},t.ControllerName="Funnel_SelectedCar",t.$inject=["$scope","Funnel_BasketService","Sitecore_CarsSettingsData","Funnel_JourneyService","Cars_Service","FunnelJourneyCookie_Service","Sitecore_RoutesData","IAnalyticsTracker","Cars_ExtrasService","Cars_InsuranceService","Cars_PriceService","FunnelReasonCookie_Service","Funnel_BasketIconService"],t}();t.SelectedCar=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this._rootScope=n;this._scope=t;this._parameters=this._scope.Section.Options.Parameters;this._scope.ShowSignInUser=!0;this._scope.SignInUserSelected=this.SignInUserSelected.bind(this);this._scope.SignUpUserSelected=this.SignUpUserSelected.bind(this);this.SetDefaultView();this.WatchForSignUpFailure()}return t.prototype.SetDefaultView=function(){this._parameters.InitialView===1?this.SwitchToSignIn():this._parameters.InitialView===2&&this.SwitchToSignUp();this._parameters.DisplayMemberExistsError&&this.SwitchToSignIn()},t.prototype.WatchForSignUpFailure=function(){this._rootScope.$on(n.Events.Names.Funnel.SignUpMemberExists,this.SwitchToSignIn.bind(this))},t.prototype.SwitchToSignIn=function(){this._scope.ShowSignInUser=!0;this._scope.ShowSignUpUser=!1},t.prototype.SwitchToSignUp=function(){this._scope.ShowSignInUser=!1;this._scope.ShowSignUpUser=!0},t.prototype.SignInUserSelected=function(){this.SwitchToSignIn()},t.prototype.SignUpUserSelected=function(){this.SwitchToSignUp()},t.ControllerName="Funnel_SignInOrSignUpDrawer",t.$inject=["$rootScope","$scope"],t}();t.SignInOrSignUpDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this.No=2;this.Yes=1;this._scope=n;this._parameters=n.Section.Options.Parameters;this._scope.PassengerName=this._parameters.PassengerName;this._scope.OnFinalAgree=this.OnFinalAgree.bind(this);this._scope.OnFinalDisagree=this.OnFinalDisagree.bind(this);this._scope.OnContinue=this.OnContinue.bind(this);this._scope.IsContinueDisabled=this.IsContinueDisabled.bind(this);this.WatchForQuestionChanges()}return t.prototype.WatchForQuestionChanges=function(){var n=this;this._scope.$watch(function(n){return n.IsBringingOwnChair},function(){n.TriggerScrollToBottom()});this._scope.$watch(function(n){return n.IsAbleToUseStairs},function(t){t===n.Yes&&(n._scope.IsAbleToMoveInCabin=null,n._scope.IsTravellingWithCompanion=null);n.TriggerScrollToBottom()});this._scope.$watch(function(n){return n.IsAbleToMoveInCabin},function(t){t===n.Yes&&(n._scope.IsTravellingWithCompanion=null);n.TriggerScrollToBottom()});this._scope.$watch(function(n){return n.IsTravellingWithCompanion},function(){n.TriggerScrollToBottom()})},t.prototype.TriggerScrollToBottom=function(){var t=this;setTimeout(function(){t._scope.$emit(n.Events.Names.TouchScroll.ScrollToBottom)},100)},t.prototype.IsContinueDisabled=function(){var n=this._scope.IsAbleToUseStairs===this.Yes||this._scope.IsAbleToMoveInCabin===this.Yes||this._scope.IsTravellingWithCompanion===this.Yes;return!n},t.prototype.OnFinalAgree=function(){this._parameters.OnSetSsrCodeAndAccept(this._parameters.ApiValueWithCompanion)},t.prototype.OnFinalDisagree=function(){this._parameters.OnReject()},t.prototype.OnContinue=function(){this._scope.IsAbleToUseStairs===this.Yes?this._parameters.OnSetSsrCodeAndAccept(this._parameters.ApiValueStairsCapable):this._scope.IsAbleToMoveInCabin===this.Yes?this._parameters.OnSetSsrCodeAndAccept(this._parameters.ApiValueCabinCapable):this._scope.IsTravellingWithCompanion===this.Yes&&this._parameters.OnSetSsrCodeAndAccept(this._parameters.ApiValueWithCompanion)},t.ControllerName="Funnel_WheelchairSsrDrawer",t.$inject=["$scope"],t}();t.CheckboxConfirmationDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(t){function i(n,i,r,u,f,e,o,s,h,c,l,a,v){var y=t.call(this,n,i,r,f,o,s,e)||this;return y._funnelBasketService=h,y._funnelPickFlightsJourneyChangeService=c,y._funnelActivePairService=l,y._funnelBasketUpdateService=a,y._searchHistoryService=v,y._scope.ChooseFlightsAnalyticsCategory=Tracking.EventConstants.Categories.ChooseFlights,y._scope.AddMoreFlightsAnalyticsAction=Tracking.EventConstants.Actions.AddMoreFlights,y.SetSearchPodModel(),y}return __extends(i,t),i.prototype.BuildInitialSearchPodModel=function(){var n={OriginIata:"",DestinationIata:"",IsOneWayFlight:!0,DepartureDate:null,ReturnDate:null,Passengers:this._funnelBasketService.GetPassengerComposition(),RecentSearches:0};return this.PrePopulateLastSearchData(n),n},i.prototype.PrePopulateLastSearchData=function(n){var t=this._searchHistoryService.GetMostRecentSearch();!t||(n.OriginIata=t.OriginAirportIata||"",n.DestinationIata=t.DestinationAirportIata||"",n.IsOneWayFlight=t.IsOneWayFlight)},i.prototype.FormAction=function(){this.UpdateGridForSearch();this.CreateNewActiveJourneyPair();n.Events.Fire(n.Events.Names.Drawer.Close);n.Events.Fire(n.Events.Names.Basket.Hide);n.Events.Fire(n.Events.Names.Funnel.ScrollToOutboundLeg)},i.prototype.UpdateGridForSearch=function(){var n={OriginIata:this._scope.SearchPodModel.OriginIata,DestinationIata:this._scope.SearchPodModel.DestinationIata,OutboundDate:this._scope.SearchPodModel.DepartureDate,ReturnDate:this._scope.SearchPodModel.IsOneWayFlight?null:this._scope.SearchPodModel.ReturnDate,IsOneWayFlight:this._scope.SearchPodModel.IsOneWayFlight,Adults:this._scope.SearchPodModel.Passengers.Adults,Children:this._scope.SearchPodModel.Passengers.Children,Infants:this._scope.SearchPodModel.Passengers.Infants};this._funnelPickFlightsJourneyChangeService.UpdateGrid(n)},i.prototype.CreateNewActiveJourneyPair=function(){var i={Date:this._scope.SearchPodModel.DepartureDate,OriginIata:this._scope.SearchPodModel.OriginIata,DestinationIata:this._scope.SearchPodModel.DestinationIata},n=null,t;this._scope.SearchPodModel.IsOneWayFlight||(n={Date:this._scope.SearchPodModel.ReturnDate,OriginIata:this._scope.SearchPodModel.DestinationIata,DestinationIata:this._scope.SearchPodModel.OriginIata});t=this._funnelBasketUpdateService.CreateNewJourneyPair(i,n);this._funnelActivePairService.UpdateActiveJourneyPair(t)},i.ControllerName="Funnel_AddMoreFlightsDrawer",i.$inject=["$scope","Sitecore_SearchPodSettings","Worldwide_CombinedRoutesService","Sitecore_RoutesData","Controls_LowestFaresApiService","Controls_SearchPodRouteDatesPreloader","Controls_LowestFaresDataFlightFinder","Controls_RouteDataFlightFinder","Funnel_BasketService","Funnel_PickFlightsJourneyChangeService","Funnel_ActivePairService","Funnel_BasketUpdateService","Controls_SearchHistoryService"],i}(n.Controllers.Controls.SearchPod.BaseSearchPodController);t.AddMoreFlightsDrawer=i})(i=t.Drawers||(t.Drawers={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._scope=n;this._parameters=n.Section.Options.Parameters;this._scope.Parameters=this._parameters}return n.ControllerName="Funnel_AdminFeeChangedDrawer",n.$inject=["$scope"],n}();n.AdminFeeChangedDrawer=t})(t=n.Drawers||(n.Drawers={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(n,i,r){var u=t.call(this,r)||this;return u._scope=n,u._settings=i,u._scope.GenericError=!1,u._scope.UpdateNotAvailableError=!1,u._scope.ResultsError=!1,u._scope.CloseAirPlusDrawers=u.CloseAirPlusDrawers.bind(u),u.SetErrorMessage(),u.TrackErrorMessage(),u}return __extends(i,t),i.prototype.SetErrorMessage=function(){var t=this.GetDrawerParameters().Error;t===n.Data.Funnel.AirPlus.AirPlusErrorDrawerType.ResultError?this._scope.ResultsError=!0:t===n.Data.Funnel.AirPlus.AirPlusErrorDrawerType.UpdateNotAvailableError?this._scope.UpdateNotAvailableError=!0:this._scope.GenericError=!0},i.prototype.TrackErrorMessage=function(){var t=this.GetDrawerParameters().Error,i;i=t===n.Data.Funnel.AirPlus.AirPlusErrorDrawerType.ResultError?this._settings.UpdateResultErrorDescription:t===n.Data.Funnel.AirPlus.AirPlusErrorDrawerType.UpdateNotAvailableError?this._settings.UpdateNotAvailableForAccountErrorDescription:this._settings.GenericErrorDescription;this.TrackEvent(Tracking.EventConstants.Actions.Error,i)},i.prototype.GetDrawerParameters=function(){return this._scope.CurrentSection.Options.Parameters},i.prototype.CloseAirPlusDrawers=function(){n.Events.Fire(n.Events.Names.Drawer.Close)},i.ControllerName="Funnel_AirPlusErrorDrawer",i.$inject=["$scope","Sitecore_AirPlusErrorDrawerSettings","IAnalyticsTracker"],i}(t.Common.Drawers.AirplusDrawer);i.AirPlusErrorDrawer=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(n,i,r,u,f){var e=t.call(this,f)||this,o;return e._airPlusApi=n,e._errorService=i,e._scope=r,e._settings=u,r.IsValidFormat=e.IsValidFormat.bind(e),r.OnChange=e.OnChange.bind(e),r.OnSubmit=e.OnSubmit.bind(e),o=e.GetDrawerParameters(),r.FormInputMask=o.FormInputMask,r.RequireValidChecksum=o.RequireValidChecksum,r.CompanyAccountNumber="",r.FormInvalid=!1,e.TrackEvent(Tracking.EventConstants.Actions.Load,Tracking.EventConstants.Labels.AccountNumberDrawer),e}return __extends(i,t),i.prototype.GetDrawerParameters=function(){return this._scope.CurrentSection.Options.Parameters},i.prototype.IsValidFormat=function(){return this._scope.AirPlusAccountForm.$valid&&!this._scope.IsWrongAccountNumber},i.prototype.OnChange=function(){this.SetFormValidity();this._scope.IsWrongAccountNumber=!1},i.prototype.OnSubmit=function(){this.SetFormValidity();this._scope.FormSubmitted=!0;!this._scope.Loading&&this.IsValidFormat()&&this.SubmitAccountFieldsRequest()},i.prototype.SetFormValidity=function(){this._scope.FormInvalid=this._scope.AirPlusAccountForm.$invalid},i.prototype.SubmitAccountFieldsRequest=function(){var n=this;this._scope.Loading=!0;this._airPlusApi.LookupAirPlusFieldsForAccount(this._scope.CompanyAccountNumber).then(function(t){n.ProcessLookupResponse(t)}).catch(function(t){n.ProcessLookupError(t)})},i.prototype.ProcessLookupError=function(t){this._scope.Loading=!1;t===n.Data.Rebooking.KnownError.AirPlusCompanyAccountInvalid?(this.TrackEvent(Tracking.EventConstants.Actions.Error,this._settings.WrongNumberValidationText),this._scope.IsWrongAccountNumber=!0):this._errorService.HandleApiError(t)},i.prototype.ProcessLookupResponse=function(t){if(this._scope.Loading=!1,this.ResponseIsValid(t)){var i={AirPlusFields:t.AirPlusFields,BookingReference:this.GetDrawerParameters().BookingReference,CompanyAccountNumber:this._scope.CompanyAccountNumber},r={AllowBackOverride:n.Data.DrawerBackOverride.AlwaysHide,Parameters:i,SectionKey:"airplus-supplementary-data-drawer"};n.Events.OpenDrawerWithOptions(r)}else this._errorService.ShowAirPlusErrorDrawer(null)},i.prototype.ResponseIsValid=function(n){return!!n.AirPlusFields&&n.AirPlusFields.length>0},i.ControllerName="Funnel_AirPlusRequestAccountDrawer",i.$inject=["Funnel_AirPlusApiService","Funnel_AirPlusErrorService","$scope","Sitecore_AirPlusRequestAccountDrawerSettings","IAnalyticsTracker"],i}(t.Common.Drawers.AirplusDrawer);i.AirPlusRequestAccountDrawer=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(n,i,r,u,f,e){var o=t.call(this,f)||this;return o._airPlusApi=n,o._errorService=i,o._scope=r,o._settings=u,o._airPlusCookieService=e,r.ChangeFieldDate=o.ChangeFieldDate.bind(o),r.FieldHasFieldRule=o.FieldHasFieldRule.bind(o),r.GetFieldGroupAriaText=o.GetFieldGroupAriaText.bind(o),r.GetInputMode=o.GetInputMode.bind(o),r.GetOrderedFieldRules=o.GetOrderedFieldRules.bind(o),r.GetPatternForFieldType=o.GetPatternForFieldType.bind(o),r.GetValidMinimumRequiredFields=o.GetValidMinimumRequiredFields.bind(o),r.IsAlphabeticField=o.IsAlphabeticField.bind(o),r.IsAlphanumericField=o.IsAlphanumericField.bind(o),r.IsDateFieldType=o.IsDateFieldType.bind(o),r.IsNumericField=o.IsNumericField.bind(o),r.IsRequiredField=o.IsRequiredField.bind(o),r.IsOptionalField=o.IsOptionalField.bind(o),r.IsMinimumRequiredField=o.IsMinimumRequiredField.bind(o),r.IsValidFormat=o.IsValidFormat.bind(o),r.MinimumRequiredFieldsFilled=o.MinimumRequiredFieldsFilled.bind(o),r.OnSubmit=o.OnSubmit.bind(o),r.AirPlusFields=o.GetAirPlusFieldsSortedByRequirement(),r.DateFieldDisplayFormat=o._settings.DateFieldFormat,r.DateFieldValueFormat="YYYY-MM-DD",r.Loading=!1,r.MinimumRequiredFields=o.GetMinimumRequiredFields(),o.TrackEvent(Tracking.EventConstants.Actions.Load,Tracking.EventConstants.Labels.SupplementaryInformationDrawer),o}return __extends(i,t),i.prototype.GetFieldGroupAriaText=function(t){return t===n.Data.Funnel.AirPlus.AirPlusFieldRule.Obligatory?this._settings.RequiredFieldGroupAriaText:t===n.Data.Funnel.AirPlus.AirPlusFieldRule.Optional?this._settings.OptionalFieldGroupAriaText:t===n.Data.Funnel.AirPlus.AirPlusFieldRule.MinimumObligatory?this._settings.MinimumRequiredFieldGroupAriaText.replaceAll("{minimum_required_fields}",this.GetMinimumRequiredFields().toString()):""},i.prototype.GetOrderedFieldRules=function(){return[n.Data.Funnel.AirPlus.AirPlusFieldRule.Obligatory,n.Data.Funnel.AirPlus.AirPlusFieldRule.Optional,n.Data.Funnel.AirPlus.AirPlusFieldRule.MinimumObligatory]},i.prototype.FieldHasFieldRule=function(n,t){return n.FieldRule===t},i.prototype.GetAirPlusFieldsSortedByRequirement=function(){var n=this,t=this.GetDrawerParameters().AirPlusFields;return t.sort(function(t,i){return n.IsRequiredField(t)&&!n.IsRequiredField(i)||n.IsOptionalField(t)&&n.IsMinimumRequiredField(i)?-1:n.IsMinimumRequiredField(t)&&!n.IsMinimumRequiredField(i)||n.IsOptionalField(t)&&n.IsRequiredField(i)?1:0})},i.prototype.GetMinimumRequiredFields=function(){var n=0;return this._scope.AirPlusFields.forEach(function(t){!!t.MinimumObligatoryFields&&t.MinimumObligatoryFields>n&&(n=t.MinimumObligatoryFields)}),n},i.prototype.ChangeFieldDate=function(t,i){var r=this,u={OnSelectDate:function(n){i.Value=n.Format(r._scope.DateFieldValueFormat)},StartDate:Utilities.TimeAgnosticDate.TodayLocal(),EndDate:Utilities.TimeAgnosticDate.TodayLocal().AddDays(this._settings.DaysToShow),AnalyticsCategory:null,AnalyticsAction:null},f={SectionKey:"genericdatepickerdrawer",Parameters:u,PreventDismissOverride:!0,TitleOverride:this._settings.DatePickerTitle.replaceAll("{field_full_name}",i.FullName)};n.Events.OpenDrawerWithOptions(f)},i.prototype.GetDrawerParameters=function(){return this._scope.CurrentSection.Options.Parameters},i.prototype.IsValidFormat=function(){return this._scope.AirPlusSupplementaryDataForm.$valid},i.prototype.IsDateFieldType=function(t){return t===n.Data.Funnel.AirPlus.AirPlusFieldType.Date},i.prototype.GetValidMinimumRequiredFields=function(){var n=this,t=this._scope.AirPlusFields.filter(function(t){return n.IsMinimumRequiredField(t)});return t.filter(function(n){return!!n.Value&&!!n.Value.length}).length},i.prototype.IsAlphabeticField=function(t){return t.FieldType===n.Data.Funnel.AirPlus.AirPlusFieldType.Alpha},i.prototype.IsAlphanumericField=function(t){return t.FieldType===n.Data.Funnel.AirPlus.AirPlusFieldType.Alphanumeric},i.prototype.IsNumericField=function(t){return t.FieldType===n.Data.Funnel.AirPlus.AirPlusFieldType.Numeric},i.prototype.MinimumRequiredFieldsFilled=function(){return this.GetValidMinimumRequiredFields()>=this._scope.MinimumRequiredFields},i.prototype.IsRequiredField=function(t){return t.FieldRule===n.Data.Funnel.AirPlus.AirPlusFieldRule.Obligatory},i.prototype.IsOptionalField=function(t){return t.FieldRule===n.Data.Funnel.AirPlus.AirPlusFieldRule.Optional},i.prototype.IsMinimumRequiredField=function(t){return t.FieldRule===n.Data.Funnel.AirPlus.AirPlusFieldRule.MinimumObligatory},i.prototype.GetInputMode=function(t){return t===n.Data.Funnel.AirPlus.AirPlusFieldType.Numeric?"numeric":"verbatim"},i.prototype.GetPatternForFieldType=function(t){return t===n.Data.Funnel.AirPlus.AirPlusFieldType.Alpha?this._settings.AlphabeticFieldAllowedRegex:t===n.Data.Funnel.AirPlus.AirPlusFieldType.Numeric?this._settings.NumericFieldAllowedRegex:this._settings.AlphanumericFieldAllowedRegex},i.prototype.OnSubmit=function(){this._scope.FormSubmitted=!0;!this._scope.Loading&&this.IsValidFormat()&&this.SubmitUpdateFieldsRequest()},i.prototype.SubmitUpdateFieldsRequest=function(){var n=this,t=this.GetDrawerParameters(),i={AirPlusFields:this._scope.AirPlusFields,BookingReference:t.BookingReference,CompanyAccount:t.CompanyAccountNumber};this._scope.Loading=!0;this._airPlusApi.UpdateAirPlusFields(i).then(function(t){n.ProcessUpdateResponse(t)}).catch(function(t){n.ProcessUpdateError(t)})},i.prototype.ProcessUpdateError=function(n){this._scope.Loading=!1;this._errorService.HandleApiError(n)},i.prototype.ProcessUpdateResponse=function(t){if(this._scope.Loading=!1,this.ResultsAreValid(t.AirPlusFieldUpdateResults)){this.TrackEvent(Tracking.EventConstants.Actions.Completed,Tracking.EventConstants.Labels.Completed);var i={SectionKey:"airplus-success-drawer",AllowBackOverride:n.Data.DrawerBackOverride.AlwaysHide,OnConfirmCallback:function(){n.Events.Fire(n.Events.Names.Drawer.Close)}};this._airPlusCookieService.RemoveCookie();n.Events.OpenDrawerWithOptions(i)}else this._errorService.ShowAirPlusErrorDrawer(n.Data.Funnel.AirPlus.AirPlusErrorDrawerType.ResultError)},i.prototype.ResultsAreValid=function(n){return!!n&&!n.some(function(n){return!n.Success})},i.ControllerName="Funnel_AirPlusSupplementaryDataDrawer",i.$inject=["Funnel_AirPlusApiService","Funnel_AirPlusErrorService","$scope","Sitecore_AirPlusSupplementaryDataDrawerSettings","IAnalyticsTracker","AirPlusCookie_Service"],i}(t.Common.Drawers.AirplusDrawer);i.AirPlusSupplementaryDataDrawer=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c){var l=this;this._scope=t;this._funnelPriceService=i;this._funnelBasketService=r;this._funnelBasketHotelsService=u;this._priceService=f;this._flightTaxCalculator=e;this._priceBreakdownDrawer=o;this._funnelJourneyService=s;this._pageSettings=h;this._funnelVouchersAssociationService=c;this._scope.$on(n.Events.Names.DrawerSection.Shown,function(){l._scope.AdminFee=l.AdminFee();l._scope.FlightsTotalCost=l.FlightsTotalCost();l._scope.FlightsTotalTax=l.FlightsTotalTax();l._scope.TotalBasketPrice=l.TotalBasketPrice();l.SetupSeats();l.SetupHoldItems();l.SetupHotels();l.SetupCars();l.SetupTravelInsurance();l.SetupInFlightVouchers();l._scope.ApplyFormatting();l._scope.ShowAdditionalContent=l.ShouldShowAdditionalContent()})}return t.prototype.AdminFee=function(){return this._funnelBasketService.GetFixedCharges().AdminFee},t.prototype.FlightsTotalTax=function(){return this._flightTaxCalculator.GetBasketTaxes()},t.prototype.FlightsTotalCost=function(){return this._priceService.Subtract(this._funnelPriceService.GetPriceOfFlights(),this.AdminFee(),this.FlightsTotalTax())},t.prototype.SetupSeats=function(){this._scope.SeatsTotalCost=this._funnelPriceService.GetPriceOfSeats();this._scope.HasSeats=this.HasBasket()&&this._funnelBasketService.HasAnySeatsAssigned()},t.prototype.SetupHoldItems=function(){this._scope.HoldItemsTotalCost=this._funnelPriceService.GetPriceOfAllLuggage();this._scope.HasHoldItems=this.HasBasket()&&this._funnelBasketService.BasketContainsLuggage()},t.prototype.SetupHotels=function(){this._scope.HotelsTotalCost=this._funnelPriceService.GetPriceOfHotelInBasketCurrency();this._scope.HasHotel=this.HasBasket()&&this._funnelBasketHotelsService.HasHotel()},t.prototype.SetupCars=function(){this._scope.HasCarHire=this.HasBasket()&&!!this._funnelBasketService.GetBasket().Car;this._scope.CarHireTotalCost=this._funnelPriceService.GetPriceOfCar()},t.prototype.SetupTravelInsurance=function(){this._scope.HasTravelInsurance=this.HasBasket()&&!!this._funnelBasketService.GetBasket().TravelInsurance&&!!this._funnelBasketService.GetBasket().TravelInsurance.Policy;this._scope.TravelInsuranceTotalCost=this._funnelPriceService.GetPriceOfTravelInsurance()},t.prototype.SetupInFlightVouchers=function(){this._scope.HasInFlightVouchers=this.HasBasket()&&this._funnelVouchersAssociationService.ThereAreVouchersInTheBasket();this._scope.InFlightVouchersCost=this._funnelPriceService.GetPriceOfVouchers()},t.prototype.TotalBasketPrice=function(){return this._funnelPriceService.TotalPrice()},t.prototype.ZeroPrice=function(){return this._priceService.NewPrice(0,0,0)},t.prototype.HasBasket=function(){return!!this._funnelBasketService.GetBasket()},t.prototype.ShouldShowAdditionalContent=function(){return Utilities.Arrays.ContainsGuid(this._priceBreakdownDrawer.ShowAdditionalContentPages,this._pageSettings.CurrentPageId)||Utilities.Arrays.ContainsGuid(this._priceBreakdownDrawer.ShowAdditionalContentSteps,this._funnelJourneyService.GetCurrentStepInJourney().StepId)},t.ControllerName="Funnel_BasketPriceBreakdownDrawer",t.$inject=["$scope","Funnel_PriceService","Funnel_BasketService","Funnel_BasketHotelsService","Common_PriceService","Funnel_FlightTaxCalculator","Sitecore_PriceBreakdownDrawer","Funnel_JourneyService","Sitecore_PageSettings","Funnel_VouchersAssociationsService"],t}();t.BasketPriceBreakdownDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(t){function i(n,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt){var tt=t.call(this,i,r,u,e,o,s,h)||this,it;return tt._qService=n,tt._funnelBasketService=c,tt._funnelPickFlightsJourneyChangeService=l,tt._searchPodSubmissionService=a,tt._funnelJourneyCookieService=v,tt._funnelBasketUpdateService=y,tt._basketFlightSelectionService=p,tt._funnelApi=w,tt._errorService=b,tt._clientBasketBuilder=k,tt._accessibilityService=d,tt._funnelActivePairService=g,tt._changeSearchDrawerSettings=nt,tt.SetSearchPodModel(),tt._scope.PassengerCompositionChangedWarningMessageVisible=!1,tt._scope.ChooseFlightsAnalyticsCategory=Tracking.EventConstants.Categories.ChooseFlights,tt._scope.ChangeSearchAnalyticsAction=Tracking.EventConstants.Actions.ChangeSearch,it=tt._funnelBasketService.GetPassengerComposition(),tt._scope.Passengers={Adults:it.Adults,Children:it.Children,Infants:it.Infants},tt.OpenNestedDrawerIfRequired(),tt}return __extends(i,t),i.prototype.BuildInitialSearchPodModel=function(){var n=this._funnelJourneyCookieService.ReadCookie();return{OriginIata:n.OriginIata,DestinationIata:n.DestinationIata,IsOneWayFlight:!n.ReturnDate,DepartureDate:n.OutboundDate,ReturnDate:n.ReturnDate,Passengers:this._funnelBasketService.GetPassengerComposition(),RecentSearches:0}},i.prototype.FormAction=function(){this.PassengerCompositionHasChanged()&&!this._scope.PassengerCompositionChangedWarningMessageVisible?(this._scope.PassengerCompositionChangedWarningMessageVisible=!0,this._accessibilityService.AlertChangeSearchPassengerCompositionChangedWarning(this._changeSearchDrawerSettings.PassengerCompositionChangedWarningMessage)):(this._scope.SearchPodModel.Passengers=this._scope.Passengers,this._searchPodSubmissionService.ShowInfoDrawersAndSubmitTheForm(this._scope.SearchPodModel,!0,this.SetNewRoute.bind(this)))},i.prototype.SetNewRoute=function(){var n={OriginIata:this._scope.SearchPodModel.OriginIata,DestinationIata:this._scope.SearchPodModel.DestinationIata,OutboundDate:this._scope.SearchPodModel.DepartureDate,ReturnDate:this._scope.SearchPodModel.IsOneWayFlight?null:this._scope.SearchPodModel.ReturnDate,IsOneWayFlight:this._scope.SearchPodModel.IsOneWayFlight,Adults:this._scope.Passengers.Adults,Children:this._scope.Passengers.Children,Infants:this._scope.Passengers.Infants};this.PassengerCompositionHasChanged()?this.EmptyBasketAndUpdateGridAndPassengerComposition(n):(this.FirePostCloseDrawerEvents(),this._funnelPickFlightsJourneyChangeService.UpdateGrid(n),this._funnelActivePairService.ActivePairHasNoFlights()&&this.UpdateEmptyJourney(n))},i.prototype.UpdateEmptyJourney=function(t){var i=this._funnelActivePairService.GetActiveJourneyPair().Id,u=this._funnelBasketService.GetPrimaryJourneyPair().Id===i,r;this.UpdateJourneyCookieBasedOnSearchParams(t);r=this._funnelBasketUpdateService.CreateJourneyPair(t,i,u);this._funnelBasketUpdateService.ReplaceClientBasketJourneyPair(r,i);n.Events.Fire(n.Events.Names.Funnel.ActiveJourneyPairChanged)},i.prototype.PassengerCompositionHasChanged=function(){var n=this._funnelBasketService.GetPassengerComposition(),t=n.Adults===this._scope.Passengers.Adults&&n.Children===this._scope.Passengers.Children&&n.Infants===this._scope.Passengers.Infants;return!t},i.prototype.EmptyBasketAndUpdateGridAndPassengerComposition=function(n){var t=this,i,r;this.FirePostCloseDrawerEvents();i=this._clientBasketBuilder.CreateClientBasketPassengerDataFromFunnelQuery(n.Adults,n.Children);r=this._clientBasketBuilder.CreateClientBasketInfantDataFromFunnelQuery(n.Infants);this._funnelActivePairService.SetPrimaryJourneyPairAsActivePair();this.EmptyServerBasket().then(function(){t._funnelBasketService.SetServerBasketRemoved();t.UpdateJourneyCookieBasedOnSearchParams(n);var u=t._funnelActivePairService.GetActiveJourneyPair();t._funnelBasketUpdateService.ResetPassengerCompositionInClientBasket(n,i,r,u.Id);t._accessibilityService.AlertAllFlightsAndExtrasRemovedFromBasket();t._funnelPickFlightsJourneyChangeService.UpdateGrid(n)})},i.prototype.FirePostCloseDrawerEvents=function(){n.Events.Fire(n.Events.Names.Drawer.Close);n.Events.Fire(n.Events.Names.Basket.Hide);n.Events.Fire(n.Events.Names.Funnel.ScrollToOutboundLeg)},i.prototype.UpdateJourneyCookieBasedOnSearchParams=function(n){var t=this._funnelJourneyCookieService.ReadCookie();t.NumberOfAdults=n.Adults;t.NumberOfChildren=n.Children;t.NumberOfInfants=n.Infants;t.OriginIata=n.OriginIata;t.DestinationIata=n.DestinationIata;t.OutboundDate=n.OutboundDate;t.ReturnDate=n.IsOneWayFlight?null:n.ReturnDate;t.JourneyPairs=[];this._funnelJourneyCookieService.WriteCookie(t)},i.prototype.EmptyServerBasket=function(){var n=this._qService.defer();return this._funnelApi.EmptyBasket(n.resolve,this._errorService.HandleDeferredError(n)),n.promise},i.prototype.OpenNestedDrawerIfRequired=function(){var t=this._scope.Section.Options.Parameters;!t||!t.NestedDrawer||n.Events.OpenDrawer(t.NestedDrawer)},i.ControllerName="Funnel_ChangeSearchDrawer",i.$inject=["$q","$scope","Sitecore_SearchPodSettings","Worldwide_CombinedRoutesService","Sitecore_RoutesData","Controls_LowestFaresApiService","Controls_LowestFaresDataFlightFinder","Controls_RouteDataFlightFinder","Controls_SearchPodRouteDatesPreloader","Funnel_BasketService","Funnel_PickFlightsJourneyChangeService","Controls_SearchPodSubmissionService","FunnelJourneyCookie_Service","Funnel_BasketUpdateService","Funnel_BasketFlightSelectionService","Funnel_Api","Funnel_ErrorService","Funnel_BasketBuilder","Funnel_AccessibilityService","Funnel_ActivePairService","Sitecore_ChangeSearchDrawerSettings"],i}(n.Controllers.Controls.SearchPod.BaseSearchPodController);t.ChangeSearchDrawer=i})(i=t.Drawers||(t.Drawers={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f){this._scope=t;this._funnelService=i;this._sessionExpirySettings=r;this._errorService=u;this._navigationService=f;this._scope.SecondsRemaining=this._sessionExpirySettings.MessageSeconds;this._scope.$on(n.Events.Names.DrawerSection.Shown,this.StartCountdown.bind(this));this._scope.$on(n.Events.Names.DrawerSection.Hidden,this.StopCountdown.bind(this));this._scope.$on(n.Events.Names.Drawer.Dismissed,this.ManualKeepAlive.bind(this));this._scope.DoKeepAlive=this.ManualKeepAlive.bind(this)}return t.prototype.StartCountdown=function(){var n=this;this._countdownStart=Utilities.ZonelessDateTime.NowLocal();this._countdownIntervalId=setInterval(function(){n.CountdownInterval()},500)},t.prototype.StopCountdown=function(){this._countdownIntervalId&&clearInterval(this._countdownIntervalId)},t.prototype.ManualKeepAlive=function(){var t=this,i=this._funnelService.KeepSessionAlive();i.then(function(){t._scope.$emit(n.Events.Names.PickFlightsOptions.ResetExpiryTimer,!0)});this._scope.$emit(n.Events.Names.Drawer.Back)},t.prototype.CountdownInterval=function(){var i=Utilities.ZonelessDateTime.NowLocal().Difference(this._countdownStart,Utilities.ZonelessDateTimePart.Seconds),t=Math.round(this._sessionExpirySettings.MessageSeconds-i);t<0?(this.StopCountdown(),this._navigationService.NavigateTo("/"),this._scope.$emit(n.Events.Names.Drawer.Close)):this._scope.$applyAsync(function(n){n.SecondsRemaining=t})},t.ControllerName="Session_Expiry",t.$inject=["$scope","Funnel_Service","Sitecore_SessionExpirySettings","Error_Service","Common_NavigationService"],t}();t.SessionExpiry=i})(i=t.Drawer||(t.Drawer={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t){this._scope=n;this._flightDataService=t;this._scope.IsAircraftFlyingTheRoute=this.IsAircraftFlyingTheRoute.bind(this)}return t.prototype.IsAircraftFlyingTheRoute=function(n){return n.indexOf(this._flightDataService.GetCurrentFlightData().AircraftType)>-1},t.ControllerName="Funnel_TravellingWithChildrenDrawer",t.$inject=["$scope",n.DynamicDependencyKeys.SeatMapFlightDataService],t}();t.TravellingWithChildrenDrawer=i})(i=t.Drawers||(t.Drawers={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f){this._funnelBasketService=u;this._insuranceBasketService=f;this._rootScope=n;this._scope=t;this._passengerDetailsPersonSettings=i;this._funnelAccessibilityService=r;this._scope.Passengers=angular.copy(this._scope.CurrentSection.Options.Parameters.Passengers);this._scope.ShowAdultRequiredError=this.IsAdultRequiredErrorVisible.bind(this);this._scope.UpdateQuote=this.UpdateQuote.bind(this);this._scope.PassengerIsInsuredAdult=this.PassengerIsInsuredAdult.bind(this);this._scope.OnSelectPassengerChange=this.OnSelectedPassengerChange.bind(this)}return t.prototype.OnSelectedPassengerChange=function(n){n.Insured===!0?this._funnelAccessibilityService.TravelInsurancePassengerAddedAlert(n.DisplayName):this._funnelAccessibilityService.TravelInsurancePassengerRemovedAlert(n.DisplayName)},t.prototype.AreAnyAdultsSelected=function(){return this._scope.Passengers.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Adult&&t.Insured===!0}).length>0},t.prototype.IsAdultRequiredErrorVisible=function(){return this.AreAnyAdultsSelected()===!1?!0:!1},t.prototype.PassengerIsInsuredAdult=function(t){return t.Insured&&t.Type===n.Data.Common.PassengerDataType.Adult},t.prototype.UpdateQuote=function(){var t=this,i;this._insuranceBasketService.HasTravelInsuranceInClientBasket()?(i={SectionKey:"travel-insurance-quote-may-have-changed-drawer",Parameters:this._scope.CurrentSection.Options.Parameters,PreventDismissOverride:!0,OnConfirmCallback:function(){t._scope.CurrentSection.Options.Parameters.OnUpdateQuote(t._scope.Passengers);n.Events.Fire(n.Events.Names.Drawer.Close)}},n.Events.OpenDrawerWithOptions(i)):(this._scope.CurrentSection.Options.Parameters.OnUpdateQuote(this._scope.Passengers),n.Events.Fire(n.Events.Names.Drawer.Close))},t.ControllerName="Funnel_WhoDoYouWantToInsureDrawer",t.$inject=["$rootScope","$scope","Sitecore_FunnelPassengerDetailsPersonSettings","Funnel_AccessibilityService","Funnel_BasketService","Funnel_TravelInsuranceBasketService"],t}();t.WhoDoYouWantToInsureDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._scope=n;this._parameters=this.GetDrawerParameters();this._scope.BelowTitleContent=this._parameters.BelowTitleContent;this._scope.BenefitsItem=this._parameters.BenefitsItem}return n.prototype.GetDrawerParameters=function(){return this._scope.CurrentSection.Options.Parameters},n.ControllerName="Controls_TravelInsurancePolicyInformationDrawer",n.$inject=["$scope"],n}();n.PolicyInformationDrawer=t})(t=n.TravelInsurance||(n.TravelInsurance={}))})(t=n.Drawers||(n.Drawers={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i){this._scope=t;this._analyticsTracker=i;this._parameters=this.GetDrawerParameters();this._analyticsOptions=this.GetDrawerAnalytics();this._scope.VoucherCost=this._parameters.VoucherCost;this._scope.VoucherRedeemableAmount=this._parameters.VoucherRedeemableAmount;this._voucherSavingPercentage=this._parameters.VoucherSavingPercentage;this._scope.MaximumVouchersPerPassenger=this._parameters.MaximumVouchersPerPassenger;this._scope.$on(n.Events.Names.DrawerSection.Hidden,this.DrawerClosedAnalytics.bind(this));this._scope.VoucherSavingPercentage=this.GetVoucherSavingPercentage.bind(this)}return t.prototype.GetDrawerParameters=function(){return this._scope.CurrentSection.Options.Parameters},t.prototype.DrawerClosedAnalytics=function(){this._analyticsTracker.TrackEvent(this._analyticsOptions.Category,this._analyticsOptions.Action,Tracking.EventConstants.Labels.Hide)},t.prototype.GetDrawerAnalytics=function(){return this._scope.CurrentSection.Options.AnalyticsOptions},t.prototype.GetVoucherSavingPercentage=function(){return this._voucherSavingPercentage},t.ControllerName="Controls_VouchersMoreDetailsDrawer",t.$inject=["$scope","IAnalyticsTracker"],t}();t.MoreDetailsDrawer=i})(i=t.Vouchers||(t.Vouchers={}))})(i=t.Drawers||(t.Drawers={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._scope=n;this._errorService=t;this._luggageChargesService=i;this._luggageDrawersService=r;this.LoadWeightList();this._scope.GetPrice=this.GetPrice.bind(this);this._scope.OnSelect=this.OnSelect.bind(this);this._scope.IsSelectableBag=this.IsSelectableBag.bind(this)}return t.prototype.LoadWeightList=function(){var t=this;this._luggageChargesService.GetWeightList().then(function(n){t._scope.WeightList=n;t._scope.OnBagListLoadedPromise.resolve()},function(){t._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.GetWeightList,n.Data.DrawerBackOverride.AlwaysHide)})},t.prototype.GetPrice=function(n){return this._scope.ShowAveragePrices?n.AverageFlightPrice:n.Price},t.prototype.OnSelect=function(n){this._scope.MaximumBaggageAllowanceReached()?this._luggageDrawersService.OpenLuggageLimitReachedDrawer(!0,!1):this._scope.OnSelectBag(n)},t.prototype.IsSelectableBag=function(){return!this._scope.MaximumBaggageAllowanceReached()},t.ControllerName="Funnel_BagWeightOptionsList",t.$inject=["$scope","Funnel_ErrorService",n.DynamicDependencyKeys.LuggageChargesService,"Funnel_LuggageDrawersService"],t}();t.BagWeightOptionsList=i})(i=t.Luggage||(t.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this.$qService=n;this.$scope=t;this._luggageChargesService=i;this._priceService=r;this._drawerParameters=this.GetChangeWeightDrawerParameters(t);this.LoadWeightsList();this.$scope.OnSelect=this.OnSelect.bind(this)}return t.prototype.GetChangeWeightDrawerParameters=function(n){return n.CurrentSection.Options.Parameters},t.prototype.CreateChangeWeightList=function(t){var i=this,r=[],u=this.CalculateBagPriceSaving(t);return(t||[]).forEach(function(t){t&&t.Price&&t.Type===n.Data.Funnel.BagType.StandardHoldBag&&(t.Price=i._priceService.Subtract(t.Price,u.Price),t.AverageFlightPrice=i._priceService.Subtract(t.AverageFlightPrice,u.AverageFlightPrice),r.push(i.CreateChangeWeightBag(t)))}),r},t.prototype.CalculateBagPriceSaving=function(n){var r=this,i=n.filter(function(n){return n.Weight==r._drawerParameters.ComparisonBag.Weight})[0],t=this._drawerParameters.ComparisonBag;return{Price:this._priceService.Subtract(i.Price,t.Price),AverageFlightPrice:this._priceService.Subtract(i.AverageFlightPrice,t.AverageFlightPrice),Weight:t.Weight}},t.prototype.CreateChangeWeightBag=function(n){var t=n;return t.PriceSign=this._priceService.Compare(n.Price,this._drawerParameters.ComparisonBag.Price),t.PriceDifference=t.PriceSign===0?null:t.PriceSign===1?this._priceService.Subtract(n.Price,this._drawerParameters.ComparisonBag.Price):this._priceService.Subtract(this._drawerParameters.ComparisonBag.Price,n.Price),t},t.prototype.LoadWeightsList=function(){var n=this;this._luggageChargesService.GetWeightList().then(function(t){n.$scope.WeightList=t;n.$scope.ChangeWeightList=n.CreateChangeWeightList(t)},this.$qService.reject)},t.prototype.OnSelect=function(t){t.IsFlexiFareBag=this._drawerParameters.ComparisonBag.IsFlexiFareBag;this._drawerParameters.OnSelect(t);this.$scope.$emit(n.Events.Names.Drawer.Close)},t.ControllerName="Funnel_ChangeWeightDrawer",t.$inject=["$q","$scope",n.DynamicDependencyKeys.LuggageChargesService,"Common_PriceService"],t}();t.ChangeWeightDrawer=i})(i=t.Luggage||(t.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._scope=n;this._qService=t;this._drawerParameters=this.GetDrawerParameters();this.SetupLoadedPromises();this._scope.OnSelectBag=this.OnSelectBag.bind(this);this._scope.OnSelectSportsEquipment=this.OnSelectSportsEquipment.bind(this);this._scope.MaximumBaggageAllowanceReached=this._drawerParameters.HasReachedMaximumBaggageAllowance;this._scope.MaximumSportsEquipmentAllowanceReached=this._drawerParameters.HasReachedMaximumSportsEquipmentAllowance;this._scope.LargeSportsEquipmentLimitReached=this._drawerParameters.HasReachedMaximumLargeSportsEquipmentAllowance;this._scope.ShowConditionalBagText=this._drawerParameters.ShowConditionalBagText;this._scope.ShowConditionalSportsText=this._drawerParameters.ShowConditionalSportsText}return n.prototype.SetupLoadedPromises=function(){var n=this;this._scope.BagsLoaded=this._qService.defer();this._scope.SportsEquipmentLoaded=this._qService.defer();this._qService.all([this._scope.BagsLoaded.promise,this._scope.SportsEquipmentLoaded.promise]).then(function(){return n._scope.CurrentSection.Options.DrawerContentIsLoaded.resolve()})},n.prototype.GetDrawerParameters=function(){return this._scope.CurrentSection.Options.Parameters},n.prototype.OnSelectBag=function(n){this._drawerParameters.OnSelectBag(n);this._scope.DoClose()},n.prototype.OnSelectSportsEquipment=function(n){this._drawerParameters.OnSelectSportsEquipment(n);this._scope.DoClose()},n.ControllerName="Funnel_CombinedBagSportsEquipmentDrawer",n.$inject=["$scope","$q"],n}();n.CombinedBagSportsEquipmentDrawer=t})(t=n.Luggage||(n.Luggage={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function i(i,r,u,f,e,o,s,h,c){var l=this;this._basketFlightItemChargeService=i;this._errorService=r;this._luggageChargesService=u;this._luggageDrawersService=f;this._funnelLuggageClientSettings=e;this._funnelBasketService=o;this._scope=s;this._qService=h;this._analyticsService=c;this._scope.IsBagRecommended=this.IsBagRecommended.bind(this);this._scope.AddBagIfLimitNotReached=this.AddBagIfLimitNotReached.bind(this);this._scope.AddSportsEquipmentIfLimitNotReached=this.AddSportsEquipmentIfLimitNotReached.bind(this);this._scope.CountBagsOfType=this.CountBagsOfType.bind(this);this._scope.CountSportsEquipmentOfType=this.CountSportsEquipmentOfType.bind(this);this._scope.OnDifferentWeightButtonClick=this.OnDifferentWeightButtonClick.bind(this);this._scope.RemoveBagOfType=this.RemoveBagOfType.bind(this);this._scope.RemoveSportsEquipmentOfType=this.RemoveSportsEquipmentOfType.bind(this);this._scope.ShowConditionalLabel=this.ShowConditionalLabel.bind(this);this._scope.ShowFromLabelForBag=this.ShowFromLabelForBag.bind(this);this._scope.ShowFromLabelForSports=this.ShowFromLabelForSports.bind(this);this._scope.HoldBagOptionVisible=this.HoldBagOptionVisible.bind(this);this._scope.SportsEquipmentOptionVisible=this.SportsEquipmentOptionVisible.bind(this);this._iconsController=new t.LuggageIconsController(this._funnelLuggageClientSettings,this._scope);this._scope.OnTiledBagsClick=this.OnTiledBagsClick.bind(this);this._scope.OnTiledSportsEquipmentClick=this.OnTiledSportsEquipmentClick.bind(this);this._scope.$on(n.Events.Names.Funnel.LuggageReady,this.LuggageReady.bind(this));this._scope.$watch(function(){return JSON.stringify(l._scope.Bags)},function(){(l._scope.BagOptions||[]).map(function(n){return n.Quantity=l._scope.CountBagsOfType(n.Bag)})});this._scope.$watch(function(){return JSON.stringify(l._scope.SportsEquipment)},function(){(l._scope.SportsEquipmentOptions||[]).map(function(n){return n.Quantity=l._scope.CountSportsEquipmentOfType(n.SportsEquipment)})})}return i.prototype.LuggageReady=function(){this.RunBagRecommendationRules();this.SetBagOptions();this.SetSportsEquipmentOptions();this.SetFromPriceLabels();this.SetCabinBagBasedOnRules()},i.prototype.AddBagIfLimitNotReached=function(n){if(this._scope.HasReachedMaximumBaggageAllowance()){this.OpenLuggageLimitReachedDrawer();return}this._scope.AddBag(n)},i.prototype.OpenLuggageLimitReachedDrawer=function(){var n=this._scope.HasReachedMaximumBaggageAllowance(),t=this._scope.HasReachedMaximumSportsEquipmentAllowance()||this._scope.HasReachedMaximumLargeSportEquipmentsAllowance();this._luggageDrawersService.OpenLuggageLimitReachedDrawer(n,t)},i.prototype.AddSportsEquipmentIfLimitNotReached=function(n){if(this._scope.HasReachedMaximumSportsEquipmentAllowance()||n.IsLarge&&this._scope.HasReachedMaximumLargeSportEquipmentsAllowance()){this.OpenLuggageLimitReachedDrawer();return}this._scope.AddSportsEquipment(n)},i.prototype.CountBagsOfType=function(n){return this._scope.Bags.filter(function(t){return t.Weight===n.Weight&&t.IsFlexiFareBag===!1}).length},i.prototype.CountSportsEquipmentOfType=function(n){return this._scope.SportsEquipment.filter(function(t){return t.Code===n.Code}).length},i.prototype.GetSpecificBagOfType=function(n){return Utilities.Arrays.FirstOrDefault(this._scope.Bags,function(t){return!t.IsFlexiFareBag&&t.Weight===n.Weight})},i.prototype.GetSpecificSportsEquipmentOfType=function(n){return Utilities.Arrays.FirstOrDefault(this._scope.SportsEquipment,function(t){return t.Code===n.Code})},i.prototype.GetBagOptions=function(n){var t=this;return n.map(function(n){return{Bag:n,IsStandardOption:t.IsStandardBagOption(n),Quantity:t.CountBagsOfType(n)}})},i.prototype.GetSportsEquipmentOptions=function(n){var t=this;return n.map(function(n){return{IsStandardOption:!1,SportsEquipment:n,Quantity:t.CountSportsEquipmentOfType(n)}})},i.prototype.IsStandardBagOption=function(t){return this._scope.IsTiledLuggageLayout&&this._scope.Bags.filter(function(n){return n.IsFlexiFareBag}).length>0?!1:this._funnelLuggageClientSettings.BagOptionWeights.some(function(n){return t.Weight===n})||t.Type===n.Data.Funnel.BagType.SmallHoldBag},i.prototype.OnDifferentWeightButtonClick=function(){if(this._scope.HasReachedMaximumBaggageAllowance()&&this._scope.HasReachedMaximumSportsEquipmentAllowance()){this._luggageDrawersService.OpenLuggageLimitReachedDrawer(this._scope.HasReachedMaximumBaggageAllowance(),this._scope.HasReachedMaximumSportsEquipmentAllowance());return}var n={OnSelectBag:this._scope.AddBag,OnSelectSportsEquipment:this._scope.AddSportsEquipment,HasReachedMaximumBaggageAllowance:this._scope.HasReachedMaximumBaggageAllowance,HasReachedMaximumSportsEquipmentAllowance:this._scope.HasReachedMaximumSportsEquipmentAllowance,HasReachedMaximumLargeSportsEquipmentAllowance:this._scope.HasReachedMaximumLargeSportEquipmentsAllowance,ShowConditionalBagText:this._showBagFromLabel,ShowConditionalSportsText:this._showSmallSportsFromLabel||this._showLargeSportsFromLabel};this._luggageDrawersService.OpenCombinedBagsSportsEquipmentDrawer(n)},i.prototype.OnTiledBagsClick=function(){var t={OnSelectBag:this._scope.AddBag,HasReachedMaximumBaggageAllowance:this._scope.HasReachedMaximumBaggageAllowance,ShowConditionalBagText:this._showBagFromLabel,SelectedBags:this.GetVisibleBagWeights()},i={SectionKey:"tiled-bags-drawer",DrawerContentIsLoaded:this._qService.defer(),Parameters:t};n.Events.OpenDrawerWithOptions(i)},i.prototype.GetVisibleBagWeights=function(){return this._scope.BagOptions.filter(function(n){return(n.IsStandardOption||n.Quantity>0)&&!n.Bag.IsFlexiFareBag}).map(function(n){return n.Bag.Weight})},i.prototype.OnTiledSportsEquipmentClick=function(){var t={OnSelectSportsEquipment:this._scope.AddSportsEquipment,HasReachedMaximumSportsEquipmentAllowance:this._scope.HasReachedMaximumSportsEquipmentAllowance,HasReachedMaximumLargeSportsEquipmentAllowance:this._scope.HasReachedMaximumLargeSportEquipmentsAllowance,ShowConditionalSportsText:this._showSmallSportsFromLabel||this._showLargeSportsFromLabel,SelectedSportsEquipment:this.GetVisibleSportsEquipmentCodes()},i={SectionKey:"tiled-sports-equipment-drawer",DrawerContentIsLoaded:this._qService.defer(),Parameters:t};n.Events.OpenDrawerWithOptions(i)},i.prototype.GetVisibleSportsEquipmentCodes=function(){return this._scope.SportsEquipmentOptions.filter(function(n){return n.Quantity>0||n.IsStandardOption}).map(function(n){return n.SportsEquipment.Code})},i.prototype.RemoveBagOfType=function(n){var t=this.GetSpecificBagOfType(n);this._scope.RemoveBag(t)},i.prototype.RemoveSportsEquipmentOfType=function(n){var t=this.GetSpecificSportsEquipmentOfType(n);this._scope.RemoveSportsEquipment(t)},i.prototype.SetBagOptions=function(){var n=this;this._luggageChargesService.GetWeightList().then(function(t){n._scope.BagOptions=n.GetBagOptions(t)},function(){n._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.GetWeightList)})},i.prototype.SetFromPriceLabels=function(){var n=this;this._basketFlightItemChargeService.GetFlightItemCharges(!1).then(function(t){n._showBagFromLabel=n.HasMoreThanOneUniquePrice(t,function(n){return n.HoldLuggage})||n.HasMoreThanOneUniquePrice(t,function(n){return n.HoldLuggageExcessWeight});n._showSmallSportsFromLabel=n.HasMoreThanOneUniquePrice(t,function(n){return n.SmallSportsEquipment});n._showLargeSportsFromLabel=n.HasMoreThanOneUniquePrice(t,function(n){return n.LargeSportsEquipment})})},i.prototype.HasMoreThanOneUniquePrice=function(t,i){return _(t.map(function(t){return i(t).Amount[n.Data.Common.PaymentType.DebitCard]})).unique().length!==1},i.prototype.SetSportsEquipmentOptions=function(){var n=this;this._luggageChargesService.GetSportsEquipmentList().then(function(t){n._scope.SportsEquipmentOptions=n.GetSportsEquipmentOptions(t)},function(){n._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.GetWeightList)})},i.prototype.ShowConditionalLabel=function(){return this._showBagFromLabel||_(this._scope.SportsEquipment).any(function(n){return n.IsLarge})&&this._showLargeSportsFromLabel||_(this._scope.SportsEquipment).any(function(n){return!n.IsLarge})&&this._showSmallSportsFromLabel},i.prototype.ShowFromLabelForBag=function(t){return t&&this._showBagFromLabel&&t.Price[n.Data.Common.PaymentType.DebitCard]!==0},i.prototype.ShowFromLabelForSports=function(n){return n&&(n.IsLarge?this._showLargeSportsFromLabel:this._showSmallSportsFromLabel)},i.prototype.HoldBagOptionVisible=function(n){return n.IsStandardOption||n.Quantity>0},i.prototype.SportsEquipmentOptionVisible=function(n){return n.Quantity>0},i.prototype.IsBagRecommended=function(n){var r=this.GetVisibleBagWeights(),t,i;return!this._bagRecommendationMatch?!1:(t=this._bagRecommendationMatch.BagWeight===n.Weight.toString(),i=r.some(function(t){return t.toString()===n.Weight.toString()}),t&&i)},i.prototype.RunBagRecommendationRules=function(){var i=this._funnelBasketService.BuildBookingRulesArgsFromBasket(),t=this._funnelLuggageClientSettings.BagRecommendationRules,n;!t||(n=Main3.SitecoreRules.Pipeline.PipelineRunner.RunPipeline(t,new Main3.SitecoreRules.Rules.Pipelines.Args.BookingRulePipelineArgs(i)),n.Matched&&n.ItemIds().length>0&&(this._bagRecommendationMatch=Utilities.Arrays.FirstOrDefault(this._funnelLuggageClientSettings.BagRecommendations,function(t){return new System.Guid(t.BagRuleGuid).Equals(n.ItemIds()[0])}),this.SendBagRecommendationAnalytics()))},i.prototype.SetCabinBagBasedOnRules=function(){var n=this,t=this._funnelBasketService.BuildBookingRulesArgsFromBasket();!!this._funnelLuggageClientSettings.RuleBasedCabinBagTiles&&this._funnelLuggageClientSettings.RuleBasedCabinBagTiles.length>0&&this._funnelLuggageClientSettings.RuleBasedCabinBagTiles.some(function(i){var r=Main3.SitecoreRules.Pipeline.PipelineRunner.RunPipeline(n.GetRulesFromCabinBagTile(i),new Main3.SitecoreRules.Rules.Pipelines.Args.BookingRulePipelineArgs(t));if(r.Matched&&r.ItemIds().length>0)return n._scope.CabinBag=i,!0})},i.prototype.GetRulesFromCabinBagTile=function(n){return{ItemId:n.ItemId,ItemRules:[JSON.parse(n.Rules)]}},i.prototype.SendBagRecommendationAnalytics=function(){var n=this._bagRecommendationMatch.BagWeight+"kg";this._analyticsService.TrackEvent(Tracking.EventConstants.Categories.Luggage,Tracking.EventConstants.Actions.Recommendation,n)},i.ControllerName="Funnel_LuggagePageController",i.$inject=["Funnel_BasketFlightItemChargeService","Funnel_ErrorService",n.DynamicDependencyKeys.LuggageChargesService,"Funnel_LuggageDrawersService","Sitecore_FunnelLuggageClientSettings","Funnel_BasketService","$scope","$q","IAnalyticsTracker"],i}();t.FunnelLuggagePageController=i})(i=t.Luggage||(t.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){this._scope=t;this._qService=i;this._funnelService=r;this._funnelBasketService=u;this._priceService=f;this._errorService=e;this._luggageRulesService=o;this._funnelBasketLuggageService=s;this._basketFlightItemChargeService=h;this._luggageChargesService=c;this._luggageLimitsService=l;this._accessibilityService=a;this._window=v;this._luggageDrawersService=y;this._funnelJourneyService=p;this._luggageReadyDeferred=this._qService.defer();this._scope.AddBag=this.AddBag.bind(this);this._scope.AddSportsEquipment=this.AddSportsEquipment.bind(this);this._scope.HasLuggage=this.HasLuggage.bind(this);this._scope.HasReachedMaximumBaggageAllowance=this.HasReachedMaximumBaggageAllowance.bind(this);this._scope.HasReachedMaximumLargeSportEquipmentsAllowance=this.HasReachedMaximumLargeSportEquipmentsAllowance.bind(this);this._scope.HasReachedMaximumSportsEquipmentAllowance=this.HasReachedMaximumSportsEquipmentAllowance.bind(this);this._scope.LuggageReady=this.LuggageReady.bind(this);this._scope.OnChangeWeightButtonClick=this.OnChangeWeightButtonClick.bind(this);this._scope.OpenSkipWithNoLuggageDrawer=this.OpenSkipWithNoLuggageDrawer.bind(this);this._scope.OpenCabinBagOnlyDrawer=this.OpenCabinBagOnlyDrawer.bind(this);this._scope.RemoveBag=this.RemoveBag.bind(this);this._scope.RemoveSportsEquipment=this.RemoveSportsEquipment.bind(this);this._scope.SetTotalPriceAndWeight=this.SetTotalPriceAndWeight.bind(this);this._scope.Price=this._priceService.NewPrice(0,0);this._scope.Weight=0;this._hasUpdateInProgress=!1;this._scope.IsTemporarilyDisabled=this.HasUpdateInProgress.bind(this);this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this);w.AllowDeleteLuggage()}return t.prototype.HasUpdateInProgress=function(){return this._hasUpdateInProgress},t.prototype.FunnelReady=function(){this.PreloadApiCalls();this._luggageLimitsService.Initialize();this.UpdateScopeLuggage();this._basketHasLuggage=this.HasLuggage()},t.prototype.IsValid=function(){return this._scope.Bags&&this._scope.Bags.length>0||this._scope.SportsEquipment&&this._scope.SportsEquipment.length>0},t.prototype.Skip=function(){if(this._scope.EnableSkipDrawer)return this.OpenSkipWithNoLuggageDrawer(),this._qService.defer().promise},t.prototype.ShouldExitFunnel=function(){return!this._funnelBasketService.HasAnyFlights()},t.prototype.GetStepOnLoadRedirect=function(){return this._funnelJourneyService.GetStepOnLoadInvalidFlightRedirect(Tracking.EventConstants.Categories.Luggage)},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!1}},t.prototype.AddBag=function(n){var t=this;this._hasUpdateInProgress=!0;this._funnelBasketLuggageService.AddBagToServerBasket(n).then(function(i){t._funnelBasketLuggageService.UpdateClientBasketFromServer(i.Luggage);t._accessibilityService.AlertBagAddedToBasket(n);t.UpdateScopeLuggage();t._hasUpdateInProgress=!1;var r=t._scope.Bags.length-1;t._scope.SetFocusAfterLuggageItemAdded(r,!1)})},t.prototype.AddSportsEquipment=function(n){var t=this;this._hasUpdateInProgress=!0;this._funnelBasketLuggageService.AddSportsEquipmentToServerBasket(n).then(function(i){t._funnelBasketLuggageService.UpdateClientBasketFromServer(i.Luggage);t._accessibilityService.AlertSportsEquipmentAddedToBasket(n);t.UpdateScopeLuggage();t._hasUpdateInProgress=!1;var r=t._scope.SportsEquipment.length-1;t._scope.SetFocusAfterLuggageItemAdded(r,!0)})},t.prototype.ChangeBagSelected=function(n,t){var i=this;this._hasUpdateInProgress=!0;this._funnelBasketLuggageService.RemoveBagFromServerBasket(n).then(function(r){i._funnelBasketLuggageService.UpdateClientBasketFromServer(r.Luggage);i._funnelBasketLuggageService.AddBagToServerBasket(t).then(function(r){i._funnelBasketLuggageService.UpdateClientBasketFromServer(r.Luggage);n.Weight!==t.Weight&&i._accessibilityService.AlertBagWeightChangedInBasket(n,t);i.UpdateScopeLuggage();i._hasUpdateInProgress=!1})})},t.prototype.HasLuggage=function(){return this._scope.Bags&&this._scope.Bags.length>0||this._scope.SportsEquipment&&this._scope.SportsEquipment.length>0},t.prototype.HasReachedMaximumBaggageAllowance=function(){return this._scope.IsLuggageReady?this._luggageLimitsService.HasReachedMaximumBaggageAllowance(this._scope.Bags):!1},t.prototype.HasReachedMaximumSportsEquipmentAllowance=function(){return this._scope.IsLuggageReady?this._luggageLimitsService.HasReachedMaximumSportsEquipmentAllowance(this._scope.SportsEquipment):!1},t.prototype.HasReachedMaximumLargeSportEquipmentsAllowance=function(){return this._scope.IsLuggageReady?this._luggageLimitsService.HasReachedMaximumLargeSportsEquipmentAllowance(this._scope.SportsEquipment):!1},t.prototype.LuggageReady=function(){return this._luggageReadyDeferred.promise},t.prototype.OnChangeWeightButtonClick=function(n,t){var i=this;n.preventDefault();this._luggageDrawersService.OpenChangeWeightDrawer(t,function(n){return i.ChangeBagSelected(t,n)})},t.prototype.PreloadApiCalls=function(){var t=this,i=[this._luggageRulesService.GetLuggageRules(),this._basketFlightItemChargeService.GetFlightItemCharges(!1)];this._qService.all(i).then(function(){t._scope.IsLuggageReady=!0;t._luggageReadyDeferred.resolve();t._scope.$emit(n.Events.Names.Funnel.LuggageReady)},function(){t._luggageReadyDeferred.reject();t._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.LuggageApiCallPromises)})},t.prototype.RemoveBag=function(n){var t=this,i;this._hasUpdateInProgress=!0;i=this._scope.Bags.indexOf(n);this._funnelBasketLuggageService.RemoveBagFromServerBasket(n).then(function(r){t._scope.SetFocusAfterLuggageItemRemoved(i,!1);t._funnelBasketLuggageService.UpdateClientBasketFromServer(r.Luggage);t.UpdateScopeLuggage();t._scope.SetTotalPriceAndWeight();t._accessibilityService.AlertBagRemovedFromBasket(n);t._hasUpdateInProgress=!1})},t.prototype.RemoveSportsEquipment=function(n){var t=this,i;this._hasUpdateInProgress=!0;i=this._scope.SportsEquipment.indexOf(n);this._funnelBasketLuggageService.RemoveSportsEquipmentFromServerBasket(n).then(function(r){t._scope.SetFocusAfterLuggageItemRemoved(i,!0);t._funnelBasketLuggageService.UpdateClientBasketFromServer(r.Luggage);t.UpdateScopeLuggage();t._scope.SetTotalPriceAndWeight();t._accessibilityService.AlertSportsEquipmentRemovedFromBasket(n);t._hasUpdateInProgress=!1})},t.prototype.UpdateScopeLuggage=function(){this._scope.Bags=this._funnelBasketLuggageService.GetClientBasketBags();this._scope.SportsEquipment=this._funnelBasketLuggageService.GetClientBasketSportsEquipment();this.SetTotalPriceAndWeight()},t.prototype.SetTotalPriceAndWeight=function(){this._scope.Price=this._luggageChargesService.CalculateTotalLuggagePrice(this._scope.Bags,this._scope.SportsEquipment);this._scope.Weight=this.SumLuggageItemWeights(this._scope.Bags,this._scope.SportsEquipment)},t.prototype.SumLuggageItemWeights=function(n,t){return this.SumItemWeights(n)+this.SumItemWeights(t)},t.prototype.SumItemWeights=function(n){var t=0;return _(n||[]).each(function(n){n&&n.Weight&&(t+=n.Weight)}),t},t.prototype.OpenSkipWithNoLuggageDrawer=function(){var n=this;this.GetPriceOptionDrawerItems().then(function(t){return n.ShowPriceOptionDrawer(t,!0)})},t.prototype.OpenCabinBagOnlyDrawer=function(){var n=this;this.GetPriceOptionDrawerItems().then(function(t){return n.ShowPriceOptionDrawer(t,!1)})},t.prototype.GetPriceOptionDrawerItems=function(){var n=this;return this._luggageChargesService.GetWeightList().then(function(n){var t=n.map(function(n){return{Reference:n.Weight.toString(),Price:n.AverageFlightPrice,Item:n}});return t||(t=[]),t.push({Reference:"0"}),t},function(){n._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.GetWeightList)})},t.prototype.ShowPriceOptionDrawer=function(t,i){var r=this,u;n.Events.Fire(n.Events.Names.Funnel.SetLoading,!1);u=function(t,i){t!=="0"?!i||r._scope.AddBag(i):(r._scope.EnableSkipDrawer=!1,r._scope.$emit(n.Events.Names.Funnel.Skip))};i?this._luggageDrawersService.OpenSkipWithNoLuggageDrawer(t,u):this._luggageDrawersService.OpenCabinBagOnlyDrawer(t,u)},t.ControllerName="Funnel_Luggage",t.$inject=["$scope","$q","Funnel_Service","Funnel_BasketService","Common_PriceService","Funnel_ErrorService","Funnel_LuggageRulesService","Funnel_BasketLuggageService","Funnel_BasketFlightItemChargeService",n.DynamicDependencyKeys.LuggageChargesService,"Funnel_LuggageLimitsService","Funnel_AccessibilityService","$window","Funnel_LuggageDrawersService","Funnel_JourneyService","Funnel_BasketIconService"],t}();t.LuggageController=i})(i=t.Luggage||(t.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._funnelLuggageClientSettings=n;this._scope=t;this._emptyIcon={Url:"",AltText:""};this._scope.GetFlexiBagsIconUrl=this.GetFlexiBagsIconUrl.bind(this);this._scope.GetFlexiBagsIconAltText=this.GetFlexiBagsIconAltText.bind(this);this._scope.GetBagsIconUrl=this.GetBagsIconUrl.bind(this);this._scope.GetBagsIconAltText=this.GetBagsIconAltText.bind(this);this._scope.GetSportsEquipmentIconUrl=this.GetSportsEquipmentIconUrl.bind(this);this._scope.GetSportsEquipmentIconAltText=this.GetSportsEquipmentIconAltText.bind(this);this._scope.GetTileBagTitle=this.GetTileBagTitle.bind(this);this._scope.GetTileBagIconUrl=this.GetTileBagIconUrl.bind(this);this._scope.GetTileBagIconAltText=this.GetTileBagIconAltText.bind(this);this._scope.GetTileSportsEquipmentIconUrl=this.GetTileSportsEquipmentIconUrl.bind(this);this._scope.GetTileSportsEquipmentIconAltText=this.GetTileSportsEquipmentIconAltText.bind(this)}return n.prototype.GetFlexiBagsIconUrl=function(n){if(n===null)return"";var t=this.GetBagIconFor(n).Url;return!t?this.GetBagIconFor(n,!1).Url:t},n.prototype.GetFlexiBagsIconAltText=function(n){return!n?"":this.GetBagIconFor(n).AltText},n.prototype.GetBagsIconUrl=function(n){return!n?"":this.GetBagIconFor(n.Bag).Url},n.prototype.GetBagsIconAltText=function(n){return!n?"":this.GetBagIconFor(n.Bag).AltText},n.prototype.GetSportsEquipmentIconUrl=function(n){return!n?"":this.GetSportsEquipmentIconFor(n.SportsEquipment).Url},n.prototype.GetSportsEquipmentIconAltText=function(n){return!n?"":this.GetSportsEquipmentIconFor(n.SportsEquipment).AltText},n.prototype.GetBagIconFor=function(n,t){t===void 0&&(t=!0);var r=n.Weight,i=Utilities.Arrays.FirstOrDefault(this._funnelLuggageClientSettings.BagsIcons,function(n){return n.BagWeight.toString()===r.toString()});return!i?this._emptyIcon:n.IsFlexiFareBag&&t?{Url:i.FlexiBagIconUrl,AltText:i.FlexiBagIconAlternateText}:{Url:i.BagIconUrl,AltText:i.BagIconAlternateText}},n.prototype.GetSportsEquipmentIconFor=function(n){var t=Utilities.Arrays.FirstOrDefault(this._funnelLuggageClientSettings.SportsEquipmentIcons,function(t){return t.CodeName.toString()===n.Code.toString()});return!t?this._emptyIcon:{Url:t.SportsEquipmentIconUrl,AltText:t.SportsEquipmentIconAlternateText}},n.prototype.GetTileBagTitle=function(n){var t=Utilities.Arrays.FirstOrDefault(this._funnelLuggageClientSettings.BagsIcons,function(t){return t.BagWeight===n.Weight.toString()});return!t?n.Weight.toString():t.TileTitle},n.prototype.GetTileBagIconUrl=function(n){return!n?"":this.GetTileBagIconFor(n).Url},n.prototype.GetTileBagIconAltText=function(n){return!n?"":this.GetTileBagIconFor(n).AltText},n.prototype.GetTileBagIconFor=function(n){var i=n.Weight,t=Utilities.Arrays.FirstOrDefault(this._funnelLuggageClientSettings.BagsIcons,function(n){return n.BagWeight===i.toString()});return!t?this._emptyIcon:{Url:t.TileIconUrl,AltText:t.TileIconAlternateText}},n.prototype.GetTileSportsEquipmentIconUrl=function(n){return!n?"":this.GetTileSportsIconFor(n).Url},n.prototype.GetTileSportsEquipmentIconAltText=function(n){return!n?"":this.GetTileSportsIconFor(n).AltText},n.prototype.GetTileSportsIconFor=function(n){var t=Utilities.Arrays.FirstOrDefault(this._funnelLuggageClientSettings.SportsEquipmentIcons,function(t){return t.CodeName===n.SportsEquipment.Code});return!t?this._emptyIcon:{Url:t.TileIconUrl,AltText:t.TileIconAlternateText}},n}();n.LuggageIconsController=t})(t=n.Luggage||(n.Luggage={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n){this.$scope=n;var t=this.$scope.CurrentSection.Options.Parameters;t&&(this.$scope.ShowHoldLuggageMessage=t.ShowHoldLuggageMessage,this.$scope.ShowSportsEquipmentMessage=t.ShowSportsEquipmentMessage);this.$scope.OnButtonClick=this.OnButtonClick.bind(this)}return t.prototype.OnButtonClick=function(){n.Events.Fire(n.Events.Names.Drawer.Close)},t.ControllerName="Funnel_LuggageLimitReachedDrawer",t.$inject=["$scope"],t}();t.LuggageLimitReachedDrawer=i})(i=t.Luggage||(t.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._scope=n;this._errorService=i;this._luggageChargesService=t;this._luggageDrawersService=r;this.LoadSportsEquipment();this._scope.GetPrice=this.GetPrice.bind(this);this._scope.OnSelect=this.OnSelect.bind(this);this._scope.IsSelectableSportsEquipment=this.IsSelectableSportsEquipment.bind(this);this._scope.OpenCannotFindWhatYouAreLookingForDrawer=this.OpenCannotFindWhatYouAreLookingForDrawer.bind(this)}return t.prototype.LoadSportsEquipment=function(){var t=this;this._luggageChargesService.GetSportsEquipmentList().then(function(n){t._scope.SportsEquipment=n;t._scope.OnEquipmentListLoadedPromise.resolve()},function(){t._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.GetSportsEquipmentList,n.Data.DrawerBackOverride.AlwaysHide)})},t.prototype.OnSelect=function(n,t){this._scope.MaximumSportsEquipmentAllowanceReached()||n.IsLarge&&!this.LargeSportsEquipmentEnabled()?this._luggageDrawersService.OpenLuggageLimitReachedDrawer(!1,!0):t||n.Code!=="Firearm"?this._scope.OnSelectEquipment(n):this.OpenSportingFirearmsDrawer(n)},t.prototype.OpenSportingFirearmsDrawer=function(i){var r={SectionKey:"luggage-sporting-firearms",AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Luggage,Action:t.SportingFirearmsDrawerId,IncludePagePathInLabel:!0},OnConfirmCallback:this._scope.OnSelect.bind(this,i,!0)};n.Events.OpenDrawerWithOptions(r,this._scope)},t.prototype.LargeSportsEquipmentEnabled=function(){return this._scope.SportsEquipment?!this._scope.LargeSportsEquipmentLimitReached():!0},t.prototype.OpenCannotFindWhatYouAreLookingForDrawer=function(){n.Events.OpenDrawerWithOptions({SectionKey:"luggage-cannot-find-what-you-are-looking-for",AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Luggage,Action:t.CannotFindWhatYouAreLookingForDrawerId,IncludePagePathInLabel:!0}},this._scope)},t.prototype.IsSelectableSportsEquipment=function(n){return this._scope.MaximumSportsEquipmentAllowanceReached()?!1:n.IsLarge&&!this.LargeSportsEquipmentEnabled()?!1:!0},t.prototype.GetPrice=function(n){return this._scope.ShowAveragePrices?n.AverageFlightPrice:n.Price},t.SportingFirearmsDrawerId="{4619A5FA-C2D8-4510-ABD0-9D38B685685A}",t.CannotFindWhatYouAreLookingForDrawerId="{2B1AB52F-5FF5-4781-8A75-98579BDA0661}",t.ControllerName="Funnel_SportsEquipmentList",t.$inject=["$scope",n.DynamicDependencyKeys.LuggageChargesService,"Funnel_ErrorService","Funnel_LuggageDrawersService"],t}();t.SportsEquipmentList=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u){this._scope=n;this._qService=t;this._errorService=i;this._luggageChargesService=r;this._luggageDrawersService=u;this._drawerParameters=this._scope.CurrentSection.Options.Parameters;this._scope.MaximumBaggageAllowanceReached=this._drawerParameters.HasReachedMaximumBaggageAllowance;this._scope.ShowConditionalBagText=this._drawerParameters.ShowConditionalBagText;this.LoadWeightList();this._scope.OnSelect=this.OnSelect.bind(this);this._scope.IsSelectableBag=this.IsSelectableBag.bind(this);this._scope.IsAlreadySelected=this.IsAlreadySelected.bind(this)}return t.prototype.LoadWeightList=function(){var t=this;this._luggageChargesService.GetWeightList().then(function(n){t._scope.WeightList=n;t._scope.AllOptionsSelected=t.AreAllOptionsAlreadySelected();t._scope.CurrentSection.Options.DrawerContentIsLoaded.resolve()},function(){t._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.GetWeightList,n.Data.DrawerBackOverride.AlwaysHide)})},t.prototype.OnSelect=function(n){this._scope.MaximumBaggageAllowanceReached()?this._luggageDrawersService.OpenLuggageLimitReachedDrawer(!0,!1):(this._drawerParameters.OnSelectBag(n),this._scope.DoClose())},t.prototype.IsSelectableBag=function(){return!this._scope.MaximumBaggageAllowanceReached()},t.prototype.IsAlreadySelected=function(n){return this._drawerParameters.SelectedBags.some(function(t){return n===t})},t.prototype.AreAllOptionsAlreadySelected=function(){var n=this;return this._scope.WeightList.every(function(t){return n.IsAlreadySelected(t.Weight)})},t.ControllerName="Funnel_TiledBagsDrawer",t.$inject=["$scope","$q","Funnel_ErrorService",n.DynamicDependencyKeys.LuggageChargesService,"Funnel_LuggageDrawersService"],t}();t.TiledBagsDrawer=i})(i=t.Luggage||(t.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u){this._scope=n;this._qService=t;this._errorService=i;this._luggageChargesService=r;this._luggageDrawersService=u;this._drawerParameters=this._scope.CurrentSection.Options.Parameters;this._scope.MaximumSportsEquipmentAllowanceReached=this._drawerParameters.HasReachedMaximumSportsEquipmentAllowance;this._scope.LargeSportsEquipmentLimitReached=this._drawerParameters.HasReachedMaximumLargeSportsEquipmentAllowance;this._scope.ShowConditionalSportsText=this._drawerParameters.ShowConditionalSportsText;this.LoadSportsEquipment();this._scope.OnSelect=this.OnSelect.bind(this);this._scope.IsSelectableSportsEquipment=this.IsSelectableSportsEquipment.bind(this);this._scope.OpenCannotFindWhatYouAreLookingForDrawer=this.OpenCannotFindWhatYouAreLookingForDrawer.bind(this);this._scope.IsAlreadySelected=this.IsAlreadySelected.bind(this)}return t.prototype.LoadSportsEquipment=function(){var t=this;this._luggageChargesService.GetSportsEquipmentList().then(function(n){t._scope.SportsEquipment=n;t._scope.AllOptionsSelected=t.AreAllOptionsAlreadySelected();t._scope.CurrentSection.Options.DrawerContentIsLoaded.resolve()},function(){t._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.GetSportsEquipmentList,n.Data.DrawerBackOverride.AlwaysHide)})},t.prototype.OnSelect=function(n,t){this._scope.MaximumSportsEquipmentAllowanceReached()||n.IsLarge&&!this.LargeSportsEquipmentEnabled()?this._luggageDrawersService.OpenLuggageLimitReachedDrawer(!1,!0):t||n.Code!=="Firearm"?(this._drawerParameters.OnSelectSportsEquipment(n),this._scope.DoClose()):this.OpenSportingFirearmsDrawer(n)},t.prototype.OpenSportingFirearmsDrawer=function(i){var r={SectionKey:"luggage-sporting-firearms",AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Luggage,Action:t.SportingFirearmsDrawerId,IncludePagePathInLabel:!0},OnConfirmCallback:this._scope.OnSelect.bind(this,i,!0)};n.Events.OpenDrawerWithOptions(r,this._scope)},t.prototype.LargeSportsEquipmentEnabled=function(){return this._scope.SportsEquipment?!this._scope.LargeSportsEquipmentLimitReached():!0},t.prototype.OpenCannotFindWhatYouAreLookingForDrawer=function(){n.Events.OpenDrawerWithOptions({SectionKey:"luggage-cannot-find-what-you-are-looking-for",AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Luggage,Action:t.CannotFindWhatYouAreLookingForDrawerId,IncludePagePathInLabel:!0}},this._scope)},t.prototype.IsSelectableSportsEquipment=function(n){return this._scope.MaximumSportsEquipmentAllowanceReached()?!1:n.IsLarge&&!this.LargeSportsEquipmentEnabled()?!1:!0},t.prototype.IsAlreadySelected=function(n){return this._drawerParameters.SelectedSportsEquipment.some(function(t){return n.Code===t})},t.prototype.AreAllOptionsAlreadySelected=function(){var n=this;return this._scope.SportsEquipment.every(function(t){return n.IsAlreadySelected(t)})},t.SportingFirearmsDrawerId="{4619A5FA-C2D8-4510-ABD0-9D38B685685A}",t.CannotFindWhatYouAreLookingForDrawerId="{2B1AB52F-5FF5-4781-8A75-98579BDA0661}",t.ControllerName="Funnel_TiledSportsEquipmentDrawer",t.$inject=["$scope","$q","Funnel_ErrorService",n.DynamicDependencyKeys.LuggageChargesService,"Funnel_LuggageDrawersService"],t}();t.TiledSportsEquipmentDrawer=i})(i=t.Luggage||(t.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t){this._controlScope=t;t.$emit(n.Events.Names.Funnel.RegisterOffersControl,this);t.LoadFailed=!1}return t.prototype.SetLoadFailed=function(){this._controlScope.LoadFailed=!0;this._controlScope.$emit(n.Events.Names.Funnel.OffersControlLoadFailure,this);this._controlScope.$emit(n.Events.Names.Funnel.OffersControlLoadComplete,this)},t.prototype.SetIsNoLongerLoading=function(){this._controlScope.IsLoading=!1;this._controlScope.$emit(n.Events.Names.Funnel.OffersControlLoadComplete,this)},t.prototype.OnBasketStateChange=function(){this._controlScope.$emit(n.Events.Names.Funnel.OffersBasketStateChanged)},t}();t.BaseOffersControl=i})(i=t.Offers||(t.Offers={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c){this._scope=t;this._funnelBasketService=r;this._funnelRootSettings=u;this._funnelJourneyService=f;this._funnelReasonCookieService=e;this._analyticsTracker=o;this._funnelOffersBasketStateService=s;this._helpingHandMessages=h;this._qService=c;this._registeredControls=[];this._foucusToVouchersQueryString="vouchers";this._foucusToTravelInsuranceQueryString="insurance";this._scope.Continue=this.Continue.bind(this);this._scope.Cancel=this.Cancel.bind(this);this._scope.ScrollToVouchers=this.ScrollToVouchers.bind(this);this._scope.ScrollToTravelInsurance=this.ScrollToTravelInsurance.bind(this);this._scope.HandleSkipLinkClick=this.HandleSkipLinkClick.bind(this);this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this);i.$on(n.Events.Names.Funnel.RegisterOffersControl,this.OnRegisterOffersControl.bind(this));i.$on(n.Events.Names.Funnel.OffersControlLoadFailure,this.SkipIfAllChildControlsFailToLoad.bind(this));i.$on(n.Events.Names.Funnel.OffersControlLoadComplete,this.ChildControlLoaded.bind(this));i.$on(n.Events.Names.Funnel.OffersBasketStateChanged,this.TrySetHelpingHand.bind(this))}return t.prototype.IsValid=function(){return!0},t.prototype.FunnelReady=function(){this._registeredControls.forEach(function(n){return n.FunnelReady()})},t.prototype.ShouldExitFunnel=function(){return!1},t.prototype.GetStepOnLoadRedirect=function(){return this._funnelJourneyService.GetStepOnLoadInvalidFlightRedirect(Tracking.EventConstants.Categories.Offers)||this.GetStepOnLoadUnavailableStepRedirect()},t.prototype.ChildControlLoaded=function(){this.AllChildControlsLoadComplete()&&(this._scope.IsLoading=!1,this._registeredControls.forEach(function(n){return n.DoRender()}),this.TryShouldScrollToChildControl(),this.TrySetHelpingHand())},t.prototype.SkipIfAllChildControlsFailToLoad=function(){var n=this._funnelJourneyService.GetSkipToNextStepUrl();return this.AllChildControlsFailedToLoad()?this.RedirectToNextStepDueAllControlsFailingToLoad("All offer controls failed to load",this.GetRedirect(n)):null},t.prototype.RedirectToNextStepDueAllControlsFailingToLoad=function(n){this._funnelReasonCookieService.UpdateCookie(function(t){return t.OffersRedirectReason=n});this._analyticsTracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.Offers,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.Error+" | "+Utilities.ZonelessDateTime.NowUtc(),this._funnelJourneyService.GetBypassNextStepUrl())},t.prototype.TrySetHelpingHand=function(){var n=this.ChildControlsThatLoadedSuccessfully();n.length==1?n[0].RefreshHelpingHand():this.SetHelpingHand(this._funnelOffersBasketStateService.GetState())},t.prototype.SetHelpingHand=function(t){this.ChildControlsThatLoadedSuccessfully().length>1&&(t===0?(n.Events.Fire(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/header/helpinghand/funnel-offers-default",this._scope),Utilities.ScreenReader.QueueAlert(this._helpingHandMessages.OffersDefaultText.replaceAll("{","").replaceAll("}","").replaceAll("[","").replaceAll("]",""),"offersDefaultTextAlert"),Utilities.ScreenReader.AlertQueued("offersDefaultTextAlert")):t===1?(n.Events.Fire(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/header/helpinghand/funnel-offers-travel-insurance-selected",this._scope),Utilities.ScreenReader.QueueAlert(this._helpingHandMessages.OnlyTravelInsuranceSelectedText.replaceAll("[","").replaceAll("]",""),"offersOnlyTravelInsuranceSelectedTextAlert"),Utilities.ScreenReader.AlertQueued("offersOnlyTravelInsuranceSelectedTextAlert")):t===2?(n.Events.Fire(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/header/helpinghand/funnel-offers-vouchers-selected",this._scope),Utilities.ScreenReader.QueueAlert(this._helpingHandMessages.OnlyVouchersSelectedText.replaceAll("[","").replaceAll("]",""),"offersOnlyVouchersSelectedTextAlert"),Utilities.ScreenReader.AlertQueued("offersOnlyVouchersSelectedTextAlert")):t===3&&(n.Events.Fire(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/header/helpinghand/funnel-offers-both-selected",this._scope),Utilities.ScreenReader.QueueAlert(this._helpingHandMessages.BothOffersSelectedText,"offersBothSelectedTextAlert"),Utilities.ScreenReader.AlertQueued("offersBothSelectedTextAlert")))},t.prototype.ChildControlsThatLoadedSuccessfully=function(){return this._registeredControls.filter(function(n){return n.HasLoadedSuccessfully()&&n.HasAttemptedToLoadComplete()})},t.prototype.AllChildControlsFailedToLoad=function(){return this._registeredControls.every(function(n){return!n.HasLoadedSuccessfully()&&n.HasAttemptedToLoadComplete()})},t.prototype.AllChildControlsLoadComplete=function(){return this._registeredControls.every(function(n){return n.HasAttemptedToLoadComplete()})},t.prototype.GetStepOnLoadUnavailableStepRedirect=function(){var n=this._funnelJourneyService.GetNextStepUrlIfOnLoadRedirectRequired();return!n?null:this.GetRedirect(n)},t.prototype.GetRedirect=function(n){return{TargetUrl:n,EventCategory:Tracking.EventConstants.Categories.Offers,EventAction:Tracking.EventConstants.Actions.Skip,EventLabel:Tracking.EventConstants.Labels.Unavailable}},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!0,EnsureNoMarginBottom:!0}},t.prototype.Save=function(){var n=this._qService.defer(),t=[];return this._registeredControls.forEach(function(n){var i=n.Save();!i||t.push(i)}),this._qService.all(t).then(function(){n.resolve()}),n.promise},t.prototype.Skip=function(){return null},t.prototype.Continue=function(){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Offers,Tracking.EventConstants.Labels.Continue,window.location.pathname);this._scope.$emit(n.Events.Names.ShelfRack.HideShelfRack);this._scope.$emit(n.Events.Names.Funnel.Continue)},t.prototype.Cancel=function(){this._scope.$emit(n.Events.Names.ShelfRack.HideShelfRack);this._scope.$emit(n.Events.Names.Funnel.Skip)},t.prototype.ScrollToVouchers=function(){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Vouchers,Tracking.EventConstants.Actions.Click,Tracking.EventConstants.Labels.ScrollToVouchers);n.Events.Fire(n.Events.Names.Funnel.ScrollToVouchers)},t.prototype.ScrollToTravelInsurance=function(){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Vouchers,Tracking.EventConstants.Actions.Click,Tracking.EventConstants.Labels.ScrollToTravelInsurance);n.Events.Fire(n.Events.Names.Funnel.ScrollToTravelInsurance)},t.prototype.OnRegisterOffersControl=function(n,t){t!==this&&this._registeredControls.indexOf(t)===-1&&(this._registeredControls.push(t),n.stopPropagation())},t.prototype.TryShouldScrollToChildControl=function(){var i=new Urls.QueryString(window.location.href),t=i.GetParameter("focus",!0);!t||(t===this._foucusToVouchersQueryString?n.Events.Fire(n.Events.Names.Funnel.ScrollToVouchers):t===this._foucusToTravelInsuranceQueryString&&n.Events.Fire(n.Events.Names.Funnel.ScrollToTravelInsurance))},t.prototype.HandleSkipLinkClick=function(n,t){n.preventDefault();var i=$jq(t);i.focus();Main3.Common.Scrolling.ScrollToElement(i)},t.ControllerName="Funnel_Offers",t.$inject=["$scope","$rootScope","Funnel_BasketService","Sitecore_FunnelRootSettings","Funnel_JourneyService","FunnelReasonCookie_Service","IAnalyticsTracker","Funnel_OffersBasketStateService","Sitecore_HelpingHandMessages","$q"],t}();t.Offers=i})(i=t.Offers||(t.Offers={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r;(function(i){var r=function(t){function i(i,r,u,f){var e=t.call(this,i,r,u,f)||this;return e._registeredFunnelControls=[],e._scope.$on(n.Events.Names.Funnel.RegisterFunnelControl,e.OnRegisterFunnelControl.bind(e)),e._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,e),e}return __extends(i,t),i.prototype.FunnelReady=function(){this._registeredFunnelControls.forEach(function(n){return n.FunnelReady()})},i.prototype.ShouldExitFunnel=function(){return this._registeredFunnelControls.some(function(n){return n.ShouldExitFunnel()})},i.prototype.GetFunnelControlSettings=function(){var n=this._registeredFunnelControls.some(function(n){return n.GetFunnelControlSettings().LoadMemberDetailsInBasket}),t=this._registeredFunnelControls.some(function(n){return n.GetFunnelControlSettings().CheckEasyJetPlusNumberStatus});return{LoadMemberDetailsInBasket:n,CheckEasyJetPlusNumberStatus:t,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!0}},i.prototype.OnRegisterFunnelControl=function(n,t){t!=this&&this._registeredFunnelControls.indexOf(t)==-1&&(this._registeredFunnelControls.push(t),n.stopPropagation())},i.ControllerName="Funnel_ReviewSection",i.$inject=["$scope","$q","Common_AccessibilityService","$timeout"],i}(t.Common.ReviewSection);i.FunnelReviewSection=r})(r=i.Structure||(i.Structure={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r;(function(i){var r=function(t){function i(n,i,r,u,f,e,o,s,h){var c=t.call(this,n,i,r,e,s,h)||this;return c._funnelService=u,c._funnelStartupService=f,c._errorService=o,c}return __extends(i,t),i.prototype.Initialised=function(){var t=this._funnelJourneyService.GetCurrentStepInJourney();!t||(this._funnelService.ShouldShowPaymentTypePickerInBasket=t.ShowPaymentTypePickerInBasket,this._funnelService.ShouldShowAddMoreFlightsLink=t.ShowAddMoreFlightsLink);this._funnelStartupService.StartUp(this.BookerDetailsRequiredInBasket(),this.ShouldCheckEasyJetPlusNumberStatus(),this.ShouldPreloadAvailabilityRequest(),!1,this.ContinueToNextStep.bind(this));this.InitialiseEjLogo();!t||this._scope.$emit(n.Events.Names.Basket.SetupBasket,"ng-templates/basket/funnel",n.Data.Common.ClientBasketType.Funnel,t.ShowCurrencySwitcherInBasket)},i.prototype.UpdateBackLinkForJourney=function(){Title.TitleBar.Instance.IsSubtitleLinkVisible()&&Title.TitleBar.Instance.UpdateSubtitleUrl(this._funnelJourneyService.GetBackStepUrl())},i.prototype.InitialiseEjLogo=function(){this._funnelJourneyService.RemoveLinkFromEjLogo()&&n.Events.Fire(n.Events.Names.Funnel.RemoveLinkFromEjLogo)},i.prototype.BookerDetailsRequiredInBasket=function(){return this.AnyRegisteredControlHasFlag(function(n){return n.LoadMemberDetailsInBasket})},i.prototype.ShouldCheckEasyJetPlusNumberStatus=function(){return this.AnyRegisteredControlHasFlag(function(n){return n.CheckEasyJetPlusNumberStatus})},i.prototype.ShouldPreloadAvailabilityRequest=function(){return this.AnyRegisteredControlHasFlag(function(n){return n.PreloadAvailabilityRequest})},i.prototype.BeforeContinue=function(){this.AnyRegisteredControlHasFlag(function(n){return n.CheckFunnelJourneyRulesOnContinue})&&this._funnelJourneyService.UpdateJourneyOnContinue();this._funnelJourneyService.ShowPopUnderOnContinue()},i.prototype.BeforeSkip=function(){return this._funnelJourneyService.ShowPopUnderOnSkip()},i.prototype.FunnelReady=function(){this.UpdateBackLinkForJourney()},i.prototype.GetSkipUrl=function(){return this._funnelJourneyService.GetSkipToNextStepUrl()},i.prototype.GetContinueUrl=function(){return this._funnelJourneyService.GetContinueToNextStepUrl()},i.prototype.HasPendingApiRequests=function(){return this._funnelService.HasAnyRequestsPending()},i.prototype.DoExit=function(n){this._errorService.Exit(n)},i.prototype.AnyRegisteredControlHasFlag=function(n){return this._registeredControls.filter(function(t){return n(t.GetFunnelControlSettings())}).length>0},i.ControllerName="Funnel_Structure_Step",i.$inject=["$q","$rootScope","$scope","Funnel_Service","Funnel_StartupService","Funnel_JourneyService","Funnel_ErrorService","IAnalyticsTracker","$document"],i}(t.SharedFunnel.BaseStep);i.Step=r})(r=i.Structure||(i.Structure={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t){this._scope=n;this._travelInsuranceSettings=t;this._scope.SelectProduct=this.SelectProduct.bind(this);this._scope.RemoveProduct=this.RemoveProduct.bind(this);this._scope.IsSelectedProduct=this.IsSelectedProduct.bind(this);this._scope.MoreDetailsClick=this.OnMoreDetailsClick.bind(this);this._scope.OptionalExtraMoreDetailsClick=this.OnOptionalExtraMoreDetailsClick.bind(this);this._scope.OnExtraCheckboxClick=this.OnExtraCheckboxClick.bind(this);this._scope.ForceMoreDetailsFocus=!1}return t.prototype.SelectProduct=function(){this._scope.OnSelectProduct(this._scope.Product);this._scope.ForceMoreDetailsFocus=!0},t.prototype.RemoveProduct=function(){var t=this,i={OnAccept:function(){n.Events.Fire(n.Events.Names.Drawer.Close);n.Events.Fire(n.Events.Names.Funnel.TravelInsuranceDeleted);t._scope.ForceMoreDetailsFocus=!0},OnReject:function(){n.Events.Fire(n.Events.Names.Drawer.Close)},StyleSecondButtonAsDismissOption:!0};n.Events.OpenDrawerWithOptions({SectionKey:this._scope.DrawerSectionKey,Parameters:i})},t.prototype.IsSelectedProduct=function(){return this._scope.Product===this._scope.SelectedProduct},t.prototype.OnMoreDetailsClick=function(n){this.OpenAdditionalInformationDrawer(n,this._travelInsuranceSettings.PolicyInformationSettings,"","travel-insurance-policy-information-drawer")},t.prototype.OnOptionalExtraMoreDetailsClick=function(n,t){this.OpenAdditionalInformationDrawer(n,this._travelInsuranceSettings.OptionalExtraInformationSettings,t,"travel-insurance-optional-extra-information-drawer")},t.prototype.OnExtraCheckboxClick=function(n){n.IsSelected=!n.IsSelected;n.IsSelected?this._scope.OnSelectExtra(n):this._scope.OnRemoveExtra(n)},t.prototype.OpenAdditionalInformationDrawer=function(t,i,r,u){var f={BelowTitleContent:(i.BelowTitleContent||"").replace("{description}",r||""),BenefitsItem:t},e={SectionKey:u,Parameters:f,TitleOverride:(i.Title||"").replace("{product name}",t.Name)};n.Events.OpenDrawerWithOptions(e)},t.ControllerName="Funnel_TravelInsuranceProductController",t.$inject=["$scope","Sitecore_FunnelTravelInsuranceSettings"],t}();t.Product=i})(i=t.TravelInsurance||(t.TravelInsurance={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f){this._scope=n;this._travelInsuranceSettings=t;this._basketService=i;this._timeout=r;this._analyticsService=u;this._travelInsuranceBasketService=f;this._scope.ChangePassengersOver64=this.ChangePassengersOver64.bind(this);this._scope.ChangePassengersToInsure=this.ChangePassengersToInsure.bind(this);this._scope.$watch("InsuredPassengers",this.Initialize.bind(this),!0);this._scope.$watch("OverSixtyFourCount",angular.copy(this.UpdateNumberOfPassengersOverSixtyFourText.bind(this)),!0);this._scope.$watch("SelectedPassengerCount",angular.copy(this.UpdateNumberOfPassengersSelectedText.bind(this)),!0)}return t.prototype.ReplaceTokens=function(n,t){return!n||!t?"":n.replace("{count}",t.toString()).replace("{total}",this._scope.TotalPassengerCount.toString())},t.prototype.ChangePassengersOver64=function(){this._analyticsService.TrackChangePassengersToOver64();this.ShowWhoDoYouWantToInsureDrawer()},t.prototype.ChangePassengersToInsure=function(){this._analyticsService.TrackChangeAllPassengersToInsure();this.ShowWhoDoYouWantToInsureDrawer()},t.prototype.ShowWhoDoYouWantToInsureDrawer=function(){var t=this,i={SectionKey:"who-do-you-want-to-insure-drawer",Parameters:{OnUpdateQuote:function(n){t._scope.InsuredPassengers=angular.copy(n);t._timeout(function(){t.UpdateNumberOfPassengersOverSixtyFourText();t.UpdateNumberOfPassengersSelectedText();t._scope.UpdateQuote();t._travelInsuranceBasketService.RemoveSelectedPolicy()},0)},Passengers:this._scope.InsuredPassengers}};n.Events.OpenDrawerWithOptions(i)},t.prototype.Initialize=function(){!this._scope.InsuredPassengers||(this._scope.TotalPassengerCount=this._scope.InsuredPassengers.length,this._scope.OverSixtyFourCount=this._scope.InsuredPassengers.filter(function(n){return n.Over64&&n.Insured}).length,this._scope.SelectedPassengerCount=this._scope.InsuredPassengers.filter(function(n){return n.Insured===!0}).length)},t.prototype.UpdateNumberOfPassengersSelectedText=function(){this._scope.NumberOfPassengersSelectedText=this.ReplaceTokens(this._travelInsuranceSettings.NumberOfPassengersInsuredText,this._scope.SelectedPassengerCount)},t.prototype.UpdateNumberOfPassengersOverSixtyFourText=function(){this._scope.NumberOfPassengersOverSixtyFourText=this.ReplaceTokens(this._travelInsuranceSettings.NumberOfPassengersOverSixtyFourText,this._scope.OverSixtyFourCount)},t.ControllerName="Funnel_TravelInsuranceSelectPassengers",t.$inject=["$scope","Sitecore_FunnelTravelInsuranceSettings","Funnel_BasketService","$timeout","Funnel_TravelInsuranceAnalyticsService","Funnel_TravelInsuranceBasketService"],t}();t.SelectPassengersController=i})(i=t.TravelInsurance||(t.TravelInsurance={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c,l,a,v,y){this._scope=t;this._errorService=r;this._funnelAccessibilityService=u;this._funnelBasketService=e;this._funnelPriceService=o;this._funnelRootSettings=s;this._funnelTravelInsuranceQuoteService=h;this._insuranceAnalyticsService=c;this._priceService=l;this._travelInsuranceBasketService=a;this._travelInsurancePassengerDataService=v;this._travelInsuranceSettings=y;this._scope.HasSelectedAProduct=this.HasSelectedAProduct.bind(this);this._scope.GetTotalPrice=this.GetTotalPrice.bind(this);this._scope.OnSelectProduct=this.OnSelectProduct.bind(this);this._scope.OnRemoveProduct=this.OnRemoveProduct.bind(this);this._scope.GetSelectedProductCode=this.GetSelectedProductCode.bind(this);this._scope.LoadQuote=this.LoadQuote.bind(this);this._scope.OnSelectExtra=this.OnSelectExtra.bind(this);this._scope.OnRemoveExtra=this.OnRemoveExtra.bind(this);this._scope.ShouldShowAdditionalInsuranceBlock=this.ShouldShowAdditionalInsuranceBlock.bind(this);f.AllowDeleteTravelInsurance();this._scope.$on(n.Events.Names.Funnel.TravelInsuranceDeleted,this.OnRemoveProduct.bind(this));i.$on(n.Events.Names.Funnel.TravelInsuranceUpdated,this.RemoveAllSelectedExtras.bind(this));this.WatchForTotalCostChanges()}return t.prototype.Initialize=function(){var t=this._funnelBasketService.GetBasket().TravelInsurance;return!t||(n.Services.Funnel.TravelInsurance.QuoteService.AuthToken=t.AuthToken),this._scope.SelectedProduct=null,this._scope.InsuredPassengers=this._travelInsurancePassengerDataService.GetPassengers(),this._scope.IsOneWayJourney=this._funnelBasketService.GetPrimaryJourneyPair().ReturnSlot===null,this.LoadQuote(!0)},t.prototype.GetSelectedProductCode=function(){return this._scope.SelectedProduct?this._scope.SelectedProduct.Code:null},t.prototype.GetTotalPrice=function(){var n=this._travelInsuranceBasketService.GetTravelInsuranceFromClientBasket(),t=!n?null:n.Policy;return this._priceService.GetTotalPrice(t)},t.prototype.GetTravelInsuranceLanguageCode=function(){return this._travelInsuranceSettings.TravelInsuranceLanguageCode||this._funnelRootSettings.SitecoreLanguageCode},t.prototype.HasSelectedAProduct=function(){if(!!this._scope.SelectedProduct)return!0;var n=this._travelInsuranceBasketService.GetTravelInsuranceFromClientBasket();return!!n&&!!n.Policy&&!!n.Policy.ProductCode},t.prototype.LoadQuote=function(n){var t=this;return n===void 0&&(n=!1),this._funnelTravelInsuranceQuoteService.GetInsuranceQuoteForCurrentBasket(this._scope.InsuredPassengers,this.GetTravelInsuranceLanguageCode()).then(function(n){t._scope.Terms=n.Terms;t._scope.Products=n.Products},function(i){n||t._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.TravelInsurance,Tracking.EventConstants.GenericErrorDrawerLabels.UpdateQuoteFailedError);throw i;})},t.prototype.OnRemoveExtra=function(n){this._insuranceAnalyticsService.TrackProductExtraDeselected(n.Code,this.GetSelectedProductCode());this._funnelAccessibilityService.TravelInsuranceOptionalExtraRemovedAlert(n);this._travelInsuranceBasketService.RemoveExtraFromClientBasket(n)},t.prototype.ShouldShowAdditionalInsuranceBlock=function(){return!Main3.Common.BreakPointService.IsMobile()&&this.HasOddNumberOfProducts()},t.prototype.HasOddNumberOfProducts=function(){return!!this._scope.Products&&this._scope.Products.length%2==1},t.prototype.OnRemoveProduct=function(){this._scope.SelectedProduct=null;this._travelInsuranceBasketService.RemoveSelectedPolicy()},t.prototype.OnSelectionChange=function(){this._travelInsuranceBasketService.SaveToClientBasket(this._scope.SelectedProduct,this._scope.InsuredPassengers,this._scope.Terms.FirstTermsConditionsLink,this._scope.Terms.SecondTermsConditionsLink,this._funnelPriceService.GetNumericValue(this.GetTotalPrice()))},t.prototype.OnSelectExtra=function(n){this._insuranceAnalyticsService.TrackProductExtraSelected(n.Code,this.GetSelectedProductCode());this._funnelAccessibilityService.TravelInsuranceOptionalExtraAddedAlert(n);this._travelInsuranceBasketService.SaveExtraToClientBasket(n)},t.prototype.OnSelectProduct=function(n){this._scope.SelectedProduct=n;this.OnSelectionChange();this._funnelAccessibilityService.TravelInsuranceProductAddedAlert(n);this._insuranceAnalyticsService.TrackProductSelected(n.Code)},t.prototype.RemoveAllSelectedExtras=function(){!this._scope.Products||this._scope.Products.forEach(function(n){n.OptionalExtras.forEach(function(n){n.IsSelected=!1})})},t.prototype.WatchForTotalCostChanges=function(){var n=this;this._scope.$watch(function(t){return n._funnelPriceService.GetNumericValue(t.GetTotalPrice())},function(t,i){t!==i&&n._funnelAccessibilityService.TravelInsuranceTotalCostAlert(t)})},t}();t.TravelInsuranceController=i})(i=t.TravelInsurance||(t.TravelInsurance={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function i(i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){this._scope=r;this._funnelBasketService=u;this._funnelRootSettings=f;this._funnelJourneyService=e;this._travelInsuranceBasketService=o;this._travelInsuranceSettings=s;this._funnelReasonCookieService=h;this._analyticsTracker=c;this._travelInsuranceController=new t.TravelInsuranceController(r,i,l,a,v,u,y,f,p,w,b,o,k,s);this._scope.Continue=this.Continue.bind(this);this._scope.Cancel=this.Cancel.bind(this);this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this);this._scope.$watch(function(n){return n.SelectedProduct},this.RefreshHelpingHand.bind(this));this._scope.IsLoading=!0}return i.prototype.IsValid=function(){return this._scope.HasSelectedAProduct()},i.prototype.FunnelReady=function(){var n=this;this._travelInsuranceController.Initialize().then(function(){n._scope.IsLoading=!1},function(){n._scope.IsLoading=!1;n.RedirectToNextFunnelStep(Constants.Redirect.Reasons.Funnel.TravelInsurance.GetQuoteApiError)});this.InitialHelpingHand()},i.prototype.ShouldExitFunnel=function(){return!this._funnelBasketService.HasAnyFlights()},i.prototype.GetStepOnLoadRedirect=function(){return this._funnelJourneyService.GetStepOnLoadInvalidFlightRedirect(Tracking.EventConstants.Categories.TravelInsurance)||this.GetStepOnLoadUnavailableStepRedirect()},i.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!0,EnsureNoMarginBottom:!0}},i.prototype.Save=function(){return this._travelInsuranceBasketService.HasTravelInsuranceInClientBasket()?this._travelInsuranceBasketService.SaveInsuranceToServerBasket(this.GetTravelInsuranceLanguageCode()):this._travelInsuranceBasketService.RemoveSelectedPolicyFromServerBasket()},i.prototype.Skip=function(){return null},i.prototype.GetStepOnLoadUnavailableStepRedirect=function(){var n=this._funnelJourneyService.GetNextStepUrlIfOnLoadRedirectRequired();return!n?null:{TargetUrl:n,EventCategory:Tracking.EventConstants.Categories.TravelInsurance,EventAction:Tracking.EventConstants.Actions.Skip,EventLabel:Tracking.EventConstants.Labels.Unavailable}},i.prototype.InitialHelpingHand=function(){this._scope.ProductSelectedHelpingHandMessageDisplayed=!1;this.RefreshHelpingHand()},i.prototype.RefreshHelpingHand=function(){this._scope.HasSelectedAProduct()?this._scope.ProductSelectedHelpingHandMessageDisplayed||(this._scope.ProductSelectedHelpingHandMessageDisplayed=!0,n.Events.Fire(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/header/helpinghand/funnel-travel-insurance-product-selected",this._scope)):(this._scope.ProductSelectedHelpingHandMessageDisplayed=!1,n.Events.Fire(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/header/helpinghand/funnel-travel-insurance-no-product-selected",this._scope))},i.prototype.Continue=function(){this._scope.$emit(n.Events.Names.ShelfRack.HideShelfRack);this._scope.$emit(n.Events.Names.Funnel.Continue)},i.prototype.Cancel=function(){this._scope.$emit(n.Events.Names.ShelfRack.HideShelfRack);this._scope.$emit(n.Events.Names.Funnel.Skip)},i.prototype.RedirectToNextFunnelStep=function(n){this._funnelReasonCookieService.UpdateCookie(function(t){return t.TravelInsuranceRedirectReason=n});this._analyticsTracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.TravelInsurance,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.Error+" | "+Utilities.ZonelessDateTime.NowUtc(),this._funnelJourneyService.GetBypassNextStepUrl())},i.prototype.GetTravelInsuranceLanguageCode=function(){return this._travelInsuranceSettings.TravelInsuranceLanguageCode||this._funnelRootSettings.SitecoreLanguageCode},i.ControllerName="Funnel_TravelInsurance",i.$inject=["$rootScope","$scope","Funnel_BasketService","Sitecore_FunnelRootSettings","Funnel_JourneyService","Funnel_TravelInsuranceBasketService","Sitecore_FunnelTravelInsuranceSettings","FunnelReasonCookie_Service","IAnalyticsTracker","Error_Service","Funnel_AccessibilityService","Funnel_BasketIconService","Common_PriceService","Funnel_TravelInsuranceQuoteService","Funnel_TravelInsuranceAnalyticsService","Funnel_TravelInsurancePriceService","Funnel_TravelInsurancePassengerDataService"],i}();t.TravelInsuranceFunnelControl=i})(i=t.TravelInsurance||(t.TravelInsurance={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(i){var r=function(t){function r(r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){var d=t.call(this,u)||this;return d._scope=u,d._funnelJourneyService=f,d._funnelRootSettings=l,d._travelInsuranceBasketService=p,d._travelInsuranceSettings=b,d._helpingHandMessages=k,d._travelInsuranceController=new i.TravelInsuranceController(u,r,e,o,s,h,c,l,a,v,y,p,w,b),d._scope.IsLoading=!0,d._scope.CanRender=!1,r.$on(n.Events.Names.Funnel.TravelInsuranceUpdated,d.OnBasketStateChange.bind(d)),d}return __extends(r,t),r.prototype.FunnelReady=function(){var n=this;this._funnelJourneyService.GetByPassRules().SkipTravelInsurancePages()?(this.SetLoadFailed(),this.SetIsNoLongerLoading()):this._travelInsuranceController.Initialize().then(function(){n._scope.LoadFailed=!1;n.SetIsNoLongerLoading();n._scope.ProductSelectedHelpingHandMessageDisplayed=!1},function(){n.SetLoadFailed();n.SetIsNoLongerLoading()})},r.prototype.RefreshHelpingHand=function(){this._scope.HasSelectedAProduct()?this._scope.ProductSelectedHelpingHandMessageDisplayed||(this._scope.ProductSelectedHelpingHandMessageDisplayed=!0,n.Events.Fire(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/header/helpinghand/funnel-travel-insurance-product-selected",this._scope),Utilities.ScreenReader.QueueAlert(this._helpingHandMessages.TravelInsuranceProductSelectedText,"travelInsuranceProductSelectedAlert"),Utilities.ScreenReader.AlertQueued("travelInsuranceProductSelectedAlert")):(this._scope.ProductSelectedHelpingHandMessageDisplayed=!1,n.Events.Fire(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/header/helpinghand/funnel-travel-insurance-no-product-selected",this._scope),Utilities.ScreenReader.QueueAlert(this._helpingHandMessages.TravelInsuranceDefaultText,"travelInsuranceNoProductSelectedAlert"),Utilities.ScreenReader.AlertQueued("travelInsuranceNoProductSelectedAlert"))},r.prototype.HasAttemptedToLoadComplete=function(){return!this._scope.IsLoading||this._scope.LoadFailed},r.prototype.HasLoadedSuccessfully=function(){return this.HasAttemptedToLoadComplete()&&!this._scope.LoadFailed},r.prototype.IsValid=function(){return this._scope.HasSelectedAProduct()},r.prototype.DoRender=function(){this._scope.LoadFailed||(this._scope.CanRender=!0)},r.prototype.Save=function(){return this._travelInsuranceBasketService.HasTravelInsuranceInClientBasket()&&!this._scope.LoadFailed?this._travelInsuranceBasketService.SaveInsuranceToServerBasket(this.GetTravelInsuranceLanguageCode()):null},r.prototype.GetTravelInsuranceLanguageCode=function(){return this._travelInsuranceSettings.TravelInsuranceLanguageCode||this._funnelRootSettings.SitecoreLanguageCode},r.ControllerName="Funnel_TravelInsuranceOfferControl",r.$inject=["$rootScope","$scope","Funnel_JourneyService","Error_Service","Funnel_AccessibilityService","Funnel_BasketIconService","Funnel_BasketService","Common_PriceService","Sitecore_FunnelRootSettings","Funnel_TravelInsuranceQuoteService","Funnel_TravelInsuranceAnalyticsService","Funnel_TravelInsurancePriceService","Funnel_TravelInsuranceBasketService","Funnel_TravelInsurancePassengerDataService","Sitecore_FunnelTravelInsuranceSettings","Sitecore_HelpingHandMessages"],r}(t.Offers.BaseOffersControl);i.TravelInsuranceOfferControl=r})(i=t.TravelInsurance||(t.TravelInsurance={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e){this._scope=i;this._basketService=r;this._priceService=u;this._scope.GetTotalPrice=this.GetTotalPrice.bind(this);this._scope.RemoveTravelInsurance=this.RemoveTravelInsurance.bind(this);this._scope.AnalyticsCategory=Tracking.EventConstants.Categories.TravelInsurance;this._scope.Icons=f.GetQueries();this._scope.EditTravelInsuranceUrl=e.GetEditTravelInsuranceStepUrl();this._scope.$on(n.Events.Names.Funnel.FunnelReady,this.LoadPolicyFromBasket.bind(this));t.$on(n.Events.Names.Funnel.TravelInsuranceUpdated,this.LoadPolicyFromBasket.bind(this))}return t.prototype.LoadPolicyFromBasket=function(){this._basketService.HasTravelInsuranceInClientBasket()&&(this._scope.TravelInsurance=this._basketService.GetTravelInsuranceFromClientBasket())},t.prototype.GetTotalPrice=function(){var n=null;return this._scope.TravelInsurance&&this._scope.TravelInsurance.Policy&&(n=this._scope.TravelInsurance.Policy),this._priceService.GetTotalPrice(n)},t.prototype.RemoveTravelInsurance=function(){this._scope.TravelInsurance&&(n.Events.Fire(n.Events.Names.Funnel.TravelInsuranceDeleted),n.Events.Fire(n.Events.Names.Funnel.ScrollToTravelInsurance))},t.ControllerName="Funnel_BasketTravelInsuranceSummary",t.$inject=["$rootScope","$scope","Funnel_TravelInsuranceBasketService","Funnel_TravelInsurancePriceService","Funnel_BasketIconService","Funnel_JourneyService"],t}();t.Summary=i})(i=t.Basket||(t.Basket={}))})(i=t.TravelInsurance||(t.TravelInsurance={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(i){var u=function(t){function i(i,u,f,e,o,s,h,c,l,a,v,y,p,w){var b=t.call(this,i)||this;return b._scope=i,b._funnelBasketService=u,b._funnelJourneyService=f,b._funnelVouchersChargesService=e,b._priceService=o,b._passengerService=s,b._vouchersSettings=h,b._accessibilityService=c,b._analyticsTracker=l,b._funnelJourneyCookieService=a,b._funnelBasketIconService=v,b.routesData=y,b._funnelBasketVouchersService=p,b._helpingHandMessages=w,b._routesService=new Main3.Routes.RoutesService(y),b._scope.VoucherSavingPercentage=b.GetVoucherSavingPercentage.bind(b),b._scope.OnAddVouchersToBasketButtonClick=b.OnAddVouchersToBasketButtonClick.bind(b),b._scope.OnAddVoucherIfLimitNotReachedClick=b.OnAddVoucherIfLimitNotReachedClick.bind(b),b._scope.OnDecreaseVouchersForPassengerClick=b.OnDecreaseVouchersForPassengerClick.bind(b),b._scope.GetNumberOfVouchersPerFlight=b.GetNumberOfVouchersPerFlight.bind(b),b._scope.OnTogglePerFlightModeClick=b.OnTogglePerFlightModeClick.bind(b),b._scope.ShowPerFlightCheckbox=b.ShowPerFlightCheckbox.bind(b),b._scope.GetCostForAllFlights=b.GetCostForAllFlights.bind(b),b._scope.GetRedeemableAmountForAllFlights=b.GetRedeemableAmountForAllFlights.bind(b),b._scope.GetCostForFlight=b.GetCostForFlight.bind(b),b._scope.GetRedeemableAmountForFlight=b.GetRedeemableAmountForFlight.bind(b),b._scope.HasReachedMaximumVouchersAllowedPerPassenger=b.HasReachedMaximumVouchersAllowedPerPassenger.bind(b),b._scope.GetPassengerDisplayName=b.GetPassengerDisplayName.bind(b),b._scope.GetTotalNumberOfVouchersAddedToBasket=b.GetTotalNumberOfVouchersAddedToBasket.bind(b),b._scope.GetPassengerList=b.GetPassengerList.bind(b),b._scope.GetFlightsForDisplayMode=b.GetFlightsForDisplayMode.bind(b),b._scope.LookUpAirportName=b.LookUpAirportName.bind(b),b._scope.IsLoading=!0,b._scope.CanRender=!1,b._scope.AllFlightsMode=b.AllFlightsMode.bind(b),b._scope.ShowMoreDetails=b.ShowMoreDetails.bind(b),b._scope.NotAddedToBasketMode=b.NotAddedToBasketMode.bind(b),b._scope.ExpandedPerFlightMode=b.ExpandedPerFlightMode.bind(b),b._scope.GetSameAmountOfVouchersOnAllFlightsCheckboxDefaultsToOn=b._vouchersSettings.GetSameAmountOfVouchersOnAllFlightsCheckboxDefaultsToOn,b._scope.VouchersMode=r.NotAddedToBasket,b._scope.VouchersAnalyticsCategory=Tracking.EventConstants.Categories.Vouchers,b._funnelBasketIconService.AllowDeleteVouchers(),b._scope.$on(n.Events.Names.Funnel.RemoveVouchersFromBasketForFlight,b.RemoveVouchersFromBasketForFlight.bind(b)),b}return __extends(i,t),i.prototype.RemoveVouchersFromBasketForFlight=function(n,t){var i,u;this._funnelBasketVouchersService.RemoveVouchersFromAllPassengers(t);this._scope.VouchersMode=this._funnelBasketService.GetFlights().length>1?r.PerFlight:r.AllFlights;i=this._funnelBasketVouchersService.GetFlight(t);this.OnBasketStateChange();this.Save();u=i.DepartureIata+" "+this._vouchersSettings.TitleTextJoinLabel+" "+i.ArrivalIata;this._accessibilityService.AlertVoucherRemovedFromBasketForFlight(u,this.PriceAsText(this._funnelBasketVouchersService.GetTotalCost()))},i.prototype.SetAllFlightsMode=function(){this._scope.VouchersMode=r.AllFlights},i.prototype.SetPerFlightMode=function(){this._scope.VouchersMode=r.PerFlight},i.prototype.RefreshHelpingHand=function(){this._funnelBasketVouchersService.GetTotalNumberOfVouchersAddedToBasket()>0?(n.Events.Fire(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/header/helpinghand/funnel-vouchers-selected",this._scope),Utilities.ScreenReader.QueueAlert(this._helpingHandMessages.VouchersSelectedText.replace("{total price}",this._priceService.GetNumericValue(this.GetCostForAllFlights()).toString()),"vouchersSelectedAlert"),Utilities.ScreenReader.AlertQueued("vouchersSelectedAlert")):(n.Events.Fire(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/header/helpinghand/funnel-vouchers-not-selected",this._scope),Utilities.ScreenReader.QueueAlert(this._helpingHandMessages.VouchersDefaultText,"vouchersDefaultAlert"),Utilities.ScreenReader.AlertQueued("vouchersDefaultAlert"))},i.prototype.AllFlightsMode=function(){return this._scope.VouchersMode===r.AllFlights},i.prototype.NotAddedToBasketMode=function(){return this._scope.VouchersMode===r.NotAddedToBasket},i.prototype.ExpandedPerFlightMode=function(){return this._scope.VouchersMode===r.PerFlight},i.prototype.FunnelReady=function(){var n=this._funnelJourneyService.GetByPassRules();n.SkipVouchers()?(this.SetLoadFailed(),this.SetIsNoLongerLoading()):this.Initialise()},i.prototype.Initialise=function(){var n=this;this._funnelVouchersChargesService.GetVoucherCharges(this._scope.IsLoading).then(function(t){t?(n._scope.VoucherCost=t.Cost,n._scope.VoucherRedeemableAmount=t.InFlightValue,n._funnelBasketVouchersService.Initialise().then(function(){n._scope.Passengers=n.GetPassengers();n.RestoreStateIfVouchersInBasket();n.SetIsNoLongerLoading();n._funnelJourneyCookieService.UpdateCookie(function(n){n.HasSeenVouchersPage=!0})}).catch(function(){n.SetLoadFailed()})):n.SetLoadFailed()}).catch(function(){n.SetLoadFailed()})},i.prototype.DoRender=function(){this._scope.LoadFailed||(this._scope.CanRender=!0)},i.prototype.RestoreStateIfVouchersInBasket=function(){this._funnelBasketVouchersService.ThereAreVouchersInTheBasket()&&(this._scope.VouchersMode=this._funnelBasketService.GetFlights().length>1?r.PerFlight:r.AllFlights)},i.prototype.OnAddVouchersToBasketButtonClick=function(){this._scope.VouchersMode=this._scope.GetSameAmountOfVouchersOnAllFlightsCheckboxDefaultsToOn?r.AllFlights:r.PerFlight;this._funnelBasketVouchersService.ResetPassengerVouchers();this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Vouchers,Tracking.EventConstants.Actions.AddToBasket,this.GetDisplayModeTrackingLabel());this.OnBasketStateChange();this._accessibilityService.AlertDefaultVouchersAddedToBasket()},i.prototype.OnTogglePerFlightModeClick=function(){this._scope.VouchersMode=this.AllFlightsMode()?r.PerFlight:r.AllFlights;this._funnelBasketVouchersService.ResetPassengerVouchers();this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Vouchers,Tracking.EventConstants.Actions.TogglePerFlightDisplay,this.GetDisplayModeTrackingLabel());this._accessibilityService.AlertDefaultVouchersAddedToBasket();this._scope.FocusOnVouchersBlock()},i.prototype.GetDisplayModeTrackingLabel=function(){return this._scope.VouchersMode===r.AllFlights?Tracking.EventConstants.Labels.AllFlights:Tracking.EventConstants.Labels.PerFlight},i.prototype.ShowPerFlightCheckbox=function(){return this._scope.VouchersMode!==r.NotAddedToBasket&&this.MultipleFlightsInBasket()},i.prototype.MultipleFlightsInBasket=function(){return this._funnelBasketService.GetFlights().length>1},i.prototype.OnAddVoucherIfLimitNotReachedClick=function(n){var t=this.GetPassengerDisplayName(n.PassengerInternalId);this._funnelBasketVouchersService.PassengerCanBeAssignedMoreVouchers(n)&&this.AdjustVoucherAmountForPassenger(n,1,Tracking.EventConstants.Actions.Add,!1);this._funnelBasketVouchersService.PassengerVoucherLimitReached(n)&&this._accessibilityService.AlertMaximumVouchersAddedToBasketForPassenger(t)},i.prototype.OnDecreaseVouchersForPassengerClick=function(n){this._funnelBasketVouchersService.PassengerHasVouchersAssigned(n)&&this.AdjustVoucherAmountForPassenger(n,-1,Tracking.EventConstants.Actions.Remove,!0)},i.prototype.AdjustVoucherAmountForPassenger=function(n,t,i,u){var f=this.GetPassengerDisplayName(n.PassengerInternalId),e;this._scope.VouchersMode===r.PerFlight?(e=this.GetDepartureDateForPassenger(n),this._funnelBasketVouchersService.AdjustVouchersForPassenger(n,t),this.TrackBasketUpdateEvent(i,r.PerFlight,n,e.Format("YYYY-MM-DD")),u?this._accessibilityService.AlertVoucherRemovedFromBasketForPassengerOnFlight(f,this.GetRouteTextForPassengerOnFlight(n),n.NumberOfVouchers,this.PriceAsText(this.GetCostForFlight(n.FlightInternalId)),e.Format("dddd Do MMMM YYYY")):this._accessibilityService.AlertVoucherAddedToBasketForPassengerOnFlight(f,this.GetRouteTextForPassengerOnFlight(n),n.NumberOfVouchers,this.PriceAsText(this.GetCostForFlight(n.FlightInternalId)),e.Format("dddd Do MMMM YYYY"))):(this._funnelBasketVouchersService.UpdatePassengerVouchersOnEveryFlightInTheBasket(n,t),this.TrackBasketUpdateEvent(i,r.AllFlights,n),u?this._accessibilityService.AlertVoucherRemovedFromBasketForPassenger(f,n.NumberOfVouchers*this._funnelBasketService.GetFlights().length,this.PriceAsText(this.GetCostForAllFlights())):this._accessibilityService.AlertVoucherAddedToBasketForPassenger(f,n.NumberOfVouchers*this._funnelBasketService.GetFlights().length,this.PriceAsText(this.GetCostForAllFlights())));this.OnBasketStateChange()},i.prototype.PriceAsText=function(n){var t=this._priceService.GetNumericValue(n);return this._priceService.NumericPriceToString(t)},i.prototype.TrackBasketUpdateEvent=function(n,t,i,u){var f=t===r.PerFlight?this.GetRouteTextForPassengerOnFlight(i)+" - "+u:Tracking.EventConstants.Labels.AllFlights;this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Vouchers,n,f)},i.prototype.GetDepartureDateForPassenger=function(n){var t=this._funnelBasketService.GetFlights().filter(function(t){return t.InternalId===n.FlightInternalId})[0];return t.LocalDepartureTime},i.prototype.GetRouteTextForPassengerOnFlight=function(n){var t=this._funnelBasketService.GetFlights().filter(function(t){return t.InternalId===n.FlightInternalId})[0];return t.DepartureIata+" "+this._vouchersSettings.TitleTextJoinLabel+" "+t.ArrivalIata},i.prototype.Save=function(){return this._funnelBasketVouchersService.SaveToServerBasket()},i.prototype.GetNumberOfVouchersPerFlight=function(){return this._funnelBasketVouchersService.GetNumberOfVouchersPerFlight()},i.prototype.GetTotalNumberOfVouchersAddedToBasket=function(n){return this.AllFlightsMode()?this._funnelBasketVouchersService.GetTotalNumberOfVouchersAddedToBasket():this._funnelBasketVouchersService.GetTotalNumberOfVouchersAddedToBasketForFlight(n)},i.prototype.GetCostForAllFlights=function(){return this._funnelBasketVouchersService.GetTotalCost()},i.prototype.GetRedeemableAmountForAllFlights=function(){return this._funnelBasketVouchersService.GetTotalRedeemableAmountPerFlight()},i.prototype.GetCostForFlight=function(n){return this._funnelBasketVouchersService.GetTotalCostForFlight(n)},i.prototype.GetRedeemableAmountForFlight=function(n){return this._funnelBasketVouchersService.GetTotalRedeemableAmountForFlight(n)},i.prototype.GetPassengers=function(){return this._funnelBasketVouchersService.GetPassengerVouchers()},i.prototype.GetPassengerDisplayName=function(n){return this._passengerService.GetDisplayName(n)},i.prototype.GetPassengerList=function(n){return this.GetPassengers()?this.AllFlightsMode()||this.NotAddedToBasketMode()||!n?this.GetPassengerVouchersFromFirstBasketFlight():this.GetPassengers().filter(function(t){return t.FlightInternalId===n.InternalId}):[]},i.prototype.GetPassengerVouchersFromFirstBasketFlight=function(){var n=this;return this.GetPassengers().filter(function(t){return t.FlightInternalId===n._funnelBasketService.GetFlights()[0].InternalId})},i.prototype.GetFlightsForDisplayMode=function(){return this.ExpandedPerFlightMode()?this._funnelBasketService.GetFlights():[this._funnelBasketService.GetFlights()[0]]},i.prototype.GetVoucherSavingPercentage=function(){if(!!this._scope.VoucherCost&&!!this._scope.VoucherRedeemableAmount){var n=new Big(this._priceService.GetNumericValue(this._scope.VoucherRedeemableAmount)),t=new Big(this._priceService.GetNumericValue(this._scope.VoucherCost)),i=n.minus(t),r=i.div(n),u=r.times(100),f=this._vouchersSettings.DiscountPercentageDigitsAfterTheDecimalPoint;return parseFloat(u.round(f,0).toString())}return 0},i.prototype.HasReachedMaximumVouchersAllowedPerPassenger=function(n){return this.HasLoadedSuccessfully()?n.NumberOfVouchers===this._vouchersSettings.MaximumVouchersPerPassenger:!1},i.prototype.LookUpAirportName=function(n){var t=this._routesService.FindAirportByIata(n);return t?t.Name:n},i.prototype.IsValid=function(){return!0},i.prototype.HasAttemptedToLoadComplete=function(){return!this._scope.IsLoading||this._scope.LoadFailed},i.prototype.HasLoadedSuccessfully=function(){return this.HasAttemptedToLoadComplete()&&!this._scope.LoadFailed},i.prototype.Cancel=function(){this._scope.$emit(n.Events.Names.Funnel.Skip)},i.prototype.ShowMoreDetails=function(){var t={SectionKey:"voucher-more-details-drawer",Parameters:{VoucherCost:this._scope.VoucherCost,VoucherRedeemableAmount:this._scope.VoucherRedeemableAmount,VoucherSavingPercentage:this.GetVoucherSavingPercentage(),MaximumVouchersPerPassenger:this._vouchersSettings.MaximumVouchersPerPassenger},AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Vouchers,Action:Tracking.EventConstants.Actions.MoreDetailsDrawer,Label:Tracking.EventConstants.Labels.Show,IncludeDrawerIdInLabel:!1,IncludePagePathInLabel:!1}};n.Events.OpenDrawerWithOptions(t)},i.ControllerName="Funnel_Vouchers",i.$inject=["$scope","Funnel_BasketService","Funnel_JourneyService","Funnel_VouchersPriceService","Common_PriceService","Funnel_PassengerService","Sitecore_FunnelVouchersSettings","Funnel_AccessibilityService","IAnalyticsTracker","FunnelJourneyCookie_Service","Funnel_BasketIconService","Sitecore_RoutesData","Funnel_VouchersBasketService","Sitecore_HelpingHandMessages"],i}(t.Offers.BaseOffersControl),r;i.Vouchers=u,function(n){n[n.NotAddedToBasket=0]="NotAddedToBasket";n[n.AllFlights=1]="AllFlights";n[n.PerFlight=2]="PerFlight"}(r=i.VouchersMode||(i.VouchersMode={}))})(i=t.Vouchers||(t.Vouchers={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._scope=n;this._scope.ConfirmClicked=this.ConfirmClicked.bind(this);var t=this._scope.CurrentSection.Options.Parameters;this._scope.CancelCallback=t.CancelCallback}return n.prototype.ConfirmClicked=function(){this._scope.CancelCallback();this._scope.DoClose()},n.ControllerName="Hotacc_ConfirmCancellationDrawer",n.$inject=["$scope"],n}();n.ConfirmCancellationDrawer=t})(t=n.HotelAllocation||(n.HotelAllocation={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.ControllerName="Hotacc_ExpiryTimerTrigger",n.$inject=["Hotacc_LoginExpiryTimer"],n}();n.ExpiryTimerTrigger=t})(t=n.HotelAllocation||(n.HotelAllocation={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._successCallbacks=[];this._errorCallbacks=[];this._scope=n;this._rootScope=t;this._authApi=i;this._dataCapturePageUrl=r;n.BookingReference="";n.Surname="";n.IsLoggedOut=!1;n.IsLoggingIn=!1;n.FormSubmitted=!1;n.IsLogInFailed=!1;n.DoHotAccLogIn=this.OnLogInAttempt.bind(this);this.ListenForEvents();this.AddErrorCallback()}return t.prototype.ListenForEvents=function(){this._scope.$on(n.Events.Names.DrawerSection.Shown,this.ExtractDrawerParameters.bind(this));this._scope.$on(n.Events.Names.DrawerSection.Hidden,this.RaiseLoggedOutEvent.bind(this))},t.prototype.ExtractDrawerParameters=function(){var n=this._scope.CurrentSection.Scope.Section.Options.Parameters;if(!n)throw new Error("HotaccLoginFormParameters must be supplied to HotaccLogInForm");this._flightId=n.FlightId;this._scope.IsLoggedOut=n.WasLoggedOut},t.prototype.RaiseLoggedOutEvent=function(){var t=this;(this._scope.IsLoggedOut||this._scope.IsLogInFailed)&&setTimeout(function(){t._scope.$emit(n.Events.Names.HotAcc.LoggedOut)},750)},t.prototype.AddErrorCallback=function(){this.AddCallback(this._errorCallbacks,this.OnLogInUnsuccessful.bind(this))},t.prototype.OnLogInAttempt=function(){var n=this;this._scope.FormSubmitted=!0;this._scope.IsLogInFailed=!1;this.AddSuccessCallback();this.ManageLoginDrawer(this._flightId)},t.prototype.AddSuccessCallback=function(){var n=this.GetDataCapturePageUrl(this._flightId),t;this._currentDataCapturPageUrl=n;t=function(){window.location.href=n};this.AddCallback(this._successCallbacks,t)},t.prototype.GetDataCapturePageUrl=function(n){return this._dataCapturePageUrl+"?FlightId="+n},t.prototype.ManageLoginDrawer=function(){if(this._scope.formValidation.$valid){this.DisableSubmitButton();var n={FlightId:this._flightId,BookingReference:this._scope.BookingReference,Surname:this._scope.Surname},t=this._authApi.Login(n,this.SuccessCallbacks.bind(this),this.ErrorCallbacks.bind(this))}},t.prototype.DisableSubmitButton=function(){this._scope.IsLoggingIn=!0;this._scope.FormSubmitted=!0;this._scope.IsLogInFailed=!1;this._scope.IsLoggedOut=!1;this._scope.$applyAsync()},t.prototype.OnLogInUnsuccessful=function(n){this._scope.IsLogInFailed=!0;this._scope.IsLoggingIn=!1;this._scope.IsLoggedOut=!1;this._scope.FormSubmitted=!1;n.status==401&&(this._scope.IsLoggedOut=!0);this._scope.$applyAsync()},t.prototype.SuccessCallbacks=function(){this._successCallbacks.forEach(function(n){n()})},t.prototype.ErrorCallbacks=function(t,i,r){this._rootScope.$emit(n.Events.Names.HotAcc.HideAll);this._errorCallbacks.forEach(function(n){n(t,i,r)})},t.prototype.AddCallback=function(n,t){n.push(t)},t.ControllerName="Hotacc_LogInForm",t.$inject=["$scope","$rootScope","Hotac_AuthApi","Hotac_DataCapturePageUrl"],t}();t.LogInForm=i})(i=t.HotelAllocation||(t.HotelAllocation={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i){this._scope=t;this._rootScope=i;this._scope.$emit(n.Events.Names.HotAcc.ResetExpiryTimer);this._scope.StartExpiry=this.StartExpiry.bind(this);this._scope.StopExpiry=this.StopExpiry.bind(this);this._scope.ResetExpiry=this.ResetExpiry.bind(this);this._scope.LoginExpired=this.OnLoggedOut.bind(this);this._rootScope.$on(n.Events.Names.HotAcc.LoggedOut,this.OnLoggedOut.bind(this));this._rootScope.$on(n.Events.Names.HotAcc.HideAll,this.OnHideAll.bind(this));this._rootScope.HotaccRootPage_Scope=this._scope}return t.prototype.OnHideAll=function(){this._scope.IsLoggedOut=!0;this._scope.$applyAsync()},t.prototype.StartExpiry=function(){this._scope.$emit(n.Events.Names.HotAcc.ResetExpiryTimer)},t.prototype.StopExpiry=function(){this._scope.$emit(n.Events.Names.HotAcc.StopTimer)},t.prototype.ResetExpiry=function(){this._scope.$emit(n.Events.Names.HotAcc.ResetExpiryTimer)},t.prototype.OnLoggedOut=function(){var i=this,t;this._scope.IsLoggedOut=!0;this.OnHideAll();t={FlightId:this.GetCurrentFlightFromQueryString(),WasLoggedOut:!0};setTimeout(function(){n.Events.OpenDrawerWithOptions({SectionKey:"hotacc-login",Parameters:t},i._rootScope)},750)},t.prototype.GetCurrentFlightFromQueryString=function(){var n=new Urls.QueryString(window.location.href),t=n.GetParameter("FlightId",!0);return parseInt(t)},t.ControllerName="Hotacc_Root",t.$inject=["$scope","$rootScope"],t}();t.HotaccRootPage=i})(i=t.HotelAllocation||(t.HotelAllocation={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f){var e=this;this._scope=t;this._windowService=i;this._hotacApi=r;this._authApi=u;this._dataCapturePageUrl=f;this._loggedIn=!1;this._scope.$on(n.Events.Names.HotAcc.CheckIsFlightDisrupted,function(n,t,i){e._hotacLoginRequest=i;e.CallIsFlightDisrupted(t)});this._scope.OnLinkClick=this.RedirectToHotac.bind(this)}return t.prototype.CallIsFlightDisrupted=function(n){var t=this.HandleFlightDisruptedResponse.bind(this),i=this._hotacApi.BuildRequest(n.DepartureIata,n.FlightNumber,n.FlightDate);this._hotacApi.IsFlightDisrupted(i,t,null)},t.prototype.HandleFlightDisruptedResponse=function(n){n&&(this._scope.IsFocalFlightDisrupted=n.IsDisrupted,this._hotacLoginRequest.FlightId=n.FlightId,this.SignInHotac(this._hotacLoginRequest))},t.prototype.RedirectToHotac=function(){var n=this._dataCapturePageUrl+"?FlightId="+this._hotacLoginRequest.FlightId;this._windowService.open(n)},t.prototype.SignInHotac=function(n){if(n){var t=this.HotacSuccess.bind(this),i=this.HandleErrorResponse.bind(this);this._authApi.Login(n,t,i)}},t.prototype.HotacSuccess=function(){this._loggedIn=!0},t.prototype.HandleErrorResponse=function(){this._loggedIn=!1},t.ControllerName="Hotac_Integration",t.$inject=["$scope","$window","Hotac_Api","Hotac_AuthApi","Hotac_DataCapturePageUrl"],t}();t.HotacIntegration=i})(i=t.HotelAllocation||(t.HotelAllocation={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u){this._scope=t;this._rootScope=i;this._authApi=r;this._settings=u;this._scope.SecondsRemaining=this._settings.MessageSeconds;this._scope.$on(n.Events.Names.DrawerSection.Shown,this.StartCountdown.bind(this));this._scope.$on(n.Events.Names.DrawerSection.Hidden,this.StopCountdown.bind(this));this._scope.DoKeepAlive=this.ManualKeepAlive.bind(this)}return t.prototype.StartCountdown=function(){var n=this;this._scope.SecondsRemaining=this._settings.MessageSeconds;this._countdownStart=Utilities.ZonelessDateTime.NowLocal();this._countdownIntervalId=setInterval(function(){n.CountdownInterval()},500)},t.prototype.StopCountdown=function(){this._countdownIntervalId&&clearInterval(this._countdownIntervalId)},t.prototype.ManualKeepAlive=function(){this._scope.$emit(n.Events.Names.HotAcc.ResetExpiryTimer,!0);this._scope.$emit(n.Events.Names.Drawer.Back)},t.prototype.CountdownInterval=function(){var t=Utilities.ZonelessDateTime.NowLocal().Difference(this._countdownStart,Utilities.ZonelessDateTimePart.Seconds),n=Math.round(this._settings.MessageSeconds-t);n<0?(this.StopCountdown(),this._authApi.Logout(this.OnLoggedOut.bind(this),this.OnLoggedOut.bind(this))):(this._scope.SecondsRemaining=n,this._scope.$applyAsync())},t.prototype.OnLoggedOut=function(){this._rootScope.$broadcast(n.Events.Names.HotAcc.LoggedOut,!0)},t.ControllerName="Hotacc_ExpiryDrawer",t.$inject=["$scope","$rootScope","Hotac_AuthApi","Sitecore_HotaccExpirySettings"],t}();t.LoginExpiryDrawer=i})(i=t.HotelAllocation||(t.HotelAllocation={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(n){function t(t,i,r,u){var f=n.call(this,t,r,i)||this;return f._manageBookingsService=u,f.UpdateTitleBackLinkUrl(),f}return __extends(t,n),t.prototype.UpdateTitleBackLinkUrl=function(){var n=Title.TitleBar.Instance.GetSubtitleUrl();Title.TitleBar.Instance.UpdateSubtitleUrl(this._manageBookingsService.ApplyBookingReferenceToUrl(n))},t}(n.Account.BaseAccountController);t.BaseCheckInController=i})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(t){function i(n,i,r,u,f,e,o,s,h,c,l,a,v){var y=t.call(this,n,h,c,l)||this;return y._scope=n,y._api=i,y._errorService=r,y._bookingModel=u,y._helpingHandSettings=f,y._checkInMapper=e,y._tracker=o,y._checkInService=s,y._checkInHelpingHandService=v,y._scope.ShowStandByLink=y.ShowStandByLink.bind(y),y._scope.ShowPassengerList=y.ShowPassengerList.bind(y),y._scope.ShowManageDisruptionLink=y.ShowManageDisruptionLink.bind(y),y._scope.GetManageDisruptionLinkUrl=y._checkInService.GetManageDisruptionLinkUrl.bind(y._checkInService),y._scope.AddPassengerInformationClicked=y.AddPassengerInformationClicked.bind(y),y._scope.IsPassengerMissingApis=y.IsPassengerMissingApis.bind(y),y._scope.IsPassengerCheckedIn=y.IsPassengerCheckedIn.bind(y),y._scope.CanPassengerCheckIn=y.CanPassengerCheckIn.bind(y),y._scope.ShowCheckInDaysRemaining=y.ShowCheckInDaysRemaining.bind(y),y._scope.ShowCheckInMissedDeadline=y.ShowCheckInMissedDeadline.bind(y),y._scope.CheckInClicked=y.CheckInClicked.bind(y),y._scope.ViewPassengerClicked=y.ViewPassengerClicked.bind(y),a.RemoveCookie(),y}return __extends(i,t),i.prototype.OnSignInConfirmed=function(n){this._api.GetBooking(this._manageBookingsService.GetCurrentBookingReference(),this.OnGetBookingSuccess.bind(this),this.OnGetBookingError.bind(this));this.SetUserIsCustomerOrBookerStatus(n)},i.prototype.SetUserIsCustomerOrBookerStatus=function(t){this._scope.UserIsCustomerOrBooker=t===n.Data.Account.SignedInStatus.SignedIn?!0:!1},i.prototype.IsPassengerMissingApis=function(n){return!n.HasCompletedApis&&!n.IsCheckedIn},i.prototype.IsPassengerCheckedIn=function(n){return n.HasCompletedApis&&n.IsCheckedIn},i.prototype.CheckInClicked=function(n){this._tracker.TrackEvent(Tracking.EventConstants.Categories.CheckIn,Tracking.EventConstants.Actions.CheckIn,this._manageBookingsService.GetCurrentBookingReference()+" | "+n.PassengerCode);this._checkInService.GoToCheckInSelectFlights(this._scope.Flights)},i.prototype.ViewPassengerClicked=function(){this._tracker.TrackEventWithValue(Tracking.EventConstants.Categories.ViewPassengers,Tracking.EventConstants.Actions.ViewPassengers,Tracking.EventConstants.Labels.PassengerInformation,""+this._manageBookingsService.GetCurrentBookingReference());var t={Passengers:this._scope.Passengers};n.Events.OpenDrawerWithOptions({SectionKey:"view-passenger",Parameters:t})},i.prototype.CanPassengerCheckIn=function(n,t){return n.HasCompletedApis&&t.CheckInState.WithinCheckInWindow&&!n.IsCheckedIn},i.prototype.ShowCheckInMissedDeadline=function(n,t){return n.HasCompletedApis&&!n.IsCheckedIn&&!t.CheckInState.WithinCheckInWindow&&t.CheckInState.AfterCheckInWindow},i.prototype.ShowCheckInDaysRemaining=function(n,t){return n.HasCompletedApis&&!n.IsCheckedIn&&!t.CheckInState.WithinCheckInWindow&&!t.CheckInState.AfterCheckInWindow},i.prototype.OnGetBookingSuccess=function(n){var t=this._checkInMapper.GetBookingResponseToBookingFlights(n);this.SetPassengerMissingApis(t);this.RedirectIfNoFlights(t);this.UpdatePassengers(t);this.SendSetupBasketEvent();this.ConfigureHelpingHand(t)},i.prototype.ConfigureHelpingHand=function(n){var t=this._checkInHelpingHandService.FirstAvailableFlightForCheckIn(n),i;!t||(i=this._checkInHelpingHandService.GetHelpingHandSettings(t),this._checkInHelpingHandService.UpdateHelpingHand(i))},i.prototype.SetPassengerMissingApis=function(n){var t=this;this._scope.AnyPassengerHasApi=!1;n.forEach(function(n){n.Passengers.forEach(function(n){if(!t.IsPassengerMissingApis(n)){t._scope.AnyPassengerHasApi=!0;return}})})},i.prototype.RedirectIfNoFlights=function(n){n.length===0?this.RedirectToEmptyBooking():(this._scope.Flights=n,this._scope.IsLoading=!1)},i.prototype.SendSetupBasketEvent=function(){n.Events.Fire(n.Events.Names.Basket.SetupBasket,"",n.Data.Common.ClientBasketType.AncillariesPanel,!1,"")},i.prototype.RedirectToEmptyBooking=function(){n.Services.Common.ErrorService.IsExiting=!0;var t=this._bookingModel.EmptyBookingPassengerRedirectUrl;n.Services.Account.AccountService.IsSignedIn===n.Data.Account.SignedInStatus.SignedIn&&(t=this._bookingModel.EmptyBookingRedirectUrl,t=this._manageBookingsService.ApplyBookingReferenceToUrl(t));window.location.href=t},i.prototype.UpdatePassengers=function(n){var t=[];n.forEach(function(n){n.Passengers.forEach(function(n){t.some(function(t){return t.PassengerCode===n.PassengerCode})||(t=t.concat(n))})});this._scope.Passengers=t},i.prototype.OnGetBookingError=function(t,i,r,u){if(t===401)n.Events.OpenDrawerWithOptions({SectionKey:"passenger-information-unavailable",PreventDismissOverride:!0,ShowAfterActionComplete:!0});else this._errorService.HandleApiError(t,i,r,u)},i.prototype.ShowStandByLink=function(t){return t.Status===n.Data.ManageBookings.FlightStatus.StandBy},i.prototype.ShowManageDisruptionLink=function(t){return t.Status===n.Data.ManageBookings.FlightStatus.Cancelled||t.Status===n.Data.ManageBookings.FlightStatus.Delayed},i.prototype.ShowPassengerList=function(t){return t.Status===n.Data.ManageBookings.FlightStatus.OnTime||t.Status===n.Data.ManageBookings.FlightStatus.Delayed},i.prototype.AddPassengerInformationClicked=function(n){var t=this._checkInService.GetAddPassengerInformationLinkUrl(n.PassengerCode);this._tracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.CheckIn,Tracking.EventConstants.Actions.AddApis,Tracking.EventConstants.Labels.PassengerInformation,t)},i.ControllerName="CheckIn_Booking",i.$inject=["$scope","CheckIn_Api","Error_Service","Sitecore_CheckInBooking","Sitecore_CheckInBooking_HelpingHandSettings","CheckIn_Mapper","IAnalyticsTracker","CheckIn_Service","Common_NavigationService","CommercialSoftLogInCookie_Service","ManageBookings_Service","CheckInPassengersCookie_Service","CheckInHelpingHand_Service"],i}(t.BaseCheckInController);t.CheckInBooking=i})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(t){function i(n,i,r,u,f,e,o,s,h,c,l,a,v,y){var p=t.call(this,c,a,y,v)||this;return p._api=n,p._analytics=i,p._checkInMapper=r,p._countryDataService=u,p._errorService=f,p._languageSettings=e,p._passengerAgeService=o,p._passengerInformationModel=s,p._qService=h,p._scope=c,p._passengerDisplayService=l,p.FieldName_DocumentType="document-type",p.FieldName_DocumentNumber="document-number",p.FieldName_Nationality="nationality",p.FieldName_CountryOfIssue="country-of-issue",p.FieldName_DateOfBirth="date-of-birth",p.FieldName_Gender="gender-dropdown",p.FieldName_DocumentExpiry="document-expiry",p.FieldName_DialCode="dial-code",p.FieldName_PhoneNumber="phone-number",p.FieldName_Email="email",p._scope.AddSavedDocumentButtonClicked=p.AddSavedDocumentButtonClicked.bind(p),p._scope.DocumentTypeClicked=p.DocumentTypeClicked.bind(p),p._scope.NationalityClicked=p.NationalityClicked.bind(p),p._scope.CountryOfIssueClicked=p.CountryOfIssueClicked.bind(p),p._scope.DialCodeClicked=p.DialCodeClicked.bind(p),p._scope.ClearForm=p.ClearAllDocumentFields.bind(p),p._scope.ContinueClicked=p.ContinueClicked.bind(p),p._scope.SaveDetailsCheckboxClicked=p.SaveDetailsCheckboxClicked.bind(p),p._scope.ShowSaveDetailsCheckbox=p.ShowSaveDetailsCheckbox.bind(p),p._scope.ShowLeadPassengerDetailsCheckbox=p.ShowLeadPassengerDetailsCheckbox.bind(p),p._scope.UseLeadPassengerCheckboxClicked=p.UseLeadPassengerCheckboxClicked.bind(p),p._scope.GetEarliestValidExpiryDate=p.GetEarliestValidExpiryDate.bind(p),p._scope.GetEarliestValidDateOfBirth=p.GetEarliestValidDateOfBirth.bind(p),p._scope.GetLatestValidDateOfBirth=p.GetLatestValidDateOfBirth.bind(p),p._scope.GetInvalidDateOfBirthForPassengerTypeMessage=p.GetInvalidDateOfBirthForPassengerTypeMessage.bind(p),p._scope.UseLeadPassengerDetails=!1,p.SetDropDownSources(),p.SetDefaultSaveDetailsValues(),p._scope.TrackChangePassengerNameOrDetailsOnClick=p.TrackChangePassengerNameOrDetailsOnClick.bind(p),p._scope.ChangeNameLinkUrl=p._manageBookingsService.ApplyBookingReferenceToUrl(p._passengerInformationModel.ChangeNameLinkUrl),p}return __extends(i,t),i.prototype.SetDefaultDialCode=function(){var n=this;this._countryDataService.GetCountryDataModelForIsoCode(this._languageSettings.EResLanguageCode,this._passengerInformationModel.DialCodeDefaultISOCode).then(function(t){!t||(n._scope.DialCode=t.DialCode);n.WatchForChangesThatEnableSaveDetails();n._scope.IsLoading=!1})},i.prototype.SetDropDownSources=function(){var n=(new Date).getFullYear(),t=_.range(1,32).map(function(n){return{Value:n,DisplayText:n.toString()}}),i=_.range(1,13).map(function(n){return{Value:n,DisplayText:Utilities.TimeAgnosticDate.FromParts(2e3,n,1).Format("MMM")}});this._scope.DateOfBirth={Day:null,DayOptions:t,Month:null,MonthOptions:i,Year:null,YearOptions:_.range(n,n-this._passengerInformationModel.DateOfBirthYearsBack-1,-1).map(function(n){return{Value:n,DisplayText:n.toString()}})};this._scope.DocumentExpiry={Day:null,DayOptions:t,Month:null,MonthOptions:i,Year:null,YearOptions:_.range(n,n+this._passengerInformationModel.ExpiryDateYearsAhead+1).map(function(n){return{Value:n,DisplayText:n.toString()}})};this._scope.Genders=this._passengerInformationModel.GenderOptions},i.prototype.OnSignInConfirmed=function(){this._api.GetPassengerOnBooking(this._manageBookingsService.GetCurrentBookingReference(),this._manageBookingsService.GetCurrentPassengerCode(),this.OnGetPassengerSuccess.bind(this),this.OnGetPassengerError.bind(this))},i.prototype.OnGetPassengerSuccess=function(t){var i=this._passengerDisplayService.GetDisplayName(t);this._scope.$emit(n.Events.Names.HelpingHand.ShowText,i);this._api.GetBooking(this._manageBookingsService.GetCurrentBookingReference(),this.OnGetBookingSuccess.bind(this,t),this._errorService.HandleApiError.bind(this))},i.prototype.OnGetBookingSuccess=function(t,i){var u=this._checkInMapper.GetBookingResponseToBookingFlights(i),r=u[0].LeadPassenger||u[0].Passengers[0]||{};this._passengerType=n.Data.Common.PassengerDataType.Parse(t.Type);this._scope.IsLeadPassenger=this._manageBookingsService.GetCurrentPassengerCode()===r.PassengerCode;this._scope.LeadPassengerDetailsConfirmed=r.HasCompletedApis;this._scope.LeadPassengerFullName=r.FullName;this.SetFlightDepartureTimes(i);this.InitialiseTravelDocumentSection(t).then(this.InitialiseContactInformationSection.bind(this,t))},i.prototype.GetInvalidDateOfBirthForPassengerTypeMessage=function(){return this._passengerType===n.Data.Common.PassengerDataType.Adult?this._scope.InvalidDateOfBirthForPassengerTypeMessage=this._passengerInformationModel.DateOfBirthInvalidForAdultMessage:this._passengerType===n.Data.Common.PassengerDataType.Child?this._scope.InvalidDateOfBirthForPassengerTypeMessage=this._passengerInformationModel.DateOfBirthInvalidForChildMessage:this._passengerType===n.Data.Common.PassengerDataType.Infant?this._scope.InvalidDateOfBirthForPassengerTypeMessage=this._passengerInformationModel.DateOfBirthInvalidForInfantMessage:""},i.prototype.SetFlightDepartureTimes=function(n){var t=this._checkInMapper.GetBookingResponseToBookingFlights(n);this._firstFlightDepartureDate=t[0].FlightCardFlight.LocalDepartureTime.Date();this._lastFlightDepartureDate=t[t.length-1].FlightCardFlight.LocalDepartureTime.Date()},i.prototype.InitialiseTravelDocumentSection=function(n){var t=this._qService.defer();return n.RequiresApis?this._api.GetSavedDocuments(this._languageSettings.WebsiteRegionCode).then(this.InitialiseSavedDocuments.bind(this)).catch(this._errorService.HandleApiError.bind(this._errorService)).finally(function(){return t.resolve()}):t.resolve(),this._scope.ShowTravelDocumentSection=n.RequiresApis,t.promise},i.prototype.ShowExpiredDocumentDrawer=function(){var t=this,i={IsLoading:function(){return t._scope.IsLoading},OnAccept:this.SubmitForm.bind(this),OnReject:function(){n.Events.Fire(n.Events.Names.Drawer.Close)}};n.Events.OpenDrawerWithOptions({SectionKey:"check-in-expired-document",AnalyticsOptions:{Action:Tracking.EventConstants.Actions.ExpiredDocument,Category:Tracking.EventConstants.Categories.PassengerInformation,IncludePagePathInLabel:!0},Parameters:i})},i.prototype.InitialiseSavedDocuments=function(n){this._savedDocuments=this._checkInMapper.GetSavedDocumentsResponseToTravelDocuments(n).filter(function(n){return!n.DocumentExpiryDate.Date().IsInThePast()});this._scope.HideAddSavedDocumentsButton=this._savedDocuments.length===0},i.prototype.InitialiseContactInformationSection=function(n){n.ContactInformation?(this._scope.DialCode=n.ContactInformation.DiallingCode,this._scope.EmailAddress=n.ContactInformation.EmailAddress,this._scope.PhoneNumber=n.ContactInformation.PhoneNumber,this.WatchForChangesThatEnableSaveDetails(),this._scope.IsLoading=!1):this.SetDefaultDialCode()},i.prototype.OnGetPassengerError=function(t,i,r,u){if(t===401)n.Events.OpenDrawerWithOptions({SectionKey:"passenger-information-unavailable",PreventDismissOverride:!0,ShowAfterActionComplete:!0});else this._errorService.HandleApiError(t,i,r,u)},i.prototype.AddSavedDocumentButtonClicked=function(){this._analytics.TrackEventWithPagePathLabel(Tracking.EventConstants.Categories.PassengerInformation,Tracking.EventConstants.Actions.AddSavedDocument);this.OpenDocumentTypeDrawer()},i.prototype.DocumentTypeClicked=function(){this._scope.DocumentTypeFocus=!0;this._analytics.TrackEventWithPagePathLabel(Tracking.EventConstants.Categories.PassengerInformation,Tracking.EventConstants.Actions.DocumentType);this.OpenDocumentTypeDrawer()},i.prototype.OpenDocumentTypeDrawer=function(){var t={LanguageCode:this._languageSettings.WebsiteRegionCode,SavedDocuments:this._savedDocuments,OnDocumentTypeSelected:this.OnDocumentTypeSelected.bind(this),OnSavedDocumentSelected:this.OnSavedDocumentSelected.bind(this)};n.Events.OpenDrawerWithOptions({SectionKey:"check-in-document-selection",Parameters:t})},i.prototype.OnDocumentTypeSelected=function(t){this.ClearFieldsForNewDocument();this._scope.DocumentType=t;this._scope.DocumentTypeFocus=!1;this._analytics.TrackEventWithPagePathLabel(Tracking.EventConstants.Categories.PassengerInformation,Tracking.EventConstants.Actions.SelectNewDocument);n.Events.Fire(n.Events.Names.Drawer.Close)},i.prototype.OnSavedDocumentSelected=function(t){this.LoadDocument(t);this._scope.DocumentTypeFocus=!1;this._analytics.TrackEventWithPagePathLabel(Tracking.EventConstants.Categories.PassengerInformation,Tracking.EventConstants.Actions.SelectSavedDocument);n.Events.Fire(n.Events.Names.Drawer.Close)},i.prototype.LoadDocument=function(n){this._scope.DocumentType=n.DocumentType;this._scope.CountryOfIssue=n.CountryOfIssue;this._scope.DocumentNumber=n.DocumentNumber;this._scope.Gender=n.Gender;this._scope.Nationality=n.Nationality;this.SetDatePickerViewModel(this._scope.DateOfBirth,n.DateOfBirth);this.SetDatePickerViewModel(this._scope.DocumentExpiry,n.DocumentExpiryDate)},i.prototype.SetDatePickerViewModel=function(n,t){if(!!t){var i=t.Date();n.Day=i.DayOfMonth();n.Month=i.Month();n.Year=i.Year()}},i.prototype.TrackChangePassengerNameOrDetailsOnClick=function(){this._analytics.TrackEventWithPagePathLabel(Tracking.EventConstants.Categories.PassengerInformation,Tracking.EventConstants.Actions.ChangePassengerNameOrDetails,Tracking.EventConstants.Labels.ChangePassengerNameOrDetails)},i.prototype.NationalityClicked=function(){var t=this,i={Action:Tracking.EventConstants.Actions.Nationality,Category:Tracking.EventConstants.Categories.PassengerInformation,IncludePagePathInLabel:!0},r={LanguageCode:this._languageSettings.WebsiteRegionCode,OnNationalitySelected:function(i){!i||(t._scope.Nationality=i);t._scope.NationalityFocus=!1;n.Events.Fire(n.Events.Names.Drawer.Close)}};this._scope.NationalityFocus=!0;n.Events.OpenDrawerWithOptions({SectionKey:"check-in-nationality",Parameters:r,AnalyticsOptions:i})},i.prototype.CountryOfIssueClicked=function(){var t=this,i={Action:Tracking.EventConstants.Actions.CountryOfIssue,Category:Tracking.EventConstants.Categories.PassengerInformation,IncludePagePathInLabel:!0},r={LanguageCode:this._languageSettings.EResLanguageCode,OnCountryInfoSelected:function(i){!i||(t._scope.CountryOfIssue=i);t._scope.CountryOfIssueFocus=!1;n.Events.Fire(n.Events.Names.Drawer.Close)}};this._scope.CountryOfIssueFocus=!0;n.Events.OpenDrawerWithOptions({SectionKey:"check-in-country-of-issue",Parameters:r,AnalyticsOptions:i})},i.prototype.DialCodeClicked=function(){var t=this,i={LanguageCode:this._languageSettings.EResLanguageCode,OnCountryInfoSelected:function(n){!n||(t._scope.DialCode=n.DialCode);t._scope.DialCodeFocus=!1}};this._scope.DialCodeFocus=!0;n.Events.OpenDrawerWithOptions({SectionKey:"dial-code-selector-drawer",Parameters:i})},i.prototype.SaveDetailsCheckboxClicked=function(){this._scope.SaveDetailsCheckboxEnabled&&this._analytics.TrackEventWithPagePathLabel(Tracking.EventConstants.Categories.PassengerInformation,Tracking.EventConstants.Actions.SavePassengerDetails)},i.prototype.UseLeadPassengerCheckboxClicked=function(){this._scope.UseLeadPassengerDetails&&this._analytics.TrackEventWithPagePathLabel(Tracking.EventConstants.Categories.PassengerInformation,Tracking.EventConstants.Actions.UseLeadPassengerContactInformation)},i.prototype.SetDefaultSaveDetailsValues=function(){this._scope.SaveDetails=this._passengerInformationModel.SaveDetailsCheckboxDefaultValue;this._scope.SaveDetailsCheckboxEnabled=!1},i.prototype.DocumentExpiresBeforeLastFlight=function(n){return n.DifferenceInDays(this._lastFlightDepartureDate)<=0},i.prototype.GetEarliestValidExpiryDate=function(){return Utilities.TimeAgnosticDate.TodayLocal()},i.prototype.GetEarliestValidDateOfBirth=function(){return this._passengerAgeService.GetEarliestValidDateOfBirthForPassengerType(this._passengerType,this._lastFlightDepartureDate)},i.prototype.GetLatestValidDateOfBirth=function(){return this._passengerAgeService.GetLatestValidDateOfBirthForPassengerType(this._passengerType,this._firstFlightDepartureDate,this._lastFlightDepartureDate)},i.prototype.ShowLeadPassengerDetailsCheckbox=function(){return!this._scope.IsLeadPassenger&&this._scope.LeadPassengerDetailsConfirmed},i.prototype.ShowSaveDetailsCheckbox=function(){return this._passengerInformationModel.ShowSaveDetailsCheckbox&&n.Services.Account.AccountService.IsSignedIn!==n.Data.Account.SignedInStatus.PassengerSignIn},i.prototype.WatchForChangesThatEnableSaveDetails=function(){var t=this,n=Object.keys(this._scope.CheckInPassengerForm);n=n.filter(function(n){return n.charAt(0)!=="$"});n.forEach(function(n){t._scope.CheckInPassengerForm[n].$viewChangeListeners.push(function(){t._scope.SaveDetailsCheckboxEnabled=!0})})},i.prototype.SaveCheckboxVisibleAndEnabled=function(){return this.ShowSaveDetailsCheckbox()&&this._scope.SaveDetailsCheckboxEnabled},i.prototype.ClearAllDocumentFields=function(){this.ClearFieldsForNewDocument(!1);this.ClearField(this.FieldName_DialCode,"DialCode");this.ClearField(this.FieldName_DocumentType,"DocumentType");this.ClearField(this.FieldName_Email,"EmailAddress");this.ClearField(this.FieldName_PhoneNumber,"PhoneNumber");this._scope.$emit(n.Events.Names.Validation.Refresh);Utilities.ScreenReader.Alert(this._passengerInformationModel.ClearFormScreenreaderAlert,"travel-document")},i.prototype.ClearFieldsForNewDocument=function(t){t===void 0&&(t=!0);this.ClearField(this.FieldName_CountryOfIssue,"CountryOfIssue");this.ClearDate(this.FieldName_DateOfBirth,"DateOfBirth");this.ClearDate(this.FieldName_DocumentExpiry,"DocumentExpiry");this.ClearField(this.FieldName_DocumentNumber,"DocumentNumber");this.ClearField(this.FieldName_Gender,"Gender");this.ClearField(this.FieldName_Nationality,"Nationality");t&&this._scope.$emit(n.Events.Names.Validation.Refresh)},i.prototype.ClearField=function(n,t){this.SetFieldUntouchedAndPristine(n);this._scope[t]=null},i.prototype.ClearDate=function(n,t){this.SetFieldUntouchedAndPristine(n+"-day");this.SetFieldUntouchedAndPristine(n+"-month");this.SetFieldUntouchedAndPristine(n+"-year");this._scope[t].Day=null;this._scope[t].Month=null;this._scope[t].Year=null},i.prototype.SetFieldUntouchedAndPristine=function(n){var t=this._scope.CheckInPassengerForm[n];t&&(t.$setPristine(),t.$setUntouched())},i.prototype.ContinueClicked=function(){var i=this.VisibleFormIsValid(),r=!0,t;this._scope.ShowTravelDocumentSection&&(t=this.DateFromDatePicker(this._scope.DocumentExpiry),r=t?!this.DocumentExpiresBeforeLastFlight(t):!1);i&&r?this.SubmitForm():i?this.ShowExpiredDocumentDrawer():this._scope.$broadcast(n.Events.Names.Validation.Validate)},i.prototype.SubmitForm=function(){this._scope.IsLoading=!0;this._analytics.TrackEventWithPagePathLabel(Tracking.EventConstants.Categories.PassengerInformation,Tracking.EventConstants.Actions.Continue);var n=this.BuildUpdatePassengerOnBookingRequest();this._api.UpdatePassengerOnBooking(n,this.OnUpdatePassengerOnBookingSuccess.bind(this),this.OnUpdatePassengerOnBookingError.bind(this))},i.prototype.VisibleFormIsValid=function(){return this._scope.ShowTravelDocumentSection?this._scope.CheckInPassengerForm.$valid:this._scope.CheckInPassengerForm[this.FieldName_DialCode].$valid&&this._scope.CheckInPassengerForm[this.FieldName_PhoneNumber].$valid&&this._scope.CheckInPassengerForm[this.FieldName_Email].$valid},i.prototype.BuildUpdatePassengerOnBookingRequest=function(){var t=this.SaveCheckboxVisibleAndEnabled()&&this._scope.SaveDetails,i=null;return this._scope.ShowTravelDocumentSection&&(i={DocumentType:this._scope.DocumentType.ApiValue,DocumentNumber:this._scope.DocumentNumber,Nationality:this._scope.Nationality.ApiValue,CountryOfIssue:this._scope.CountryOfIssue.ISOCountryCode,DateOfBirth:this.DateFromDatePicker(this._scope.DateOfBirth).ToIso8601(),Gender:n.Data.Common.Gender.ToString(this._scope.Gender),DocumentExpiryDate:this.DateFromDatePicker(this._scope.DocumentExpiry).ToIso8601()}),{BookingReference:this._manageBookingsService.GetCurrentBookingReference(),PassengerCode:this._manageBookingsService.GetCurrentPassengerCode(),TravelDocumentInformation:i,ContactInformation:{DiallingCode:this._scope.DialCode,EmailAddress:this._scope.EmailAddress,PhoneNumber:this._scope.PhoneNumber},SaveContactInformationToProfile:t,SaveTravelDocumentInformationToProfile:t}},i.prototype.DateFromDatePicker=function(n){return n.Year&&n.Month&&n.Day?Utilities.TimeAgnosticDate.FromParts(n.Year,n.Month,n.Day):null},i.prototype.OnUpdatePassengerOnBookingSuccess=function(){var n=this._manageBookingsService.ApplyBookingReferenceToUrl(this._passengerInformationModel.ContinueTargetUrl);window.location.href=n},i.prototype.OnUpdatePassengerOnBookingError=function(n,t,i,r){this._scope.IsLoading=!1;this._errorService.HandleApiError(n,t,i,r)},i.ControllerName="CheckIn_PassengerInformation",i.$inject=["CheckIn_Api","IAnalyticsTracker","CheckIn_Mapper","Data_CountryDataService","Error_Service","Sitecore_LanguageSettings","Common_PassengerAgeService","Sitecore_CheckInPassengerInformation","$q","$scope","Common_PassengerDisplayService","Common_NavigationService","ManageBookings_Service","CommercialSoftLogInCookie_Service"],i}(t.BaseCheckInController);t.CheckInPassengerInformation=i})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(i,r,u,f,e,o,s,h){var c=t.call(this,i,s,o)||this;return c._scope=i,c._yourAccountModel=r,c._manageBookingsApi=u,c._errorService=f,c._analyticsTracker=e,c._routesService=new Main3.Routes.RoutesService(h),c._scope.LoadMore=c.LoadMore.bind(c),c._scope.ShowFilter=!1,c._scope.Filter=c.Filter.bind(c),c._scope.FilterBy=c._yourAccountModel.FilterOptions[0].Value,c._scope.GetFilterDropDownOptions=c.GetFilterDropDownOptions.bind(c),c._scope.TextFilter="",c._scope.ShowSort=!1,c._scope.ShowTextFilter=!1,c._scope.Sort=c.Sort.bind(c),c._scope.SortBy=c._yourAccountModel.SortOptions[0].Value,c._scope.GetSortByDropDownOptions=c.GetSortByDropDownOptions.bind(c),c._scope.ClearTextFilter=c.ClearTextFilter.bind(c),c._scope.ShowBookingCancelledDrawer=c.ShowBookingCancelledDrawer.bind(c),c._initialFilter=n.Data.ManageBookings.BookingListQueryFilter.ActiveOnlyUnlessEmpty,c._currentFilter=c._initialFilter,c._currentSort=n.Data.ManageBookings.BookingListQuerySort.FlightDate,c._currentTextFilter="",c}return __extends(i,t),i.prototype.OnSignInConfirmed=function(){this.Reset();this.LoadMore()},i.prototype.ShowBookingCancelledDrawer=function(t){var i={SectionKey:"booking-cancelled",PreventDismissOverride:!0,TitleOverride:this._yourAccountModel.BookingCancelledDrawerTitle.replace("{BookingRef}",t.BookingReference)};n.Events.OpenDrawerWithOptions(i)},i.prototype.Reset=function(n){n===void 0&&(n=!0);this._scope.ShowSort=!1;this._scope.ShowFilter=!1;this._scope.ShowTextFilter=!1;this._scope.Bookings=[];this._numberOfBookingsRequested=0;this._loadedBookingReferences=[];this._isFirstRequest=n},i.prototype.LoadMore=function(){this._scope.ShowLoadMore=!1;this._scope.IsLoadingMore=!0;var n={Uncached:this._isFirstRequest,Skip:this._numberOfBookingsRequested,Take:Math.max(1,this._yourAccountModel.DefaultNumberOfBookings),MaxFlightsPerBooking:this._yourAccountModel.MaximumBookingFlightsToShow,MaxPassengersPerBooking:this._yourAccountModel.MaxiumumPassengersToShow,Filter:this._currentFilter,Sort:this._currentSort,TextFilter:encodeURIComponent(this._currentTextFilter)};n.Skip>0&&(n.Take=Math.max(1,this._yourAccountModel.NumberOfExtraBookingsToLoad));this._manageBookingsApi.QueryBookings(n,this.OnGetBookingsSuccess.bind(this,n.Take),this._errorService.HandleApiError.bind(this._errorService))},i.prototype.OnGetBookingsSuccess=function(n,t){var r=this,i=[],u;t.Bookings.forEach(function(n){r._loadedBookingReferences.indexOf(n.BookingReference)===-1&&(r._loadedBookingReferences.push(n.BookingReference),i.push(r.BookingViewModelFromApiBooking(n)))});this.HavePreviouslyLoadedBookings()&&(Utilities.ScreenReader.Alert(this._yourAccountModel.MoreBookingsLoadedScreenreaderAlert,"your-account"),this._scope.Bookings.forEach(function(n){return n.FocusOnBooking=!1}),i.length>0&&this._scope.$applyAsync(function(){i[0].FocusOnBooking=!0}));(u=this._scope.Bookings).push.apply(u,i);this._isFirstRequest=!1;this._numberOfBookingsRequested+=n;this._numberOfBookingsRequested<t.TotalNumberOfBookingsMatchingQuery&&(this._scope.ShowLoadMore=!0);this.UpdateControlVisibility(t);t.TotalNumberOfActiveBookings+t.TotalNumberOfOldBookings>0?this.HandleBookingsOnAccount(t):this.HandleNoBookings();this._scope.IsLoadingMore=!1;this._scope.IsLoading=!1},i.prototype.HandleNoBookings=function(){this._scope.ShowFilter=!1;this.ShowNoUpcomingFlightsMessage()},i.prototype.HandleBookingsOnAccount=function(t){this.RemoveInvalidFilterOptions(t);this.AccountOnlyContainsOldBookings(t)?(this._scope.FilterBy=n.Data.ManageBookings.BookingListQueryFilter.OldOnly.toString(),this._yourAccountModel.FilterOptions[0].DisplayText=this._yourAccountModel.ShowingOldBookingsOnlyText,this.ShowNoUpcomingFlightsMessage()):this.DisplayUpcomingFlightInformationHelpingHand(t)},i.prototype.ShowNoUpcomingFlightsMessage=function(){n.Events.Fire(n.Events.Names.HelpingHand.ShowText,this._yourAccountModel.NoUpcomingFlightsHelpingHandMessage)},i.prototype.DisplayUpcomingFlightInformationHelpingHand=function(t){var i;if(this._currentFilter===this._initialFilter)if(i=t.Bookings.filter(function(n){return n.Flights.filter(function(n){return!n.HasFlown&&!n.IsCancelled}).length>0}),i.length===0)this.ShowNoUpcomingFlightsMessage();else{var f=i[0].Flights.filter(function(n){return!n.HasFlown&&!n.IsCancelled}),u=f[0],r=this.GetDepartureDateDaysFromToday(u.LocalDepartureTime),e=r===0?this._yourAccountModel.NextUpcomingFlightIsTodayHelpingHandMessage:r===1?this._yourAccountModel.NextUpcomingFlightIsTomorrowHelpingHandMessage:this._yourAccountModel.NextUpcomingFlightIsInNDaysHelpingHandMessage;n.Events.Fire(n.Events.Names.HelpingHand.ShowText,this.ReplaceTokensInUpcomingFlightMessage(e,r,u.ArrivalIata))}},i.prototype.ReplaceTokensInUpcomingFlightMessage=function(n,t,i){return n.replaceAll("{Days}",t.toString()).replaceAll("{Destination}",this._routesService.FindAirportByIata(i).Name)},i.prototype.GetDepartureDateDaysFromToday=function(n){var t=new Utilities.TimeAgnosticDate(n).ToStartOfDayLocal();return t.diff(moment().startOf("day"),"days")},i.prototype.AccountOnlyContainsOldBookings=function(t){return t.TotalNumberOfActiveBookings===0&&this._currentFilter===n.Data.ManageBookings.BookingListQueryFilter.ActiveOnlyUnlessEmpty},i.prototype.UpdateControlVisibility=function(n){var t=n.TotalNumberOfActiveBookings+n.TotalNumberOfOldBookings;this._scope.ShowNoBookingsMessage=t===0;this._scope.ShowNoResultsMessage=n.TotalNumberOfBookingsMatchingQuery===0&&t>0;this._scope.ShowFilter=t>0;this._scope.ShowSort=t>=this._yourAccountModel.DisplaySortDropdownIfBookingsCountIsAtLeast;this._scope.ShowTextFilter=t>=this._yourAccountModel.DisplayTextFilterIfBookingsCountIsAtLeast},i.prototype.RemoveInvalidFilterOptions=function(t){t.TotalNumberOfOldBookings===0&&(this.RemoveFilterDropdownItem(n.Data.ManageBookings.BookingListQueryFilter.OldOnly),this.RemoveFilterDropdownItem(n.Data.ManageBookings.BookingListQueryFilter.All));t.TotalNumberOfActiveBookings===0&&(this.RemoveFilterDropdownItem(n.Data.ManageBookings.BookingListQueryFilter.ActiveOnly),this.RemoveFilterDropdownItem(n.Data.ManageBookings.BookingListQueryFilter.All))},i.prototype.RemoveFilterDropdownItem=function(n){var t=this._yourAccountModel.FilterOptions,i=t.filter(function(t){return t.Value!==n.toString()});this._yourAccountModel.FilterOptions=i},i.prototype.HavePreviouslyLoadedBookings=function(){return this._numberOfBookingsRequested>0},i.prototype.BookingViewModelFromApiBooking=function(n){var t=this;return{BookingReference:n.BookingReference,ScreenreaderBookingReference:this.GetScreenreaderFriendlyBookingReference(n.BookingReference),DateOfBooking:Utilities.ZonelessDateTime.FromIso8601(n.DateOfBooking),NameOfBooker:n.NameOfBooker,Flights:n.Flights.map(function(n){var i=Utilities.ZonelessDateTime.FromIso8601(n.LocalDepartureTime);return{ArrivalAirportName:t._routesService.FindAirportByIata(n.ArrivalIata).Name,DepartureAirportName:t._routesService.FindAirportByIata(n.DepartureIata).Name,LocalDepartureTime:i,HasFlown:n.HasFlown,IsDelayed:n.IsDelayed,IsCancelled:n.IsCancelled}}),NumberOfUnshownFlights:n.NumberOfUnshownFlights,PassengerList:n.Passengers.map(function(n){return n.FirstName+" "+n.LastName}).join(", "),NumberOfUnshownPassengers:n.NumberOfUnshownPassengers,IsFlexiBooking:n.IsFlexiBooking,IsStandByBooking:n.IsStandByBooking,ViewBookingUrl:this.GetViewBookingUrl(n.BookingReference),FocusOnBooking:!1,IsCancelled:n.IsCancelled,NumberOfDisruptedFlightsInBooking:n.NumberOfDisruptedFlightsInBooking}},i.prototype.GetScreenreaderFriendlyBookingReference=function(n){return n.split("").join(" ")+""},i.prototype.GetViewBookingUrl=function(t){var i=new Urls.UrlBuilder(this._yourAccountModel.ViewBookingTargetUrl);return i.AddQueryParameter(n.Services.ManageBookings.ManageBookingsService.BookingReferenceQueryParameterName,t),i.GetUrl()},i.prototype.GetFilterDropDownOptions=function(){return this._yourAccountModel.FilterOptions},i.prototype.GetSortByDropDownOptions=function(){return this._yourAccountModel.SortOptions},i.prototype.Filter=function(){var t=n.Data.ManageBookings.BookingListQueryFilter.Parse(n.Data.ManageBookings.BookingListQueryFilter[this._scope.FilterBy]),i=t!==this._currentFilter,r=this._scope.TextFilter!==this._currentTextFilter;(i||r)&&(this._currentFilter=t,this._currentTextFilter=this._scope.TextFilter,this._currentFilter===n.Data.ManageBookings.BookingListQueryFilter.ActiveOnly&&(this._yourAccountModel.FilterOptions[0].DisplayText=this._yourAccountModel.ShowingActiveBookingsOnlyText,this.ResetFilterOptionsToDefaults([n.Data.ManageBookings.BookingListQueryFilter.OldOnly,n.Data.ManageBookings.BookingListQueryFilter.All])),this._currentFilter===n.Data.ManageBookings.BookingListQueryFilter.OldOnly&&(this._yourAccountModel.FilterOptions[1].DisplayText=this._yourAccountModel.ShowingOldBookingsOnlyText,this.ResetFilterOptionsToDefaults([n.Data.ManageBookings.BookingListQueryFilter.ActiveOnly,n.Data.ManageBookings.BookingListQueryFilter.All])),this._currentFilter===n.Data.ManageBookings.BookingListQueryFilter.All&&(this._yourAccountModel.FilterOptions[2].DisplayText=this._yourAccountModel.ShowingAllBookings,this.ResetFilterOptionsToDefaults([n.Data.ManageBookings.BookingListQueryFilter.ActiveOnly,n.Data.ManageBookings.BookingListQueryFilter.OldOnly])),i&&this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.ManageBookings,Tracking.EventConstants.Actions.Filter,n.Data.ManageBookings.BookingListQueryFilter.ToString(this._currentFilter)),r&&this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.ManageBookings,Tracking.EventConstants.Actions.TextFilter,this._currentTextFilter),this.Reset(!1),this.LoadMore(),Utilities.ScreenReader.Alert(this._yourAccountModel.BookingsHaveBeenFilteredAlert,"manageBookingsBookingListFilteredAlert"))},i.prototype.ClearTextFilter=function(){this._scope.TextFilter=""},i.prototype.ResetFilterOptionsToDefaults=function(t){_.contains(t,n.Data.ManageBookings.BookingListQueryFilter.ActiveOnly)&&!!this._yourAccountModel.FilterOptions[0]&&(this._yourAccountModel.FilterOptions[0].DisplayText=this._yourAccountModel.ActiveBookingsOnlyText);_.contains(t,n.Data.ManageBookings.BookingListQueryFilter.OldOnly)&&!!this._yourAccountModel.FilterOptions[1]&&(this._yourAccountModel.FilterOptions[1].DisplayText=this._yourAccountModel.OldBookingsOnlyText);_.contains(t,n.Data.ManageBookings.BookingListQueryFilter.All)&&!!this._yourAccountModel.FilterOptions[2]&&(this._yourAccountModel.FilterOptions[2].DisplayText=this._yourAccountModel.AllBookingsText)},i.prototype.Sort=function(){var t=n.Data.ManageBookings.BookingListQuerySort.Parse(n.Data.ManageBookings.BookingListQuerySort[this._scope.SortBy]);t!==this._currentSort&&(this._currentSort=t,this._currentSort===n.Data.ManageBookings.BookingListQuerySort.BookingDate&&(this._yourAccountModel.SortOptions[0].DisplayText=this._yourAccountModel.FlightDateText,this._yourAccountModel.SortOptions[1].DisplayText=this._yourAccountModel.SortByBookingDateText),this._currentSort===n.Data.ManageBookings.BookingListQuerySort.FlightDate&&(this._yourAccountModel.SortOptions[0].DisplayText=this._yourAccountModel.SortByFlightDateText,this._yourAccountModel.SortOptions[1].DisplayText=this._yourAccountModel.BookingDateText),this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.ManageBookings,Tracking.EventConstants.Actions.Sort,n.Data.ManageBookings.BookingListQuerySort.ToString(this._currentSort)),this.Reset(!1),this.LoadMore(),Utilities.ScreenReader.Alert(this._yourAccountModel.BookingsHaveBeenSortedAlert,"manageBookingsBookingListSortedAlert"))},i.ControllerName="YourAccount_ListBookings",i.$inject=["$scope","Sitecore_YourAccount","ManageBookings_Api","Error_Service","IAnalyticsTracker","Common_NavigationService","CommercialSoftLogInCookie_Service","Sitecore_RoutesData"],i}(t.Account.BaseAccountController);i.ListBookings=r})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(t){function i(n,i,r,u,f,e,o,s,h){var c=t.call(this,n,f,s,h)||this;return c._scope=n,c._tracker=i,c._packingRestrictions=r,c._checkInPassengerCookieService=u,c._navService=f,c._checkInApiService=e,c._errorService=o,c._scope.OnCheckIn=c.OnCheckIn.bind(c),c._scope.ConfirmationCheckBoxChanged=c.ConfirmationCheckBoxChanged.bind(c),c._scope.CheckBoxTicked=!1,c.EnsureCheckInCookieExists(),c}return __extends(i,t),i.prototype.OnSignInConfirmed=function(){this._scope.IsLoading=!1},i.prototype.EnsureCheckInCookieExists=function(){if(!this._checkInPassengerCookieService.HasCookie()||this._checkInPassengerCookieService.ReadCookie().Flights.length===0){var n=this._manageBookingsService.ApplyBookingReferenceToUrl(this._packingRestrictions.UnsuccessfulRedirectTargetUrl);this._navService.NavigateTo(n)}},i.prototype.ConfirmationCheckBoxChanged=function(){this._scope.CheckBoxTicked&&this._tracker.TrackEvent(Tracking.EventConstants.Categories.CheckIn,Tracking.EventConstants.Actions.PackingRestrictions,Tracking.EventConstants.Labels.PackingRestrictionsAccepted)},i.prototype.OnCheckIn=function(){var t=this,i,r;this._scope.PackingRestrictionsForm.$valid&&(this._scope.IsLoading=!0,this._tracker.TrackEvent(Tracking.EventConstants.Categories.CheckIn,Tracking.EventConstants.Actions.PackingRestrictions,Tracking.EventConstants.Labels.CompleteCheckIn),i=this._checkInPassengerCookieService.ReadCookie(),r=this._manageBookingsService.ApplyBookingReferenceToUrl(this._packingRestrictions.SuccessfulRedirectTargetUrl),this._checkInApiService.CheckIn(i,function(){t._checkInPassengerCookieService.RemoveCookie();t._navService.NavigateTo(r)},function(i,r,u,f){var e=!f?null:f.KnownErrorAdditionalData,o=JSON.parse(e),s=t._manageBookingsService.ApplyBookingReferenceToUrl(t._packingRestrictions.UnsuccessfulRedirectTargetUrl),h={ErrorCode:o.ErrorCode,CheckInUrl:s},c={SectionKey:"check-in-error",Parameters:h,PreventDismissOverride:!0};n.Events.OpenDrawerWithOptions(c)}))},i.ControllerName="CheckIn_PackingRestrictions",i.$inject=["$scope","IAnalyticsTracker","Sitecore_PackingRestrictions","CheckInPassengersCookie_Service","Common_NavigationService","CheckIn_Api","Error_Service","CommercialSoftLogInCookie_Service","ManageBookings_Service"],i}(t.BaseCheckInController);t.PackingRestrictions=i})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(n,i,r,u,f,e,o,s,h,c,l,a){var v=t.call(this,n,c,i)||this;return v._tracker=a,v._scope=n,v._viewBookingModel=r,v._manageBookingsApi=u,v._errorService=f,v._manageBookingsService=e,v._manageBookingsMapper=o,v._airportInformationService=s,v._paymentSettingsService=h,v._manageBookingsSkipPageService=l,v._scope.GetManageDisruptionLinkUrl=v.GetManageDisruptionLinkUrl.bind(v),v._scope.ShowAirportInformation=v.ShowAirportInformation.bind(v),v._scope.ShowPassengerRestrictionsDrawer=v.ShowPassengerRestrictionsDrawer.bind(v),v._scope.ShowPaymentHistoryDrawer=v.ShowPaymentHistoryDrawer.bind(v),v._scope.ShowManageSeats=v.ShowManageSeats.bind(v),v._scope.FireAddLuggageAnalyticsEvent=v.FireAddLuggageAnalyticsEvent.bind(v),v._scope.FireAddOrChangeLuggageAnalyticsEvent=v.FireAddOrChangeLuggageAnalyticsEvent.bind(v),v._scope.FireAddMoreLuggageAnalyticsEvent=v.FireAddMoreLuggageAnalyticsEvent.bind(v),v}return __extends(i,t),i.prototype.IsSignedInAsPassenger=function(){return n.Services.Account.AccountService.IsSignedIn===n.Data.Account.SignedInStatus.PassengerSignIn},i.prototype.OnSignInConfirmed=function(){this.IsSignedInAsPassenger()&&Title.TitleBar.Instance.RemoveSubtitle();this._scope.BookingReference=this._manageBookingsService.GetCurrentBookingReference();this.UpdatePageTitle();this._manageBookingsApi.ViewBooking(this._manageBookingsService.GetCurrentBookingReference(),this.OnViewBookingSuccess.bind(this),this._errorService.HandleApiError.bind(this._errorService));n.Events.Fire(n.Events.Names.Basket.SetupBasket,"",n.Data.Common.ClientBasketType.AncillariesPanel,!1,"")},i.prototype.OnViewBookingSuccess=function(n){var i=this,t;this._scope.Flights=this._manageBookingsMapper.ViewBookingResponseToViewBookingFlights(n);this._scope.Payments=this._manageBookingsMapper.ViewBookingResponseToViewBookingPayments(n);this._scope.ShowConfirmationEmailSummary=n.ShowConfirmationEmailNotification;this._scope.ShowPassengerRestrictionSummary=n.IsPassengerRestrictedView;this._scope.ShowPaymentSummary=n.ShowPaymentHistory;this._scope.ShowCheckInSummary=n.AllowCheckIn;this._scope.Payments&&this._scope.Payments.length>0?(t=this._scope.Payments[0],this._scope.PaymentDate=t.PaymentDate,this._scope.PaymentAmount=t.Price,this._scope.PaymentCurrency=t.CurrencyCode,this._scope.PaymentVendorName=this._paymentSettingsService.GetPaymentCardWithPaymentMethodType(t.PaymentInformation.CardInformation.CardType).PaymentCardDisplayName):this._scope.ShowPaymentSummary=!1;this._scope.CheckInAvailableForAnyFlight=_(this._scope.Flights).any(function(n){return n.WithinCheckInWindow&&n.CheckInApplicable});this._scope.LowestDaysUntilCheckIn=this.GetLowestDaysUntilCheckIn(this._scope.Flights);this._airportInformationService.GetAirportsInformation(this.GetUniqueIatas(n)).then(function(n){i._scope.AirportInformation=n.AirportsInformation}).finally(function(){i._scope.IsLoading=!1})},i.prototype.GetLowestDaysUntilCheckIn=function(){var n=_.chain(this._scope.Flights).select(function(n){return!n.AfterCheckInWindow&&!n.WithinCheckInWindow&&n.CheckInApplicable}).min(function(n){return n.DaysUntilCheckIn}).value();return!n?0:n.DaysUntilCheckIn},i.prototype.ShowManageSeats=function(n){return n.ShowSeats&&!this._manageBookingsSkipPageService.ShouldDisableSeatingDueToMaxPassengers(n.Passengers)},i.prototype.GetUniqueIatas=function(n){return _(n.Flights).chain().map(function(n){return[n.DepartureIata,n.ArrivalIata]}).flatten().unique().value()},i.prototype.UpdatePageTitle=function(){var n=this._viewBookingModel.PageTitle.replace("{booking reference}",this._manageBookingsService.GetCurrentBookingReference());Title.TitleBar.Instance.UpdateHeaderTitle(n)},i.prototype.GetManageDisruptionLinkUrl=function(n){return this._manageBookingsService.ManageDisruptionLinkReplacements(this._viewBookingModel.ManageDisruptionLinkTargetUrl,n.FlightCardFlight)},i.prototype.ShowAirportInformation=function(){var t={AirportInformation:this._scope.AirportInformation};n.Events.OpenDrawerWithOptions({SectionKey:"combined-airport-information",Parameters:t,AnalyticsOptions:{Category:Tracking.EventConstants.Categories.ViewBooking,Action:Tracking.EventConstants.Actions.Drawer,Label:Tracking.EventConstants.Labels.AirportInformation}})},i.prototype.ShowPassengerRestrictionsDrawer=function(){n.Events.OpenDrawer("passenger-view-restrictions")},i.prototype.ShowPaymentHistoryDrawer=function(){var t={Payments:this._scope.Payments};n.Events.OpenDrawerWithOptions({SectionKey:"payment-history",Parameters:t,AnalyticsOptions:{Category:Tracking.EventConstants.Categories.ViewBooking,Action:Tracking.EventConstants.Actions.Drawer,Label:Tracking.EventConstants.Labels.PaymentHistory}})},i.prototype.FireAddLuggageAnalyticsEvent=function(){this.FireManageHoldLuggageAndSportsEquipmentAnalyticsEvent(Tracking.EventConstants.Labels.AddHoldLuggage)},i.prototype.FireAddOrChangeLuggageAnalyticsEvent=function(){this.FireManageHoldLuggageAndSportsEquipmentAnalyticsEvent(Tracking.EventConstants.Labels.AddOrChangeHoldLuggage)},i.prototype.FireAddMoreLuggageAnalyticsEvent=function(){this.FireManageHoldLuggageAndSportsEquipmentAnalyticsEvent(Tracking.EventConstants.Labels.AddMoreHoldLuggage)},i.prototype.FireManageHoldLuggageAndSportsEquipmentAnalyticsEvent=function(n){this._tracker.TrackEvent(Tracking.EventConstants.Categories.ViewBooking,Tracking.EventConstants.Actions.ManageHoldLuggageAndSportsEquipment,n)},i.ControllerName="YourAccount_ViewBooking",i.$inject=["$scope","Common_NavigationService","Sitecore_ViewBooking","ManageBookings_Api","Error_Service","ManageBookings_Service","ManageBookings_Mapper","Common_AirportsInformationService","Sitecore_PaymentSettingsService","CommercialSoftLogInCookie_Service","ManageBookings_SkipPageService","IAnalyticsTracker"],i}(t.Account.BaseAccountController);i.ViewBooking=r})(i=t.CheckIn||(t.CheckIn={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){var f=this,u;this._scope=n;this._drawerSettings=t;this._navService=i;this._tracker=r;this._tracker.TrackEvent(Tracking.EventConstants.Categories.CheckIn,Tracking.EventConstants.Actions.CheckIn,Tracking.EventConstants.Labels.CheckInFailed);this._scope.Continue=this.Continue.bind(this);this._parameters=this._scope.Section.Options.Parameters;this._scope.ContinueButtonText=this._drawerSettings.ContinueButtonText;u=this._drawerSettings.Errors.filter(function(n){return n.HybrisErrorCode===f._parameters.ErrorCode})[0];u&&u.ErrorMessage?(this._scope.ErrorMessage=u.ErrorMessage,this._scope.TitleText=u.ErrorTitle):this._scope.ErrorMessage=this._drawerSettings.DefaultErrorMessage}return n.prototype.Continue=function(){this._navService.NavigateTo(this._parameters.CheckInUrl)},n.ControllerName="CheckIn_ErrorDrawer",n.$inject=["$scope","Sitecore_CheckInErrorDrawer","Common_NavigationService","IAnalyticsTracker",],n}();n.CheckInErrorDrawer=t})(t=n.Drawers||(n.Drawers={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i,r){this._scope=t;this._tracker=i;this._checkInService=r;this._parameters=this._scope.Section.Options.Parameters;this._scope.Flights=this.MapFlights(this._parameters.Flights);this._scope.OnFlightChanged=this.OnFlightChanged.bind(this);this._scope.CanContinue=this.CanContinue.bind(this);this._scope.Continue=this.Continue.bind(this);this._scope.$on(n.Events.Names.DrawerSection.Shown,this.OnSectionShown.bind(this))}return t.prototype.OnSectionShown=function(){this._tracker.TrackEvent(Tracking.EventConstants.Categories.CheckIn,Tracking.EventConstants.Actions.SelectFlights,Tracking.EventConstants.Labels.Show)},t.prototype.MapFlights=function(n){var t=this;return n.map(function(n){return t._checkInService.MapFlightToCheckInDrawerFlight(n)})},t.prototype.OnFlightChanged=function(n){n.IsSelected?this._tracker.TrackEvent(Tracking.EventConstants.Categories.CheckIn,Tracking.EventConstants.Actions.SelectFlights,Tracking.EventConstants.Labels.FlightSelected):this._tracker.TrackEvent(Tracking.EventConstants.Categories.CheckIn,Tracking.EventConstants.Actions.SelectFlights,Tracking.EventConstants.Labels.FlightDeselected)},t.prototype.CanContinue=function(){return this._scope.Flights.filter(function(n){return n.IsSelected}).length>0},t.prototype.Continue=function(){this._tracker.TrackEvent(Tracking.EventConstants.Categories.CheckIn,Tracking.EventConstants.Actions.SelectFlights,Tracking.EventConstants.Labels.Continue);this._checkInService.GoToCheckInSelectPassengers(this.SelectedFlights())},t.prototype.SelectedFlights=function(){var n=this;return this._parameters.Flights.filter(function(t){return n.FlightIsSelected(t.FlightCardFlight.SegmentId)})},t.prototype.FlightIsSelected=function(n){return this.GetFlightFromScope(n).IsSelected},t.prototype.GetFlightFromScope=function(n){return this._scope.Flights.filter(function(t){return t.SegmentId===n})[0]},t.ControllerName="CheckIn_FlightsDrawer",t.$inject=["$scope","IAnalyticsTracker","CheckIn_Service"],t}();t.CheckInFlightsDrawer=i})(i=t.Drawers||(t.Drawers={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u){this._scope=t;this._checkInService=i;this._tracker=r;this._routesService=new Main3.Routes.RoutesService(u);this._parameters=this._scope.Section.Options.Parameters;this._flights=this._parameters.Flights;this._scope.Passengers=this._checkInService.MapFlightPassengersToCheckInDrawerPassengers(this._parameters.Flights);this._scope.GetAddPassengerInformationLinkUrl=this._checkInService.GetAddPassengerInformationLinkUrl.bind(this._checkInService);this._scope.OnPassengerChanged=this.OnPassengerChanged.bind(this);this._scope.CanContinue=this.CanContinue.bind(this);this._scope.Continue=this.Continue.bind(this);this._scope.$on(n.Events.Names.DrawerSection.Shown,this.OnSectionShown.bind(this))}return t.prototype.OnSectionShown=function(){this._tracker.TrackEvent(Tracking.EventConstants.Categories.CheckIn,Tracking.EventConstants.Actions.SelectPassengers,Tracking.EventConstants.Labels.Show)},t.prototype.OnPassengerChanged=function(n){n.IsSelected?this._tracker.TrackEvent(Tracking.EventConstants.Categories.CheckIn,Tracking.EventConstants.Actions.SelectPassengers,Tracking.EventConstants.Labels.PassengerSelected):this._tracker.TrackEvent(Tracking.EventConstants.Categories.CheckIn,Tracking.EventConstants.Actions.SelectPassengers,Tracking.EventConstants.Labels.PassengerDeselected)},t.prototype.CanContinue=function(){return this._scope.Passengers.filter(function(n){return n.IsSelected}).length>0},t.prototype.Continue=function(){this._tracker.TrackEvent(Tracking.EventConstants.Categories.CheckIn,Tracking.EventConstants.Actions.SelectPassengers,Tracking.EventConstants.Labels.Continue);var n=this._checkInService.MapSelectedPassengersToPassengerCodes(this._scope.Passengers,!0);this._checkInService.GoToCheckInConfirmation(this._flights,n)},t.ControllerName="CheckIn_PassengersDrawer",t.$inject=["$scope","CheckIn_Service","IAnalyticsTracker","Sitecore_RoutesData"],t}();t.CheckInPassengersDrawer=i})(i=t.Drawers||(t.Drawers={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i,r){var u=this;this._api=t;this._errorService=i;this._scope=r;this._parameters=this._scope.Section.Options.Parameters;this._scope.SelectNewDocumentType=this.SelectNewDocumentType.bind(this);this._scope.SelectSavedDocument=this.SelectSavedDocument.bind(this);this._scope.MarkDocumentForDelete=this.MarkDocumentForDelete.bind(this);this._scope.DeleteDocument=this.DeleteDocument.bind(this);this._scope.CancelDelete=this.CancelDelete.bind(this);this._scope.IsLoading=!0;this._api.GetDocumentTypes(this._parameters.LanguageCode,this.GetDocumentTypesSuccess.bind(this),this._errorService.HandleApiError.bind(this._errorService));this._scope.SavedDocuments=this._parameters.SavedDocuments;this._scope.$on(n.Events.Names.Drawer.Closed,function(){u._scope.SavedDocuments.forEach(function(n){return n.MarkedForDeletion=!1})})}return t.prototype.GetDocumentTypesSuccess=function(n){this._scope.DocumentTypes=n.Types;this._scope.IsLoading=!1},t.prototype.SelectNewDocumentType=function(n){this._parameters.OnDocumentTypeSelected(n)},t.prototype.SelectSavedDocument=function(n){this._parameters.OnSavedDocumentSelected(n)},t.prototype.MarkDocumentForDelete=function(n){n.MarkedForDeletion=!0},t.prototype.DeleteDocument=function(n){var t=this;this._api.DeleteDocumentType(n.DocumentNumber,function(){return t.RemoveDocumentFromList(n.DocumentNumber)},this._errorService.HandleApiError.bind(this._errorService))},t.prototype.CancelDelete=function(n){n.MarkedForDeletion=!1},t.prototype.RemoveDocumentFromList=function(n){this._scope.SavedDocuments=this._scope.SavedDocuments.filter(function(t){return t.DocumentNumber!=n})},t.ControllerName="CheckIn_DocumentSelectionDrawer",t.$inject=["CheckIn_Api","Error_Service","$scope"],t}();t.DocumentSelectionDrawer=i})(i=t.Drawers||(t.Drawers={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._scope=n;this._api=t;this._errorService=i;this._parameters=this._scope.Section.Options.Parameters;this._scope.IsLoading=!0;this._scope.SelectNationality=this.SelectNationality.bind(this);this._api.GetNationalities(this._parameters.LanguageCode,this.GetNationalitiesSuccess.bind(this),this._errorService.HandleApiError.bind(this._errorService))}return n.prototype.GetNationalitiesSuccess=function(n){this._scope.Nationalities=n.Nationalities;this._scope.IsLoading=!1},n.prototype.SelectNationality=function(n){var t=this._scope.Nationalities.filter(function(t){return t.ApiValue===n});t.length===1&&this._parameters.OnNationalitySelected(t[0])},n.ControllerName="CheckIn_NationalityDrawer",n.$inject=["$scope","CheckIn_Api","Error_Service"],n}();n.NationalityDrawer=t})(t=n.Drawers||(n.Drawers={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u){this._scope=n;this._tracker=t;this._errorService=i;this._manageBookingsApi=r;this._manageBookingsService=u;this._parameters=this._scope.Section.Options.Parameters;this._scope.Payments=this._parameters.Payments;this._scope.VatInvoice=this.VatInvoice.bind(this);this._scope.GetPaymentConfirmation=this.GetPaymentConfirmation.bind(this)}return t.prototype.GetPaymentConfirmation=function(){var t=this;n.Events.OpenDrawerWithOptions({SectionKey:"payment-confirmation",OnConfirmCallback:function(){t._tracker.TrackEvent(Tracking.EventConstants.Categories.ViewBooking,Tracking.EventConstants.Actions.Drawer,Tracking.EventConstants.Labels.PaymentConfirmationRequest);n.Events.Fire(n.Events.Names.Drawer.Close);t._manageBookingsApi.RequestPaymentConfirmation(t._manageBookingsService.GetCurrentBookingReference(),function(){},t._errorService.HandleApiError.bind(t._errorService))}})},t.prototype.VatInvoice=function(){var t=this;n.Events.OpenDrawerWithOptions({SectionKey:"vat-invoice",OnConfirmCallback:function(){t._tracker.TrackEvent(Tracking.EventConstants.Categories.ViewBooking,Tracking.EventConstants.Actions.Drawer,Tracking.EventConstants.Labels.VatRequest);n.Events.Fire(n.Events.Names.Drawer.Close);t._manageBookingsApi.RequestVatInvoice(t._manageBookingsService.GetCurrentBookingReference(),function(){},t._errorService.HandleApiError.bind(t._errorService))}})},t.ControllerName="YourAccount_PaymentHistoryDrawer",t.$inject=["$scope","IAnalyticsTracker","Error_Service","ManageBookings_Api","ManageBookings_Service"],t}();t.PaymentHistoryDrawer=i})(i=t.Drawers||(t.Drawers={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u){this._bookingModel=r;this._manageBookingsService=u;this._scope=t;this._tracker=i;this._scope.Passengers=this._scope.Section.Options.Parameters.Passengers;this._scope.$on(n.Events.Names.DrawerSection.Shown,this.OnSectionShown.bind(this));this._scope.AddPassengerInformationClicked=this.AddPassengerInformationClicked.bind(this)}return t.prototype.AddPassengerInformationClicked=function(n){var t=this.GetAddPassengerInformationLinkUrl(n);this._tracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.CheckIn,Tracking.EventConstants.Actions.AddApis,Tracking.EventConstants.Labels.PassengerInformation,t)},t.prototype.GetAddPassengerInformationLinkUrl=function(n){var t=this._bookingModel.AddPassengerInformationLinkUrl;return t=this._manageBookingsService.ApplyBookingReferenceToUrl(t),this._manageBookingsService.ApplyPassengerCodeToUrl(t,n.PassengerCode)},t.prototype.OnSectionShown=function(){this._tracker.TrackEvent(Tracking.EventConstants.Categories.ViewPassengers,Tracking.EventConstants.Actions.ViewPassengers,Tracking.EventConstants.Labels.Show)},t.ControllerName="CheckIn_ViewPassengersDrawer",t.$inject=["$scope","IAnalyticsTracker","Sitecore_CheckInBooking","ManageBookings_Service"],t}();t.ViewPassengersDrawer=i})(i=t.Drawers||(t.Drawers={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i){this._qService=t;this._scope=i;this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this)}return t.prototype.FunnelReady=function(){},t.prototype.ShouldExitFunnel=function(){return!1},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!1}},t.prototype.IsValid=function(){return!1},t.ControllerName="ManageBookingFunnel_AmendmentCheckout",t.$inject=["$q","$scope","$document"],t}();t.AmendmentCheckout=i})(i=t.Funnel||(t.Funnel={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i,r){this._scope=t;this._basketService=i;this._basketSettings=r;this._scope.IsLoading=!0;this._scope.BuildPassengerText=this.BuildPassengerText.bind(this);this._scope.$on(n.Events.Names.Funnel.FunnelReady,this.OnFunnelReady.bind(this));this._seatChanges=new Dictionary;n.Events.Fire(n.Events.Names.Basket.BasketInitialised)}return t.prototype.OnFunnelReady=function(){this._scope.Basket=this._basketService.GetBasket();this._scope.IsLoading=!1;n.Events.Fire(n.Events.Names.Basket.FunnelBasketReady);n.Events.Fire(n.Events.Names.Basket.HeightModified);this._scope.$emit(n.Events.Names.Basket.SetPrice,0)},t.prototype.BuildPassengerText=function(t){var r=n.Services.ManageBookings.Funnel.ManageBookingFunnelBasketMapper.BuildPassengerComposition(t),i=[];return this.BuildPassengerTextPart(i,r.Adults,this._basketSettings.OneAdultText,this._basketSettings.AdultsText),this.BuildPassengerTextPart(i,r.Children,this._basketSettings.OneChildText,this._basketSettings.ChildrenText),this.BuildPassengerTextPart(i,r.Infants,this._basketSettings.OneInfantText,this._basketSettings.InfantsText),i.join(", ")},t.prototype.BuildPassengerTextPart=function(n,t,i,r){t>0&&(t==1?n.push(i.replace("{number}",t.toString())):n.push(r.replace("{number}",t.toString())))},t.ControllerName="ManageBookingFunnel_Basket",t.$inject=["$scope","ManageBookings_Funnel_ClientBasketService","Sitecore_ManageBookingBasketModel"],t}();t.Basket=i})(i=t.Funnel||(t.Funnel={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){var u=this;this._scope=n;this._basketService=t;this._priceService=i;this._journeyCookieService=r;this._scope.SeatingAnalyticsCategory=Tracking.EventConstants.Categories.Seating;this._scope.$watch(function(){return u.GetChangesKey()},this.UpdateSeatingChanges.bind(this));this._scope.SetActiveFlight=this.SetActiveFlight.bind(this)}return n.prototype.SetActiveFlight=function(){var n=this;this._journeyCookieService.UpdateCookie(function(t){return t.SeatMapFirstFlightSegmentId=n._scope.Flight.Flight.SegmentId})},n.prototype.GetChangesKey=function(){var n="";return this._scope.Flight&&this._scope.Flight.Seating&&this._scope.Flight.Seating.Changes&&this._scope.Flight.Seating.Changes.forEach(function(t){n+=JSON.stringify(t)}),n},n.prototype.UpdateSeatingChanges=function(){var n=this,t=[];this._scope.Flight&&this._scope.Flight.Seating&&this._scope.Flight.Seating.Changes&&this._scope.Flight.Seating.Changes.length>0&&this._scope.Flight.Seating.Changes.forEach(function(i){var r=n._basketService.GetPassengerByInternalId(n._scope.Flight.Flight.InternalId,i.PassengerCode,!0).HasEjPlusCard,u=t.filter(function(t){return t.DisplayName===i.DisplayName&&t.IsEjPlus===r&&n._priceService.AreEqual(t.Price,i.PricePerSeat)}),f;u.length>0?u[0].Quantity++:(f={DisplayName:i.DisplayName,Price:i.PricePerSeat,Quantity:1,IsEjPlus:r},t.push(f))});this._scope.Changes=t},n.ControllerName="ManageBookingFunnel_BasketSeatChanges",n.$inject=["$scope","ManageBookings_Funnel_ClientBasketService","Common_PriceService","ManageBookingJourney_Service"],n}();n.BasketSeatChanges=t})(t=n.Funnel||(n.Funnel={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){var i=function(n){function t(t,i,r,u,f,e,o,s){var h=n.call(this,t,i,r,u)||this;return h._helpingHandMessages=f,h._extrasSettings=e,h._journeyCookieService=o,h._manageBookingsService=s,h}return __extends(t,n),t.prototype.BeforeFunnelReady=function(){this._journeyCookieService.UpdateCookie(function(n){return n.BackToViewBooking=!1});this.UpdateTitleLinkToIncludeBookingReference()},t.prototype.UpdateTitleLinkToIncludeBookingReference=function(){var n=Title.TitleBar.Instance.GetSubtitleUrl(),t=this._journeyCookieService.ReadCookie().BookingReference;n=this._manageBookingsService.ApplyBookingReferenceToUrl(n,t);Title.TitleBar.Instance.UpdateSubtitleUrl(n)},t.prototype.GetExtrasPanelsSettings=function(){return this._extrasSettings.Panels},t.prototype.ShouldExitFunnel=function(){return!1},t.prototype.GetStepOnLoadRedirect=function(){return null},t.prototype.GetSomeSelectedHelpingHandText=function(){return this._helpingHandMessages.SomeExtrasSelectedText},t.prototype.GetSomeSelectedHelpingHandButtonText=function(){return this._helpingHandMessages.SomeExtrasSelectedButtonText},t.ControllerName="ManageBookingFunnel_Extras",t.$inject=["$scope","ManageBookings_Funnel_ExtraPanelStrategyService","IAnalyticsTracker","Funnel_ExtrasSmartMessagesService","Sitecore_ManageBookingsFunnelHelpingHandSettings","Sitecore_ManageBookingFunnelExtraSettings","ManageBookingJourney_Service","ManageBookings_Service"],t}(n.SharedFunnel.BaseExtras);t.Extras=i})(i=t.Funnel||(t.Funnel={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h,c,l,a){this._scope=t;this._qService=i;this._priceService=r;this._errorService=u;this._luggageRulesService=f;this._funnelBasketLuggageService=e;this._basketFlightItemChargeService=o;this._luggageChargesService=s;this._luggageLimitsService=h;this._accessibilityService=c;this._luggageDrawersService=l;this._basketService=a;this._luggageReadyDeferred=this._qService.defer();this._scope.AddBag=this.AddBag.bind(this);this._scope.AddSportsEquipment=this.AddSportsEquipment.bind(this);this._scope.HasLuggage=this.HasLuggage.bind(this);this._scope.HasReachedMaximumBaggageAllowance=this.HasReachedMaximumBaggageAllowance.bind(this);this._scope.HasReachedMaximumLargeSportEquipmentsAllowance=this.HasReachedMaximumLargeSportEquipmentsAllowance.bind(this);this._scope.HasReachedMaximumSportsEquipmentAllowance=this.HasReachedMaximumSportsEquipmentAllowance.bind(this);this._scope.LuggageReady=this.LuggageReady.bind(this);this._scope.OnChangeWeightButtonClick=this.OnChangeWeightButtonClick.bind(this);this._scope.RemoveBag=this.RemoveBag.bind(this);this._scope.RemoveSportsEquipment=this.RemoveSportsEquipment.bind(this);this._scope.SetTotalPriceAndWeight=this.SetTotalPriceAndWeight.bind(this);this._scope.Price=this._priceService.NewPrice(0,0);this._scope.Weight=0;this._hasUpdateInProgress=!1;this._scope.IsTemporarilyDisabled=this.HasUpdateInProgress.bind(this);this._scope.$emit(n.Events.Names.Funnel.RegisterFunnelControl,this)}return t.prototype.HasUpdateInProgress=function(){return this._hasUpdateInProgress},t.prototype.FunnelReady=function(){this.PreloadApiCalls();this._luggageLimitsService.Initialize();this._scope.Bags=this._funnelBasketLuggageService.GetClientBasketBags();this._scope.SportsEquipment=this._funnelBasketLuggageService.GetClientBasketSportsEquipment();this._basketHasLuggage=this.HasLuggage();this.SetTotalPriceAndWeight()},t.prototype.IsValid=function(){return this.HasItems()},t.prototype.HasItems=function(){return this._scope.Bags&&this._scope.Bags.length>0||this._scope.SportsEquipment&&this._scope.SportsEquipment.length>0},t.prototype.GetFunnelControlSettings=function(){return{LoadMemberDetailsInBasket:!1,PreloadAvailabilityRequest:!1,PreventHelpingHandUpdateOnValid:!1}},t.prototype.ShouldExitFunnel=function(){return!1},t.prototype.AddBag=function(n){var t=this;this._hasUpdateInProgress=!0;this._scope.Bags.push(n);this._scope.SetTotalPriceAndWeight();this._funnelBasketLuggageService.AddBagToServerBasket(n).then(function(i){t._funnelBasketLuggageService.UpdateClientBasketFromServer(i.Luggage);t._accessibilityService.AlertBagAddedToBasket(n);t._hasUpdateInProgress=!1})},t.prototype.AddSportsEquipment=function(n){var t=this;this._hasUpdateInProgress=!0;this._scope.SportsEquipment.push(n);this._scope.SetTotalPriceAndWeight();this._funnelBasketLuggageService.AddSportsEquipmentToServerBasket(n).then(function(i){t._funnelBasketLuggageService.UpdateClientBasketFromServer(i.Luggage);t._accessibilityService.AlertSportsEquipmentAddedToBasket(n);t._hasUpdateInProgress=!1})},t.prototype.ChangeBagSelected=function(n,t){var i=this._scope.Bags[n];this._scope.Bags[n]=t;this.SetTotalPriceAndWeight();this._funnelBasketLuggageService.UpdateClientBasket(this._scope.Bags,this._scope.SportsEquipment);i.Weight!==t.Weight&&this._accessibilityService.AlertBagWeightChangedInBasket(i,t)},t.prototype.HasLuggage=function(){return this._scope.Bags&&this._scope.Bags.length>0||this._scope.SportsEquipment&&this._scope.SportsEquipment.length>0},t.prototype.HasReachedMaximumBaggageAllowance=function(){return this._scope.IsLuggageReady?this._luggageLimitsService.HasReachedMaximumBaggageAllowance(this._scope.Bags):!1},t.prototype.HasReachedMaximumSportsEquipmentAllowance=function(){return this._scope.IsLuggageReady?this._luggageLimitsService.HasReachedMaximumSportsEquipmentAllowance(this._scope.SportsEquipment):!1},t.prototype.HasReachedMaximumLargeSportEquipmentsAllowance=function(){return this._scope.IsLuggageReady?this._luggageLimitsService.HasReachedMaximumLargeSportsEquipmentAllowance(this._scope.SportsEquipment):!1},t.prototype.LuggageReady=function(){return this._luggageReadyDeferred.promise},t.prototype.OnChangeWeightButtonClick=function(n,t,i){var r=this;n.preventDefault();this._luggageDrawersService.OpenChangeWeightDrawer(t,function(n){return r.ChangeBagSelected(i,n)})},t.prototype.PreloadApiCalls=function(){var t=this,i=this._basketService.GetBasket(),r=[this._luggageRulesService.GetLuggageRules(),this._basketFlightItemChargeService.GetFlightItemCharges(i.CurrencyCode,i.LanguageCode,i.Flights)];this._qService.all(r).then(function(){t._scope.IsLuggageReady=!0;t._luggageReadyDeferred.resolve();t._scope.$emit(n.Events.Names.Funnel.LuggageReady)},function(){t._luggageReadyDeferred.reject();t._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.LuggageApiCallPromises)})},t.prototype.RemoveBag=function(n){var t=this,i;this._hasUpdateInProgress=!0;i=this._scope.Bags[n];this._funnelBasketLuggageService.RemoveBagFromServerBasket(n).then(function(r){t._scope.SetFocusAfterLuggageItemRemoved(n,!1);t._scope.Bags=(t._scope.Bags||[]).filter(function(t,i){return i!==n});t._scope.SetTotalPriceAndWeight();t._funnelBasketLuggageService.UpdateClientBasketFromServer(r.Luggage);t._accessibilityService.AlertBagRemovedFromBasket(i);t._hasUpdateInProgress=!1})},t.prototype.RemoveSportsEquipment=function(n){var t=this,i=this._scope.SportsEquipment[n];this._funnelBasketLuggageService.RemoveSportsEquipmentFromServerBasket(n).then(function(r){t._scope.SetFocusAfterLuggageItemRemoved(n,!0);t._scope.SportsEquipment=(t._scope.SportsEquipment||[]).filter(function(t,i){return i!==n});t._scope.SetTotalPriceAndWeight();t._funnelBasketLuggageService.UpdateClientBasketFromServer(r.Luggage);t._accessibilityService.AlertSportsEquipmentRemovedFromBasket(i)})},t.prototype.SetTotalPriceAndWeight=function(){this._scope.Price=this._luggageChargesService.CalculateTotalLuggagePrice(this._scope.Bags,this._scope.SportsEquipment);this._scope.Weight=this.SumLuggageItemWeights(this._scope.Bags,this._scope.SportsEquipment)},t.prototype.SumLuggageItemWeights=function(n,t){return this.SumItemWeights(n)+this.SumItemWeights(t)},t.prototype.SumItemWeights=function(n){var t=0;return _(n||[]).each(function(n){n&&n.Weight&&(t+=n.Weight)}),t},t.ControllerName="ManageBookingFunnel_Luggage",t.$inject=["$scope","$q","Common_PriceService","ManageBookings_Funnel_ErrorService","Funnel_LuggageRulesService","ManageBookings_Funnel_BasketLuggageService","Funnel_FlightItemChargeService",n.DynamicDependencyKeys.LuggageChargesService,"ManageBookings_Funnel_LuggageLimitsService","Funnel_AccessibilityService","Funnel_LuggageDrawersService","ManageBookings_Funnel_ClientBasketService"],t}();t.Luggage=i})(i=t.Luggage||(t.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(i=t.ManageBooking||(t.ManageBooking={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o){this._basketFlightItemChargeService=t;this._errorService=i;this._funnelLuggageClientSettings=r;this._luggageChargesService=u;this._luggageDrawersService=f;this._basketService=e;this._scope=o;this._scope.AddBagIfLimitNotReached=this.AddBagIfLimitNotReached.bind(this);this._scope.AddSportsEquipmentIfLimitNotReached=this.AddSportsEquipmentIfLimitNotReached.bind(this);this._scope.CountBagsOfType=this.CountBagsOfType.bind(this);this._scope.CountSportsEquipmentOfType=this.CountSportsEquipmentOfType.bind(this);this._scope.OnDifferentWeightButtonClick=this.OnDifferentWeightButtonClick.bind(this);this._scope.RemoveBagOfType=this.RemoveBagOfType.bind(this);this._scope.RemoveSportsEquipmentOfType=this.RemoveSportsEquipmentOfType.bind(this);this._scope.ShowConditionalLabel=this.ShowConditionalLabel.bind(this);this._scope.ShowFromLabelForBag=this.ShowFromLabelForBag.bind(this);this._scope.ShowFromLabelForSports=this.ShowFromLabelForSports.bind(this);this._scope.$on(n.Events.Names.Funnel.LuggageReady,this.LuggageReady.bind(this))}return t.prototype.LuggageReady=function(){this.SetBagOptions();this.SetSportsEquipmentOptions();this.SetFromPriceLabels()},t.prototype.AddBagIfLimitNotReached=function(n){if(this._scope.HasReachedMaximumBaggageAllowance()){this._luggageDrawersService.OpenLuggageLimitReachedDrawer(this._scope.HasReachedMaximumBaggageAllowance(),this._scope.HasReachedMaximumSportsEquipmentAllowance()||this._scope.HasReachedMaximumLargeSportEquipmentsAllowance());return}this._scope.AddBag(n)},t.prototype.AddSportsEquipmentIfLimitNotReached=function(n){if(this._scope.HasReachedMaximumSportsEquipmentAllowance()||n.IsLarge&&this._scope.HasReachedMaximumLargeSportEquipmentsAllowance()){this._luggageDrawersService.OpenLuggageLimitReachedDrawer(this._scope.HasReachedMaximumBaggageAllowance(),this._scope.HasReachedMaximumSportsEquipmentAllowance()||this._scope.HasReachedMaximumLargeSportEquipmentsAllowance());return}this._scope.AddSportsEquipment(n)},t.prototype.CountBagsOfType=function(n){return this._scope.Bags.filter(function(t){return t.Weight===n.Weight&&t.IsFlexiFareBag===!1}).length},t.prototype.CountSportsEquipmentOfType=function(n){return this._scope.SportsEquipment.filter(function(t){return t.Code===n.Code}).length},t.prototype.GetSpecificBagOfType=function(n){return Utilities.Arrays.FirstOrDefault(this._scope.Bags,function(t){return!t.IsFlexiFareBag&&t.Weight===n.Weight})},t.prototype.GetSpecificSportsEquipmentOfType=function(n){return Utilities.Arrays.FirstOrDefault(this._scope.SportsEquipment,function(t){return t.Code===n.Code})},t.prototype.GetBagOptions=function(n){var t=this;return n.map(function(n){return{Bag:n,IsStandardOption:t.IsStandardBagOption(n),Quantity:t.CountBagsOfType(n)}})},t.prototype.GetSportsEquipmentOptions=function(n){var t=this;return n.map(function(n){return{IsStandardOption:!1,SportsEquipment:n,Quantity:t.CountSportsEquipmentOfType(n)}})},t.prototype.IsStandardBagOption=function(t){return this._funnelLuggageClientSettings.BagOptionWeights.some(function(n){return t.Weight===n})||t.Type===n.Data.Funnel.BagType.SmallHoldBag},t.prototype.OnDifferentWeightButtonClick=function(){var n=this,t;if(this._scope.HasReachedMaximumBaggageAllowance()&&this._scope.HasReachedMaximumSportsEquipmentAllowance()){this._luggageDrawersService.OpenLuggageLimitReachedDrawer(this._scope.HasReachedMaximumBaggageAllowance(),this._scope.HasReachedMaximumSportsEquipmentAllowance());return}t={OnSelectBag:function(t){return n._scope.AddBag(t)},OnSelectSportsEquipment:function(t){return n._scope.AddSportsEquipment(t)},HasReachedMaximumBaggageAllowance:this._scope.HasReachedMaximumBaggageAllowance,HasReachedMaximumSportsEquipmentAllowance:this._scope.HasReachedMaximumSportsEquipmentAllowance,HasReachedMaximumLargeSportsEquipmentAllowance:this._scope.HasReachedMaximumLargeSportEquipmentsAllowance,ShowConditionalBagText:this._showBagFromLabel,ShowConditionalSportsText:this._showSmallSportsFromLabel||this._showLargeSportsFromLabel};this._luggageDrawersService.OpenCombinedBagsSportsEquipmentDrawer(t)},t.prototype.RemoveBagOfType=function(n){this._scope.RemoveBag(this.GetSpecificBagOfType(n))},t.prototype.RemoveSportsEquipmentOfType=function(n){this._scope.RemoveSportsEquipment(this.GetSpecificSportsEquipmentOfType(n))},t.prototype.SetBagOptions=function(){var n=this;this._luggageChargesService.GetWeightList().then(function(t){n._scope.BagOptions=n.GetBagOptions(t)},function(){n._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.GetWeightList)})},t.prototype.SetFromPriceLabels=function(){var t=this,i=this._basketService.GetBasket();this._basketFlightItemChargeService.GetFlightItemCharges(i.CurrencyCode,i.LanguageCode,i.Flights).then(function(i){t._showBagFromLabel=_(i.map(function(t){return t.HoldLuggage.Amount[n.Data.Common.PaymentType.DebitCard]})).unique().length!==1||_(i.map(function(t){return t.HoldLuggageExcessWeight.Amount[n.Data.Common.PaymentType.DebitCard]})).unique().length!==1;t._showSmallSportsFromLabel=_(i.map(function(t){return t.SmallSportsEquipment.Amount[n.Data.Common.PaymentType.DebitCard]})).unique().length!==1;t._showLargeSportsFromLabel=_(i.map(function(t){return t.LargeSportsEquipment.Amount[n.Data.Common.PaymentType.DebitCard]})).unique().length!==1})},t.prototype.SetSportsEquipmentOptions=function(){var n=this;this._luggageChargesService.GetSportsEquipmentList().then(function(t){n._scope.SportsEquipmentOptions=n.GetSportsEquipmentOptions(t)},function(){n._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.GetWeightList)})},t.prototype.ShowConditionalLabel=function(){return this._showBagFromLabel||_(this._scope.SportsEquipment).any(function(n){return n.IsLarge})&&this._showLargeSportsFromLabel||_(this._scope.SportsEquipment).any(function(n){return!n.IsLarge})&&this._showSmallSportsFromLabel},t.prototype.ShowFromLabelForBag=function(t){return t&&this._showBagFromLabel&&t.Price[n.Data.Common.PaymentType.DebitCard]!==0},t.prototype.ShowFromLabelForSports=function(n){return n&&(n.IsLarge?this._showLargeSportsFromLabel:this._showSmallSportsFromLabel)},t.ControllerName="ManagedBookings_Funnel_LuggageOptions",t.$inject=["Funnel_FlightItemChargeService","ManageBookings_Funnel_ErrorService","Sitecore_FunnelLuggageClientSettings",n.DynamicDependencyKeys.LuggageChargesService,"Funnel_LuggageDrawersService","ManageBookings_Funnel_ClientBasketService","$scope"],t}();t.LuggageOptions=i})(i=t.Funnel||(t.Funnel={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(t){function i(n,i,r,u,f,e,o,s,h,c,l){var a=t.call(this,n,i,r,u,f,e,o,s,h,c)||this;return a._serverBasketService=l,a}return __extends(i,t),i.prototype.UpdateSeatAssociationsInServerBasket=function(n){return this._serverBasketService.UpdateSeatsForFlight(n.FlightInternalId)},i.prototype.ShouldShowAreYouSureDrawerForSkip=function(){return!1},i.prototype.ShouldShowYouHaventSelectedAllSeatsDrawerForSkip=function(){return!1},i.prototype.ShouldExitFunnel=function(){return!1},i.prototype.ShouldRedirectOnLoad=function(){return!1},i.prototype.BeforeLeavingStep=function(){},i.prototype.GetStepOnLoadRedirect=function(){return null},i.ControllerName="ManageBookingFunnel_SeatMap",i.$inject=["$q","$scope",n.DynamicDependencyKeys.SeatMapFlightDataService,n.DynamicDependencyKeys.SeatMapAssociationsService,n.DynamicDependencyKeys.SeatMapPassengerService,"IAnalyticsTracker","SeatMapDrawerService","seatMapSettings","SeatMapSeatAssignmentService",n.DynamicDependencyKeys.SeatMapSameSeatService,"ManageBookings_Funnel_ServerBasketService"],i}(n.Controllers.SharedFunnel.BaseSeatMap);t.SeatMap=i})(i=t.Funnel||(t.Funnel={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r;(function(i){var r=function(t){function i(n,i,r,u,f,e,o,s,h,c,l,a){var v=t.call(this,n,i,r,u,f,e)||this;return v._startupService=o,v._errorService=s,v._api=h,v._journeyCookieService=c,v._journeySettings=l,v._manageBookingService=a,v}return __extends(i,t),i.prototype.Initialised=function(){this._startupService.StartUp();this._scope.$emit(n.Events.Names.Basket.SetupBasket,"ng-templates/basket/manage-booking-funnel",n.Data.Common.ClientBasketType.Funnel,!1)},i.prototype.BeforeContinue=function(){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.ManageBookingFunnel,Tracking.EventConstants.Actions.Continue,window.location.pathname)},i.prototype.BeforeSkip=function(){return this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.ManageBookingFunnel,Tracking.EventConstants.Actions.Skip,window.location.pathname),!0},i.prototype.FunnelReady=function(){!this._journeyCookieService.ReadCookie().BackToViewBooking||this.UpdateBackTitleLinkForViewBooking()},i.prototype.UpdateBackTitleLinkForViewBooking=function(){var i=this,n=Title.TitleBar.Instance,t=this._journeySettings.BackToViewBookingUrl;t=this._manageBookingService.ApplyBookingReferenceToUrl(t,this._journeyCookieService.ReadCookie().BookingReference);n.UpdateSubtitleUrl(t);n.UpdateSubtitleText(this._journeySettings.BackToViewBookingText);n.AddClickHandlerToSubtitle(function(){i._journeyCookieService.RemoveCookie()})},i.prototype.GetSkipUrl=function(){return this._funnelJourneyService.GetSkipToNextStepUrl()},i.prototype.GetContinueUrl=function(){return this._funnelJourneyService.GetContinueToNextStepUrl()},i.prototype.HasPendingApiRequests=function(){return this._api.HasAnyRequestsPending()},i.prototype.DoExit=function(n){this._errorService.Exit(n)},i.ControllerName="ManageBookingFunnel_Step",i.$inject=["$q","$rootScope","$scope","Funnel_JourneyService","IAnalyticsTracker","$document","ManageBookings_Funnel_StartupService","ManageBookings_Funnel_ErrorService","ManageBookings_Funnel_Api","ManageBookings_Funnel_StepTransitionService","ManageBookingJourney_Service","Sitecore_ManageBookingsFunnelJourneySettings","ManageBookings_Service"],i}(t.SharedFunnel.BaseStep);i.Step=r})(r=i.Funnel||(i.Funnel={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(n){function t(t,i,r,u,f){var s=this,e,o;return i.IncludeFlexiFares=!1,i.IncludePrices=!1,i.IsFlightTransfer=!0,e=new Main3.Routes.RoutesService(r),o=function(){return!0},n.call(this,t,i,u,e,f,!0,o)||this}return __extends(t,n),t.ControllerName="Rebooking_AvailabilityGridProvider",t.$inject=["$rootScope","$scope","Sitecore_RoutesData","Availability_AvailabilityService","Rebooking_SyncedRefreshService"],t}(n.Availability.BaseAvailabilityGridProvider);t.AvailabilityGridProvider=i})(t=n.Rebooking||(n.Rebooking={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._scope=n;this._rebookingPageService=t;this._dataRefreshSeconds=i.RebookingRootSettings.DataRefreshSeconds;this._scope.IsLoading=!0;this._scope.RemoveModification=this.OnRemoveModification.bind(this);this.ListenForEvents();this.InitializeSelectedFareRefresherService()}return t.prototype.ListenForEvents=function(){var t=this;this._scope.$on(n.Events.Names.Rebooking.BasketLoaded,this.OnBasketLoaded.bind(this));this._scope.$on(n.Events.Names.Account.DeprecatedSignInStatusChanged,function(n,i){i||(t._scope.ClientBasket=null,t._scope.IsLoading=!0)})},t.prototype.InitializeSelectedFareRefresherService=function(){this._refresher&&this._refresher.StopPeriodicRefresh();this._refresher=new Main3.Refreshing.PeriodicRefresher(this._rebookingPageService,this._dataRefreshSeconds);this._refresher.ResetRefresh()},t.prototype.OnBasketLoaded=function(n,t){this._scope.ClientBasket=t;this._scope.IsLoading=!1;this._refresher.ImmediateRefresh()},t.prototype.OnRemoveModification=function(t){this._scope.$emit(n.Events.Names.Rebooking.FlightModified,{SegmentId:t.SegmentId,Modification:n.Data.Rebooking.FlightModificationType.None,ReplacementFlight:null})},t.ControllerName="Rebooking_Basket",t.$inject=["$scope","RebookingPage_Service","Sitecore_RebookingClientSettings"],t}();t.Basket=i})(i=t.Rebooking||(t.Rebooking={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e){var o=this;this._scope=t;this._api=i;this._clientSettings=r;this._errorService=u;this._rebookingService=f;this.routesData=e;this._routesService=new Main3.Routes.RoutesService(e);this._scope.IsConfirmed=!1;this._scope.IsLoading=!1;this._scope.DoToggleConfirmation=this.OnToggleConfirmation.bind(this);this._scope.DoConfirm=this.OnConfirm.bind(this);this._scope.DoHandleKeyup=this.HandleKeyup.bind(this);this._scope.LookUpAirportName=this.LookUpAirportName.bind(this);this._scope.GetPassengersOnFlight=this.GetPassengersOnFlight.bind(this);this._clientBasket=this._rebookingService.CurrentClientBasket;!this._clientBasket||!this._clientBasket.Flights||(this._scope.RefundedFlights=this._clientBasket.Flights.filter(function(t){return t.Modification===n.Data.Rebooking.FlightModificationType.Refund}),this._scope.TransferredFlights=this._clientBasket.Flights.filter(function(t){return t.Modification===n.Data.Rebooking.FlightModificationType.Transfer}).map(function(n){return n.ReplacementFlight}));this._scope.$on(n.Events.Names.DrawerSection.Shown,function(){o._scope.IsConfirmed=!1;o._scope.IsLoading=!1})}return t.prototype.OnToggleConfirmation=function(){this._scope.IsConfirmed=!this._scope.IsConfirmed},t.prototype.OnConfirm=function(){this._scope.IsConfirmed&&(this._scope.IsLoading=!0,this._api.Finalize(this.OnFinalizeSuccess.bind(this),this.HandleApiError.bind(this)))},t.prototype.HandleApiError=function(n,t,i){this._errorService.HandleApiError(n,t,i)},t.prototype.LookUpAirportName=function(n){var t=this._routesService.FindAirportByIata(n);return t?t.Name:n},t.prototype.GetPassengersOnFlight=function(n){var t=this._clientBasket.Associations.filter(function(t){return t.FlightInternalId===n}),i=t.map(function(n){return n.PassengerInternalId}),r=this._clientBasket.Passengers.filter(function(n){return i.indexOf(n.InternalId)>-1}).map(function(n){return n.FirstName+" "+n.LastName}),u=t.filter(function(n){return!!n.CarriedInfantId}).map(function(n){return n.CarriedInfantId}),f=this._clientBasket.CarriedInfants.filter(function(n){return u.indexOf(n.InternalId)>-1}).map(function(n){return n.FirstName+" "+n.LastName});return r.concat(f).join(", ")},t.prototype.OnFinalizeSuccess=function(){window.location.href=this._clientSettings.RebookingConfirmationPageUrl},t.prototype.HandleKeyup=function(n){n.which==13&&this.OnToggleConfirmation()},t.ControllerName="Rebooking_ConfirmationDrawer",t.$inject=["$scope","Rebooking_Api","Sitecore_RebookingClientSettings","Error_Service","Rebooking_Service","Sitecore_RoutesData"],t}();t.ConfirmationDrawer=i})(i=t.Rebooking||(t.Rebooking={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(i,r,u,f,e,o,s,h,c,l,a){var v=t.call(this,f,h,s,i)||this;return v._scope=i,v._rootScope=r,v._confirmationService=u,v._pickBookingService=e,v._errorService=o,v._bookingDataService=c,v._flightConfirmationCookieService=l,v._basketBookingDataMapper=a,v._scope.ShowAncillariesPanel=function(){return n.Events.Fire(n.Events.Names.Basket.Show)},v._scope.IsLoading=!0,v._scope.RefundRequested=!1,v._scope.HasAdditionalBookings=!1,v._scope.ShowAirportInformation=v.ShowAirportInformation.bind(v),v._scope.AirportsInformation=[],v._scope.DoManageAdditionalDisruptions=v.RedirectToRebooking.bind(v),v._scope.$on(n.Events.Names.Account.DeprecatedSignInStatusChanged,v.OnSignInStatusChanged.bind(v)),v._bookingDataService.Expecting(n.Services.Controls.BookingData.BookingDataSource.DisruptionBasket),v._confirmationService.GetBasket(v.GotBasket.bind(v),v.HandleApiError.bind(v)),v}return __extends(i,t),i.prototype.HandleApiError=function(n,t,i){this._errorService.HandleApiError(n,t,i)},i.prototype.GotBasket=function(t){if(this.SetAirportsInformation(t.Flights),this._flightSegmentId=this.GetFlightSegmentIdFromFlights(t.Flights),!t.HasBeenFinalised){this.RedirectToRebooking();return}this._scope.FlightsToCheckIn=t.Flights.filter(function(n){return n.CanCheckIn}).length;t.IsSoleBookingForUser?(this._scope.HasAdditionalBookings=!1,this._scope.IsLoading=!1):this.CheckForAdditionalBookings();this.ShowAncillaries();this._scope.Flights=t.Flights.filter(function(t){return t.Modification!=n.Data.Rebooking.FlightModificationType.Refund}).sort(this.CompareBasketFlights.bind(this));this._scope.BookingPassengers=Main3.Common.BookingPassengers.CreateFromBasket(t);this._scope.Luggage=t.Luggage;this._scope.HasLuggage=t.Luggage.HoldBags.length>0||t.Luggage.SportsEquipment.length>0;this._scope.LuggageText=this.BuildLuggageText(t.Luggage,t.Passengers);this._scope.ShowCheckIn=this._scope.FlightsToCheckIn>0;this._scope.RefundRequested=t.Flights.filter(function(t){return t.Modification==n.Data.Rebooking.FlightModificationType.Refund}).length>0;this._scope.Ancillaries=t.Ancillaries;this._scope.HasAncillaries=this._scope.Ancillaries.HasCar||this._scope.Ancillaries.HasHotelBooking||this._scope.Ancillaries.HasTravelInsurance;this.SetDisruptionBasket(t);n.Events.OpenDrawer("rebooking-confirmation-lite");this.ShowHelpingHand();this.SetPageTitle(t);this.SetFlightConfirmationCookie(t)},i.prototype.SetDisruptionBasket=function(t){var i=this._basketBookingDataMapper.Map(t);this._bookingDataService.Received(n.Services.Controls.BookingData.BookingDataSource.DisruptionBasket,i)},i.prototype.SetFlightConfirmationCookie=function(n){var t=n.Flights[0],r=t.LocalDepartureTime.Date(),i=Main3.Common.BookingPassengers.CreateFromBasket(n).PassengerComposition();this._flightConfirmationCookieService.SetFlightConfirmationCookie(n.BookingReference,t.DepartureIata,t.ArrivalIata,i.Adults,i.Children,i.Infants,r,null)},i.prototype.CompareBasketFlights=function(n,t){var i=this.GetComparableDepartureTime(n),r=this.GetComparableDepartureTime(t);return i-r},i.prototype.GetComparableDepartureTime=function(t){var i=t.LocalDepartureTime.ToSortable();return t.Modification==n.Data.Rebooking.FlightModificationType.Transfer&&t.ReplacementFlight&&(i=t.ReplacementFlight.LocalDepartureTime.ToSortable()),i},i.prototype.GetFlightSegmentIdFromFlights=function(n){for(var i,r="",t=0;t<n.length;t++)if(i=n[t],i.IsFocalFlight){r=i.SegmentId;break}return r},i.prototype.SetPageTitle=function(n){var t=this._scope.TitleTextFormat.replace("{booking ref}",n.BookingReference);Title.TitleBar.Instance.HideAndThenShowText(t)},i.prototype.ShowHelpingHand=function(){this._scope.FlightsToCheckIn==0?this._rootScope.$emit(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/rebooking/confirmation/no-flights",this._scope):this._scope.FlightsToCheckIn==1?this._rootScope.$emit(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/rebooking/confirmation/one-flight",this._scope):this._rootScope.$emit(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/rebooking/confirmation/more-flights",this._scope)},i.prototype.CheckForAdditionalBookings=function(){this._confirmationService.GetBookings(this._flightSegmentId,this.CheckedForAdditionalBookings.bind(this),this.HandleApiError.bind(this))},i.prototype.CheckedForAdditionalBookings=function(n){this._scope.HasAdditionalBookings=n.Bookings.length>0;this._scope.IsLoading=!1},i.prototype.RedirectToRebooking=function(){this._pickBookingService.RedirectToRebooking(this._flightSegmentId)},i.prototype.OnSignInStatusChanged=function(n,t){t||(this._scope.IsLoading=!0,window.location.href="/")},i.ControllerName="Rebooking_ConfirmationPage",i.$inject=["$scope","$rootScope","Rebooking_ConfirmationService","Controls_LuggageService","Rebooking_PickBookingService","Error_Service","Sitecore_AirportInformationDrawer","Common_AirportsInformationService","Controls_BookingDataService","FlightConfirmationCookie_Service","Controls_DisruptionBasketBookingDataMapper"],i}(t.Common.BaseConfirmationPage);i.ConfirmationPage=r})(i=t.Rebooking||(t.Rebooking={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._scope=n;this._rootScope=t;n.DoClick=this.DoOnClick.bind(this);n.DoFocusBasket=this.DoFocusBasket.bind(this);n.IsEnabled=!0;this._rebookingService=i;this.GetDisruptionLevel();this.ListenForEvents()}return t.prototype.GetDisruptionLevel=function(){var t=this._rebookingService.GetDisruptionLevel()==n.Data.Rebooking.DisruptionLevel.Level1;this._scope.ShowLevel1Message=t;this._scope.ShowLevel3Message=!t},t.prototype.DoOnClick=function(){this._scope.IsEnabled&&n.Events.OpenDrawer(t.ConfirmationDrawerKey)},t.prototype.DoFocusBasket=function(){n.Events.Fire(n.Events.Names.Basket.SetFocusOnTitle)},t.prototype.ListenForEvents=function(){var t=this;this._rootScope.$on(n.Events.Names.FinaliseButton.Status,function(n,i){t._scope.IsEnabled=i})},t.ConfirmationDrawerKey="rebooking-confirmation",t.ControllerName="Rebooking_FinaliseButton",t.$inject=["$scope","$rootScope","Rebooking_Service"],t}();t.FinaliseButton=i})(i=t.Rebooking||(t.Rebooking={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var r=function(){function t(t,i,r,u){var f=this;this._scope=t;this._rootScope=i;this._rebookingService=r;this._scope.AutoRefreshGrid=!0;this._selectedRouteIds=new Dictionary;this._pastFlightThresholdMinutes=u.PastFlightThresholdMinutes;this._screenreaderSettings=u.ScreenreaderSettings;this._scope.IsRouteBeingModified=!1;this._scope.FlightModificationChosen=n.Data.Rebooking.FlightModificationType.None;this._scope.IsFlightUnmodified=function(){return f._scope.Flight.Modification==n.Data.Rebooking.FlightModificationType.None};this._scope.IsFlightRefunded=function(){return f._scope.Flight.Modification==n.Data.Rebooking.FlightModificationType.Refund};this._scope.IsFlightTransferred=function(){return f._scope.Flight.Modification==n.Data.Rebooking.FlightModificationType.Transfer};this._scope.IsFlightSearchVisible=function(){return!f._scope.IsFlightRefunded()};this._scope.ShouldFlightGridBeShown=this.ShouldFlightGridBeShown.bind(this);this._scope.ShouldCancelRefundBeShown=this.ShouldCancelRefundBeShown.bind(this);this._scope.ShouldLevel3DisruptedRequestRefundBeShown=this.ShouldLevel3DisruptedRequestRefundBeShown.bind(this);this._scope.ShouldLevel3UndisruptedRequestRefundBeShown=this.ShouldLevel3UndisruptedRequestRefundBeShown.bind(this);this._scope.ShouldLevel1RefundPlaceholderBeShown=this.ShouldLevel1RefundPlaceholderBeShown.bind(this);this._scope.RequestRefund=this.RequestRefund.bind(this);this._scope.CancelRefund=this.CancelRefund.bind(this);this._scope.Initialize=this.Initialize.bind(this);this.ListenForEvents()}return t.prototype.ShouldFlightGridBeShown=function(){return this._scope.IsFlightRefunded()?!1:this._scope.IsModifyable},t.prototype.ShouldCancelRefundBeShown=function(){return this._scope.IsModifyable&&this._scope.IsFlightRefunded()},t.prototype.ShouldLevel3DisruptedRequestRefundBeShown=function(){return this._scope.IsModifyable&&this._scope.BasketIsLevel3&&this._scope.Flight.IsCancelled&&!this._scope.IsFlightRefunded()},t.prototype.ShouldLevel3UndisruptedRequestRefundBeShown=function(){return this._scope.IsModifyable&&this._scope.BasketIsLevel3&&!this._scope.Flight.IsCancelled&&!this._scope.IsFlightRefunded()},t.prototype.ShouldLevel1RefundPlaceholderBeShown=function(){return this._scope.IsModifyable&&this._scope.BasketIsLevel1&&this._scope.Flight.IsDisrupted&&!this._scope.IsFlightRefunded()},t.prototype.Initialize=function(t,i){var e=t.Disruption==n.Data.Rebooking.DisruptionLevel.Level1,r=t.Disruption==n.Data.Rebooking.DisruptionLevel.Level3,u=this.IsFlightModifyable(i,r),f;this._scope.Flight=i;this._scope.Luggage=t.Luggage;this._scope.BookingPassengers=Main3.Common.BookingPassengers.CreateFromBasket(t);this._scope.PassengerComposition=this._scope.BookingPassengers.PassengerComposition(i.InternalId);this._scope.IsModifyable=u;this._scope.IsCurrentlyEditable=!u||t.CanBeFinalised||i.IsFocalFlight||!r;this._scope.Route=this.CreateRoute(this._scope.Flight.ReplacementFlight);this._scope.BasketIsLevel1=e;this._scope.BasketIsLevel3=r;f=this.GetActiveSegmentIdFromClientBasketFlight(i);this.UpdateDuplicateIdsFromBasket(t);this._scope.ChosenFare=this.FlightFareFromSegmentId(f)},t.prototype.FlightFareFromSegmentId=function(t){return t?{FareType:n.Data.Common.FlightFareType.Standard,FlightSegmentId:t}:null},t.prototype.IsFlightModifyable=function(n,t){var r=n.LocalDepartureTime.IsInThePast(!1,this._pastFlightThresholdMinutes),i=n.IsDisrupted||n.IsCancelled;return r&&!i?!1:t?!0:i},t.prototype.ListenForEvents=function(){this._scope.$on(n.Events.Names.FlightGrid.FlightFareSelected,this.OnFlightFareSelected.bind(this));this._scope.$on(n.Events.Names.RouteSearch.UpdateFlightCard,this.UpdateFlightCard.bind(this));this._rootScope.$on(n.Events.Names.Rebooking.FlightModified,this.OnFlightModified.bind(this));this._rootScope.$on(n.Events.Names.Rebooking.BasketLoaded,this.OnBasketUpdated.bind(this));this._scope.$on(n.Events.Names.FlightSearch.SearchStarted,this.OnSearchStarted.bind(this));this._scope.$on(n.Events.Names.FlightSearch.SearchCancelled,this.OnSearchCancelled.bind(this));this._scope.$on(n.Events.Names.FlightSearch.SearchCompleted,this.OnSearchCompleted.bind(this));this._scope.$on(n.Events.Names.Account.DeprecatedSignInStatusChanged,this.OnSignInStatusChanged.bind(this))},t.prototype.UpdateFlightCard=function(n,t){this._scope.Flight.RouteSearchFlight={ArrivalIata:t.DestinationIata,DepartureIata:t.OriginIata}},t.prototype.OnFlightFareSelected=function(t,i){if(i&&i.Flight)if(i.Flight.SegmentId==this._scope.Flight.SegmentId)this.SetFlightUnmodified(!1);else if(this._scope.Flight.ReplacementFlight&&i.Flight.SegmentId==this._scope.Flight.ReplacementFlight.SegmentId)this._scope.Flight.RouteSearchFlight=null;else{var r={SegmentId:this._scope.Flight.SegmentId,Modification:n.Data.Rebooking.FlightModificationType.Transfer,ReplacementFlight:{InternalId:this._scope.Flight.InternalId,CarrierCode:i.Flight.CarrierCode,FlightNumber:i.Flight.FlightNumber,DepartureIata:i.Flight.DepartureIata,ArrivalIata:i.Flight.ArrivalIata,LocalDepartureTime:i.Flight.LocalDepartureTime,LocalArrivalTime:i.Flight.LocalArrivalTime,SegmentId:i.Flight.SegmentId,FlightKey:i.Flight.FlightKey,IsCancelled:i.Flight.IsCancelled,IsDisrupted:!1},RouteSearchFlight:null};this._scope.$emit(n.Events.Names.Rebooking.FlightModified,r);this.CheckForDuplicateFlights(i.Flight);this.CheckForAirportsChange(i.Flight)}else this.SetFlightUnmodified(!0),n.Events.OpenDrawer("flightgrid-notavailable",this._scope)},t.prototype.CheckForDuplicateFlights=function(t){var i=this;this._selectedRouteIds.AllKeys().forEach(function(r){r!=i._scope.Flight.SegmentId&&i._selectedRouteIds.Get(r)==i.GetRouteId(t)&&n.Events.OpenDrawer("rebooking-duplicate-flight")})},t.prototype.GetRouteId=function(n){return n.DepartureIata.toUpperCase()+"_"+n.LocalDepartureTime.Date().ToCompressedString()},t.prototype.SetFlightUnmodified=function(t){this._scope.$emit(n.Events.Names.Rebooking.FlightModified,{SegmentId:this._scope.Flight.SegmentId,Modification:n.Data.Rebooking.FlightModificationType.None,ReplacementFlight:null,RouteSearchFlight:null,ResetGrid:t})},t.prototype.OnFlightModified=function(t,r){this._scope.Flight.RouteSearchFlight=null;r.SegmentId==this._scope.Flight.SegmentId&&(r.ReplacementFlight&&r.Modification==n.Data.Rebooking.FlightModificationType.Transfer||r.ResetGrid&&(this._scope.$broadcast(n.Events.Names.RouteSearch.ResetRoute),this._scope.Route=this.CreateRoute(null)),this._scope.ChosenFare=r.ReplacementFlight?this.FlightFareFromSegmentId(r.ReplacementFlight.SegmentId):null,this.ScreenreaderAlertBasketChanged(i.ReplacementFlight));r.ReplacementFlight&&this._selectedRouteIds.Set(r.SegmentId,this.GetRouteId(r.ReplacementFlight))},t.prototype.CreateRoute=function(n){return n?{Date:n.LocalDepartureTime.Date(),OriginIata:n.DepartureIata,DestinationIata:n.ArrivalIata}:this._scope.Flight?{Date:this._scope.Flight.LocalDepartureTime.Date(),OriginIata:this._scope.Flight.DepartureIata,DestinationIata:this._scope.Flight.ArrivalIata}:null},t.prototype.CheckForAirportsChange=function(t){(t.DepartureIata!=this._scope.Flight.DepartureIata||t.ArrivalIata!=this._scope.Flight.ArrivalIata)&&n.Events.Fire(n.Events.Names.Rebooking.AirportChangeNotification,!0)},t.prototype.OnBasketUpdated=function(n,t){this._scope.Flight&&this._scope.Flight.ReplacementFlight&&(this._scope.ChosenFare=this.FlightFareFromSegmentId(this._scope.Flight.ReplacementFlight.SegmentId));this.UpdateDuplicateIdsFromBasket(t)},t.prototype.OnSearchStarted=function(){this._scope.IsRouteBeingModified=!0},t.prototype.OnSearchCancelled=function(){this._scope.IsRouteBeingModified=!1},t.prototype.OnSearchCompleted=function(t,i){this._scope.IsRouteBeingModified=!1;var r={OriginIata:i.Origin,DestinationIata:i.Destination,Date:i.Date},u=null;this._scope.Flight&&this._scope.Flight.ReplacementFlight&&(u=this._scope.Flight.ReplacementFlight.SegmentId);this._scope.Route=r;this._scope.ChosenFare=this.FlightFareFromSegmentId(u);this._scope.$broadcast(n.Events.Names.RouteSearch.UpdateFlightCard,r)},t.prototype.UpdateDuplicateIdsFromBasket=function(n){var t=this;n.Flights.forEach(function(n){t._selectedRouteIds.Set(n.SegmentId,t.GetActiveRouteIdFromClientBasketFlight(n))})},t.prototype.GetActiveRouteIdFromClientBasketFlight=function(n){var t=this.GetRouteId(n);return n.ReplacementFlight&&(t=this.GetRouteId(n.ReplacementFlight)),t},t.prototype.GetActiveSegmentIdFromClientBasketFlight=function(n){var t=n.SegmentId;return n.ReplacementFlight&&(t=n.ReplacementFlight.SegmentId),t},t.prototype.OnSignInStatusChanged=function(){this._scope.AutoRefreshGrid=!1},t.prototype.ScreenreaderAlertBasketChanged=function(n){var t=this.ScreenreaderAlertText(n);Utilities.ScreenReader.Alert(t,"basketChangedAlert")},t.prototype.ScreenreaderAlertText=function(n){var t=this._screenreaderSettings.BasketChangedAlertText;switch(n){case i.GetRefund:t+=": "+this._screenreaderSettings.GetRefundSelectedAlertText;break;case i.ChooseOriginalFlight:t+=": "+this._screenreaderSettings.OriginalFlightSelectedAlertText;break;case i.ReplacementFlight:t+=": "+this._screenreaderSettings.ReplacementFlightSelectedAlertText}return t},t.prototype.RequestRefund=function(){this._scope.$emit(n.Events.Names.Rebooking.FlightModified,{SegmentId:this._scope.Flight.SegmentId,Modification:n.Data.Rebooking.FlightModificationType.Refund,ReplacementFlight:null,RouteSearchFlight:null});this.ScreenreaderAlertBasketChanged(i.GetRefund)},t.prototype.CancelRefund=function(){this._scope.IsFlightRefunded()&&(this.SetFlightUnmodified(!0),this.ScreenreaderAlertBasketChanged(i.ChooseOriginalFlight))},t.ControllerName="Rebooking_FlightPanel",t.$inject=["$scope","$rootScope","Rebooking_Service","Sitecore_RebookingClientSettings"],t}(),i;t.FlightPanel=r,function(n){n[n.GetRefund=0]="GetRefund";n[n.ChooseOriginalFlight=1]="ChooseOriginalFlight";n[n.ReplacementFlight=2]="ReplacementFlight"}(i||(i={}))})(i=t.Rebooking||(t.Rebooking={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h){this._scope=t;this._rebookingService=i;this._pickBookingService=r;this._textSettings=u;this._sce=f;this._dynamicTitleService=o;this._bookingDataService=s;this._basketBookingDataMapper=h;this._alreadyNotified=!1;this._initialized=!1;this._loadedGrids=0;this._scope.IsLoading=!0;this._scope.$on(n.Events.Names.Account.DeprecatedSignInStatusChanged,this.OnSignInStatusChanged.bind(this));this._bookingDataService.Expecting(n.Services.Controls.BookingData.BookingDataSource.DisruptionBasket);e.ready(this.Initialise.bind(this))}return t.prototype.Initialise=function(){this._scope.$emit(n.Events.Names.Basket.SetupBasket,"ng-templates/basket/rebooking",n.Data.Common.ClientBasketType.Rebooking);this.ListenForEvents()},t.prototype.ListenForEvents=function(){var t=this;this._scope.$on(n.Events.Names.Rebooking.BasketLoaded,this.OnBasketUpdated.bind(this));this._scope.$on(n.Events.Names.FlightGrid.InitialLoadComplete,this.OnInitialLoadComplete.bind(this));this._scope.$on(n.Events.Names.Drawer.Closing,function(){var n=t.GetCurrentFlightFromQueryString();t._rebookingService.StartRebookingProcessIfNoValidBasket(n)});this._scope.$on(n.Events.Names.Rebooking.AirportChangeNotification,function(){t._alreadyNotified||(n.Events.OpenDrawer("rebooking-airportschange-alert",t._scope),t._alreadyNotified=!0)})},t.prototype.OnBasketUpdated=function(n,t){this.SetDisruptionBasket(t);var i=t.Disruption==="Level1";this._scope.HeaderText=i?this._textSettings.Level1HeaderText:this._textSettings.Level3HeaderText;this._scope.IntroductionText=this._sce.trustAsHtml(i?this._textSettings.Level1IntroductionText:this._textSettings.Level3IntroductionText);this._scope.ClientBasket=t;this._scope.IsLoading=!1;this._dynamicTitleService.HandleUpdate(this.GetCurrentFlightFromQueryString(),t)},t.prototype.SetDisruptionBasket=function(t){var i=this._basketBookingDataMapper.Map(t);this._bookingDataService.Received(n.Services.Controls.BookingData.BookingDataSource.DisruptionBasket,i)},t.prototype.OnSignInStatusChanged=function(n,t){if(t){if(!this._initialized){this._initialized=!0;var i=this.GetCurrentFlightFromQueryString();this._rebookingService.StartRebookingProcess(i)}}else this._scope.ClientBasket=null,this._scope.IsLoading=!0,this._pickBookingService.OpenLoginDrawer(this.GetCurrentFlightFromQueryString())},t.prototype.OnInitialLoadComplete=function(){this.SetFlightPositionText();this._loadedGrids++;this._scope.ClientBasket.Flights.length==this._loadedGrids&&this._scope.$broadcast(n.Events.Names.Rebooking.ScrollToFirstDisruption)},t.prototype.GetCurrentFlightFromQueryString=function(){var n=new Urls.QueryString(window.location.href),t=n.GetParameter("FlightId",!0);return Utilities.FlightSegmentIdReformatter.GetSegmentIdInDefaultFormat(t)},t.prototype.SetFlightPositionText=function(){if(!!this._scope.ClientBasket&&!!this._scope.ClientBasket.Flights){var n=this._scope.ClientBasket.Flights;n.forEach(function(t){t.Position=n.indexOf(t)+1+". "})}},t.ControllerName="Rebooking_Page",t.$inject=["$scope","Rebooking_Service","Rebooking_PickBookingService","Sitecore_RebookingPageTextSettings","$sce","$document","Rebooking_DynamicTitleService","Controls_BookingDataService","Controls_DisruptionBasketBookingDataMapper"],t}();t.Page=i})(i=t.Rebooking||(t.Rebooking={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i){this._flightSegmentId="";this._scope=t;this._pickBookingService=i;var r=t.Section.Options.Parameters;this._flightSegmentId=r.FlightSegmentId;this._apiResponse=r.BookingsData;this._dataMapper=new n.Services.Rebooking.RebookingDataMapper(this._flightSegmentId);t.Bookings=this.CreateBookingData(this._apiResponse.Bookings);t.PickBooking=this.PickBooking.bind(this);t.$on(n.Events.Names.DrawerSection.Shown,function(){t.$emit(n.Events.Names.Account.ResetExpiryTimer)})}return t.prototype.CreateBookingData=function(n){var t=this;return n.map(function(n){return{BookingReference:n.BookingReference,FlightCard:t.CreateFlightCardData(t.GetFlightCardFlight(n)),IsWorldwide:n.IsWorldwide,Passengers:new Main3.Common.BookingPassengers(t._dataMapper.CreateClientPassengers(n.Passengers),n.Associations,t._dataMapper.CreateClientInfants(n.CarriedInfants))}})},t.prototype.GetFlightCardFlight=function(n){var i=this,t=n.Flights.filter(function(n){return n.SegmentId==i._flightSegmentId});return t.length>0?t[0]:n.Flights[0]},t.prototype.CreateFlightCardData=function(t){return{ArrivalIata:t.ArrivalIata,CarrierCode:t.CarrierCode,DepartureIata:t.DepartureIata,FlightNumber:t.FlightNumber,SegmentId:t.SegmentId,FlightKey:t.FlightKey,DepTerminalName:t.DepartureTerminalName,ArrTerminalName:t.ArrivalTerminalName,IsCancelled:t.Disruption===n.Data.Rebooking.DisruptionLevel.Level3,IsDisrupted:t.Disruption===n.Data.Rebooking.DisruptionLevel.Level1,LocalArrivalTime:n.Data.Common.Flight.ZonelessArrivalTime(t),LocalDepartureTime:n.Data.Common.Flight.ZonelessDepartureTime(t),InternalId:t.InternalId,FlightTaxes:t.FlightTaxes}},t.prototype.PickBooking=function(n){var t=this._apiResponse.Bookings.filter(function(t){return t.BookingReference==n});t.length==1&&this._pickBookingService.CheckForUnmanageableBooking(t[0])&&this._pickBookingService.CreateBasket(n,this._flightSegmentId)},t.ControllerName="Rebooking_PickBooking",t.$inject=["$scope","Rebooking_PickBookingService"],t}();t.PickBooking=i})(i=t.Rebooking||(t.Rebooking={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o){var s=this;this._flightGridMessageSettings=e;this._alternativeAirportsService=o;this._scope=t;this._analyticsTracker=r;this._window=u;this._smartMessageService=f;this._routesService=new Main3.Routes.RoutesService(i);this._originAirport=this._routesService.FindAirportByIata(this._scope.Route.OriginIata);this._destinationAirport=this._routesService.FindAirportByIata(this._scope.Route.DestinationIata);this._displayDelayMilliseconds=Main3.Common.BreakPointService.IsMobile()?this._scope.MobileDelayDurationMilliseconds:this._scope.DesktopAndTabletDelayDurationMilliseconds;this._displayDelayMilliseconds===null&&(this._displayDelayMilliseconds=0);this._scope.OpenAlternativeOriginAirportsDrawer=this.OpenAlternativeOriginAirportsDrawer.bind(this);this._scope.GetCommaOrConjunction=this.GetCommaOrConjunction.bind(this);this._scope.$on(n.Events.Names.Funnel.FlightAddedToBasket,this.StopMessageDelayTimer.bind(this));this.ShowOrHideAsApplicable();this._scope.AlternativeOriginAirports=this.AlternativeAirportOrigins();this._scope.DisplayAlternativeMessage=this._flightGridMessageSettings.IsAlternativeMessagingEnabled;this._scope.Destination=this._destinationAirport.Name;this._scope.ChangeOrigin=function(n){f.IgnoreNextRouteChangeEvent(!0);s.AlternativeOriginAirportChosen(n)}}return t.prototype.ShowOrHideAsApplicable=function(){var n=this;setTimeout(function(){n.ShouldShowMessage()?n.StartMessageDelayTimer():n.HideMessage();n._smartMessageService.IgnoreNextRouteChangeEvent(!1)},0)},t.prototype.AlternativeAirportOrigins=function(){var t=this._alternativeAirportsService.GetAlternativeOriginAirports(this._originAirport.Iata,this._destinationAirport.Iata),n=t.filter(function(n){return n.RouteNearbyOrigin.Nearby});return(this._scope.RenderDrawerOpenLink=n.length>this._flightGridMessageSettings.MaxAllowedAirports,this._fullListOfNearbyAlternativeOrigins=n,n.length>this._flightGridMessageSettings.MaxAllowedAirports)?n.slice(0,this._flightGridMessageSettings.MaxAllowedAirports):n},t.prototype.ShouldShowMessage=function(){return this.HasAlternativeOrigin()&&!this.IsMarketGroupRoute()&&!this._smartMessageService.ShouldIgnoreNextRouteChangeEvent()},t.prototype.HideMessage=function(){this.StopMessageDelayTimer();this._scope.HideMessage&&this._scope.HideMessage()},t.prototype.GetCommaOrConjunction=function(n){var t=this._fullListOfNearbyAlternativeOrigins.length,i;return t>this._flightGridMessageSettings.MaxAllowedAirports?n===this._flightGridMessageSettings.MaxAllowedAirports-1?"":",":(i=this._flightGridMessageSettings.ConjunctionText.trim(),n===t-1?"":n===t-2?" "+i:",")},t.prototype.OpenAlternativeOriginAirportsDrawer=function(t){t.preventDefault();var i={OnSelect:this.AlternativeOriginAirportChosen.bind(this),OriginIata:this._scope.Route.OriginIata,DestinationIata:this._scope.Route.DestinationIata},r={SectionKey:"routedatepicker-alternativeorigin",Parameters:i};this._analyticsTracker.TrackEvent("Choose Flights","Alternate Origin",this._window.location.pathname);n.Events.OpenDrawerWithOptions(r)},t.prototype.AlternativeOriginAirportChosen=function(t){if(this._scope.Route.OriginIata=t,n.Events.Fire(n.Events.Names.Drawer.Close),this._scope.FlightGridJourneyChange){var i={};i.OriginIata=t;this._scope.FlightGridJourneyChange(i)}},t.prototype.HasAlternativeOrigin=function(){return this._scope.Route?this._routesService.HasNearbyOriginsForDestination(this._destinationAirport,this._originAirport):!1},t.prototype.IsMarketGroupRoute=function(){return this._originAirport.IsMarketGroup||this._destinationAirport.IsMarketGroup},t.prototype.StartMessageDelayTimer=function(){var n=this;this.StopMessageDelayTimer();this._currentTimeoutNumber=setTimeout(function(){n._scope.ShowMessage()},this._displayDelayMilliseconds)},t.prototype.StopMessageDelayTimer=function(){this._currentTimeoutNumber!=null&&clearTimeout(this._currentTimeoutNumber)},t.$inject=["$scope","Sitecore_RoutesData","IAnalyticsTracker","$window","SmartMessage_Service","Sitecore_FlightGridMessageSettings","Funnel_AlternativeAirportsService"],t}();t.FlightGridMessage=i})(i=t.SmartMessages||(t.SmartMessages={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this.$scope=n;this.$rootScope=t;this.$timeout=i;this._breakPointService=r;this.AttachEventHandlers();this.$scope.ShowOnLoad&&this.ShowSmartMessageIfEnabledOnDevice()}return t.prototype.AttachEventHandlers=function(){!this.$scope.SmartMessageId||!this.$scope.SmartMessageSettings||(this.$rootScope.$on(n.Events.Names.SmartMessaging.Show,this.OnShowSmartMessage.bind(this)),this.$rootScope.$on(n.Events.Names.SmartMessaging.Hide,this.CloseMessage.bind(this)),this.$rootScope.$on(n.Events.Names.SmartMessaging.HideAll,this.CloseMessage.bind(this)))},t.prototype.CloseMessage=function(){this.$timeout.cancel(this._displayTimeoutPromise);this.$scope.HideMessage()},t.prototype.OnShowSmartMessage=function(n,t){this.SmartMessageIsEnabledForTheDevice()&&t&&t.Id===this.$scope.SmartMessageId&&this.ShowSmartMessageIfEnabledOnDevice()},t.prototype.ShowSmartMessageIfEnabledOnDevice=function(){this.SmartMessageIsEnabledForTheDevice()&&this.StartDisplayTimer(this.$scope.SmartMessageSettings.DelayMilliseconds)},t.prototype.SmartMessageIsEnabledForTheDevice=function(){return this._breakPointService.IsDesktop()&&this.$scope.SmartMessageSettings.EnabledOnDesktop||this._breakPointService.IsTablet()&&this.$scope.SmartMessageSettings.EnabledOnTablet||this._breakPointService.IsMobile()&&this.$scope.SmartMessageSettings.EnabledOnMobile},t.prototype.StartDisplayTimer=function(n){var t=this;this._displayTimeoutPromise=this.$timeout(function(){t.$scope.ShowMessage()},n||0)},t.$inject=["$scope","$rootScope","$timeout","ejBreakPointService"],t}();t.SmartMessageController=i})(i=t.SmartMessages||(t.SmartMessages={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t){this._scope=t;this._parameters=this._scope.Section.Options.Parameters;this._scope.EasyjetToEasyjetConnecting=this._parameters.ConnectionType===n.Data.RouteSearch.ConnectionType.IndirectConnection;this._scope.EasyjetToPartnerConnecting=this._parameters.ConnectionType===n.Data.RouteSearch.ConnectionType.IndirectPartnerConnection;this._scope.PartnerDirect=this._parameters.ConnectionType===n.Data.RouteSearch.ConnectionType.DirectPartnerConnection;this._scope.ContinueButtonClick=this.ContinueButtonClick.bind(this)}return t.prototype.ContinueButtonClick=function(){n.Events.Fire(n.Events.Names.Drawer.Close)},t.ControllerName="Worldwide_WorldwideInformationDrawer",t.$inject=["$scope"],t}();t.WorldwideInformationDrawer=i})(i=t.Worldwide||(t.Worldwide={}))})(t=n.Controllers||(n.Controllers={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){n[n.FromSitecore=0]="FromSitecore";n[n.AlwaysShow=1]="AlwaysShow";n[n.AlwaysHide=2]="AlwaysHide"})(t=n.DrawerBackOverride||(n.DrawerBackOverride={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.None=0]="None";n[n.EasyJet=1]="EasyJet";n[n.ThirdParty=2]="ThirdParty"})(t=n.MarketingType||(n.MarketingType={}))})(t=n.Account||(n.Account={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]||n.EasyJet}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.MarketingType||(n.MarketingType={}))})(t=n.Account||(n.Account={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Unknown=0]="Unknown";n[n.SignedIn=1]="SignedIn";n[n.NotSignedIn=2]="NotSignedIn";n[n.SoftSignedIn=3]="SoftSignedIn";n[n.PassengerSignIn=4]="PassengerSignIn"})(t=n.SignedInStatus||(n.SignedInStatus={}))})(t=n.Account||(n.Account={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.None=0]="None";n[n.IncorrectPassword=1]="IncorrectPassword";n[n.IncorrectEmail=2]="IncorrectEmail";n[n.AccountLocked=3]="AccountLocked";n[n.AccountAlreadyExists=4]="AccountAlreadyExists"})(t=n.SignInErrorResult||(n.SignInErrorResult={}))})(t=n.Account||(n.Account={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Passenger=0]="Passenger";n[n.RegisteredUser=1]="RegisteredUser"})(t=n.SignInType||(n.SignInType={}))})(t=n.Account||(n.Account={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.NotLoggedIn=0]="NotLoggedIn";n[n.SoftLogIn=1]="SoftLogIn";n[n.HardLogIn=2]="HardLogIn";n[n.Passenger=3]="Passenger"})(t=n.LoggedInStatus||(n.LoggedInStatus={}))})(t=n.Api||(n.Api={}))})(t=n.Account||(n.Account={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.LoggedInStatus||(n.LoggedInStatus={}))})(t=n.Api||(n.Api={}))})(t=n.Account||(n.Account={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Rebooking=0]="Rebooking";n[n.Funnel=1]="Funnel";n[n.AncillariesPanel=2]="AncillariesPanel"})(t=n.ClientBasketType||(n.ClientBasketType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Desktop=0]="Desktop";n[n.Mobile=1]="Mobile";n[n.Tablet=2]="Tablet"})(t=n.DeviceType||(n.DeviceType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Valid=0]="Valid";n[n.InvalidNumber=1]="InvalidNumber";n[n.IncorrectName=2]="IncorrectName";n[n.Expired=3]="Expired";n[n.Duplicate=4]="Duplicate"})(t=n.EjPlusCardStatus||(n.EjPlusCardStatus={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){function i(t){return n.Data.Common.EjPlusCardStatus[t]}function r(t){return n.Data.Common.EjPlusCardStatus[t]}t.Parse=i;t.ToString=r})(i=t.EjPlusCardStatus||(t.EjPlusCardStatus={}))})(i=t.Common||(t.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(){function t(n,t,i,r,u,f,e,o,s,h,c,l,a){this.InternalId=n;this.CarrierCode=t;this.FlightNumber=i;this.SegmentId=r;this.FlightKey=u;this.DepartureIata=f;this.ArrivalIata=e;this.LocalDepartureTime=o;this.LocalArrivalTime=s;this.IsDisrupted=h;this.PromotionalFareType=c;this.CanCheckIn=l;!a||(this.FlightTaxes={TaxAmount:a.TaxAmount,ApplyApdRules:a.ApplyApdRules})}return t.prototype.HasFares=function(){return!!this.FlightFares},t.prototype.FareTypeIsSelectable=function(n){var t=this.HasFares()?this.FlightFares.filter(function(t){return t.FareType===n}):[];return t.length>0&&t[0].HasEnoughSeatsForRequiredPassengers},t.prototype.IncludesFlexiFares=function(){return this.HasFares()?!!this.FlightFares.filter(function(t){return t.FareType===n.Common.FlightFareType.Flexi}):!1},t.ZonelessDepartureTime=function(n){return Utilities.ZonelessDateTime.FromIso8601(n.LocalDepartureTime)},t.ZonelessArrivalTime=function(n){return Utilities.ZonelessDateTime.FromIso8601(n.LocalArrivalTime)},t}();t.Flight=i})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(){function t(t){this.FareType=n.Common.FlightFareType.Parse(t)}return t}();t.FlightFare=i})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Standard=0]="Standard";n[n.Flexi=1]="Flexi"})(t=n.FlightFareType||(n.FlightFareType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(){return Object.keys(n).map(function(t){return n[t]}).filter(function(n){return typeof n=="number"})}function i(t){return n[t]}function r(t){return n[t]}n.GetValues=t;n.Parse=i;n.ToString=r})(t=n.FlightFareType||(n.FlightFareType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Outbound=0]="Outbound";n[n.Inbound=1]="Inbound";n[n.Any=2]="Any"})(t=n.FlightType||(n.FlightType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.FlightType||(n.FlightType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Female=0]="Female";n[n.Male=1]="Male"})(t=n.Gender||(n.Gender={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){function i(t){return n.Data.Common.Gender[t]}function r(t){return n.Data.Common.Gender[t]}t.Parse=i;t.ToString=r})(i=t.Gender||(t.Gender={}))})(i=t.Common||(t.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.BookNowPayLater=0]="BookNowPayLater";n[n.BookNowPayNow=1]="BookNowPayNow"})(t=n.HotelBookingType||(n.HotelBookingType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Adult=0]="Adult";n[n.Child=1]="Child";n[n.Infant=2]="Infant"})(t=n.PassengerDataType||(n.PassengerDataType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.PassengerDataType||(n.PassengerDataType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Unknown=0]="Unknown";n[n.AmericanExpress=1]="AmericanExpress";n[n.MasterCard=2]="MasterCard";n[n.DebitMasterCard=3]="DebitMasterCard";n[n.Visa=4]="Visa";n[n.VisaDebit=5]="VisaDebit";n[n.VisaElectron=6]="VisaElectron";n[n.CarteBleue=7]="CarteBleue";n[n.Maestro=8]="Maestro";n[n.DinersClub=9]="DinersClub";n[n.UatpAirPlus=10]="UatpAirPlus"})(t=n.PaymentMethodType||(n.PaymentMethodType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){function i(i){return n.Common.PaymentMethodType[i]||t.Unknown}function r(t){return n.Common.PaymentMethodType[t]}t.Parse=i;t.ToString=r})(i=t.PaymentMethodType||(t.PaymentMethodType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.CreditCard=0]="CreditCard";n[n.DebitCard=1]="DebitCard";n[n.Base=2]="Base"})(t=n.PaymentType||(n.PaymentType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.PaymentType||(n.PaymentType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.prototype.FullPhoneNumber=function(){return this.DialingCode&&this.DialingCode.length>0&&this.PhoneNumberWithoutDialingCode?this.DialingCode+" "+this.PhoneNumberWithoutDialingCode.replace(/^0/,""):this.PhoneNumberWithoutDialingCode},n}();n.PhoneNumber=t})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Outbound=1]="Outbound";n[n.Return=2]="Return";n[n.Basket=3]="Basket"})(t=n.PickFlightsSkipLinkTargetType||(n.PickFlightsSkipLinkTargetType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.PickFlightsSkipLinkTargetType||(n.PickFlightsSkipLinkTargetType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.None=0]="None";n[n.Sale=1]="Sale";n[n.Save=2]="Save"})(t=n.PromotionalFareType||(n.PromotionalFareType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}n.Parse=t})(t=n.PromotionalFareType||(n.PromotionalFareType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Outbound=0]="Outbound";n[n.Return=1]="Return"})(t=n.RouteDirection||(n.RouteDirection={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.RouteDirection||(n.RouteDirection={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Bicycle=0]="Bicycle";n[n.Canoe=1]="Canoe";n[n.Firearm=2]="Firearm";n[n.GolfBag=3]="GolfBag";n[n.HangGlider=4]="HangGlider";n[n.Skis=5]="Skis";n[n.Snowboard=6]="Snowboard";n[n.WindsurfingBoard=7]="WindsurfingBoard";n[n.OtherSmallSportsEquipment=8]="OtherSmallSportsEquipment"})(t=n.SportsEquipmentType||(n.SportsEquipmentType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){function i(t){return n.Common.SportsEquipmentType[t]}function r(t){return n.Common.SportsEquipmentType[t]}t.Parse=i;t.ToString=r})(i=t.SportsEquipmentType||(t.SportsEquipmentType={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.HotelAffiliateId="HotelAffiliateId",n}();n.UrlTokens=t})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Standard=0]="Standard";n[n.Flexi=1]="Flexi"})(t=n.FlightFareType||(n.FlightFareType={}))})(t=n.Api||(n.Api={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.FlightFareType||(n.FlightFareType={}))})(t=n.Api||(n.Api={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Card=0]="Card";n[n.Sepa=1]="Sepa"})(t=n.PaymentMethod||(n.PaymentMethod={}))})(t=n.Api||(n.Api={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){function i(t){return n.Data.Common.Api.PaymentMethod[t]}function r(t){return n.Data.Common.Api.PaymentMethod[t]}t.Parse=i;t.ToString=r})(i=t.PaymentMethod||(t.PaymentMethod={}))})(i=t.Api||(t.Api={}))})(i=t.Common||(t.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Unknown=0]="Unknown";n[n.Amend=1]="Amend";n[n.Payment=2]="Payment";n[n.Refund=3]="Refund"})(t=n.TransactionType||(n.TransactionType={}))})(t=n.Api||(n.Api={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){function i(t){return n.Data.Common.Api.TransactionType[t]}function r(t){return n.Data.Common.Api.TransactionType[t]}t.Parse=i;t.ToString=r})(i=t.TransactionType||(t.TransactionType={}))})(i=t.Api||(t.Api={}))})(i=t.Common||(t.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.UpdatedPrice=0]="UpdatedPrice";n[n.RequiresRequote=1]="RequiresRequote";n[n.Error=2]="Error"})(t=n.TravelInsuranceThresholdBreachedDrawerStates||(n.TravelInsuranceThresholdBreachedDrawerStates={}))})(t=n.Drawers||(n.Drawers={}))})(t=n.Common||(n.Common={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.NotSelected=0]="NotSelected";n[n.Selected=1]="Selected";n[n.OtherFareTypeSelected=2]="OtherFareTypeSelected"})(t=n.FlightGridSelectedInOtherPairResult||(n.FlightGridSelectedInOtherPairResult={}))})(t=n.Controls||(n.Controls={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.StandardBag=0]="StandardBag";n[n.SmallBag=1]="SmallBag";n[n.SportsItem=2]="SportsItem"})(t=n.DisplayItemType||(n.DisplayItemType={}))})(t=n.Controls||(n.Controls={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Names={ChildApd:"child-apd-saving",CurrentlyLooking:"currently-looking",LastBooked:"last-booked"},n}();n.MessageKeys=t})(t=n.MessageCarousel||(n.MessageCarousel={}))})(t=n.Controls||(n.Controls={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Unknown=0]="Unknown";n[n.DebitCard=1]="DebitCard";n[n.CreditCard=2]="CreditCard";n[n.Sepa=3]="Sepa"})(t=n.FunnelPaymentAnalyticsPaymentMethod||(n.FunnelPaymentAnalyticsPaymentMethod={}))})(t=n.Cookies||(n.Cookies={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.None=0]="None";n[n.Car=1]="Car";n[n.Hotel=2]="Hotel";n[n.Insurance=3]="Insurance"})(t=n.AncillaryType||(n.AncillaryType={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){function i(t){return n.Data.Funnel.AncillaryType[t]}function r(t){return n.Data.Funnel.AncillaryType[t]}t.Parse=i;t.ToString=r})(i=t.AncillaryType||(t.AncillaryType={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.StandardHoldBag=0]="StandardHoldBag";n[n.SmallHoldBag=1]="SmallHoldBag"})(t=n.BagType||(n.BagType={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.BagType||(n.BagType={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.None=0]="None";n[n.SavedCard=1]="SavedCard";n[n.NewCard=2]="NewCard";n[n.SEPA=3]="SEPA"})(t=n.PaymentMethod||(n.PaymentMethod={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){function i(t){return n.Data.Funnel.PaymentMethod[t]}function r(t){return n.Data.Funnel.PaymentMethod[t]}t.Parse=i;t.ToString=r})(i=t.PaymentMethod||(t.PaymentMethod={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.GenericError=0]="GenericError";n[n.ResultError=1]="ResultError";n[n.UpdateNotAvailableError=2]="UpdateNotAvailableError"})(t=n.AirPlusErrorDrawerType||(n.AirPlusErrorDrawerType={}))})(t=n.AirPlus||(n.AirPlus={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.AirPlusErrorDrawerType||(n.AirPlusErrorDrawerType={}))})(t=n.AirPlus||(n.AirPlus={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.MinimumObligatory=0]="MinimumObligatory";n[n.Obligatory=1]="Obligatory";n[n.Optional=2]="Optional"})(t=n.AirPlusFieldRule||(n.AirPlusFieldRule={}))})(t=n.AirPlus||(n.AirPlus={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.AirPlusFieldRule||(n.AirPlusFieldRule={}))})(t=n.AirPlus||(n.AirPlus={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Alpha=0]="Alpha";n[n.Alphanumeric=1]="Alphanumeric";n[n.Date=2]="Date";n[n.Numeric=3]="Numeric"})(t=n.AirPlusFieldType||(n.AirPlusFieldType={}))})(t=n.AirPlus||(n.AirPlus={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.AirPlusFieldType||(n.AirPlusFieldType={}))})(t=n.AirPlus||(n.AirPlus={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Basic=0]="Basic";n[n.Medium=1]="Medium";n[n.Premium=2]="Premium"})(t=n.CarInsuranceTypeIndex||(n.CarInsuranceTypeIndex={}))})(t=n.Cars||(n.Cars={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.CarInsuranceTypeIndex||(n.CarInsuranceTypeIndex={}))})(t=n.Cars||(n.Cars={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Adult=0]="Adult";n[n.Child=1]="Child";n[n.Infant=2]="Infant";n[n.Over64=3]="Over64"})(t=n.TravelInsurancePassengerType||(n.TravelInsurancePassengerType={}))})(t=n.TravelInsurance||(n.TravelInsurance={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.TravelInsurancePassengerType||(n.TravelInsurancePassengerType={}))})(t=n.TravelInsurance||(n.TravelInsurance={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.bicycle=0]="bicycle";n[n.checkinluggage=1]="checkinluggage";n[n.canoe=2]="canoe";n[n.sportingfirearm=3]="sportingfirearm";n[n.golfbag=4]="golfbag";n[n.hangglider=5]="hangglider";n[n.skisandorboots=6]="skisandorboots";n[n.snowboard=7]="snowboard";n[n.windsurfingboard=8]="windsurfingboard";n[n.othersmallsportsequipment=9]="othersmallsportsequipment"})(t=n.TravelInsuranceAncillaryName||(n.TravelInsuranceAncillaryName={}))})(t=n.Api||(n.Api={}))})(t=n.TravelInsurance||(n.TravelInsurance={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.TravelInsuranceAncillaryName||(n.TravelInsuranceAncillaryName={}))})(t=n.Api||(n.Api={}))})(t=n.TravelInsurance||(n.TravelInsurance={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.Unknown=0]="Unknown";n[n.No=1]="No";n[n.Yes=2]="Yes"})(t=n.TravelInsuranceAncillarySelectedOption||(n.TravelInsuranceAncillarySelectedOption={}))})(t=n.Api||(n.Api={}))})(t=n.TravelInsurance||(n.TravelInsurance={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.TravelInsuranceAncillarySelectedOption||(n.TravelInsuranceAncillarySelectedOption={}))})(t=n.Api||(n.Api={}))})(t=n.TravelInsurance||(n.TravelInsurance={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.ActiveOnly=0]="ActiveOnly";n[n.OldOnly=1]="OldOnly";n[n.All=2]="All";n[n.ActiveOnlyUnlessEmpty=3]="ActiveOnlyUnlessEmpty"})(t=n.BookingListQueryFilter||(n.BookingListQueryFilter={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.BookingListQueryFilter||(n.BookingListQueryFilter={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.FlightDate=0]="FlightDate";n[n.BookingDate=1]="BookingDate"})(t=n.BookingListQuerySort||(n.BookingListQuerySort={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}n.Parse=t;n.ToString=i})(t=n.BookingListQuerySort||(n.BookingListQuerySort={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.OnTime=0]="OnTime";n[n.Cancelled=1]="Cancelled";n[n.Delayed=2]="Delayed";n[n.StandBy=3]="StandBy"})(t=n.FlightStatus||(n.FlightStatus={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(){return Object.keys(n).map(function(t){return n[t]}).filter(function(n){return typeof n=="number"})}function i(t){return n[t]}function r(t){return n[t]}n.GetValues=t;n.Parse=i;n.ToString=r})(t=n.FlightStatus||(n.FlightStatus={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Level1="Level1",n.Level3="Level3",n}();n.DisruptionLevel=t})(t=n.Rebooking||(n.Rebooking={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.None=0]="None";n[n.Refund=1]="Refund";n[n.Transfer=2]="Transfer"})(t=n.FlightModificationType||(n.FlightModificationType={}))})(t=n.Rebooking||(n.Rebooking={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){function i(t){return n.Rebooking.FlightModificationType[t]}function r(t){return n.Rebooking.FlightModificationType[t]}t.Parse=i;t.ToString=r})(i=t.FlightModificationType||(t.FlightModificationType={}))})(t=n.Rebooking||(n.Rebooking={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.FlightNotAvailable=1]="FlightNotAvailable";n[n.PossibleDuplicateBooking=2]="PossibleDuplicateBooking";n[n.MemberAccountLocked=3]="MemberAccountLocked";n[n.SessionUnavailable=4]="SessionUnavailable";n[n.MemberDetailsNotFound=5]="MemberDetailsNotFound";n[n.PaymentBillingAddressError=6]="PaymentBillingAddressError";n[n.PaymentDetailsError=7]="PaymentDetailsError";n[n.PaymentGeneralProcessingError=8]="PaymentGeneralProcessingError";n[n.PaymentGeneralError=9]="PaymentGeneralError";n[n.MemberAlreadyExists=10]="MemberAlreadyExists";n[n.FailedLoginAfterSuccessfulAddNewMember=11]="FailedLoginAfterSuccessfulAddNewMember";n[n.UserCreationError=12]="UserCreationError";n[n.MemberEmailDoesNotExist=13]="MemberEmailDoesNotExist";n[n.MemberPasswordIncorrect=14]="MemberPasswordIncorrect";n[n.FlightPriceChanged=15]="FlightPriceChanged";n[n.BasketPriceChanged=16]="BasketPriceChanged";n[n.SeatNotAvailable=17]="SeatNotAvailable";n[n.InfantSeatClash=18]="InfantSeatClash";n[n.CarAvailability=19]="CarAvailability";n[n.InsuranceAvailability=20]="InsuranceAvailability";n[n.CarPriceChanged=21]="CarPriceChanged";n[n.AirPlusCompanyAccountInvalid=23]="AirPlusCompanyAccountInvalid";n[n.AirPlusProviderInvalid=24]="AirPlusProviderInvalid";n[n.AirPlusFilekeyInvalid=25]="AirPlusFilekeyInvalid";n[n.AirPlusUpdateNotAvailableForAccount=26]="AirPlusUpdateNotAvailableForAccount";n[n.PassengerNotAssociatedWithBooking=27]="PassengerNotAssociatedWithBooking";n[n.CheckInError=28]="CheckInError";n[n.ResetPasswordBadToken=29]="ResetPasswordBadToken";n[n.SeatingAvailability=30]="SeatingAvailability";n[n.RobotDetected=99]="RobotDetected"})(t=n.KnownError||(n.KnownError={}))})(t=n.Rebooking||(n.Rebooking={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.DirectEasyJetConnection=1]="DirectEasyJetConnection";n[n.AlternativeDirectEasyJetConnection=2]="AlternativeDirectEasyJetConnection";n[n.IndirectConnection=4]="IndirectConnection";n[n.IndirectPartnerConnection=8]="IndirectPartnerConnection";n[n.DirectPartnerConnection=16]="DirectPartnerConnection";n[n.NoConnection=32]="NoConnection";n[n.Worldwide=28]="Worldwide"})(t=n.ConnectionType||(n.ConnectionType={}))})(t=n.RouteSearch||(n.RouteSearch={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){function t(t){return n[t]}function i(t){return n[t]}function r(t){return(t&n.Worldwide)>0}n.Parse=t;n.ToString=i;n.IsWorldwide=r})(t=n.ConnectionType||(n.ConnectionType={}))})(t=n.RouteSearch||(n.RouteSearch={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.SmartMessageTipForType=function(n){n=n.toLowerCase();switch(n){case"bottom left":return this.BottomLeft;case"bottom left long tip":return this.BottomLeftLongTip;case"bottom right long tip":return this.BottomRightLongTip;case"top right":return this.TopRight;case"left center":return this.LeftCenter;default:return this.BottomLeft}},n.BottomLeft={width:30,height:15,corner:"bottom left",mimic:"bottom center",offset:30},n.BottomLeftLongTip={width:30,height:20,corner:"bottom left",mimic:"bottom center",offset:30},n.BottomRightLongTip={width:30,height:20,corner:"bottom right",mimic:"bottom center",offset:30},n.TopRight={width:30,height:15,corner:"top right",mimic:"top center",offset:30},n.LeftCenter={width:15,height:10,corner:"left center",mimic:"left center",offset:0},n}();n.SmartMessageTips=t})(t=n.SmartMessages||(n.SmartMessages={}))})(t=n.Data||(n.Data={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",link:function(t,i){t.$watch(function(){return i.height().toString()},function(){n.Events.Fire(n.Events.Names.Basket.HeightModified)})}}},t.DirectiveName="ejAncillariesHeightChange",t}();t.AncillariesHeightChange=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",link:function(t,i){t.$on(n.Events.Names.AriaHideModal.Hide,function(n,t){i[0]!=t[0]?i.attr("aria-hidden","true"):i.removeAttr("aria-hidden")});t.$on(n.Events.Names.AriaHideModal.Unhide,function(){i.removeAttr("aria-hidden")})}}},t.DirectiveName="ejAriaHideModal",t}();t.AriaHideModal=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(t,i,r){t.$watch(r[n.DirectiveName],function(n){n?i.attr("aria-hidden","true"):i.removeAttr("aria-hidden")});t.$eval(r[n.DirectiveName])&&i.attr("aria-hidden","true")}}},n.DirectiveName="ejAriaHideWhen",n}();n.AriaHideWhen=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(t,i,r){var f=r[n.DirectiveName+"Map"],u=!1;t.$watch(r[n.DirectiveName],function(n,r){if(n&&n!=r&&!u){var e=t.$eval(f);i.attr(e);u=!0}})}}},n.DirectiveName="ejAttrWhen",n}();n.AttrWhen=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",link:function(t){var i=null;t.$on(n.Events.Names.Basket.BasketInitialised,function(){i=angular.element(".basket-height-content")});t.$on(n.Events.Names.Basket.HeightModified,function(){!i||setTimeout(function(){var n=i.innerHeight()+i.offset().top;Main3.Common.Scrolling.EnsureMinumumHeightForScrolling(n,"Basket")},0)})}}},t.DirectiveName="ejBasketPageMinHeight",t}();t.BasketPageMinHeight=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(t){return{restrict:"A",link:function(i,r,u){i.$watch(function(){return i.$eval(u[n.DirectiveName])},function(n){r.html(n&&n.toString());t(r.contents())(i)})}}},n.DirectiveName="ejBindHtml",n}();n.BindHtml=t;t.Factory.$inject=["$compile"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(t){return{restrict:"A",link:function(i,r){r.click(function(u){var e=u.target,o=$jq(e),f=n.FindClickEvent(o,r,t);f&&(u.preventDefault(),i.$apply(function(){f(i,{$event:u})}))})}}},n.FindClickEvent=function(t,i,r){if(i.has(t[0]).length>0){var u=t.attr(n.ChildEventAttribute);return u?r(u):n.FindClickEvent(t.parent(),i,r)}return null},n.DirectiveName="ejChildClick",n.ChildEventAttribute="ej-child-click-event",n}();n.ChildClick=t;t.Factory.$inject=["$parse"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(t){return{restrict:"A",link:function(i,r,u){r.on("click",function(r){var f=u[n.DirectiveName]?t(u[n.DirectiveName]):null;f&&i.$apply(function(){f(i,{$event:r})})})}}},n.DirectiveName="ejClickEvent",n}();n.ClickEvent=t;t.Factory.$inject=["$parse"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",compile:function(t,i){return i.$set(n.DirectiveName,undefined),{}}}},n.DirectiveName="ejCloakMobileTablet",n}();n.CloakMobileTablet=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(t){return{restrict:"A",scope:!0,link:function(i,r,u){var e=r.find(".scroller"),o=r.find(u[n.ContentSliderListSelector]),s=parseInt(u[n.ContentWidth]),h=parseInt(u[n.SlidingIncrement]),f=new Main3.Content.ContentSliderActions(e,s,h,i,o);e.on("scroll",_.throttle(function(){return i.$digest()},100));angular.element(t).on("resize",_.throttle(function(){return i.$digest()},100));i.Slide=function(n){f.Slide(n)};i.SlideToSelectedItem=function(n){f.SlideToSelectedItem(n)};i.SlideRight=function(){f.SlideRight()};i.SlideLeft=function(){f.SlideLeft()};i.CanSlide=function(){return f.CanSlide()};i.CanSlideLeft=function(){return f.CanSlideLeft()};i.CanSlideRight=function(){return f.CanSlideRight()};i.ScrollIntoView=function(n){return f.ScrollIntoView(n.target)};i.CheckIfArrowKeypress=function(n){n.which===37&&(n.preventDefault(),f.SlideLeft());n.which===39&&(n.preventDefault(),f.SlideRight())}}}},n.DirectiveName="ejContentSlider",n.SlidingIncrement="ejContentSliderIncrement",n.ContentWidth="ejContentSliderWidth",n.ContentSliderListSelector="ejContentSliderListSelector",n}();n.ContentSlider=t;t.Factory.$inject=["$window"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",link:function(i,r,u){var f=i.$eval(u[t.DirectiveName]),e=i.$eval(u[t.IsOutboundAttributeName]),o=_.debounce(function(){var n=i.$eval(u[t.IsOutboundAttributeName]);Main3.RouteDatePicker.DayHighlighter.UpdateHighlighterForElement(r,i.DepartureDate,i.ReturnDate,n)},250);if(i.$on(n.Events.Names.SimpleTemplate.ModelRebuilt,function(){o()}),f&&f.length===2)Main3.RouteDatePicker.DayHighlighter.CreateHighlighterForElement(r,f[0],f[1],e);else throw new Error("Dates array provided to ej-day-highlighting was incorrect format");}}},t.DirectiveName="ejDayHighlighting",t.IsOutboundAttributeName="ejDayHighlightingIsOutbound",t}();t.DayHighlighting=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",require:"ngModel",link:function(t,i,r,u){var f=r[n.DirectiveName];u.$validators[f]=function(){return!0}}}},n.DirectiveName="ejDisableValidator",n}();n.DisableValidator=t;t.$inject=[""]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(i,r,u,f){return{restrict:"AE",link:function(e,o,s){var h=new Main3.Drawers.DrawerSectionController(i,r,u,f,o,e);e.$watch(s[t.DirectiveName],function(n){h.ChangeSection(n)});e.$on(n.Events.Names.Drawer.Closed,function(){h.DestroyLoadedSectionsWhereMarkedOnDrawerClose()})}}},t.DirectiveName="ejDrawerSectionView",t}();t.DrawerSectionView=i;i.Factory.$inject=["$compile","$animate","$templateRequest","$sce"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(t){return{restrict:"A",link:function(i,r,u){var f=u[n.DirectiveName]?t(u[n.DirectiveName]):null,e=u.ngClick?t(u.ngClick):null,o=function(n){n.which===13&&i.$apply(function(){f?f(i,{$event:n}):e&&e(i,{$event:n})})};r.on("keydown",o);i.$on("$destroy",function(){r.off("keydown",o)})}}},n.DirectiveName="ejEnterKey",n}();n.EnterKey=t;t.Factory.$inject=["$parse"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{link:function(i,r,u){var e=u[t.DirectiveName]||"",f=null,o=r.is("["+t.MinAttribute+"]"),s=r.is("["+t.ShowWhenResized+"]"),h=r.is("["+t.CheckHeightOfAllChildElements+"]"),c=r.is("["+t.IncludePaddingAndBorder+"]");t._groups.ContainsKey(e)?(f=t._groups.Get(e),f.ResetIfElementsRemovedFromDom()):(f=new Main3.Common.EqualHeightGroup(o,s,h,c),t._groups.Set(e,f));!f||(f.AddElement(r),i.$on(n.Events.Names.EqualHeight.Refresh,function(){f.Refresh()}))}}},t.DirectiveName="ejEqualHeight",t.MinAttribute="ej-equal-height-min",t.ShowWhenResized="ej-equal-height-show-when-resized",t.CheckHeightOfAllChildElements="ej-equal-height-check-all-child-elements",t.IncludePaddingAndBorder="ej-equal-height-include-padding-and-border",t._groups=new Dictionary,t}();t.EqualHeight=i;i.Factory.$inject=[]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(i,r){return{restrict:"A",scope:{ErrorWhen:"="+t.DirectiveName,NoAlert:"=?noAlert",ForElementSelector:"@for",Priority:"=?priority",Text:"@text"},link:function(u,f){var e,s,h,c,l;if(u.Text){h=f.parents(".drawer").length>0;r(function(){e=angular.element(u.ForElementSelector);e.focusin(a).focusout(o)});c=function(n,t){s=!0;var i=t.tooltip.attr("id");e.prependDelimitedAttr("aria-describedBy",i)};l=function(n,t){if(s=!1,e){var i=t.tooltip.attr("id");e.removeDelimitedAttr("aria-describedBy",i)}};f.on("tooltipopen",c);f.on("tooltipclose",l);f.tooltip({items:"*",tooltipClass:t.PopupClassName,content:function(){return u.Text},position:{collision:"none",using:function(n,t){h&&angular.element(this).addClass("in-drawer");angular.element(this).css(n);angular.element("<div>").addClass("arrow").addClass(t.vertical).addClass(t.horizontal).appendTo(this);u.NoAlert||angular.element(this).attr("role","alert")},my:"center bottom",at:"center top-13"},show:0,hide:0});var v=function(){y()||(i.SetMessageOpen(u.Priority),e&&e.is(":visible")&&e.focus())},y=function(){return!u.Priority?i.IsMessageOpen():i.IsHigherPriorityMessageOpen(u.Priority)},p=function(){e.attr("aria-invalid","true");v()},w=function(){e&&e.removeAttr("aria-invalid");o()},a=function(){u.ErrorWhen&&(i.SetMessageOpen(u.Priority),f.tooltip("open"))},o=function(){i.SetMessageClosed();f.tooltip("close")},b=function(){s&&(o(),a())},k=_.debounce(b,100);$jq(window).resize(function(){k()});u.$watch(function(n){return n.ErrorWhen},function(n){n?p():w()});u.$on(n.Events.Names.ErrorMessage.Close,function(){r(function(){o()})})}}}},t.DirectiveName="ejErrorMessage",t.PopupClassName="popup-error",t}();t.ErrorMessage=i;i.Factory.$inject=["Controls_ErrorMessageService","$timeout"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(t,i,r){var u=r[n.DirectiveName];t.$watch(function(){return t.$eval(u)},function(r,f){r&&r!=f&&n.SafeSetFocus(i,function(){i.is("[ej-focus-when-reset]")&&t.$eval(u+" = false")})})}}},n.SafeSetFocus=function(n,t){t===void 0&&(t=null);n.is(":visible")?(n.focus(),t&&t()):setTimeout(function(){n.focus();t&&t()})},n.DirectiveName="ejFocusWhen",n}();n.FocusWhen=t;t.Factory.$inject=["$parse"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",link:function(t){t.ShowShelfRack=!1;t.$on(n.Events.Names.ShelfRack.ShowShelfRack,function(){t.ShowShelfRack=!0});t.$on(n.Events.Names.ShelfRack.HideShelfRack,function(){t.ShowShelfRack=!1})}}},t.DirectiveName="ejHideUntilEventShelfRack",t}();t.HideUntilEventShelfRack=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(t,i,r){var u=r[n.DirectiveName]||"",e=r[n.ParentHoverName]||"",f;u&&(f=i,e&&(f=i.closest("."+e)),u=n.PreLoadImage(u),i.is("img")?n.SetUpEventsForImage(f,i,u):n.SetUpEventsForBackgroundImage(f,i,u))}}},n.PreLoadImage=function(n){var t=new Image;return t.src=n,t.src},n.SetUpEventsForImage=function(n,t,i){var r=t.attr("src");n.on("mouseenter focus",function(){Device.IsTouchDevice()||t.attr("src",i)});n.on("mouseleave blur",function(){Device.IsTouchDevice()||(r||(r=t.attr("ng-src")),t.attr("src",r))})},n.SetUpEventsForBackgroundImage=function(n,t,i){var r=t.css("background-image"),u="url(".concat(i).concat(")");n.on("mouseenter focus",function(){Device.IsTouchDevice()||t.css("background-image",u)});n.on("mouseleave blur",function(){Device.IsTouchDevice()||t.css("background-image",r)})},n.DirectiveName="ejHoverImageChange",n.ParentHoverName="ejHoverImageChangeParent",n}();n.HoverImageChange=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",require:"ngModel",link:function(t,i,r,u){u.$validators[n.DirectiveName]=function(n){return Utilities.IbanValidation.Validate(n)}}}},n.DirectiveName="ejIbanValidation",n}();n.IbanValidation=t;t.$inject=[""]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"E",link:function(n,t,i){/^(search|email|url|tel|number|text)$/i.test(i.type)&&t.bind("mouseup",function(){var n=t.val();!n||setTimeout(function(){var n=t.val();n||t.change()},1)})}}},n.DirectiveName="input",n}();n.IeClearInputFix=t;t.Factory.$inject=[]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(t,i,r){var u=r[n.DirectiveName]||"";u&&(n.AddMouseDownEventHandler(i,u),n.AddKeyDownEventHandler(i,u),n.AddFocusEventHandler(i,u))}}},n.AddMouseDownEventHandler=function(t){t.on("mousedown",function(){n.MouseUsed=!0})},n.AddKeyDownEventHandler=function(t){t.on("keydown",function(){n.MouseUsed=!1})},n.AddFocusEventHandler=function(t,i){t.on("focus",function(){n.MouseUsed?t.removeClass(i):t.addClass(i)})},n.DirectiveName="ejKeyboardFocusClass",n.MouseUsed=!1,n}();n.KeyboardFocusClass=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(n,t){var i=$jq(window),r=function(){if(t.is(":visible")&&Main3.Common.BreakPointService.IsDesktop()){var n=i.scrollTop();t.scrollTop(n)}},u=_.debounce(r,10);i.scroll(u)}}},n.DirectiveName="ejLinkedScroll",n}();n.LinkedScroll=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",require:"ngModel",link:function(t,i,r,u){u.$validators[n.DirectiveName]=function(t){return r[n.DirectiveName]==undefined?!0:Utilities.LuhnValidation.Validate(t)}}}},n.DirectiveName="ejLuhnCheck",n}();n.LuhnValidation=t;t.$inject=[""]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(n){return{require:"ngModel",link:function(i,r,u,f){t.InitialiseMask(n,i,r,u);t.InitialiseValidator(f,r)}}},t.InitialiseMask=function(scriptSettings,scope,element,attributes){var isDisabled=eval(scriptSettings.InputMaskDisableScript),modelController;isDisabled||(scope.$watch(attributes[t.DirectiveName],function(t){element.unmask();t&&element.mask(t);element.val("");scope.$broadcast(n.Events.Names.Validation.Refresh)}),element.is("[ng-model]")&&(modelController=element.controller("ngModel"),modelController.$parsers.push(function(n){var t=element.data("mask");return t&&(n=t.getCleanVal()),n})))},t.InitialiseValidator=function(n,i){n.$validators[t.DirectiveName]=function(){var n=i.data("mask"),t;return n&&n.mask&&(t=n.getMaskedVal().length===n.mask.length,!t)?!1:!0}},t.DirectiveName="ejMask",t}();t.Mask=i;i.Factory.$inject=["Sitecore_ScriptSettings"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function t(){}return t.Factory=function(){return{restrict:"A",link:function(i,r,u){var f=u[t.DirectiveName];i.$watch(f,function(t,i){t&&t!=i&&(n.ShowModal.ElementToFocusOnCloseOverride=r)})}}},t.DirectiveName="ejModalCloseFocusWhen",t}();n.ModalCloseFocusWhen=t;t.Factory.$inject=["$parse"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(t,i){return{restrict:"A",link:function(r,u,f){var w=$jq(t),e=angular.fromJson(f[n.DirectiveName]),o,s,h,c,l=function(){o=Main3.Common.BreakPointService.IsDesktop();s=Main3.Common.BreakPointService.IsTablet();h=Main3.Common.BreakPointService.IsMobile();c=Main3.Common.BreakPointService.IsDrawerSingleColumn()};l();var a=i(e.enterDesktop),v=i(e.enterTablet),y=i(e.enterMobile),p=i(e.enterDrawerSingleColumn),b=function(){var n=a!=null&&!o&&Main3.Common.BreakPointService.IsDesktop(),t=v!=null&&!s&&Main3.Common.BreakPointService.IsTablet(),i=y!=null&&!h&&Main3.Common.BreakPointService.IsMobile(),u=p!=null&&!c&&Main3.Common.BreakPointService.IsDrawerSingleColumn();r.$apply(function(){n&&a(r);t&&v(r);i&&y(r);u&&p(r)});l()};w.on("debouncedresize",b)}}},n.DirectiveName="ejOnBreakpoint",n}();n.OnBreakpoint=t;t.Factory.$inject=["$window","$parse"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(t){return{link:function(i,r,u){var e=t(u[n.DirectiveName]),o=function(n){i.$apply(function(){e(i,{$event:n})})},f=_.debounce(o,100);r.scroll(f);r.on("touchmove",null,f)}}},n.DirectiveName="ejOnScroll",n}();n.OnScroll=t;t.Factory.$inject=["$parse"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function t(){}return t.Factory=function(){return{restrict:"A",link:function(i,r){r.click(function(i){var u=r.find("a:first, button:first");u.length>0&&u[0]!=$jq(i.target)[0]&&(r.is("["+t.ExpectDrawerAttributeName+"]")&&(n.ShowModal.ElementToFocusOnCloseOverride=u),u.click())})}}},t.DirectiveName="ejPassClickToChildLink",t.ExpectDrawerAttributeName="expect-drawer",t}();n.PassClickToChildLink=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(t,i,r){var u=t.$eval(r[n.DirectiveName]),f=new Main3.Password.PasswordStrengthController(i,u)}}},n.DirectiveName="ejPasswordStrength",n}();n.PasswordStength=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(n,t){t.scroll(function(){t.scrollLeft(0);t.scrollTop(0)})}}},n.DirectiveName="ejPreventElementScroll",n}();n.PreventElementScroll=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(n,t){t.on("keydown",function(n){var t=n.which>=48&&n.which<=57||n.which>=96&&n.which<=105,i=n.which<=46,r=n.which>=112&&n.which<=123,u=(n.ctrlKey||n.metaKey)&&n.which==86;t||i||r||u||n.preventDefault()});t.on("paste",function(n){var t=n.originalEvent.clipboardData.getData("text");jQuery.isNumeric(t.replaceAll(" ",""))||n.preventDefault()})}}},n.DirectiveName="ejPreventNonNumericKeys",n}();n.PreventNonNumericKeys=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.DisableScroll=function(){var i=$jq(document),n=i.find("body"),r,t;i.data("page-scroll-prevented")&&(n.removeAttr("style"),r=n.width(),t={overflow:"hidden",width:r},bowser.ios&&(t.position="fixed"),n.css(t))},n.PreventDefault=function(n){n.preventDefault()},n.PreventPageScroll=function(){var t=$jq(document),i=$jq(window);t.data("page-scroll-prevented",!0);i.on("debouncedresize",n.DisableScroll);if(n.DisableScroll(),bowser.ios)t.on("touchmove",this.PreventDefault)},n.AllowPageScroll=function(){var t=$jq(document),i=$jq(window),r=t.find("body");t.data("page-scroll-prevented")&&(t.data("page-scroll-prevented",!1),r.removeAttr("style"),i.off("debouncedresize",n.DisableScroll),bowser.ios&&t.off("touchmove",this.PreventDefault))},n.Factory=function(){return{restrict:"A",link:function(t,i,r){t.$watch(r[n.DirectiveName],function(t){t?n.PreventPageScroll():n.AllowPageScroll()})}}},n.DirectiveName="ejPreventScroll",n}();n.PreventScroll=t;t.Factory.$inject=["$animate"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",scope:null,controller:n.Controllers.Common.ProcessQueryStrings}},t.DirectiveName="ejProcessQueryStrings",t}();t.ProcessQueryStrings=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(t,i,r){var e=r[n.DirectiveName],u=r[n.ReplaceWith],o=r[n.ReplaceModel],f=function(){var n=t.$eval(o),r=t.$eval(u);n=n.replaceAll(e,r);i.text(n)};t.$watch(function(){return t.$eval(u)},function(n,t){n&&n!=t&&f()});f()}}},n.DirectiveName="ejReplace",n.ReplaceWith="ejReplaceWith",n.ReplaceModel="ejReplaceModel",n}();n.Replace=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(t,i,r,u,f){return{restrict:"AE",templateUrl:"ng-templates/route-search",controller:n.Controllers.Controls.RouteSearch.AngularRouteSearch,scope:{InitialOrigin:"=initialOrigin",InitialDestination:"=initialDestination",IsRebookingSearch:"=isRebookingSearch",IsWorldwideMode:"=isWorldwideMode",AnalyticsCategory:"=analyticsCategory",AnalyticsAction:"=analyticsAction",ExcludeMarketGroups:"=excludeMarketGroups",ReturnToDrawerKey:"=returnToDrawerKey"},link:function(e,o){var c=e.InitialOrigin,l=e.InitialDestination,a=e.IsRebookingSearch,v=e.IsWorldwideMode,y=e.AnalyticsCategory,p=e.AnalyticsAction,h,s;!u||(i.WorldwideText=u.AirportWorldwideText);h=o.find(".route-search-wrapper");s=new Main3.RouteSearch.RouteSearchControl(h,t,i,f,a,v,e.ExcludeMarketGroups||!1,c,l,y,p,e.ReturnToDrawerKey);s.OnChanged(function(){var t={OriginIata:e.OriginIata(),DestinationIata:e.DestinationIata()};e.$applyAsync(function(i){i.$emit(n.Events.Names.RouteSearch.ChangeMade,t);i.OriginError=i.OriginHasError()?i.OriginError:!1;i.DestinationError=i.DestinationHasError()?i.DestinationError:!1})});s.OnUnmatchedOriginTextEntry(function(){e.$applyAsync(function(n){return n.OriginError?!0:(n.OriginError=!1,r(function(){n.OriginError=n.OriginHasError()}),!1)})});s.OnUnmatchedDestinationTextEntry(function(){e.$applyAsync(function(n){return n.DestinationError?!0:(n.DestinationError=!1,r(function(){n.DestinationError=n.DestinationHasError()}),!1)})});e.Control=s;e.Validate=function(){return e.OriginError=!1,e.DestinationError=!1,r(function(){e.OriginError=e.OriginHasError();e.DestinationError=e.DestinationHasError()}),s.Validate()};e.DestinationIata=function(){return s.DestinationIata()};e.OriginIata=function(){return s.OriginIata()};e.OriginHasError=function(){return h.find(".outer-origin").hasClass("invalid")};e.DestinationHasError=function(){return h.find(".outer-destination").hasClass("invalid")};e.$on(n.Events.Names.RouteSearch.ResetRoute,function(n,t,i){var r=c,u=l;!t&&t!==""||(r=t);!i&&i!==""||(u=i);s.SetOrigin(r);s.SetDestination(u)});e.$parent.$on(n.Events.Names.RouteDatePicker.BeforeOpen,function(){s.Blur()})}}},t.DirectiveName="ejRouteSearch",t}();t.RouteSearch=i;i.Factory.$inject=["Sitecore_RoutesData","Sitecore_RouteSearchSettings","$timeout","Sitecore_WorldwideSettings","Worldwide_CombinedRoutesService"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(t,i,r,u,f){return{restrict:"AE",templateUrl:"ng-templates/route-search-text-box",scope:{Airport:"=airport",DeleteAirport:"&deleteAirport",AlwaysShowDelete:"=showDelete",HelpText:"@helpText",PlaceHolder:"@placeHolder",DeleteImage:"@deleteImage",DeleteAirportHelpText:"@deleteAirportHelpText",PickAirportHelpText:"@pickAirportHelpText",PickAirportImage:"@pickAirportImage",ExcludedAirports:"=excludedAirports",PickAirportImageAlt:"@pickAirportImageAlt",InvalidAirportAccessibilityMessage:"@invalidAirportAccessibilityMessage"},link:function(t,r){var o=r.find("input"),e=new Main3.RouteSearch.RouteSearchTextbox({Textbox:o,IsOrigin:!0,RouteSearchSettings:i,CombinedRoutesService:f,IsRebookingSearch:!1,IsWorldwideMode:!1,ExcludeMarketGroups:!0,InitialAirportIata:t.Airport.Iata,AnalyticsCategory:null,AnalyticsAction:null,SelectOrigin:function(n){e.SetSelected(n)},SelectDestination:null,AfterDrawerSelect:function(){n.Events.Fire(n.Events.Names.Drawer.Close)}});e.OnUpdate(function(n){t.$applyAsync(function(){if(!n){u.AlertInvalidEntry(t.InvalidAirportAccessibilityMessage);t.DeleteAirport(t.Airport);return}_.extend(t.Airport,n)})});t.ShowDeleteButton=function(){return t.AlwaysShowDelete||!!t.Airport&&!!t.Airport.Iata};t.$watch(function(){return JSON.stringify(t.ExcludedAirports)},function(){var n=null;t.ExcludedAirports&&t.Airport&&(n=t.ExcludedAirports.filter(function(n){return n.Iata!==t.Airport.Iata}));e.SetExcludedAirports(n)})}}},t.DirectiveName="ejRouteSearchTextBox",t}();t.RouteSearchTextBox=i;i.Factory.$inject=["Sitecore_RoutesData","Sitecore_RouteSearchSettings","$timeout","Common_RouteSearchAccessibilityService","Worldwide_CombinedRoutesService"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(t){return{restrict:"AE",templateUrl:"ng-templates/route-search-text-box-list",scope:{AddAnotherAirportText:"@addAnotherAirportText",AirportLimit:"@airportLimit",Airports:"=airports",ExcludedAirports:"=excludedAirports",HelpText:"@helpText",PlaceHolder:"@placeHolder",DeleteImage:"@deleteImage",DeleteAirportHelpText:"@deleteAirportHelpText",PickAirportHelpText:"@pickAirportHelpText",PickAirportImage:"@pickAirportImage",InvalidAirportAccessibilityMessage:"@invalidAirportAccessibilityMessage"},controller:n.Controllers.Controls.RouteSearch.RouteSearchTextBoxList,link:function(n){var i=function(){t(function(){angular.element(".origin-button").first().focus()},0)},r=function(n){t(function(){var t=angular.element(".ej-form-field-input-textbox.ej-input.origin.ui-autocomplete-input").get(n);t&&t.focus()},0)};n.FocusOnOriginAirportChange=function(t){n.Airports.length===t?i():r(t)}}}},t.DirectiveName="ejRouteSearchTextBoxList",t}();t.RouteSearchTextBoxList=i;i.Factory.$inject=["$timeout"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"AE",link:function(n,t){t.attr("onclick","return;")}}},n.DirectiveName="ejSafariMobileClickableElement",n}();n.SafariMobileClickableElement=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(i){return{restrict:"A",link:function(r,u,f){var s=this,h=f[t.EventAttributeName],c=u.is("["+t.PadToTopAttribute+"]"),e=function(n,t,r){(r===void 0&&(r=0),r>s.MaxRetries)||(n.is(":visible")?t():(r++,i(function(){return e(n,t,r)},s.TimeoutMsBetweenRetries)))},o;c&&e(u,function(){Main3.Common.Scrolling.AddPaddingToAllowScrollToTopOf(u,"ScrollToScopeId:"+r.$id)});o=function(){e(u,function(){r.$applyAsync(function(){Main3.Common.Scrolling.ScrollToElement(u);n.Events.Fire(n.Events.Names.ScrollTo.PageScrolled)})})};r.$watch(function(){return r.$eval(f[t.DirectiveName])},function(n){n&&(h?r.$on(h,function(){o()}):o())})}}},t.DirectiveName="ejScrollTo",t.EventAttributeName="ejScrollToEvent",t.PadToTopAttribute="ej-scroll-to-pad-to-top",t.MaxRetries=20,t.TimeoutMsBetweenRetries=100,t}();t.ScrollTo=i;i.Factory.$inject=["$timeout"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{scope:{EventName:"="+n.DirectiveName},restrict:"A",link:function(t,i,r){var u=r[n.ClassName];t.EventName&&u&&t.$on(t.EventName,function(){var n=i.find("."+u);n.length!==0&&Main3.Common.Scrolling.ScrollToElements(n,".scroller")})}}},n.DirectiveName="ejScrollToGroup",n.ClassName="ejScrollToGroupClass",n}();n.ScrollToGroup=t;t.Factory.$inject=["$window"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function i(){}return i.Factory=function(r){return{restrict:"A",link:function(u,f,e){var o=e.ejShowModalClass||"ng-hide",s=e.ejShowModalHideEvent,h=e.ejShowModalHidingEvent,c=e.ejShowModalShowEvent,l;u.$watch(e[i.DirectiveName],function(e,a){var v=function(){f.focus();c&&!a&&n.Events.Fire(c);n.Events.Fire(n.Events.Names.AriaHideModal.Hide,f)},y=function(){t.PreventScroll.AllowPageScroll();h&&a&&n.Events.Fire(h);n.Events.Fire(n.Events.Names.AriaHideModal.Unhide);i.ReturnFocusToPage(l)},p=function(){s&&a&&n.Events.Fire(s)};e?(l=$jq(document.activeElement),t.PreventScroll.PreventPageScroll(),Utilities.WindowActive.HasFocus()&&!u.PreventOpenAnimation?r.removeClass(f,o,{tempClasses:"ng-hide-animate"}).then(v):(f.removeClass(o),v())):Utilities.WindowActive.HasFocus()?(r.addClass(f,o,{tempClasses:"ng-hide-animate"}).then(p),y()):(f.addClass(o),y(),p())})}}},i.ReturnFocusToPage=function(n){if(i.ElementToFocusOnCloseOverride)t.FocusWhen.SafeSetFocus(i.ElementToFocusOnCloseOverride,function(){i.ElementToFocusOnCloseOverride=null});else if(n){var r=$jq(document.activeElement),u=r.length==0,f=r.parents(".drawer").length>0,e=r[0]==$jq("body")[0],o=!r.is(":visible");u||f||e||o?n.focus():r.blur().focus()}},i.DirectiveName="ejShowModal",i}();t.ShowModal=i;i.Factory.$inject=["$animate"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(t){return{restrict:"A",link:function(i,r,u){var o=$jq(t),s=u[n.ShowOnDesktop]==="true",h=u[n.ShowOnTablet]==="true",c=u[n.ShowOnMobile]==="true",f=function(n){n?r.show():r.hide()},e=function(){Main3.Common.BreakPointService.IsDesktop()?f(s):Main3.Common.BreakPointService.IsTablet()?f(h):Main3.Common.BreakPointService.IsMobile()&&f(c)};e();o.on("debouncedresize",e)}}},n.DirectiveName="ejShowOnBreakpoint",n.ShowOnDesktop="showOnDesktop",n.ShowOnTablet="showOnTablet",n.ShowOnMobile="showOnMobile",n}();n.ShowOnBreakpoint=t;t.Factory.$inject=["$window"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",link:function(i,r,u){var f=u[t.ModelAttributeName],e=u[t.DirectiveName],o=t.GetTemplate(e);i.$watch(f,function(f){var e=new Main3.SimpleTemplate.DotSimpleTemplateEngine(o,f);setTimeout(function(){r.html(e.Render());i.$broadcast(n.Events.Names.SimpleTemplate.ModelRebuilt);var f=u[t.ScrollToElementOnRebuildAttributeName];!f||$jq(f).scrollTop(0)})})}}},t.GetTemplate=function(n){var t=document.getElementById(n);if(t&&t.tagName.toLowerCase()==="script"&&t.getAttribute("type").toLowerCase()==="text/html")return t.innerHTML;throw new Error("Could not load template with id '"+n+"'");},t.DirectiveName="ejSimpleTemplate",t.ModelAttributeName="ejSimpleTemplateModel",t.ScrollToElementOnRebuildAttributeName="ejScrollToElementOnRebuild",t}();t.SimpleTemplate=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{link:function(t,i,r){var u=function(){t.$applyAsync(function(){var u=i.parent().innerHeight()>$jq(window).height()?i.parent().innerHeight():$jq(window).height(),f=n.GetMarginAndPaddingHeight(i),r=0,t;i.siblings().each(function(t,i){var u=$jq(i);n.HasLayout(u)&&(r+=u.outerHeight())});t=u-r-f;i.css({maxHeight:t+"px",height:t+"px"})})},f=r[n.TriggeringEvent],e;f&&t.$on(f,u);e=_.debounce(u,n.WindowResizeDelay);$jq(window).on("resize",e)}}},n.HasLayout=function(n){var t=n.css("position");return t==="relative"||t==="static"},n.GetMarginAndPaddingHeight=function(n){return n.outerHeight(!0)-n.innerHeight()},n.DirectiveName="ejSpanRemainingHeight",n.TriggeringEvent="ejSpanRemainingHeightTriggeringEvent",n.WindowResizeDelay=100,n}();n.SpanRemainingHeight=t;t.Factory.$inject=[]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{link:function(t,i,r){var u=r[n.DirectiveName],f=window;f[u]=t}}},n.DirectiveName="ejStoreScope",n}();n.StoreScope=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(t){return{link:function(i,r,u){var e=t(u[n.DirectiveName]),f=function(n){i.$apply(function(){e(i,{$event:n})})},o=r.hammer({swipe_velocity:.5});o.on("swiperight",f);r.easySwipe({swipeRight:f})}}},n.DirectiveName="ejSwipeRight",n}();n.SwipeRight=t;t.Factory.$inject=["$parse"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(t,i,r){t.$watch(r[n.DirectiveName],function(t){var u=n.AncestorsTabEnabled(i),r=$jq(i).find(n._tabbableSelector).addBack(n._tabbableSelector);i.attr(n._resultAttribute,t);t&&u?n.EnableAllElements(r):n.DisableAllElements(r)})}}},n.AncestorsTabEnabled=function(t,i){var f,r,e,u,o,s;if(i===void 0&&(i=!1),f=!0,r=t.parents("["+n._resultAttribute+"]"),i&&(e=t.attr(n._resultAttribute),e=="false"))return!1;if(r.length>0)for(u=0;u<r.length;u++)if(o=angular.element(r[u]),s=o.attr(n._resultAttribute),s=="false"){f=!1;break}return f},n.EnableAllElements=function(t){t.each(function(t,i){var r=angular.element(i),o=n.AncestorsTabEnabled(r,!0),u,f,e;o&&(u=r.data(n._tabIndexDataKey),u?r.attr("tabindex",u):(f=r.attr("tabindex"),e=r.attr("tab-enabled-ignore"),f=="-1"&&e!="true"&&r.removeAttr("tabindex")))})},n.DisableAllElements=function(t){t.each(function(t,i){var r=angular.element(i),u=r.attr("tabindex");u?r.data(n._tabIndexDataKey,u):r.removeData(n._tabIndexDataKey);r.attr("tabindex",-1)})},n._tabbableSelector="a, [tabindex], button, input, select",n._resultAttribute="ej-tab-enabled-result",n._tabIndexDataKey="ejTabEnabled-tabindex",n.DirectiveName="ejTabEnabled",n}();n.TabEnabled=t;t.Factory.$inject=["$animate"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){var t="tapped";return{link:function(i,r){r.on("tap","a, button",function(n){$jq("."+t).removeClass(t);var i=$jq(n.target),r=i;i.is("button *")?r=i.closest("button"):i.is("a *")&&(r=i.closest("a"));r.is("[ej-tap-class-exclude]")||r.addClass(t)});i.$on(n.Events.Names.DrawerSectionView.End,function(){r.find("."+t).removeClass(t)})}}},t.DirectiveName="ejTapClass",t}();t.TapClass=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){var t=this;return{link:function(i,r,u){var h=u.ejTouchScrollDesktopDisable||!1,o=function(){r.scrollTop(0)},s=function(){var t=r.children().height(),i=r.height(),n=t-i;r.scrollTop(n<0?0:n)},f,e;if(bowser.ios){if(f=new Controls.Touch.TouchScrollPanel(r),o=function(){f.Reset()},s=function(){f.ScrollToBottom()},h){e=function(){var n=Main3.Common.BreakPointService.IsDesktop();n?f.Disable():f.Enable()};$jq(window).on("debouncedresize",function(){return i.$apply(e)});e()}i.$on(n.Events.Names.TouchScroll.DisableObserverForScrollHeightChanges,function(){f.DisableObserverForScrollHeightChanges()})}i.$on(n.Events.Names.TouchScroll.Reset,o.bind(t));i.$on(n.Events.Names.TouchScroll.ScrollToBottom,s.bind(t))}}},t.DirectiveName="ejTouchScroll",t}();t.TouchScroll=i;i.$inject=[]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(t){return{restrict:"A",link:function(i,r,u){r.bind("click",function(i){var f=u[n.Category],e=u[n.Action],o=u[n.Label],r=$jq(i.target).closest("a");if(r&&n.ShouldTrackLink(r))return n.TrackLink(t,r,f,e,o)})}}},n.ShouldTrackLink=function(n){var t=n.attr("href"),i;return!t||t.charAt(0)==="#"||t.match(/^javascript:/i)?!1:(i=n.attr("class"),i!=null&&i.indexOf("noTrack")>=0)?!1:!0},n.TrackLink=function(n,t,i,r,u){var e=t.attr("href"),f=t.attr("target")==="_blank";return n.TrackLinkClick(e,f,i,r,u),f},n.DirectiveName="ejTrackLinkClicks",n.Category="ejTrackLinkClicksCategory",n.Action="ejTrackLinkClicksAction",n.Label="ejTrackLinkClicksLabel",n}();n.TrackLinkClicks=t;t.Factory.$inject=["IAnalyticsTracker"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(t,i,r){var u=new Main3.Common.TabTrap(i);t.$watch(r[n.DirectiveName],function(n){n?u.Enable():u.Disable()})}}},n.DirectiveName="ejTrapTab",n}();n.TrapTab=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(t){return{restrict:"AE",require:"ngModel",link:function(i,r,u,f){var e=u[n.DirectiveName+"Key"]||"custom",o=t(u[n.ValidOnInvalid]);i.$watch(u[n.DirectiveName],function(n){if(f.$setValidity(e,n),!n){var t=o(i);t&&t()}})}}},n.DirectiveName="ejValid",n.ValidOnInvalid="ejValidOnInvalid",n}();n.Valid=t;t.Factory.$inject=["$parse"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(n){var i=this;return t.Tracker=n,{restrict:"A",link:function(n,r,u){var f=t.FindValidationElements(r),o=n.$eval(u[t.UpdateOnAnyTouch])?t.UpdateIfAnyModelTouched.bind(i):t.UpdateIfAllModelsTouched.bind(i),e;f.NgModelElements.length>0&&(e=new Main3.Common.ValidationController(r,t.AreAllElementsValid.bind(i,f),t.GetErrorMessagesForElements.bind(i,n,f,u),f.FocusableElements),t.HookUpEventsAndWatches(n,r,f,e,o))}}},t.FindValidationElements=function(n){var i=[],t=$jq();return n.find("[ng-model]").addBack("[ng-model]").each(function(r,u){var e=angular.element(u),o=e.controller("ngModel"),f;o&&(i.push({Controller:o,Element:e}),f=n.find("["+Main3.Common.ValidationController.AttributeFocusable+"]"),t=f.length>0?t.add(f):t.add(u))}),{NgModelElements:i,FocusableElements:t}},t.AreAllElementsValid=function(n){var t=!0;return n.NgModelElements.forEach(function(n){n.Controller.$validate();n.Controller.$valid||(t=!1)}),t},t.GetErrorMessagesForElements=function(n,i,r){var u=[],f=n.$eval(r[t.DirectiveName]);return i.NgModelElements.forEach(function(n){var i,t;for(i in n.Controller.$error)t=f[i],t&&u.push(t)}),u},t.UpdateIfAllModelsTouched=function(n,i,r,u){var f,e;r===void 0&&(r=!1);u===void 0&&(u="");f=n.NgModelElements.filter(function(n){return!n.Controller.$touched}).length;f==0||i.IsRadio()&&i.AnyChecked()?(e=i.Update(!1),!r||e||!u||t.Tracker.TrackEvent(u,Tracking.EventConstants.Actions.ValidationError,t.GetElementGroupIdentifier(n))):f>0&&i.Reset()},t.UpdateIfAnyModelTouched=function(n,i,r,u){var f,e;r===void 0&&(r=!1);u===void 0&&(u="");f=n.NgModelElements.some(function(n){return n.Controller.$touched});f||i.IsRadio()&&i.AnyChecked()?(e=i.Update(!1),!r||e||!u||t.Tracker.TrackEvent(u,Tracking.EventConstants.Actions.ValidationError,t.GetElementGroupIdentifier(n))):i.Reset()},t.GetElementGroupIdentifier=function(n){if(!!n.NgModelElements&&n.NgModelElements.length>0){var t=n.NgModelElements[0].Element.attr("name");return!t?n.NgModelElements[0].Element.attr("id"):t}return"unknown"},t.HookUpEventsAndWatches=function(t,i,r,u,f){var e=this;r.NgModelElements.forEach(function(n){t.$watch(function(){return n.Controller.$viewValue},function(){f(r,u)})});r.FocusableElements.blur(function(n){angular.element(n.target).is("["+Main3.Common.ValidationController.AttributeFocusable+"]")&&r.NgModelElements.forEach(function(n){return n.Controller.$setTouched()});t.$applyAsync(function(){f(r,u,!0,i.attr(e.SendEventCategoryAttribute))})});t.$on(n.Events.Names.Validation.Validate,function(n,t){if(!t||r.NgModelElements.filter(function(n){return n.Element[0]===t[0]}).length>0){var i=u.Update();i||n.preventDefault()}});t.$on(n.Events.Names.Validation.Refresh,function(){f(r,u)});t.$on(n.Events.Names.Page.LoadedFromCache,function(){r.NgModelElements.forEach(function(n){n.Element.is("["+Main3.Common.ValidationController.AttributeUncacheable+"]")&&n.Element.val("");n.Element.val()&&(n.Element.attr("type")==="checkbox"?n.Controller.$setViewValue(n.Element.is(":checked")):n.Controller.$setViewValue(n.Element.val()));n.Controller.$setPristine();n.Controller.$setUntouched()});u.Reset()})},t.DirectiveName="ejValidation",t.UpdateOnAnyTouch="ejValidationUpdateOnAnyTouch",t.SendEventOnErrorCategory="ejValidationEventErrorCategory",t.SendEventCategoryAttribute="ej-validation-event-error-category",t}();t.Validation=i;i.Factory.$inject=["IAnalyticsTracker"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Account.PassengerSignInController,templateUrl:"ng-templates/passenger-sign-in",link:function(n){n.SignInButtonDescribedBy=function(){var t="";return n.PassengerSignInForm.$valid?t:(n.PassengerSignInForm.surname.$invalid&&(t+="surname-invalid-message "),n.PassengerSignInForm.bookingRef.$invalid&&(t+="booking-ref-invalid-message "),n.PassengerSignInForm.permission.$invalid&&(t+="permission-invalid-message"),t)}}}},t.DirectiveName="ejPassengerSignIn",t}();t.PassengerSignIn=i})(i=t.Account||(t.Account={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",require:"ngModel",link:function(i,r,u,f){var e=u[t.DirectiveName];f.$validators[t.DirectiveName]=function(n){if(!!e){var t=i[e];return n===t}return!0};i.$watch(e,function(){f.$validate();i.$broadcast(n.Events.Names.Validation.Refresh)})}}},t.DirectiveName="ejPasswordMatch",t}();t.PasswordMatchValidation=i;i.$inject=[""]})(i=t.Account||(t.Account={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Account.SignInForm,templateUrl:"ng-templates/registered-user-sign-in",scope:!1,link:function(n,t,i){n.SignInSuccessUrl=i.signInSuccessUrl;n.SignInSuccessTarget=i.signInSuccessTarget}}},t.DirectiveName="ejRegisteredUserSignIn",t}();t.RegisteredUserSignIn=i})(i=t.Account||(t.Account={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(t){return{restrict:"A",controller:n.Controllers.Account.SignInDrawerController,link:function(i,r){i.$on(n.Events.Names.Account.SignInDrawer.SignInTypeChanged,function(){for(var f=[],u=1;u<arguments.length;u++)f[u-1]=arguments[u];t(function(){var t=r.closest(".drawer-content").find("a.check-in-drawer-link");t&&(t.click(function(){i.$applyAsync(function(){i.SignInType=n.Data.Account.SignInType.Passenger})}),t.attr("href","javascript:void(0);"),t.attr("tabindex","-1"))})})}}},t.DirectiveName="ejSignInDrawer",t}();t.SignInDrawer=i;i.Factory.$inject=["$timeout"]})(i=t.Account||(t.Account={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(n){return{restrict:"A",link:function(t,i,r){var u=r.ejWatchForAutofill,f=n(u);i.on("animationstart",function(){var n=t.$root.$$phase;n==="$apply"||n==="$digest"?f(u):t.$apply(f)});i.on("animationend",function(){i.off("animationstart")})}}},n.DirectiveName="ejWatchForAutofill",n}();n.WatchForAutofill=t;t.Factory.$inject=["$parse"]})(t=n.Account||(n.Account={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){var t=this;return{restrict:"A",require:"ngModel",link:function(i,r,u,f){var c=r.hasClass("day"),l=r.hasClass("month"),a=r.hasClass("year"),e=0,o=0,s=0,v=function(){var t=i.$eval(u[n.EarliestDateValidationAttribute]),r=Utilities.TimeAgnosticDate.FromParts(s,o,e);return r.DifferenceInDays(t)<0},y=function(){var t=i.$eval(u[n.LatestDateValidationAttribute]),r=Utilities.TimeAgnosticDate.FromParts(s,o,e);return r.DifferenceInDays(t)>0},p=function(t){var r=i.$eval(u[n.DirectiveName]);e=c?t:r.Day;o=l?t:r.Month;s=a?t:r.Year},w=function(){return e>n.NumberOfDaysInMonth(s,o)},h=function(t,i){f.$validators[t]=function(t){return(p(t),n.DateIsComplete(s,o,e)&&i())?!1:!0}};h(n.DirectiveName,w.bind(t));!u[n.LatestDateValidationAttribute]||h(n.LatestDateValidationAttribute,y.bind(t));!u[n.EarliestDateValidationAttribute]||h(n.EarliestDateValidationAttribute,v.bind(t))}}},n.DateIsComplete=function(n,t,i){return!!i&&!!t&&!!n},n.NumberOfDaysInMonth=function(n,t){var i=new Date(n,t,0);return i.getDate()},n.DirectiveName="ejDatePickerValidation",n.EarliestDateValidationAttribute="ejDatePickerEarliestValidDate",n.LatestDateValidationAttribute="ejDatePickerLatestValidDate",n}();n.DatePickerValidation=t;t.Factory.$inject=[]})(t=n.Common||(n.Common={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(t,i){var r=function(){var t=0,r=!1;return angular.element("[ej-edit-section]").each(function(u,f){var e=angular.element(f),o=e.attr("ej-edit-section-selector")||n.DefaultSelector;e.find(o).is(":visible")&&(t++,e.is(i)&&(r=!0))}),t===1&&r};t.$watch(function(){return r()},function(n){t.EditSectionIsVisible=n})}}},n.DirectiveName="ejEditSection",n.EditSectionSelector="ejEditSectionSelector",n.DefaultSelector=".section-content .edit-mode",n}();n.EditSection=t})(t=n.Common||(n.Common={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(t){return{restrict:"A",controller:n.Controllers.Common.EventDrivenContentController,link:function(n,i){n.$watch("Content",function(){var r=i.html(n.Content).text(),u=t(r);i.html(u)})}}},t.DirectiveName="ejEventDrivenContent",t}();t.EventDrivenContent=i;i.Factory.$inject=["$sanitize"]})(i=t.Common||(t.Common={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(i,r,u,f){return{restrict:"A",link:function(){var e=i.GetCookie();!e||(r.Expecting(n.Services.Controls.BookingData.BookingDataSource.FlightConfirmationCookie),u(function(){var t=f.Map(e);r.Received(n.Services.Controls.BookingData.BookingDataSource.FlightConfirmationCookie,t)},t.FlightConfirmationDelay))}}},t.DirectiveName="ejFlightConfirmationBookingData",t.FlightConfirmationDelay=2e3,t}();t.FlightConfirmationBookingData=i;i.Factory.$inject=["FlightConfirmationCookie_Service","Controls_BookingDataService","$timeout","Controls_FlightConfirmationCookieBookingDataMapper"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(n){return{restrict:"A",link:function(t,i,r){t.$watch(r.focus,function(n){n===!0&&i[0].focus()});i.bind("blur",function(){n(function(){t.$apply(r.focus+"=false")},0)});i.bind("focus",function(){n(function(){t.$apply(r.focus+"=true")},0)})}}},n.DirectiveName="focus",n}();n.Focus=t;t.Factory.$inject=["$timeout"]})(t=n.Common||(n.Common={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",scope:null,controller:n.Controllers.Common.SitecoreLanguageCookie}},t.DirectiveName="ejLanguageCookie",t}();t.SitecoreLanguageCookie=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",scope:!1,link:function(n,t){n.SetFocusOnTriggerEdit=function(){t.find(".section-content .edit-mode :focusable").first().focus()};n.SetFocusOnContinue=function(){var n=angular.element(".review-section"),i=n.index(t),r=null,u;i>-1&&n.length>i+1?(u=angular.element(n[i+1]),r=u.find(":focusable").first()):r=t.find(".trigger-link button");r.focus()}}}},n.DirectiveName="ejReviewSectionFocus",n}();n.ReviewSectionFocus=t})(t=n.Common||(n.Common={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Controls.BookingLinkBlock,scope:{},transclude:!0,link:function(n,t,i,r,u){n.LinkTarget=i.linkTarget;n.TrackingKey=i.trackingKey;n.DateFormat=i.dateFormat;n.TimeFormat=i.timeFormat;!n.BuildViewModel||n.BuildViewModel();u(n,function(n){t.append(n)})}}},t.DirectiveName="ejBookingLinkBlock",t}();t.BookingLinkBlockDirective=i})(i=t.Content||(t.Content={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",require:"^form",scope:{},link:function(t,i,r,u){t.FormController=u;t.$on(n.Events.Names.NavigationService.ChangeStart,function(i,r){if(t.FormController.$dirty){i.preventDefault();var u={StyleSecondButtonAsDismissOption:!0,OnAccept:function(){n.Events.Fire(n.Events.Names.Drawer.Close)},OnReject:function(){window.location.href=r}},f={SectionKey:"registration-incomplete-warning-drawer",Parameters:u};n.Events.OpenDrawerWithOptions(f)}})}}},t.DirectiveName="ejIncompleteFormWarning",t}();t.IncompleteFormWarning=i})(i=t.Content||(t.Content={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(i,r){return{restrict:"A",link:function(u,f){i(function(){t.AddInterceptor(t.FindPageLinks(f),r)},0);u.$on(n.Events.Names.Drawer.SectionCreated,function(n,i){t.AddInterceptor(t.FindDrawerLinks(i),r)})}}},t.GetHrefAttribute=function(n){return n.attr("href")},t.IsNavigationLink=function(n){var i=t.GetHrefAttribute(n);return!(i==="#"||i==="javascript:void(0);"||i==null)},t.FindPageLinks=function(n){return n.parents("body").find("a")},t.FindDrawerLinks=function(n){return n.find("a")},t.AddInterceptor=function(n,i){n.each(function(n,r){t.IsNavigationLink($jq(r))&&$jq(r).click(function(n){if(!n.isDefaultPrevented())return i.NavigateTo(t.GetHrefAttribute($jq(r))),n.preventDefault(),!1})})},t.DirectiveName="ejNavigationAnchorInterceptor",t}();t.NavigationAnchorInterceptor=i;i.Factory.$inject=["$timeout","Common_NavigationService"]})(i=t.Content||(t.Content={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",scope:!0,link:function(n,t,i){var r=i.backgroundImage,u=i.mobileBackgroundImage,f=i.backgroundColour;n.BackgroundImage=Main3.Common.BreakPointService.IsMobile()?u:r;n.ShowBackgroundImage=function(){n.BackgroundImage=r};n.ShowMobileBackgroundImage=function(){n.BackgroundImage=u};n.BackgroundStyle=function(){var t=f;return n.BackgroundImage&&(t+=" url("+n.BackgroundImage+") top right"),{background:t}}}}},n.DirectiveName="ejStretch",n}();n.StretchDirective=t})(t=n.Shelves||(n.Shelves={}))})(t=n.Content||(n.Content={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var i=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(n,i){var u=$jq(i),f,r;u.addClass("advanced-radio-buttons");f=$jq(u).find("input:radio");r=[];$jq(f).each(function(n,i){var f=$jq(i);r.push(new t(u,f))});n.$watch(function(){for(var n=0;n<r.length;n++)r[n].Update()})}}},n.DirectiveName="ejAdvancedRadioButtons",n}(),t;n.AdvancedRadioButtons=i;i.Factory.$inject=["$compile"];t=function(){function n(n,t){this._parent=n;this._radioButton=t;this.Initialise();this.AttachEventListeners()}return n.prototype.IsChecked=function(){return!!this._radioButton.attr("checked")},n.prototype.Update=function(){this.IsChecked()?this.CheckAdvancedInput():this.UncheckAdvancedInput()},n.prototype.Initialise=function(){this._radioButton.addClass("access-hidden");var n=!!this._radioButton.attr("checked");this._fakeRadioButton=this.BuildFakeRadio(n);this._fakeRadioImage=this._fakeRadioButton.find(".radio");this._fakeRadioButton.insertAfter(this._radioButton)},n.prototype.BuildFakeRadio=function(n){var r=this._radioButton.siblings("label").text().trim(),t=$jq("<a>").attr({title:r,href:"#"}).addClass("advanced-radio"),i=$jq("<span>").addClass("radio");return n&&i.addClass("radio-checked"),t.append(i),t},n.prototype.AttachEventListeners=function(){this._radioButton.on("click",this.HandleRadioButtonChange.bind(this));this._fakeRadioButton.on("click",this.HandleClick.bind(this)).on("keydown",this.HandleKeydown.bind(this))},n.prototype.HandleClick=function(n){n.preventDefault();this.IsChecked()||this._radioButton.click()},n.prototype.HandleRadioButtonChange=function(){this.Update()},n.prototype.ResetRadioGroup=function(){this._parent.find(".radio").removeClass("radio-checked");this._parent.find("input:checked").attr("checked",!1)},n.prototype.CheckRadioInput=function(){this._radioButton.attr("checked",!0)},n.prototype.CheckAdvancedInput=function(){this._fakeRadioImage.addClass("radio-checked")},n.prototype.UncheckAdvancedInput=function(){this._fakeRadioImage.removeClass("radio-checked")},n.prototype.HandleKeydown=function(n){n.which==32&&this._fakeRadioButton.trigger("click")},n}();n.AdvancedRadioButtonsButton=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",templateUrl:"ng-templates/button-grid",controller:n.Controllers.Controls.ButtonGrid,scope:{ButtonDtos:"=buttons",ClickFunction:"=click"}}},t.DirectiveName="ejButtonGrid",t}();t.ButtonGrid=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"C",link:function(n,t,i){var r=t.children("input:first"),f=t.children("label:first"),e,u;if(f.wrapInner($jq("<span>").addClass("checkbox-label-text")),f.prepend($jq("<span>").addClass("checkbox-container").append($jq("<span>").addClass("checkbox").html("&#10003;").attr("unselectable","on").attr("aria-hidden","true"))),r.is("[ng-model]")?(e=r.attr("ng-model"),n.$watch(e,function(n){n?t.addClass("checked"):t.removeClass("checked")})):n.$watch(function(){return r.is(":checked")},function(n){n?t.addClass("checked"):t.removeClass("checked")}),n.$watch(function(){return r.is(":disabled")},function(n){n?t.addClass("disabled"):t.removeClass("disabled")}),i.ejFireCheckboxClick===""&&r.attr("ng-click")){u=function(n){!n.srcElement||n.srcElement.tagName==="button"||(n.preventDefault(),n.stopPropagation(),r.triggerHandler("click"))};t.on("click",u);t.on("keyup",function(n){n.keyCode===32&&u(n)})}i.ejFireHover===""&&t.hover(function(){t.find(".checkbox").addClass("hover")},function(){t.find(".checkbox").removeClass("hover")})}}},n.DirectiveName="ejCheckbox",n}();n.Checkbox=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{link:function(t,i,r){var u=t.$eval(r[n.DirectiveName]),e=new Main3.Content.DelayedMasking({MaskingCharacter:unescape(u.MaskingCharacter),IntervalMs:u.IntervalMs,ShowLastCharacterMs:u.LastCharacterMs,GetDisplayValue:function(){return i.val()},SetDisplayValue:function(n){i.val(n)},GetHiddenValue:function(){var i=n.GetNgModelForLinkedField(t,u.HiddenValueId);return i.$viewValue},SetHiddenValue:function(i){var r=n.GetNgModelForLinkedField(t,u.HiddenValueId);r.$setViewValue(i)},GetCaretPosition:function(){return n.GetCaretSelectionPosition(i[0])},SetCaretPosition:function(t){n.SetCaretSelectionPosition(i[0],t)}}),f=null,o=function(){f=setInterval(function(){e.RunLastCharacterTimeout()},u.BackgroundIntervalMs)};i.on("focus",function(){!f||(clearInterval(f),f=null);e.Focus()});i.on("blur",function(){e.Blur();o()});o()}}},n.GetNgModelForLinkedField=function(n,t){var i=$jq("#"+t+"[name]"),r=i.closest("form[name]");return n[r.attr("name")][i.attr("name")]},n.GetCaretSelectionPosition=function(n){var t={start:0,end:0};if(n.setSelectionRange)t.start=n.selectionStart,t.end=n.selectionEnd;else if(n.createTextRange){var u=document.selection.createRange().getBookmark(),i=n.createTextRange(),r=i.duplicate();i.moveToBookmark(u);r.setEndPoint("EndToStart",i);t.start=r.text.length;t.end=t.start+i.text.length}return t},n.SetCaretSelectionPosition=function(n,t){if(n.setSelectionRange)n.setSelectionRange(t.start,t.end);else if(n.createTextRange){var i=n.createTextRange();i.collapse(!0);i.moveEnd("character",t.end);i.moveStart("character",t.start);i.select()}},n.DirectiveName="ejDelayedMasking",n}();n.DelayedMasking=t;t.Factory.$inject=[]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(i){return{link:function(r,u,f){var o=f[t.InitialKey],s=f[t.Category],h=f[t.Action],e=new Main3.Drawers.DrawerTabsController(u,i,s,h);e.Initialize(o);e.OnTabChanged.add(function(t){r.$apply(function(){r.$broadcast(n.Events.Names.TouchScroll.Reset);r.$parent.$broadcast(n.Events.Names.Drawer.TabChanged,t)})});r.$watch(function(){return u.height()},function(){e.ResizeTabButtons()});r.$on(n.Events.Names.Drawer.ActivateTab,function(n,t){e.ActivateTab(t);e.ResizeTabButtons()});$jq(window).resize(function(){e.ResizeTabButtons()})}}},t.DirectiveName="ejDrawerTabs",t.InitialKey="ejDrawerTabsInitialKey",t.Category="ejDrawerTabsCategory",t.Action="ejDrawerTabsAction",t}();t.DrawerTabs=i;i.Factory.$inject=["IAnalyticsTracker","$window","$timeout"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"AE",link:function(n,t){var r=t.find("div.basket-header"),i=t.find(".basket-content"),u=n.$watch(function(){return r.height()},function(n,t){if(n>t){var f=r.height();i.css("top",f+20+"px");i.show();u()}else i.hide()})}}},n.DirectiveName="ejDynamicBasketHeaderHeight",n}();n.DynamicBasketHeaderHeight=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(t,i,r){var u=r[n.DirectiveName];t.$watch(u,function(t){var f="",o=r[n.InputFormatAttribute]||"",s=r[n.OutputFormatAttribute]||"DD-MM-YYYY",h=i.is("[ej-date-markup]"),u,e;if(t||!i.is("[ej-date-skip-empty]")){if(t=t||null,t instanceof Utilities.ZonelessDateTime)f=t.Format(s);else{if(u=null,moment.isMoment(t))u=t;else if(t instanceof Utilities.TimeAgnosticDate)u=t.ToStartOfDayLocal();else try{u=o?moment(t,o):moment(t)}catch(c){}u&&(e=r[n.EmptyTextAttribute],f=!u.isValid()&&e?e:u.format(s))}f?h?i.html(f):i.text(f):console.warn("Unknown value type in ejDate directive")}})}}},n.DirectiveName="ejDate",n.EmptyTextAttribute="ejDateEmptyText",n.InputFormatAttribute="ejDateInputFormat",n.OutputFormatAttribute="ejDateOutputFormat",n.ShowEmptyForEmptyDateAttribute="ejShowEmptyForEmptyDate",n.WithMarkupAttribute="ejWithMarkup",n}();n.EjDate=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(i){return{restrict:"A",require:"ngModel",link:function(r,u,f,e){var s=f[t.DirectiveName],o=function(n,i){e.$validators[t.DirectiveName+n]=function(){return r[s]!==i}};o(t.InvalidNumber,n.Data.Common.EjPlusCardStatus.InvalidNumber);o(t.IncorrectName,n.Data.Common.EjPlusCardStatus.IncorrectName);o(t.Expired,n.Data.Common.EjPlusCardStatus.Expired);e.$validators[t.DirectiveName+t.Staff]=function(n){if(!!n){var t=i.IsStaffCard(n);return!t}return!0};u.on("input",function(){r[s]=n.Data.Common.EjPlusCardStatus.Valid});r.$watch(f[t.DirectiveName],function(t,i){t!=i&&(e.$setTouched(),r.$broadcast(n.Events.Names.Validation.Validate,u))})}}},t.DirectiveName="ejPlusValidation",t.InvalidNumber="InvalidNumber",t.IncorrectName="IncorrectName",t.Expired="Expired",t.Staff="Staff",t}();t.EjPlusValidation=i;i.Factory.$inject=["Funnel_EjPlusService"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(t){return{restrict:"A",link:function(i,r,u){var f=r.find("input[type='text']"),e=r.find("input[type='submit']"),o=u[n.UrlAttribute]||"",s=u[n.QueryAttribute]||"",h=function(n){t.NavigateTo(n)},c=new Search.FacetedPageSearch.Standalone.SearchForm(f,e,s,o,h)}}},n.DirectiveName="ejFaqSearchBox",n.UrlAttribute="ejFaqSearchBoxUrl",n.QueryAttribute="ejFaqSearchBoxQuery",n}();n.FaqSearchBox=t;t.Factory.$inject=["Common_NavigationService"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",templateUrl:"ng-templates/flight-card",controller:n.Controllers.Controls.FlightCard,require:"?^ejPickFlightPanel",scope:{Flight:"=flight",Route:"=route",ShowStatusText:"=showStatusText",EnableAlternativeOriginLink:"=?enableAlternativeOriginLink",EnableAlternativeDestinationLink:"=?enableAlternativeDestinationLink",ShowLowFareFinder:"=?showLowFareFinder",IsReturnFlightCard:"=?isReturnSegment",ShowMessageCarousel:"=?showMessageCarousel",ShowAccessibleTitle:"=?showAccessibleTitle",HeaderId:"=?headerId",FocusTitle:"=?focusTitle",PositionText:"=?positionText"},link:function(n,t,i,r){r&&(n.FlightGridJourneyChange=r.FlightGridJourneyChange.bind(r))}}},t.DirectiveName="ejFlightCard",t}();t.FlightCard=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",templateUrl:"ng-templates/flight-grid",controller:n.Controllers.Controls.FlightGrid,scope:{IsTemporarilyDisabled:"=isTemporarilyDisabled",ShowFlexiFares:"=showFlexiFares",ShowPastFlights:"=showPastFlights",ShowChildPrices:"=showChildPrices",OriginalFlight:"=originalFlight",ReplacementFlight:"=replacementFlight",Route:"=route",FocalDate:"=focalDate",ChosenFare:"=chosenFare",MinimumDate:"=minDate",MaximumDate:"=maxDate",IsReturnSegment:"=isReturnSegment",ShowFlightDirectionHelpText:"=showFlightDirectionHelpText",IsOneWayJourney:"=isOneWayJourney",AriaAlertOnRouteChange:"=ariaAlertOnRouteChange",FlightIsSelectedInOtherPairs:"=flightIsSelectedInOtherPairs",SelectedFlightSkipLinkType:"=selectedFlightSkipLinkType"},link:{pre:function(n,t,i,r){var u=function(t){n.$applyAsync(t)},f=new Main3.FlightGrid.AnimatingFlightUpserter(t,u);r.StartUp(f)}}}},t.DirectiveName="ejFlightGrid",t}();t.FlightGrid=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",controller:n.Controllers.Controls.FlightGridFlight,templateUrl:"ng-templates/flight-grid-flight",scope:{Flight:"=flight",ShowChildPrices:"=showChildPrices",Selectable:"=selectable",OnFareSelect:"=onFareSelect",ShowFareTitles:"=showFareTitles",IsReturnSegment:"=isReturnSegment",ShowFlightDirectionHelpText:"=showFlightDirectionHelpText",MinimumDate:"=minDate",MaximumDate:"=maxDate",FlightIsSelectedInOtherPairs:"=flightIsSelectedInOtherPairs",SelectedFlightSkipLinkType:"=selectedFlightSkipLinkType"}}},t.DirectiveName="ejFlightGridFlight",t}();t.FlightGridFlight=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",templateUrl:"ng-templates/flight-passengers",controller:n.Controllers.Controls.FlightPassengers,scope:{Passengers:"=passengers",Flight:"=flight",Luggage:"=luggage",IgnoreSeatReservations:"=ignoreSeatReservations",Ancillaries:"=ancillaries"}}},t.DirectiveName="ejFlightPassengers",t}();t.FlightPassengers=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",templateUrl:"ng-templates/flight-search",controller:n.Controllers.Controls.FlightSearch,scope:{InitialFlight:"=initialFlight",IsVisible:"&isVisible",GroupId:"@groupId"}}},t.DirectiveName="ejFlightSearch",t}();t.FlightSearch=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"AE",link:function(n,t,i){var o=i.ejInputId,r=i.ejUseOutlineWrapper,u=$jq('input[id="'+o+'"]'),s=$jq('label[for="'+o+'"]'),f=!1,e,h;r&&t.addClass("ej-input-wrapper-with-outline");u.focus(function(){e()});u.blur(function(){h()});t.click(function(){e()});e=function(){f||(s.hide(),u.select(),f=!0,r&&t.addClass("active"))};h=function(){s.show();f=!1;r&&t.removeClass("active")}}}},n.DirectiveName="ejInputWithInnerLabelWrapper",n}();n.InputWithInnerLabel=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"AE",templateUrl:"ng-templates/manage-flight-call-to-action-settings",scope:{ClientBooking:"=clientBooking"}}},n.DirectiveName="ejManageFlight",n}();n.ManageFlightCallToAction=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(i){return{restrict:"A",templateUrl:"ng-templates/message-carousel",controller:n.Controllers.Controls.MessageCarouselController,scope:{Key:"=ejMessageCarouselKey",CycleSeconds:"@?ejMessageCarouselCycleSeconds"},link:function(n,r,u){t.SetDefaultScopeValues(n,u);var f=t.GetFirstChild(r);i(function(){if(t.ElementNotSet(f)&&(f=t.GetFirstChild(r)),t.HasMultipleChildren(r)){var n=t.GetNextChild(f,r);f.fadeOut(t.FadeDuration,t.FadeEasing,function(){n.fadeIn(t.FadeDuration,t.FadeEasing);f=n})}},n.CycleSeconds*1e3)}}},t.ElementNotSet=function(n){return!n||n.length==0?!0:!1},t.HasMultipleChildren=function(n){return t.GetCarouselContainer(n).children().length>1},t.GetFirstChild=function(n){return t.GetCarouselContainer(n).children().first()},t.GetNextChild=function(n,i){var r=n.next();return t.ElementNotSet(r)&&(r=t.GetFirstChild(i)),r},t.GetCarouselContainer=function(n){return n.find(".message-carousel")},t.SetDefaultScopeValues=function(n,t){t.ejMessageCarouselCycleSeconds&&t.ejMessageCarouselCycleSeconds!=0||(n.CycleSeconds=5)},t.DirectiveName="ejMessageCarousel",t.FadeEasing="linear",t.FadeDuration=500,t}();t.MessageCarousel=i;i.Factory.$inject=["$interval"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",require:"?ngModel",compile:function(){return{post:function(t,i,r,u){(bowser.ios||bowser.safari)&&i.is("input[type=text], input[type=number]")&&t.$watch(r[n.DirectiveName],function(n){r.$set("value",n)});n.SetAriaInvalidAttributes(t,i,u)}}}}},n.SetAriaInvalidAttributes=function(t,i,r){if(r){var u=i.closest("form");if(!!u&&u.length>0)u.on("submit",function(){n.CreateAriaInvalidWatch(t,i,r)});else n.CreateAriaInvalidWatch(t,i,r)}},n.CreateAriaInvalidWatch=function(n,t,i){n.$watch(function(){return i.$invalid},function(n){t.attr("aria-invalid",!!n)})},n.DirectiveName="ngModel",n}();n.Model=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",templateUrl:"ng-templates/new-payment-card-details",controller:n.Controllers.Controls.NewPaymentCardDetails,scope:!1}},t.DirectiveName="ejNewPaymentCardDetails",t}();t.NewPaymentCardDetails=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",templateUrl:"ng-templates/passenger-details-person",controller:n.Controllers.Funnel.PassengerDetailsPerson,scope:{Passenger:"=passenger",IsAdult:"=isAdult",IsChild:"=isChild",IsInfant:"=isInfant",PassengerDetailsNumber:"=passengerDetailsNumber",Adults:"=adults"},link:function(n,t){n.ShowAgeSmartMessage=function(){t.find("#"+n.GetInputId("age-dropdown")).focus()};n.$watch(function(){return t.find(".hotel-lead-guest-text").is(":visible")},function(n,i){if(i===!0&&n===!1){var r=t.find(".pre-form-links a:visible, .pre-form-links button:visible").first();r.length===0&&(r=t.find(".ej-input-container .ej-select:visible").first());r.focus()}})}}},t.DirectiveName="ejPassengerDetailsPerson",t}();t.PassengerDetailsPerson=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",scope:{ShowText:"=showText",HideText:"=hideText",PasswordFieldId:"=passwordFieldId"},link:function(n,t){var i=angular.element("#"+n.PasswordFieldId);i||t.hide();n.IsHidden=!0;t.text(n.ShowText);t.click(function(){n.IsHidden?(i.attr("type","text"),t.text(n.HideText),n.IsHidden=!1):(i.attr("type","password"),t.text(n.ShowText),n.IsHidden=!0)})}}},n.DirectiveName="ejPasswordVisibilitySwitcher",n}();n.PasswordVisibilitySwitcher=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",templateUrl:"ng-templates/pick-flight-pair",controller:n.Controllers.Funnel.PickFlightPair,scope:{JourneyPair:"=journeyPair",DisplayedRoutes:"=displayedRoutes",OutboundFlightGridAccessibleHeader:"=outboundFlightGridAccessibleHeader",PassengerComposition:"=passengerComposition",ReturnFlightGridAccessibleHeader:"=returnFlightGridAccessibleHeader",ShowFlexiFares:"=showFlexiFares"}}},t.DirectiveName="ejPickFlightPair",t}();t.PickFlightPair=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",templateUrl:"ng-templates/pick-flight-panel",controller:n.Controllers.Funnel.PickFlightPanel,scope:{PanelInLegIndex:"=panelInLegIndex",JourneySlot:"=journeySlot",JourneyPairId:"=journeyPairId",IsReturnSegment:"=isReturnSegment",IsOneWayJourney:"=isOneWayJourney",ChosenFare:"=chosenFare",Route:"=route",ContainingLegRoute:"=displayedRoute",FocalDate:"=focalDate",PassengerComposition:"=passengerComposition",MinimumDate:"=minDate",MaximumDate:"=maxDate",ShowFlexiFares:"=showFlexiFares",SelectedFlightSkipLinkType:"=selectedFlightSkipLinkType"},link:function(n,t){var i=t.parents(".pick-flights-page");n.ResetGridFocus=function(){var n=i.find("button, a").first();n.focus()}}}},t.DirectiveName="ejPickFlightPanel",t}();t.PickFlightPanel=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(i){return{restrict:"A",link:function(r,u,f){var l=f[t.DirectiveName],a=f[t.AutoSize]==="true",v=f[t.ForceDebit]==="true",y=f[t.ForceCredit]==="true",h=f[t.ApplyRounding]!=="false",p=f[t.HideIfZero]==="true",w=f[t.HideZeroMinor]==="true",c=f[t.DisplayCurrency],e=null,o=null,s=function(){if(p&&k()){t.ClearElement(u);return}var n=b();t.RecreatePriceElement(n,u,r,a,w)},b=function(){if(o!=null)return i.Render(o,h,r.$eval(c));var t;return t=v?n.Data.Common.PaymentType.DebitCard:y?n.Data.Common.PaymentType.CreditCard:i.GetPaymentType(),i.RenderPrice(e,t,h,r.$eval(c))},k=function(){return o===0||!!e&&i.AreEqual(e,i.NewPrice(0,0,0))};r.$watch(l,function(n){typeof n=="number"?o=n:e=n;s()},!0);r.$watch(function(){return i.GetCurrentCurrency()},function(n,t){n!=t&&s()});r.$watch(function(){return i.GetPaymentType()},function(n,t){n!=t&&s()})}}},t.ClearElement=function(n){n&&n.empty()},t.RecreatePriceElement=function(n,t,i,r,u){var f=t.data("Price_visibleWatchRemover"),o,s,e;n&&(f&&(f(),f=null),o=!u||parseInt(n.MinorNumber)!==0,s='<span class="price price-'+n.CurrencyCode.toLowerCase()+'" aria-hidden="true" data-currency="'+n.CurrencyCode.toLowerCase()+'">'+('<span class="before">'+n.Before+"<\/span>")+('<span class="major">'+n.MajorNumber+"<\/span>")+(o?'<span class="separator">'+n.NumberSeparator+'<\/span><span class="minor">'+n.MinorNumber+"<\/span>":"")+('<span class="after">'+n.After+"<\/span>")+"<\/span>"+('<span class="access-hidden">'+n.Before+n.MajorNumber+n.NumberSeparator+n.MinorNumber+n.After+"<\/span>"),t.empty(),t.html(s),e=t.find(".price"),r&&(f=i.$watch(function(){return e.is(":visible")},function(n){n&&(e.bigText({horizontalAlign:"left",verticalAlign:"center",maximumFontSize:13}),f&&(f(),f=null))}),t.data("Price_visibleWatchRemover",f)))},t.DirectiveName="ejPrice",t.AutoSize="ejPriceAutoSize",t.ForceCredit="ejPriceForceCredit",t.ForceDebit="ejPriceForceDebit",t.HideIfZero="ejPriceHideIfZero",t.HideZeroMinor="ejPriceHideZeroMinor",t.ApplyRounding="ejPriceApplyRounding",t.DisplayCurrency="ejPriceCurrency",t}();t.Price=i;i.Factory.$inject=["Common_PriceService"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(t){return{restrict:"A",link:function(i,r,u){var e=u[n.DirectiveName],o=u[n.PriceSourceName],s=u[n.ContentName],h=u[n.Escape]!=="false",f;e&&o&&s&&(f=i.$eval(s),f&&(h&&(f=_.escape(f)),f=f.replace(e,'\n<span ej-price="'+o+'" ej-price-apply-rounding="false" class="price"><\/span>'),r.html(f),t(r.contents())(i)))}}},n.DirectiveName="ejPriceToken",n.PriceSourceName="ejPriceTokenSrc",n.ContentName="ejPriceTokenContent",n.Escape="ejPriceTokenEscape",n}();n.PriceToken=t;t.Factory.$inject=["$compile"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",templateUrl:"ng-templates/quantity-selector",controller:n.Controllers.Controls.QuantitySelectorController,scope:{CanIncrementQuantity:"=ejQuantitySelectorCanIncrement",CanDecrementQuantity:"=ejQuantitySelectorCanDecrement",InputName:"=?ejQuantitySelectorInputName",InputId:"=?ejQuantitySelectorInputId",OnInvalidQuantity:"=?ejQuantitySelectorOnInvalidQuantity",OnInvalidIncrement:"=?ejQuantitySelectorOnInvalidIncrement",OnInvalidDecrement:"=?ejQuantitySelectorOnInvalidDecrement",Quantity:"=ejQuantitySelectorQuantity",Validation:"=ejQuantitySelectorValidation",FireIncrementAnalyticsEvent:"=?ejQuantitySelectorIncrementAnalyticsEvent",FireDecrementAnalyticsEvent:"=?ejQuantitySelectorDecrementAnalyticsEvent"},compile:function(n,t){return{pre:function(){},post:function(n){t.ejQuantitySelectorOnInvalidQuantity||(n.OnInvalidQuantity=function(){});t.ejQuantitySelectorOnInvalidIncrement||(n.OnInvalidIncrement=function(){});t.ejQuantitySelectorOnInvalidDecrement||(n.OnInvalidDecrement=function(){});t.ejQuantitySelectorIncrementAnalyticsEvent||(n.FireIncrementAnalyticsEvent=function(){});t.ejQuantitySelectorDecrementAnalyticsEvent||(n.FireDecrementAnalyticsEvent=function(){})}}}}},t.DirectiveName="ejQuantitySelector",t}();t.QuantitySelector=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"C",link:function(t,i){var r=i.children("input:first"),f=i.children("label:first"),u,e;f.wrapInner($jq("<span>").addClass("radio-label-text"));f.prepend($jq("<span>").addClass("radio-container").attr("aria-hidden","true").append($jq("<span>").addClass("radio").attr("unselectable","on")));r.is("[ng-model]")&&(u=r.attr("ng-model"),e=t.$watch(u,function(){var f=t.$eval(r.attr("ng-value")),o=r.attr("value");e();t.$watch(u,function(t){f!=undefined?n.SetRadioButtonCssClass(f,t,i):n.SetRadioButtonCssClass(o,t,i)})}));t.$watch(function(){return r.is(":disabled")},function(n){n?i.addClass("disabled"):i.removeClass("disabled")})}}},n.SetRadioButtonCssClass=function(n,t,i){t==n?i.addClass("checked"):i.removeClass("checked")},n.DirectiveName="ejRadio",n}();n.Radio=t})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Controls.RouteMessages.RouteMessagesContent,transclude:!0,scope:{SubscriberGroup:"@subscriberGroup"},link:function(n,t,i,r,u){u(n,function(n){t.append(n)})}}},t.DirectiveName="ejRouteMessages",t}();t.RouteMessages=i;i.Factory.$inject=[]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var i=System.Guid,t=function(){function n(){}return n.Factory=function(t){return{restrict:"A",link:function(r,u,f){if(f[n.RuleContent]!=="null"){var e=i.MakeNew(),o={ItemId:e.ToCleanString(),ItemRules:[JSON.parse(f[n.RuleContent])]};t.Subscribe(function(n){var t=Main3.SitecoreRules.Pipeline.PipelineRunner.RunPipeline(o,new Main3.SitecoreRules.Rules.Pipelines.Args.BookingRulePipelineArgs(n));t.Matched?u.show():u.hide()})}}}},n.DirectiveName="ruleBasedContent",n.RuleContent="ruleContent",n}();n.RuleBasedContent=t;t.Factory.$inject=["Common_RuleBasedContentService"]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",templateUrl:"ng-templates/saved-payment-card-details",controller:n.Controllers.Controls.SavedPaymentCardDetails,scope:!1}},t.DirectiveName="ejSavedPaymentCardDetails",t}();t.SavedPaymentCardDetails=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",templateUrl:"ng-templates/sepa-payment-details",controller:n.Controllers.Controls.SepaPaymentDetails,scope:!1}},t.DirectiveName="ejSepaPaymentDetails",t}();t.SepaPaymentDetails=i})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(t,i,r,u){return{restrict:"A",link:function(f){!r.EnsightenUrl||f.$on(n.Events.Names.Funnel.FunnelReady,function(){i.dataLayer=u.GetEnsightenData();var n=angular.element("<script><\/script>");n.attr("type","text/javascript");n.attr("src",r.EnsightenUrl);n.appendTo(t.find("head"))})}}},t.DirectiveName="ejAnalyticsScript",t}();t.AnalyticsScript=i;i.Factory.$inject=["$document","$window","Sitecore_AnalyticsSettings","EnsightenData_Service"]})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",templateUrl:"ng-templates/funnel-car-child-seat-type-quantity-selector",controller:n.Controllers.Funnel.CarChildSeatTypeQuantitySelector,scope:{Code:"=seatTypeCode",Maximum:"=maximumQuantity",Quantity:"=quantity",IsValid:"=isValid",InputId:"=inputId"}}},t.DirectiveName="ejCarChildSeatTypeQuantitySelector",t}();t.CarChildSeatTypeQuantitySelector=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",controller:n.Controllers.Funnel.AvailabilityBasketProvider,template:'<div class="availability-basket-wrapper" ng-transclude><\/div>',scope:{JourneyPair:"=journeyPair",PassengerComposition:"=passengerComposition",IncludeFlexiFares:"=includeFlexiFares",IncludePrices:"=includePrices",AutoRefreshDisabled:"=autoRefreshDisabled"},transclude:!0}},t.DirectiveName="ejFunnelAvailabilityBasketProvider",t}();t.FunnelAvailabilityBasketProvider=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",controller:n.Controllers.Funnel.AvailabilityGridProvider,template:'<div class="availability-grid-wrapper" ng-transclude><\/div>',scope:{DisplayedRoutes:"=displayedRoutes",PassengerComposition:"=passengerComposition",IncludeFlexiFares:"=includeFlexiFares",AutoRefreshDisabled:"=autoRefreshDisabled"},transclude:!0}},t.DirectiveName="ejFunnelAvailabilityGridProvider",t}();t.FunnelAvailabilityGridProvider=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.BasketCarsSummary,templateUrl:"ng-templates/funnel-basket-cars-summary"}},t.DirectiveName="ejFunnelBasketCarsSummary",t}();t.FunnelBasketCarsSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",templateUrl:"ng-templates/funnel-basket-fare-passenger",scope:{PassengerType:"@passengerType",ShowFlexiText:"=showFlexiText",PassengerAmount:"=passengerAmount",LinkToChildApdDrawer:"=linkToChildApdDrawer",LinkToInfantFixedPriceDrawer:"=linkToInfantFixedPriceDrawer",Price:"=price"},link:function(t){t.OpenChildApdDrawer=function(){n.Events.OpenDrawer("child-apd-saving")};t.OpenInfantFixedPriceDrawer=function(){n.Events.OpenDrawer("infant-fixed-price")}}}},t.DirectiveName="ejFunnelBasketFarePassenger",t}();t.FunnelBasketFarePassenger=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.BasketHotelSummary,templateUrl:"ng-templates/funnel-basket-hotel-header"}},t.DirectiveName="ejFunnelBasketHotelHeader",t}();t.FunnelBasketHotelHeader=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.BasketHotelSummary,templateUrl:"ng-templates/funnel-basket-hotel-summary"}},t.DirectiveName="ejFunnelBasketHotelSummary",t}();t.FunnelBasketHotelSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.BasketLeg,templateUrl:"ng-templates/funnel-basket-leg",scope:{Slot:"=slot",PassengerComposition:"=passengerComposition",IsReturnLeg:"=isReturnLeg",IsOneWayJourney:"=isOneWayJourney",IsUsingFlexiFare:"=isUsingFlexiFare",JourneyPairId:"=journeyPairId"}}},t.DirectiveName="ejFunnelBasketLeg",t}();t.FunnelBasketLeg=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.BasketLuggageSummary,templateUrl:"ng-templates/funnel-basket-luggage-summary"}},t.DirectiveName="ejFunnelBasketLuggageSummary",t}();t.FunnelBasketLuggageSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.BasketPriceBreakdownDrawer,link:function(n,t){n.ApplyFormatting=function(){setTimeout(function(){var i="section-spacer",n=t.find("table tr.travel-extra-row"),r;!!n&&n.length>0&&(n.removeClass(i),r=n.first(),r.addClass(i))})}}}},t.DirectiveName="ejFunnelBasketPriceBreakdown",t}();t.FunnelBasketPriceBreakdownDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.BasketSeatSummary,templateUrl:"ng-templates/funnel-basket-seat-summary",scope:{FlightInternalId:"=flightId"}}},t.DirectiveName="ejFunnelBasketSeatSummary",t}();t.FunnelBasketSeatSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.BasketSummaryDeleteLink,templateUrl:"ng-templates/funnel-basket-summary-delete-link",scope:{AnalyticsCategory:"@analyticsCategory",DrawerSectionKey:"@drawerSectionKey",AlternativeText:"@alternativeText",DeleteAction:"=deleteAction"}}},t.DirectiveName="ejFunnelBasketDeleteLink",t}();t.FunnelBasketSummaryDeleteLink=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.BasketSummaryEditLink,templateUrl:"ng-templates/funnel-basket-summary-edit-link",scope:{AnalyticsCategory:"@analyticsCategory",DrawerSectionKey:"@drawerSectionKey",RedirectStep:"@redirectStep",AlternativeText:"@alternativeText",EditOverride:"=editOverride",BeforeRedirectAction:"=beforeRedirectAction"}}},t.DirectiveName="ejFunnelBasketEditLink",t}();t.FunnelBasketSummaryEditLink=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.BasketTravelExtrasSummary,templateUrl:"ng-templates/funnel-basket-travel-extras-summary"}},t.DirectiveName="ejFunnelBasketTravelExtrasSummary",t}();t.FunnelBasketTravelExtrasSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.BasketVouchersSummary,templateUrl:"ng-templates/funnel-basket-vouchers-summary",scope:{FlightInternalId:"=flightId"}}},t.DirectiveName="ejFunnelBasketVouchersSummary",t}();t.FunnelBasketVouchersSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.LeadDriverDetails,templateUrl:"ng-templates/funnel-cars-lead-driver-details",scope:{LoadCars:"=loadCarsFunction"}}},t.DirectiveName="ejFunnelCarsLeadDriverDetails",t}();t.FunnelCarsLeadDriverDetails=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.ConfirmationCarsSummary,templateUrl:"ng-templates/funnel-confirmation-cars-summary",scope:{Car:"=car",Booking:"=booking"}}},t.DirectiveName="ejFunnelConfirmationCarSummary",t}();t.FunnelConfirmationCarSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.ConfirmationHotelsSummary,templateUrl:"ng-templates/funnel-confirmation-hotels-summary",scope:{Hotel:"=hotel",BookingNumber:"=bookingNumber",PinCode:"=pinCode"}}},t.DirectiveName="ejFunnelConfirmationHotelSummary",t}();t.FunnelConfirmationHotelSummary=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",templateUrl:"ng-templates/funnel-confirmation-travel-insurance-summary",controller:n.Controllers.Funnel.ConfirmationTravelInsuranceSummary,scope:{TravelInsurance:"=travelInsurance",PolicyNumber:"=policyNumber"}}},t.DirectiveName="ejFunnelConfirmationTravelInsuranceSummary",t}();t.FunnelConfirmationTravelInsurance=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",templateUrl:"ng-templates/funnel-confirmation-voucher-summary",controller:n.Controllers.Funnel.ConfirmationVoucherSummary,scope:{Vouchers:"=vouchers",RedeemableValue:"=redeemableValue",VoucherTotalCount:"=voucherTotalCount"}}},t.DirectiveName="ejFunnelConfirmationVoucherSummary",t}();t.FunnelConfirmationVoucher=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.ExtraPanel,templateUrl:"ng-templates/extra-panel",scope:{Extra:"=extra",RemoveExtraFromAvailablePanels:"=removeExtraFromAvailablePanels"}}},t.DirectiveName="ejExtraPanel",t}();t.FunnelExtraPanel=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",templateUrl:"ng-templates/funnel-flight-passengers",controller:n.Controllers.Controls.FlightPassengers,scope:{Passengers:"=passengers",Flight:"=flight",Luggage:"=luggage",IgnoreSeatReservations:"=ignoreSeatReservations",Ancillaries:"=ancillaries",BookingReference:"=bookingRef"}}},t.DirectiveName="ejFunnelFlightPassengers",t}();t.FunnelFlightPassengers=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",templateUrl:"ng-templates/funnel-finalise-flight-price-change-section",scope:{PriceChange:"=priceChange"}}},n.DirectiveName="ejFunnelFlightPriceChangeSection",n}();n.FunnelFlightPriceChangeSection=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(i){return{restrict:"A",controller:n.Controllers.Funnel.Hotels,template:'<div id="'+t._containerName+'" style="display: none;"><\/div>',link:function(r,u){i.booking={env:{}};r.OnHotelsReady=function(){r.booking=i.booking;r.booking.env.container=t._containerName;r.booking.env.iata=r.ArrivalIata;r.booking.env.depIata=r.DepartureIata;r.booking.env.depDate=r.DepartureDate;r.booking.env.depTime=r.DepartureTime;r.booking.env.arrTime=r.ArrivalTime;r.booking.env.aid=r.AffiliateId;r.booking.env.lang=r.Language;r.booking.env.currency=r.Currency;r.booking.env.checkinFullDate=r.CheckinDate;r.booking.env.checkoutFullDate=r.CheckoutDate;r.booking.env.roomsNumber=r.NumberOfRooms;r.booking.env.adultsNumber=r.NumberOfAdults;r.booking.env.childrenNumber=r.NumberOfChildren;r.booking.env.childrenAges=[];r.booking.env.debug=r.Debug;r.booking.env.hostname=i.location.protocol+"//"+r.HostName;r.booking.env.onLoad=r.OnContentLoaded;u.append("\n\t\t\t\t\t\t\t<script id=\"load-hotels\">\n\t\t\t\t\t\t\t\t(function(d, src, id) {\n\t\t\t\t\t\t\t\t\tvar s = d.createElement('script'),\n\t\t\t\t\t\t\t\t\t\tp = d.getElementsByTagName('script')[0];\n\t\t\t\t\t\t\t\t\ts.type = 'text/javascript';\n\t\t\t\t\t\t\t\t\ts.async = true;\n\t\t\t\t\t\t\t\t\ts.src = src;\n\t\t\t\t\t\t\t\t\ts.id = id;\n\t\t\t\t\t\t\t\t\tp.parentNode.insertBefore(s, p);\n\t\t\t\t\t\t\t\t})(document, '//aff.bstatic.com/static/js/inpath-loader.js');\n\t\t\t\t\t\t\t<\/script>\n\t\t\t\t\t\t")};r.DisplayContent=function(){u.find("#"+t._containerName).attr("style","display: block;");r.BookingInpathIframe=u.find("#"+t._containerName+" iframe")[0]};r.HotelsBasketScreenReader=$jq("#AddToBasketHotelScreenReader");r.$on(n.Events.Names.Drawer.Closing,function(){r.FocusIFrameAfterDrawerClosed&&(r.BookingInpathIframe.contentWindow.focus(),r.FocusIFrameAfterDrawerClosed=!1)})}}},t.DirectiveName="ejFunnelHotels",t._containerName="booking-inpath",t}();t.FunnelHotelsDirective=i;i.Factory.$inject=["$window"]})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.LeadGuestDrawer,scope:{SitecoreDrawerKey:"@"+t.DirectiveName},transclude:!0,link:function(n,t,i,r,u){u(n,function(n){t.append(n)})}}},t.DirectiveName="ejHotelsLeadGuestDrawer",t}();t.FunnelHotelsLeadGuestDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.HotelsMessageDrawer,scope:{AnalyticsAction:"@"+t.DirectiveName,DoConfirm:"=doConfirm"},transclude:!0,link:function(n,t,i,r,u){u(n,function(n){t.append(n)})}}},t.DirectiveName="ejHotelsMessageDrawer",t}();t.FunnelHotelsMessageDrawer=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",templateUrl:"ng-templates/payment-breakdown",controller:n.Controllers.Funnel.PaymentChargeBreakdown,scope:{IsIncludedChargeList:"=isIncludedChargeList"}}},t.DirectiveName="ejFunnelPaymentChargeBreakdown",t}();t.FunnelPaymentChargeBreakdownDirective=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",templateUrl:"ng-templates/passenger-ssr-options",controller:n.Controllers.Funnel.PassengerSsrOptions,scope:{IdSuffix:"=idSuffix",Passenger:"=passenger"},link:function(n,t){n.SetFocusOnEdit=function(){t.find(".passenger-ssrs-checkboxes :focusable").first().focus()};n.SetFocusOnConfirmOrCancel=function(){t.find(".add-edit-ssr-button").focus()}}}},t.DirectiveName="ejPassengerSsrOptions",t}();t.PassengerSsrOptions=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",scope:{},link:function(i,r,u){var e=i.$eval(u[t.DirectiveName]||'{ text: "" }'),o=angular.element(".funnel-step"),f=new Main3.Funnel.SecurePaymentHandler(o,e.text);f.OnSuccess.add(function(t,i){var r={MD:t,SecureId:f.SecureId,PayerAuthResponse:i};n.Events.Fire(n.Events.Names.Funnel.SecurePaymentSuccess,r)});i.$on(n.Events.Names.Funnel.SecurePaymentStart,function(n,t){f.SecureId=t.SecureId;f.MD=t.MD;f.Start(t.RedirectorLink,t.PayerAuthRequest)})}}},t.DirectiveName="ejSecurePayment",t}();t.SecurePayment=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.Luggage.BagWeightOptionsList,templateUrl:"ng-templates/bag-weight-options-list",scope:{OnBagListLoadedPromise:"=listLoaded",OnSelectBag:"=onSelect",MaximumBaggageAllowanceReached:"=limitReached",StandardWeightSubTitle:"@?standardSubtitle",MaximumWeightSubTitle:"@?maximumSubtitle",ShowAveragePrices:"@?showAveragePrices"}}},t.DirectiveName="ejFunnelBagWeightOptionsList",t}();t.FunnelBagWeightOptionsList=i})(i=t.Luggage||(t.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.Luggage.LuggageController,scope:{EnableSkipDrawer:"=?enableSkipDrawer"},transclude:!0,link:function(n,t,i,r,u){u(n,function(n){t.append(n)})}}},t.DirectiveName="ejLuggage",t}();t.FunnelLuggage=i;i.Factory.$inject=["$timeout"]})(i=t.Luggage||(t.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(t){return{restrict:"A",controller:n.Controllers.Funnel.Luggage.FunnelLuggagePageController,link:function(n,i,r){new Main3.Funnel.FunnelLuggagePageLinker(n,i,r,t).Link()}}},t.DirectiveName="ejFunnelLuggagePage",t}();t.FunnelLuggagePage=i;i.Factory.$inject=["$timeout"]})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.SportsEquipmentList,templateUrl:"ng-templates/sports-equipment-list",scope:{OnEquipmentListLoadedPromise:"=listLoaded",OnSelectEquipment:"=onSelect",MaximumSportsEquipmentAllowanceReached:"=limitReached",LargeSportsEquipmentLimitReached:"=largeLimitReached",CannotFindWhatYourAreLookingForButtonText:"@infoDrawerText",ShowAveragePrices:"@?showAveragePrices"}}},t.DirectiveName="ejFunnelSportsEquipmentList",t}();t.FunnelSportsEquipmentList=i})(i=t.Luggage||(t.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Funnel.TravelInsurance.Product,templateUrl:"ng-templates/funnel/insurance/travel-insurance-product",scope:{Product:"=product",GetSelectedProductCode:"=getSelectedProductCode",OnSelectProduct:"=onSelectProduct",OnSelectExtra:"=onSelectExtra",GetTotalPrice:"=getTotalPrice",OnRemoveExtra:"=onRemoveExtra",DrawerSectionKey:"@deleteDrawerSectionKey",SelectedProduct:"=selectedProduct"},link:function(){}}},t.DirectiveName="ejTravelInsuranceProduct",t}();t.Product=i})(i=t.TravelInsurance||(t.TravelInsurance={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",templateUrl:"ng-templates/travelinsurance/selectpassengers",controller:n.Controllers.Funnel.TravelInsurance.SelectPassengersController,scope:{InsuredPassengers:"=insuredPassengers",UpdateQuote:"=updateQuote"}}},t.DirectiveName="ejSelectPassengers",t}();t.SelectPassengers=i})(i=t.TravelInsurance||(t.TravelInsurance={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.ManageBookings.Funnel.BasketSeatChanges,templateUrl:"ng-templates/manage-booking-basket-seat-changes",scope:{Flight:"=ejManageBookingBasketSeatChanges"}}},t.DirectiveName="ejManageBookingBasketSeatChanges",t}();t.ManageBookingBasketSeatChanges=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(t){return{restrict:"A",controller:n.Controllers.ManageBookings.Funnel.LuggageOptions,link:function(n,i){n.$watch(function(){return JSON.stringify(n.Bags)},function(){(n.BagOptions||[]).map(function(t){return t.Quantity=n.CountBagsOfType(t.Bag)})});n.$watch(function(){return JSON.stringify(n.SportsEquipment)},function(){(n.SportsEquipmentOptions||[]).map(function(t){return t.Quantity=n.CountSportsEquipmentOfType(t.SportsEquipment)})});var r=function(){return i.find("ul.luggage-option-list li:not(.ng-hide)")},u=function(n){return angular.element(r()[n])},f=function(){return n.Bags.filter(function(n){return n.IsFlexiFareBag}).length},e=function(){return n.BagOptions.filter(function(n){return n.Quantity>0||n.IsStandardOption}).length},o=function(t){if(!n.Bags||n.Bags.length<=t)return 0;var i=n.Bags[t];return n.BagOptions.filter(function(n){return n.Quantity>0||n.IsStandardOption||n.Bag.Weight===i.Weight}).map(function(n){return n.Bag.Weight}).indexOf(i.Weight)},s=function(t){if(!n.SportsEquipment||n.SportsEquipment.length<=t)return 0;var i=n.SportsEquipment[t];return n.SportsEquipmentOptions.filter(function(n){return n.Quantity>0||n.IsStandardOption||n.SportsEquipment.Code===i.Code}).map(function(n){return n.SportsEquipment.Code}).indexOf(i.Code)},h=function(n){t(function(){var i=u(n),t=i.find(".plus-button");t.length===0&&(t=i.find(".change-weight"));t.focus()},100)};n.SetFocusAfterLuggageItemRemoved=function(n,t){if(!Device.IsTouchDevice()){var i=f();i+=t?e()+s(n):o(n);h(i-1)}}}}},t.DirectiveName="ejManageBookingLuggageOptions",t}();t.ManageBookingFunnelLuggageOptions=i;i.Factory.$inject=["$timeout"]})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.ManageBooking.Funnel.Luggage.Luggage,scope:{EnableSkipDrawer:"=?enableSkipDrawer"},transclude:!0,link:function(n,t,i,r,u){u(n,function(n){t.append(n)})}}},t.DirectiveName="ejManageBookingLuggage",t}();t.ManageBookingFunnelLuggage=i;i.Factory.$inject=["$timeout"]})(i=t.Luggage||(t.Luggage={}))})(i=t.ManageBookingFunnel||(t.ManageBookingFunnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",controller:n.Controllers.Rebooking.AvailabilityGridProvider,template:'<div class="availability-grid-wrapper" ng-transclude><\/div>',scope:{DisplayedRoutes:"=displayedRoutes",PassengerComposition:"=passengerComposition",IncludeFlexiFares:"=includeFlexiFares",AutoRefreshDisabled:"=autoRefreshDisabled"},transclude:!0}},t.DirectiveName="ejRebookingAvailabilityGridProvider",t}();t.RebookingAvailabilityGridProvider=i})(i=t.Rebooking||(t.Rebooking={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",templateUrl:"ng-templates/return-route-date-picker",controller:n.Controllers.Controls.RouteDatePicker.ReturnRouteDatePicker,scope:{OriginIata:"=originIata",DestinationIata:"=destinationIata",DepartureDate:"=departureDate",ReturnDate:"=returnDate",IsOneWayFlight:"=isOneWayFlight",DrawerTitles:"=?drawerTitles",AnalyticsCategory:"=analyticsCategory",AnalyticsAction:"=analyticsAction"}}},t.DirectiveName="ejReturnRouteDatePicker",t}();t.ReturnRouteDatePicker=i})(i=t.RouteDatePicker||(t.RouteDatePicker={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"AE",templateUrl:"ng-templates/route-date-picker",controller:n.Controllers.Controls.RouteDatePicker.RouteDatePicker,scope:{OriginIata:"=originIata",DestinationIata:"=destinationIata",IsOneWayFlight:"=isOneWayFlight",Date:"=date",StartDate:"=startDate",EndDate:"=endDate",IsReturnDate:"@?isReturnDate",DrawerTitleOverride:"=?drawerTitle",LowestFareFinderEnabled:"=lowestFareFinderEnabled",AnalyticsCategory:"=analyticsCategory",AnalyticsAction:"=analyticsAction",GroupId:"@groupId"}}},t.DirectiveName="ejRouteDatePicker",t}();t.RouteDatePicker=i})(i=t.RouteDatePicker||(t.RouteDatePicker={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Controls.RouteDatePicker.RouteDatePickerLowestFares,scope:{OnSelect:"=dateSelected",LowestFaresParameters:"=parameters",DelayLoad:"=delayLoad",IsReturn:"=isReturn"},templateUrl:"ng-templates/routeDatePicker/lowestFares",link:function(n,t){n.Element=t}}},t.DirectiveName="ejRouteDatePickerLowestFares",t}();t.RouteDatePickerLowestFares=i})(i=t.RouteDatePicker||(t.RouteDatePicker={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{controller:n.Controllers.Controls.SearchPod.SearchPassengersController,restrict:"AE",templateUrl:"ng-templates/search-passengers",scope:{Passengers:"=searchPassengers"}}},t.DirectiveName="ejSearchPassengers",t}();t.SearchPassengers=i})(i=t.SearchPod||(t.SearchPod={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=n.Controllers.Controls.SearchPod,r=function(){function n(){}return n.Factory=function(){return{controller:i.SearchPassengerGroupController,require:[n.DirectiveName,"^ejSearchPassengers"],restrict:"AE",templateUrl:"ng-templates/search-passengers-group",scope:{Type:"@passengerType",Label:"@passengerLabel"},link:function(n,t,i,r){var f=r[0],u=r[1];f.PassengersViewModel=u.PassengersViewModel[n.Type];n.Passengers=u.Passengers;n.Identifier=Math.floor(Math.random()*1e6)}}},n.DirectiveName="ejSearchPassengersGroup",n}();t.SearchPassengersGroup=r})(i=t.SearchPod||(t.SearchPod={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{controller:n.Controllers.Controls.SearchPod.SearchPodController,restrict:"A",scope:!1,link:function(n,t){n.FormElement=t}}},t.DirectiveName="ejSearchPod",t}();t.SearchPod=i})(i=t.SearchPod||(t.SearchPod={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.Controls.SearchPod.SearchPodPackageHolidaysButtonController,scope:{SearchPodModel:"=searchModel"},link:function(){}}},t.DirectiveName="ejSearchPodPackageHolidaysButton",t}();t.SearchPodPackageHolidaysButton=i;i.Factory.$inject=[]})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(i,r){return{restrict:"A",templateUrl:"ng-templates/added-to-basket-smart-message",scope:{DurationMilliseconds:"=durationMilliseconds",ShowOnDesktop:"=enabledOnDesktop",ShowOnTablet:"=enabledOnTablet",ShowOnMobile:"=enabledOnMobile"},link:function(u,f,e){var h=parseInt(e[t.DurationAttributeName]),o=t.CreateQTip(f,u,r),c=$jq(window).width(),s;$jq(window).on("debouncedresize",function(){o&&c!==$jq(window).width()&&(o.destroy(),o=t.CreateQTip(f,u,r))});s=null;i.$on(n.Events.Names.Funnel.FlightAddedToBasket,function(){o&&(f.data("AddedToBasketMessage.IsAnimatingIn")||o.show(),s&&clearTimeout(s),s=setTimeout(function(){o.hide()},h))})}}},t.CreateQTip=function(n,i,r){var f=t.BuildQTipOptions(n,r),u=!1;return Main3.Common.BreakPointService.IsDesktop()?u=i.ShowOnDesktop:Main3.Common.BreakPointService.IsTablet()?u=i.ShowOnTablet:Main3.Common.BreakPointService.IsMobile()&&(u=i.ShowOnMobile),u?(n.qtip(f),n.qtip("api")):null},t.BuildQTipOptions=function(n,t){var i={show:{event:"",effect:function(){n.data("AddedToBasketMessage.IsAnimatingIn",!0);$jq(this).fadeIn(500,"linear",function(){n.data("AddedToBasketMessage.IsAnimatingIn",!1)})}},hide:{event:"",effect:function(){$jq(this).fadeOut(500)}},content:{text:n.clone()},style:{classes:"ej-qtip-smart-message ej-qtip-smart-message-fixed ej-qtip-above-header"},events:{render:function(n,i){t.SetDefaultAriaAttributesOnQtip(i)}}};return Main3.Common.BreakPointService.IsDesktop()?(i.position={at:"top left",my:"center right",target:$jq(".basket"),viewport:$jq(".page-wrapper")},i.style.tip={width:15,height:8}):(i.position={at:"bottom right",my:"top center",target:$jq(".main-header"),viewport:$jq(".page-wrapper"),adjust:{scroll:!1}},i.style.classes=i.style.classes+" ej-qtip-top-override",i.style.tip={width:15,height:8,corner:"top center"}),i},t.DirectiveName="ejFunnelAddedToBasketMessage",t.DurationAttributeName="durationMilliseconds",t.EnabledOnDesktopAttributeName="enabledOnDesktop",t.EnabledOnTabletAttributeName="enabledOnTablet",t.EnabledOnMobileAttributeName="enabledOnMobile",t}();t.AddedToBasketMessage=i;i.Factory.$inject=["$rootScope","SmartMessage_Service"]})(i=t.SmartMessages||(t.SmartMessages={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",scope:{},link:function(t,i,r){var u=r[n.DirectiveName];n.CreateQTip(i,u)}}},n.CreateQTip=function(t,i){t.qtip(n.BuildQTipOptions(t,i))},n.BuildQTipOptions=function(n,t){return{show:{event:"focus",effect:function(){n.data("AgeAtTimeOfTravelMessage.IsAnimatingIn",!0);$jq(this).fadeIn(500,"linear",function(){n.data("AgeAtTimeOfTravelMessage.IsAnimatingIn",!1)})}},hide:{event:"focusout",effect:function(){$jq(this).fadeOut(500)}},content:{text:t},position:{viewport:$jq(".page-content"),adjust:{method:"shift shift"},at:"top center",my:"bottom center"},style:{classes:"ej-qtip-smart-message ej-qtip-age-at-time-of-travel-smart-message",tip:{width:15,height:8}}}},n.DirectiveName="ejFunnelAgeAtTimeOfTravelMessage",n}();n.AgeAtTimeOfTravelMessage=t})(t=n.SmartMessages||(n.SmartMessages={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(i){return{restrict:"AE",templateUrl:"ng-templates/flight-grid-message",controller:n.Controllers.SmartMessages.FlightGridMessage,require:"?^ejPickFlightPanel",scope:{Route:"=route",DesktopAndTabletDelayDurationMilliseconds:"=desktopAndTabletDelayDurationMilliseconds",MobileDelayDurationMilliseconds:"=mobileDelayDurationMilliseconds"},link:function(n,r,u,f){f&&(n.FlightGridJourneyChange=f.FlightGridJourneyChange.bind(f));var o=t.CreateContainer(r),e=t.CreateQTip(r,o,i);n.ShowMessage=function(){e.show()};n.HideMessage=function(){e.hide()}}}},t.CreateContainer=function(n){var r="flight-grid-message-"+t._messageCounter++,i=angular.element("<div>");return i.addClass(r),i.addClass("smart-message-container"),n.before(i),n.addClass("smart-message"),i},t.UpdateCloseIcon=function(n,t,i){var r=t.find(".close-icon");i?r.appendTo(t).stop().show():r.fadeOut(400)},t.CreateQTip=function(n,i,r){return i.qtip({show:{event:"",effect:function(){t.UpdateCloseIcon($jq(this),i,!0);$jq(this).stop().slideDown(500,"linear")}},hide:{event:"",effect:function(){t.UpdateCloseIcon($jq(this),i,!1);$jq(this).stop().slideUp(500)}},position:{at:"top center",my:"bottom center",target:[0,0],container:i},content:{text:n},style:{classes:"ej-qtip-smart-message ej-qtip-smart-message-inline",def:!1,tip:{width:25,height:14,corner:"bottom center",mimic:"bottom center",offset:-88}},events:{render:function(n,t){r.SetDefaultAriaAttributesOnQtip(t)}}}),i.qtip("api")},t.DirectiveName="ejFlightGridMessage",t._messageCounter=0,t}();t.FlightGridMessage=i;i.Factory.$inject=["SmartMessage_Service"]})(i=t.SmartMessages||(t.SmartMessages={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",scope:!1,link:function(i,r,u){var o=u[t.MessageAttributeName],s=t.GetSafeDuration(u),f,e;o&&s&&(f=t.CreateQTip(r,o),e=null,i.$on(n.SeatMap.Events.InfantRestricted,function(n,t){if(t.length>0){var r=t[0].SeatNumber,i=$jq(".seat[data-seat-number='"+r+"']");i.length>0&&(f.set("position.target",i),f.show(),e&&clearTimeout(e),e=setTimeout(function(){f.hide()},s))}}))}}},t.GetSafeDuration=function(n){var r=n[t.DurationAttributeName],i=parseInt(r);return isNaN(i)?2e3:i},t.CreateQTip=function(n,i){var r=t.BuildQTipOptions(n,i);return n.qtip(r),n.qtip("api")},t.BuildQTipOptions=function(n,t){var i={show:{event:"",effect:function(){n.data("InfantRestrictedSeatMessage.IsAnimatingIn",!0);$jq(this).fadeIn(500,"linear",function(){n.data("InfantRestrictedSeatMessage.IsAnimatingIn",!1)})}},hide:{event:"",effect:function(){$jq(this).fadeOut(500)}},content:{text:t},style:{classes:"ej-qtip-smart-message ej-qtip-infant-restricted-message"}};return i.position={viewport:$jq(".plane-map"),adjust:{method:"shift shift"},at:"top center",my:"bottom center"},i.style.tip={width:15,height:8},i},t.DirectiveName="ejFunnelInfantRestrictedSeatMessage",t.MessageAttributeName="infantRestrictedMessage",t.DurationAttributeName="infantRestrictedDuration",t}();t.InfantRestrictedSeatMessage=i;i.Factory.$inject=[]})(i=t.SmartMessages||(t.SmartMessages={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(t){return{restrict:"A",scope:{PassengerComposition:"=passengerComposition"},link:function(i,r){var u=n.CreateQTip(r);r.on("mouseenter",".flight-grid-flight-fare",function(r){var f=$jq(r.currentTarget),e=parseInt(f.attr("data-lowest-fare-seats-available")),o=n.GetNumberOfPassengers(i),s,h;n.ShouldShowRemainingSeatsMessage(o,e,t)&&(s=f.parents(".flight-grid-window"),h=n.GetMessageContent(o,e,t),u.hide(),u.set("content.text",h),u.set("position.target",f),u.set("position.viewport",s),u.show())});r.on("mouseleave",".flight-grid-flight-fare",function(){u.hide()})}}},n.GetMessageContent=function(t,i,r){var u=n.CalculateNumberOfSeatsToDisplay(t,i),f=r.MessageFormat;return u==1&&(f=r.MessageFormatSingular),f.replace("{quantity}",u.toString())},n.CalculateNumberOfSeatsToDisplay=function(n,t){return t<n?n:t},n.GetNumberOfPassengers=function(n){return n.PassengerComposition.Adults+n.PassengerComposition.Children},n.ShouldShowRemainingSeatsMessage=function(n,t,i){return!i||!i.MessageFormat||!i.MessageFormatSingular?!1:Main3.Common.BreakPointService.IsDesktop()?n>i.MaximumAmountOfSeatsToShow?!1:t?t==0?!1:t>i.MaximumAmountOfSeatsToShow?!1:!0:!1:!1},n.CreateQTip=function(t){return t.qtip(n.BuildQTipOptions(t)),t.qtip("api")},n.BuildQTipOptions=function(){var n={show:{event:"",effect:function(){$jq(this).fadeIn(500,"linear")}},hide:{event:"",effect:function(){$jq(this).fadeOut(500)}},position:{at:"bottom center",my:"top center",adjust:{method:"shift none"}},content:{text:""},style:{classes:"ej-qtip-smart-message ej-qtip-lowest-fare-searts-remaining-smart-message"}};return n.style.tip={width:15,height:8},n},n.DirectiveName="ejLowestFareSeatsRemainingSmartMessage",n}();n.LowestFareSeatsRemainingSmartMessage=t;t.Factory.$inject=["Sitecore_LowestFareSeatsRemainingMessageSettings"]})(t=n.SmartMessages||(n.SmartMessages={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",scope:{},link:function(t,i,r){var u=n.CreateQTip(i),f=r[n.DirectiveName];i.on("focus",".ej-input.firstname-input",function(n){if(!!f){var t=$jq(n.currentTarget),i=t.parents(".passenger-details");u.hide();t.attr("aria-label",f);u.set("content.text",f);u.set("style.classes",t.attr("id")+" ej-qtip-smart-message ej-qtip-name-smart-message");u.set("position.target",t);u.set("position.viewport",i);u.show()}});i.on("blur",".ej-input.firstname-input",function(){u.hide()})}}},n.CreateQTip=function(t){return t.qtip(n.BuildQTipOptions(t)),t.qtip("api")},n.BuildQTipOptions=function(){var n={show:{event:"",effect:function(){$jq(this).fadeIn(500,"linear")}},hide:{event:"",effect:function(){$jq(this).fadeOut(500)}},position:{at:"top center",my:"bottom center",adjust:{method:"shift shift"}},content:{text:""},style:{classes:""}};return n.style.tip={width:15,height:8},n},n.DirectiveName="ejNameSmartMessage",n}();n.NameSmartMessage=t})(t=n.SmartMessages||(n.SmartMessages={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",link:function(t,i){n.CreateQTip(i)}}},n.CreateQTip=function(t){var u=n.BuildQTipOptions(t),i,r;return t.qtip(u),i=t.qtip("api"),r=t.find("input"),r.keyup(function(n){n.which===Controls.KeyCodes.Tab||Controls.KeyCodes.IsArrowKey(n.which)||Controls.KeyCodes.IsModifierKey(n.which)||!r.val()||i.hide()}),i},n.BuildQTipOptions=function(n){var t={show:{event:"focus",target:n.find("input"),effect:function(){n.data("PasswordRequirementsMessage.IsAnimatingIn",!0);$jq(this).fadeIn(500,"linear",function(){n.data("PasswordRequirementsMessage.IsAnimatingIn",!1)})}},hide:{event:"focusout",target:n.find("input"),effect:function(){$jq(this).fadeOut(500)}},content:{text:n.find(".password-requirement-message-content")},style:{classes:"ej-qtip-smart-message ej-qtip-password-requirements-smart-message"}};return t.position={at:"top center",my:"bottom center"},t.style.tip={width:15,height:8},t},n.DirectiveName="ejPasswordRequirementsMessage",n}();n.PasswordRequirementsMessage=t;t.Factory.$inject=["$rootScope"]})(t=n.SmartMessages||(n.SmartMessages={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(i){return{restrict:"A",templateUrl:"ng-templates/smart-message",controller:n.Controllers.SmartMessages.SmartMessageController,scope:{AnimationType:"=animationType",ShowOnLoad:"=showOnLoad",SmartMessageId:"@smartMessageId",SmartMessageSettings:"=settings",TipPosition:"@tipPosition"},link:function(r,u,f){var s,e,o;r.SmartMessageSettings&&(s=t.CreateContainer(u),e=r.SmartMessageSettings.tip?r.SmartMessageSettings.tip:null,!e&&f.tipPosition&&(e=n.Data.SmartMessages.SmartMessageTips.SmartMessageTipForType(f.tipPosition)),o=t.CreateQTip(u,s,e,r.AnimationType,i),r.HideMessage=function(){o.hide();r.SmartMessageSettings.OnClose&&r.SmartMessageSettings.OnClose()},r.ShowMessage=function(){o.show()})}}},t.CreateContainer=function(n){var t=angular.element("<div>");return t.addClass("smart-message-container"),n.before(t),n.addClass("smart-message"),t},t.CreateQTip=function(i,r,u,f,e){return r.qtip({show:{event:"",effect:function(n){var i=t.GetShowAnimation(f,r).bind(this);i(n)}},hide:{event:"",effect:t.GetCloseAnimation(f,r)},position:{at:"top center",my:"bottom center",target:[0,0],container:r},content:{text:i},style:{classes:"ej-qtip-smart-message ej-qtip-smart-message-inline",tip:u?u:n.Data.SmartMessages.SmartMessageTips.BottomLeft},events:{render:function(n,t){e.SetDefaultAriaAttributesOnQtip(t)}}}),r.qtip("api")},t.GetCloseAnimation=function(n,i){if(n&&n!==0){if(n===1)return function(){angular.element(this).fadeOut(500);t.UpdateCloseIcon(angular.element(this),i,!1)}}else return function(){angular.element(this).stop().slideUp(500);t.UpdateCloseIcon(angular.element(this),i,!1)};return null},t.GetShowAnimation=function(n,i){if(n&&n!==0){if(n===1)return function(){angular.element(this).fadeIn(500,"linear");t.UpdateCloseIcon(angular.element(this),i,!0)}}else return function(){t.UpdateCloseIcon(angular.element(this),i,!0);angular.element(this).stop().slideDown(500,"linear")};return null},t.UpdateCloseIcon=function(n,t,i){var r=t.find(".close-icon");r.css("display","table-cell");i?r.appendTo(t).stop().show():r.fadeOut(400)},t.DirectiveName="ejSmartMessage",t}();t.SmartMessageDirective=i;i.Factory.$inject=["SmartMessage_Service"]})(i=t.SmartMessages||(t.SmartMessages={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return{restrict:"A",require:"^ejWeinerCarousel",scope:"true",link:function(t,i,r,u){var f=parseInt(r.buttonId),o=r.hoverIcon,e=r.inactiveIcon,s=r.activeIcon;i.on("click",function(){n.OnButtonClick(t,u,f)});i.on("mouseleave",function(i){i.which===Controls.KeyCodes.Enter&&(i.preventDefault(),n.OnButtonClick(t,u,f))});i.on("mouseenter focus",function(){n.IsButtonActive(t,f)||Device.IsTouchDevice()||n.SetIcon(i,o)});i.on("mouseleave blur",function(){n.IsButtonActive(t,f)||Device.IsTouchDevice()||n.SetIcon(i,e)});t.$watch(function(n){return n.ActiveWeiner},function(t){f===t?n.SetIcon(i,s):n.SetIcon(i,e)})}}},n.OnButtonClick=function(t,i,r){n.IsButtonActive(t,r)||i.ControlButtonClicked(r)},n.IsButtonActive=function(n,t){return n.ActiveWeiner===t},n.SetIcon=function(n,t){n.css("background-image","url("+t+")")},n.DirectiveName="ejCarouselControlButton",n.IsActive="ejIsActive",n}();n.CarouselControlButtonDirective=t})(t=n.UberKahuna||(n.UberKahuna={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.GetNumericValue=function(n){return!n?0:parseInt(n.slice(0,-2))},t.Factory=function(i,r){return{restrict:"A",controller:n.Controllers.Controls.UberKahuna.UberKahunaController,link:function(n,u){var f=$jq(i);n.DefaultWeiner=u.find(".defaultWeiner");n.SetContainerHeight=function(){r(function(){var f=u.find(".tabbed-container-wrapper"),c=u.find(".carousel-control-panel"),l=t.GetNumericValue(f.css("top")),a=f.css("padding-bottom"),e=u.find("#weiner-"+n.ActiveWeiner+", .defaultWeiner"),r=e.find("img"),i=e.find(".deal-panel");if(r&&i&&r.outerHeight()!==0&&i.outerHeight()!==0){var v=i.outerHeight(),o=t.GetNumericValue(i.css("top"))+i.outerHeight(),s=r.outerHeight(),h=s<o?o:s;n.Height=h}})};n.SetContainerHeight();f.on("debouncedresize",n.SetContainerHeight)}}},t.DirectiveName="ejUberKahuna",t}();t.UberKahunaDirective=i;i.Factory.$inject=["$window","$timeout"]})(i=t.UberKahuna||(t.UberKahuna={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(){return{controller:n.Controllers.Controls.UberKahuna.WeinerCarouselController,restrict:"A",scope:!1}},t.DirectiveName="ejWeinerCarousel",t}();t.WeinerCarouselDirective=i})(i=t.UberKahuna||(t.UberKahuna={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(i,r){return{restrict:"A",require:"^ejUberKahuna",link:function(i,u,f){var e=u.find(".weiner-image"),o=i.TransitionTime;i.RefreshWeinerImage=function(n){n===void 0&&(n=!1);var f=e.attr("src"),r=t.GetWeinerBackgroundUrl(i.weiner);Main3.Common.BreakPointService.IsMobile()&&(n=!1);f!=r&&(n?t.SoftTransitionWeinerBackground(u,e,r,o):e.attr("src",r))};i.GetDealPanelDisclaimerText=function(){return Main3.Common.BreakPointService.IsMobile()?i.weiner.DealPanelMobileDisclaimerText:i.weiner.DealPanelDisclaimerText};r(function(){return i.RefreshWeinerImage()});i.$on(n.Events.Names.UberKahuna.RefreshBackgroundImage,function(){i.RefreshWeinerImage(!0)});f.$observe("active",function(n){n==="true"?u.fadeIn(o,function(){i.SetContainerHeight()}):u.fadeOut(o)})}}},t.GetWeinerBackgroundUrl=function(n){var i=Main3.Common.BreakPointService.IsDesktop(),t=[];return!n||(!n.NextBestAction||(!n.NextBestAction.DestinationAirportData||t.push(i?n.NextBestAction.DestinationAirportData.CarouselDesktopImageUrl:n.NextBestAction.DestinationAirportData.CarouselTabletImageUrl),t.push(i?n.NextBestAction.CarouselDesktopImageUrl:n.NextBestAction.CarouselTabletImageUrl)),t.push(i?n.CarouselDesktopImage:n.CarouselTabletImage)),Utilities.Arrays.FirstOrDefault(t,function(n){return!!n})||""},t.SoftTransitionWeinerBackground=function(n,i,r,u){if(!!n.data("SoftTransitionInProgress")){n.data("SoftTransitionQueuedUrl",r);return}var f=i.clone();f.removeClass("weiner-image");f.addClass("temporary-weiner-image");i.after(f);f.show();i.hide();i.attr("src",r);n.data("SoftTransitionInProgress",!0);f.fadeOut(u);i.fadeIn(u,function(){i.removeAttr("style");n.find(".temporary-weiner-image").remove();n.data("SoftTransitionInProgress",!1);var r=n.data("SoftTransitionQueuedUrl");!r||(n.data("SoftTransitionQueuedUrl",null),t.SoftTransitionWeinerBackground(n,i,r,u))})},t.DirectiveName="ejWeiner",t}();t.WeinerDirective=i;i.Factory.$inject=["$window","$timeout"]})(i=t.UberKahuna||(t.UberKahuna={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.Factory=function(t){return{restrict:"A",controller:n.Controllers.Funnel.Vouchers.Vouchers,link:function(n,i){n.FocusOnVouchersBlock=function(){t(function(){i.find(".vouchers-block").focus()},100)}}}},t.DirectiveName="ejVouchers",t}();t.FunnelVouchers=i;i.Factory.$inject=["$timeout"]})(i=t.Funnel||(t.Funnel={}))})(t=n.Directives||(n.Directives={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return hotaccApiSettings},n.FactoryName="Sitecore_HotacAuthApiSettings",n}();n.HotaccAuthApiSettings=t})(t=n.Hotacc||(n.Hotacc={}))})(t=n.Factories||(n.Factories={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return hotaccExpirySettings},n.FactoryName="Sitecore_HotaccExpirySettings",n}();n.HotaccExpirySettings=t})(t=n.Hotacc||(n.Hotacc={}))})(t=n.Factories||(n.Factories={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return dataCapturePageUrl},n.FactoryName="Hotac_DataCapturePageUrl",n}();n.HotaccLoginSettings=t})(t=n.Hotacc||(n.Hotacc={}))})(t=n.Factories||(n.Factories={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return flightGridSettings},n.FactoryName="Sitecore_FlightGridSettings",n}();n.FlightGridSettings=t})(t=n.Sitecore||(n.Sitecore={}))})(t=n.Factories||(n.Factories={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return function(n){return n.replace(/(\{price\:)([0-9.]+?)(\})/g,'<span ej-price="$2"><\/span>')}},n.FilterName="ejPriceAsHtml",n}();n.PriceAsHtmlFilter=t;t.Factory.$inject=[]})(t=n.Common||(n.Common={}))})(t=n.Filters||(n.Filters={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return function(n,t){return!n?"":n.Format(t)}},n.FilterName="ejTimeAgnosticDate",n}();n.TimeAgnosticDateFilter=t})(t=n.Common||(n.Common={}))})(t=n.Filters||(n.Filters={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(n){return function(t){return n.trustAsHtml(t)}},n.FilterName="ejTrustAsHtml",n}();n.TrustAsHtmlFilter=t;t.Factory.$inject=["$sce"]})(t=n.Common||(n.Common={}))})(t=n.Filters||(n.Filters={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.Factory=function(){return function(n,t){return!n?"":n.Format(t)}},n.FilterName="ejZonelessDateTime",n}();n.ZonelessDateTimeFilter=t})(t=n.Common||(n.Common={}))})(t=n.Filters||(n.Filters={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(){function t(n,t,i,r,u){this._http=n;this._httpParamsSerializer=t;this._tracking=i;this._trackingCategory=r;this._podCookieName=u}return t.prototype.AjaxRequest=function(t,i,r,u,f,e,o){var s=this,h,c;o===void 0&&(o=!1);h={method:t,url:i,headers:this.GetRequestHeaders(),responseType:"json",withCredentials:!0};t.toUpperCase()=="GET"?(c=this._httpParamsSerializer(r),c&&(h.url=h.url+"?"+c)):t.toUpperCase()=="POST"&&(h.data=r);this._http(h).then(function(t){n.Services.Common.ErrorService.IsExiting||(s.TrackEvent(e,["Success"],o),u&&u(t.data,t.headers))},function(t){n.Services.Common.ErrorService.IsExiting||(t.status?t.status==500?s.TrackEvent(e,[s.IsKnownError(t)?"Fail":"Error",t.status.toString(),t.statusText],o):s.TrackEvent(e,["Fail",t.status.toString(),t.statusText],o):s.TrackEvent(e,["Error","Unable to connect to "+t.config.url],o),f&&f(t.status,t.statusText,t.data))})},t.prototype.IsKnownError=function(n){return!!n.data&&!!n.data.KnownErrorNumber},t.prototype.TrackEvent=function(n,t,i){var r,u;this._tracking&&this._podCookieName&&this._trackingCategory&&n&&(r=this.GetPodValue(),r||(r="Unknown"),t.push("POD-"+r),u=t.join(" | "),i?this._tracking.TrackNonInteractionEvent(this._trackingCategory,n,u):this._tracking.TrackEvent(this._trackingCategory,n,u))},t.prototype.GetPodValue=function(){return $jq.getCookie(this._podCookieName)},t.prototype.GetRequestHeaders=function(){var i=this.GetHeaders()||{},n=System.Guid.MakeNew();return!t.ApiCorrelationToken||(n=this.TransposeFirstGuidChunkFromCorrelationToTransactionGuid(n,t.ApiCorrelationToken)),i["X-Transaction-Id"]=n.ToString(),i},t.prototype.TransposeFirstGuidChunkFromCorrelationToTransactionGuid=function(n,t){var r=t.ToString().split("-"),i=n.ToString().split("-");return i[0]=r[0],new System.Guid(i.join("-"))},t.prototype.GetHeaders=function(){return null},t.prototype.ExtractKnownError=function(n){return function(t,i,r){var u=null;r&&(u=r.KnownErrorNumber);n(t,i,u,r)}},t}();t.BaseApiService=i})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(n){function t(t,i,r,u,f,e){var o=n.call(this,i,r,u,f,e)||this;return o._clientApiService=t,o}return __extends(t,n),t.prototype.AjaxRequest=function(t,i,r,u,f,e,o){o===void 0&&(o=!1);var s=this._clientApiService.GetApiUrlByMethod(i);n.prototype.AjaxRequest.call(this,t,s,r,u,f,e,o)},t}(n.BaseApiService);n.BaseClientApiService=t})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(n){function t(t,i,r,u,f,e){var o=n.call(this,t,i,r,u,f,e)||this;return o._requestQueue=[],o}return __extends(t,n),t.prototype.AjaxRequest=function(n,t,i,r,u,f,e){var o=this;e===void 0&&(e=!1);var h=function(n){o.CheckForQueuedRequestAndExecute();r&&r(n)},c=function(n,t,i){o.CheckForQueuedRequestAndExecute();u&&u(n,t,i)},s={data:i,httpMethod:n,apiMethod:t,trackingAction:f,onSuccess:h,onError:c,isNonInteractionTrackingEvent:e};this._requestInProgress?this._requestQueue.push(s):(this._requestInProgress=!0,this.ProcessRequest(s))},t.prototype.CheckForQueuedRequestAndExecute=function(){if(this._requestQueue.length>0){var n=this._requestQueue.shift();this.ProcessRequest(n)}else this._requestInProgress=!1},t.prototype.ProcessRequest=function(t){n.prototype.AjaxRequest.call(this,t.httpMethod,t.apiMethod,t.data,t.onSuccess,t.onError,t.trackingAction,t.isNonInteractionTrackingEvent)},t.prototype.HasAnyRequestsPending=function(){return this._requestQueue.length>0||this._requestInProgress},t}(n.BaseClientApiService);n.QueuedBaseApiService=t})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){this.SearchDateFormat="YYYY-MM-DD HH:mm:ss[Z]"}return n.prototype.ToString=function(n){return n?"{0}|{1}|{2}|{3}|{4}|{5}|{6}|{7}|{8}|{9}|{10}".format(n.OriginIata,n.DestinationIata,n.OutboundDate?n.OutboundDate.ToIso8601():"",n.ReturnDate?n.ReturnDate.ToIso8601():"",n.Adults,n.Children,n.Infants,n.FlexibleOnDates?"True":"False",n.MemberEmail?n.MemberEmail:"",n.SearchId,n.SearchDate.utc().format(this.SearchDateFormat)):""},n.prototype.ToSearchCookies=function(n){var t=this;return _.chain(n).map(function(n){return t.ToSearchCookie(n)}).select(function(n){return n!=null}).value()},n.prototype.ToSearchCookie=function(n){var t=n.split("|"),i=t.length;return i<10||!t[2]?null:{OriginIata:this.TryGet(0,t),DestinationIata:this.TryGet(1,t),OutboundDate:Utilities.ZonelessDateTime.FromIso8601(this.TryGet(2,t)),ReturnDate:this.TryGet(3,t)?Utilities.ZonelessDateTime.FromIso8601(this.TryGet(3,t)):null,Adults:this.TryParseInt(this.TryGet(4,t),0),Children:this.TryParseInt(this.TryGet(5,t),0),Infants:this.TryParseInt(this.TryGet(6,t),0),FlexibleOnDates:this.TryGet(7,t).toLowerCase()=="true",MemberEmail:this.TryGet(8,t)?this.TryGet(8,t):null,SearchId:this.TryParseInt(this.TryGet(9,t),0),SearchDate:moment.utc(this.TryGet(10,t),this.SearchDateFormat)}},n.prototype.TryGet=function(n,t){if(t.length>n)return t[n]},n.prototype.TryParseInt=function(n,t){var i=parseInt(n);return isNaN(i)?t:i},n.prototype.Equal=function(n,t){return n.OriginIata==t.OriginIata&&n.DestinationIata==t.DestinationIata&&this.ZonelessDateTimesMatch(n.OutboundDate,t.OutboundDate)&&this.ZonelessDateTimesMatch(n.ReturnDate,t.ReturnDate)&&n.Adults==t.Adults&&n.Children==t.Children&&n.Infants==t.Infants&&n.FlexibleOnDates==t.FlexibleOnDates&&n.MemberEmail==t.MemberEmail},n.prototype.ZonelessDateTimesMatch=function(n,t){return n==null||t==null?n==t:n.ToSortable()==t.ToSortable()},n}();n.SearchCookieBase=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this._tracker=n;this._baseCookieService=t}return t.prototype.HandleApiError=function(n,t,i,r,u){r===void 0&&(r=null);u===void 0&&(u=null);this.HandleApiErrorWithAdditionalChecks({HttpCode:n,StatusText:t,KnownError:i,KnownErrorJson:r,KnownErrorCallback:u})},t.prototype.HandleApiErrorWithAdditionalChecks=function(n,t){t===void 0&&(t=null);this.Unauthorised(n.HttpCode)?this.Exit("ErrorService - Unauthorised"):n.KnownError?(this.HandleSessionUnavailable(n.KnownError),this.HandlePickFlightsFlightNoLongerAvailable(n.KnownError),!t||t(n)):this.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Api,Tracking.EventConstants.GenericErrorDrawerLabels.NotKnownError)},t.prototype.Unauthorised=function(n){return n===401},t.prototype.Exit=function(n){this.LogError(n);t.IsExiting=!0;this._tracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.Alert,Tracking.EventConstants.Actions.FunnelExitReason,n,"/")},t.prototype.LogError=function(){},t.prototype.HandleSessionUnavailable=function(t){if(t===n.Data.Rebooking.KnownError.SessionUnavailable){var i=Tracking.EventConstants.Categories.Funnel,r=Tracking.EventConstants.Actions.SessionExpiry,u=window.location.href;this._tracker.TrackEvent(i,r,u);this.Exit("ErrorService - SessionUnavailable")}},t.prototype.HandlePickFlightsFlightNoLongerAvailable=function(t){(t===n.Data.Rebooking.KnownError.FlightNotAvailable||t===n.Data.Rebooking.KnownError.SeatNotAvailable)&&(n.Events.OpenDrawer("flightgrid-notavailable"),n.Events.Fire(n.Events.Names.AvailabilityFlightsProvider.ForceRefresh))},t.prototype.ShowGenericErrorDrawer=function(t,i,r){n.Events.OpenDrawerWithOptions({AllowBackOverride:r,SectionKey:"global-error-drawer",ShowAfterActionComplete:!0,OnConfirmCallback:this.ErrorDrawerExit.bind(this),AnalyticsOptions:{Category:t,Action:Tracking.EventConstants.Actions.Error,Label:i,IncludePagePathInLabel:!0}})},t.prototype.ErrorDrawerExit=function(){this._baseCookieService.DeleteCookieForAllDomains(Main3.Cookies.CookieConstants.Names.AvailabilityPodIdentifier);this._baseCookieService.DeleteCookieForAllDomains(Main3.Cookies.CookieConstants.Names.RebookingPodIdentifier);this._baseCookieService.DeleteCookieForAllDomains(Main3.Cookies.CookieConstants.Names.FunnelQuery);this._baseCookieService.DeleteCookieForAllDomains(Main3.Cookies.CookieConstants.Names.FunnelJourney);this._baseCookieService.DeleteCookieForAllDomains(Main3.Cookies.CookieConstants.Names.FunnelECommerce);window.location.href="/"},t.prototype.HandleDeferredError=function(n){var t=this;return function(i,r,u){t.HandleApiError(i,r,u);n.reject()}},t.IsExiting=!1,t.ServiceName="Error_Service",t.$inject=["IAnalyticsTracker","Cookies_BaseCookieService"],t}();t.ErrorService=i})(i=t.Common||(t.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(n,i,r,u,f,e){var o=t.call(this,n,f)||this;return o._funnelJourneyCookieService=i,o._funnelReasonCookieService=r,o._funnelPriceChangeHandlerService=u,o._funnelRootSettings=e,o}return __extends(i,t),i.prototype.HandleApiErrorOnFinalize=function(n,t,i,r){this.Unauthorised(n)?this.Exit("ErrorService - Unauthorised"):i?(this.HandleDetectedRobot(i),this.HandleSessionUnavailable(i),this.HandleFlightNoLongerAvailable(i,r),this.HandleSeatNoLongerAvailable(i,r),this.HandleInfantSeatClash(i),this.HandleDuplicateBooking(i),this.HandlePaymentError(i),this.HandleFlightPricesChanged(i,r),this.HandleBasketPriceChanged(i,r)):this.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.NotKnownErrorOnFinalise)},i.prototype.LogError=function(n){n&&this._funnelReasonCookieService&&this._funnelReasonCookieService.UpdateCookie(function(t){return t.ExitReason=n})},i.prototype.HandleFlightNoLongerAvailable=function(t,i){var o=this,r,u,f,e;t===n.Data.Rebooking.KnownError.FlightNotAvailable&&(this._tracker.TrackEvent(Tracking.EventConstants.Categories.Checkout,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.SoldOut),r=null,!i||(u=JSON.parse(i),r=_(u.UnavailableFlights).map(function(n){return o.MapErrorDataToUnavailableFlight(n)})),f={UnavailableFlights:r},e={SectionKey:"payment-flightnotavailable",Parameters:f},n.Events.OpenDrawerWithOptions(e))},i.prototype.HandleDetectedRobot=function(t){if(t===n.Data.Rebooking.KnownError.RobotDetected){var i=this._funnelRootSettings.ScreenScrapersPageUrl;this._tracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.Alert,Tracking.EventConstants.Actions.FunnelExitReason,"ErrorService - Robot Detected",i);window.location.href=i}},i.prototype.MapErrorDataToUnavailableFlight=function(n){return{ArrivalAirport:n.ArrivalAirport,DepartureAirport:n.DepartureAirport,ArrivalDateTime:Utilities.ZonelessDateTime.FromIso8601(n.ArrivalDateTimeIso8601),DepartureDateTime:Utilities.ZonelessDateTime.FromIso8601(n.DepartureDateTimeIso8601),FlightNumber:n.FlightNumber}},i.prototype.HandleInfantSeatClash=function(t){if(t===n.Data.Rebooking.KnownError.InfantSeatClash){this._tracker.TrackEvent(Tracking.EventConstants.Categories.Checkout,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.InfantSeatClash);n.Events.OpenDrawerWithOptions({SectionKey:"payment-infantseatclash",Parameters:{UnavailableSeats:null,IsInfantClash:!0}})}},i.prototype.HandleSeatNoLongerAvailable=function(t,i){if(t===n.Data.Rebooking.KnownError.SeatNotAvailable)if(this._tracker.TrackEvent(Tracking.EventConstants.Categories.Checkout,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.SeatClash),!i)this.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.SeatNoLongerAvailableNoKnownErrorJson);else{var r=JSON.parse(i),u=this.MapErrorDataToUnavailableSeats(r),f={UnavailableSeats:u,IsInfantClash:!1},e={SectionKey:"payment-seatnotavailable",Parameters:f};n.Events.OpenDrawerWithOptions(e)}},i.prototype.MapErrorDataToUnavailableSeats=function(n){var i=this,t=[];return n.UnavailableFlights.forEach(function(n){var r=_(t).find(function(t){return t.Flight.ArrivalAirport===n.ArrivalAirport&&t.Flight.DepartureAirport===n.DepartureAirport&&t.Flight.FlightNumber===n.FlightNumber&&t.Flight.DepartureDateTime.ToSortable()===Utilities.ZonelessDateTime.FromIso8601(n.DepartureDateTimeIso8601).ToSortable()&&t.Flight.ArrivalDateTime.ToSortable()===Utilities.ZonelessDateTime.FromIso8601(n.ArrivalDateTimeIso8601).ToSortable()}),u;r?r.Seats.push(n.SeatNumber):(u={Flight:i.MapErrorDataToUnavailableFlight(n),Seats:[n.SeatNumber]},t.push(u))}),t},i.prototype.HandleDuplicateBooking=function(t){t==n.Data.Rebooking.KnownError.PossibleDuplicateBooking&&n.Events.OpenDrawer("funnel-duplicate-booking")},i.prototype.HandlePaymentError=function(t){this.IsPaymentError(t)&&(this.IncrementPaymentErrors(),t===n.Data.Rebooking.KnownError.PaymentBillingAddressError?this.HandlePaymentBillingAddressError():t===n.Data.Rebooking.KnownError.PaymentDetailsError?this.HandlePaymentDetailsError():t===n.Data.Rebooking.KnownError.PaymentGeneralProcessingError?this.HandlePaymentGeneralProcessingError():t===n.Data.Rebooking.KnownError.PaymentGeneralError&&this.HandlePaymentGeneralError())},i.prototype.IsPaymentError=function(t){return t===n.Data.Rebooking.KnownError.PaymentBillingAddressError||t===n.Data.Rebooking.KnownError.PaymentDetailsError||t===n.Data.Rebooking.KnownError.PaymentGeneralProcessingError||t===n.Data.Rebooking.KnownError.PaymentGeneralError},i.prototype.IncrementPaymentErrors=function(){var t=this._funnelJourneyCookieService.ReadCookie(),n=t.NumberOfPaymentErrors;n||(n=0);n++;this._funnelJourneyCookieService.UpdateCookie(function(t){t.NumberOfPaymentErrors=n})},i.prototype.HandlePaymentBillingAddressError=function(){n.Events.OpenDrawerWithOptions({SectionKey:"funnel-payment-billing-address-error",AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Payment,Action:Tracking.EventConstants.Actions.Error,Label:this.BuildPaymentErrorLabel(Tracking.EventConstants.Labels.PaymentBillingAddressError),IncludePagePathInLabel:!0}})},i.prototype.HandlePaymentDetailsError=function(){n.Events.OpenDrawerWithOptions({SectionKey:"funnel-payment-details-error",AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Payment,Action:Tracking.EventConstants.Actions.Error,Label:this.BuildPaymentErrorLabel(Tracking.EventConstants.Labels.PaymentDetailsError),IncludePagePathInLabel:!0}})},i.prototype.HandlePaymentGeneralProcessingError=function(){n.Events.OpenDrawerWithOptions({SectionKey:"funnel-payment-general-processing-error",AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Payment,Action:Tracking.EventConstants.Actions.Error,Label:this.BuildPaymentErrorLabel(Tracking.EventConstants.Labels.PaymentGeneralProcessingError),IncludePagePathInLabel:!0}})},i.prototype.HandlePaymentGeneralError=function(){this.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Payment,this.BuildPaymentErrorLabel(Tracking.EventConstants.Labels.PaymentGeneralError))},i.prototype.BuildPaymentErrorLabel=function(n){return n+" | "+this.GetNumberOfPaymentErrorsFromJourneyCookie()},i.prototype.GetNumberOfPaymentErrorsFromJourneyCookie=function(){var t=this._funnelJourneyCookieService.ReadCookie(),n=t.NumberOfPaymentErrors;return n||(n=0),n.toString()},i.prototype.HandleFlightPricesChanged=function(t,i){if(t===n.Data.Rebooking.KnownError.FlightPriceChanged){var r=JSON.parse(i);this._funnelPriceChangeHandlerService.HandleFlightPriceChange(r)}},i.prototype.HandleBasketPriceChanged=function(t,i){if(t===n.Data.Rebooking.KnownError.BasketPriceChanged){var r=JSON.parse(i);this._funnelPriceChangeHandlerService.HandleBasketPriceChange(r)}},i.ServiceName="Funnel_ErrorService",i.$inject=["IAnalyticsTracker","FunnelJourneyCookie_Service","FunnelReasonCookie_Service","Funnel_FinalisePriceChangeHandlerService","Cookies_BaseCookieService","Sitecore_FunnelRootSettings"],i}(t.Common.ErrorService);i.ErrorService=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i=function(i){function r(n,t,r,u,f,e){return i.call(this,n,t,r,u,f,e)||this}return __extends(r,i),r.prototype.AuthenticatedAjaxRequest=function(r,u,f,e,o,s,h){h===void 0&&(h=!1);var c=function(i){t.Account.AccountService.IsSignedIn=n.Data.Account.SignedInStatus.SignedIn;e(i)},l=function(i,r,u){i==401&&(t.Account.AccountService.IsSignedIn=n.Data.Account.SignedInStatus.NotSignedIn);o(i,r,u)};i.prototype.AjaxRequest.call(this,r,u,f,c,l,s,h)},r}(t.QueuedBaseApiService);t.AuthenticatedBaseApiService=i})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(t){function i(n,i,r,u){return t.call(this,n,i,r,u,"DA-ACC",Main3.Cookies.CookieConstants.Names.RebookingPodIdentifier)||this}return __extends(i,t),i.prototype.GetHeaders=function(){return null},i.prototype.GetLoggedInStatus=function(t,i){var r=function(i){var r=n.Data.Account.Api.LoggedInStatus.Parse(i.Status);t(r)};this.AjaxRequest("GET","account/getloggedinstatus",null,r,this.ExtractKnownError(i),"Rebooking.GetLoggedInStatus",!0)},i.prototype.LogIn=function(n,t,i,r,u,f){u===void 0&&(u=!1);f===void 0&&(f=0);u||(f=0);var e={Username:n,Password:t,KeepMeSignedIn:u,KeepMeSignedInMinutes:f};this.AuthenticatedAjaxRequest("POST","account/login",e,i,this.ExtractKnownError(r),"Account.LogIn")},i.prototype.RefreshExpiry=function(n,t,i){var r={KeepMeSignedInMinutes:n};this.AuthenticatedAjaxRequest("POST","account/refreshexpiry",r,t,this.ExtractKnownError(i),"Account.RefreshExpiry")},i.prototype.LogOut=function(n,t){this.AjaxRequest("POST","account/logout",null,n,this.ExtractKnownError(t),"Account.LogOut")},i.prototype.GetUsername=function(n,t){this.AuthenticatedAjaxRequest("GET","account/getusername",null,n,this.ExtractKnownError(t),"Rebooking.GetUsername",!0)},i.prototype.PassengerLogin=function(n,t,i,r){var u={Surname:n,BookingReference:t};this.AjaxRequest("POST","account/passengerlogin",u,i,this.ExtractKnownError(r),"Account.PassengerLogin",!0)},i.prototype.Register=function(n,t,i){this.AjaxRequest("POST","account/register",n,t,this.ExtractKnownError(i),"Account.Register",!1)},i.prototype.ResetPassword=function(n,t,i){this.AjaxRequest("POST","account/resetpassword",n,t,this.ExtractKnownError(i),"Account.ResetPassword",!1)},i.prototype.RequestResetPassword=function(n,t,i){this.AjaxRequest("POST","account/requestresetpassword",{EmailAddress:n},t,this.ExtractKnownError(i),"Account.RequestResetPassword",!1)},i.ServiceName="Account_Api",i.$inject=["ClientApi_Service","$http","$httpParamSerializer","IAnalyticsTracker","Sitecore_AccountClientSettings"],i}(n.Services.AuthenticatedBaseApiService);t.AccountApi=i})(i=t.Account||(t.Account={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,i,r,u){this._rootScope=n;this._api=i;this._errorService=r;this._qService=u;this.InitialiseUsername();this._signInStateDetermined=this._qService.defer();this._rootScope.$watch(function(){return t.IsSignedIn},this.SignedInStatusChanged.bind(this));this.IsSecure()?this.UpdateIsSignedIn():this._signInStateDetermined.resolve()}return t.prototype.WhenSignInStateDetermined=function(){return this._signInStateDetermined.promise},t.GetExpiresCookieValue=function(){return this.GetCookie(this._expiresCookieName)},t.prototype.GetUsername=function(i,r){var u=this;this._signInStateDetermined?this._signInStateDetermined.promise.then(function(){u.UsernameDataIsPopulated()?i(u._usernameData):t.IsSignedIn===n.Data.Account.SignedInStatus.SignedIn&&!u._getUsernamePreviouslyCalledForUser&&u.GetUsernamePreviousErrorIsNullOrNotA401()?u.GetUsernameApiCall(i,r):u.Simulate401Response(r)}):(this.UpdateIsSignedIn(),this.GetUsername(i,r))},t.prototype.GetUsernamePreviousErrorIsNullOrNotA401=function(){return!this._getUsernamePreviousErrorCode||this._getUsernamePreviousErrorCode!==401},t.prototype.GetUsernameApiCall=function(t,i){var r=this;this._api.GetUsername(function(n){r._usernameData=n;r._getUsernamePreviouslyCalledForUser=!0;t(n)},function(t,u,f){r._getUsernamePreviousErrorCode=t;r._getUsernamePreviouslyCalledForUser=!0;f||t===401||r._rootScope.$broadcast(n.Events.Names.Account.GetUsernameFailed);i(t,u,f)})},t.prototype.Simulate401Response=function(n){n(401,"Unauthorised",null)},t.HasExpiresCookie=function(){return!!this.GetExpiresCookieValue()},t.prototype.IsSecure=function(){return window.location.protocol.toLowerCase()=="https:"},t.prototype.IsSignedIn=function(){var n=this.GetSignedInStatusAsBool(t.IsSignedIn);return n===null?!1:n},t.prototype.LogIn=function(n,t,i,r,u,f){u===void 0&&(u=!1);f===void 0&&(f=0);this._api.LogIn(n,t,i,r,u,f)},t.prototype.LogOut=function(n,t){this._api.LogOut(n,t)},t.prototype.PassengerLogin=function(n,t){var i=this._qService.defer();return this._api.PassengerLogin(n,t,function(){i.resolve()},function(n,t,r){var u={HttpCode:n,StatusText:t,KnownError:r};i.reject(u)}),i.promise},t.prototype.RegisterUser=function(n){var t=this._qService.defer();return this._api.Register(n,function(n){return t.resolve(n)},function(n,i,r){var u={HttpCode:n,StatusText:i,KnownError:r};t.reject(u)}),t.promise},t.prototype.RefreshExpiry=function(n,t,i){this._api.RefreshExpiry(n,t,i)},t.prototype.SignOut=function(n){this._api.LogOut(this.OnLogOutSuccess.bind(this,n),this.OnLogOutError.bind(this))},t.GetCookie=function(n){var i="; "+document.cookie,t=i.split("; "+n+"=");if(t.length==2)return t.pop().split(";").shift()},t.prototype.GetSignedInStatusAsBool=function(t){return t===n.Data.Account.SignedInStatus.SignedIn?!0:t===n.Data.Account.SignedInStatus.NotSignedIn?!1:null},t.prototype.InitialiseUsername=function(){this._usernameData=null;this._getUsernamePreviouslyCalledForUser=!1;this._getUsernamePreviousErrorCode=null},t.prototype.OnLogOutSuccess=function(i){t.IsSignedIn=n.Data.Account.SignedInStatus.NotSignedIn;i&&i()},t.prototype.OnLogOutError=function(i,r,u){i!=401?this._errorService.HandleApiError(i,r,u):t.IsSignedIn=n.Data.Account.SignedInStatus.NotSignedIn},t.prototype.SignedInStatusChanged=function(t,i){var r=this.GetSignedInStatusAsBool(t),u=this.GetSignedInStatusAsBool(i);t!==i&&(this._rootScope.$broadcast(n.Events.Names.Account.SignInStatusChanged,t,i),this._rootScope.$broadcast(n.Events.Names.Account.DeprecatedSignInStatusChanged,r,u),r||u==null||this.InitialiseUsername())},t.prototype.UpdateIsSignedIn=function(){var i=this;this._api.GetLoggedInStatus(function(r){t.IsSignedIn=r==n.Data.Account.Api.LoggedInStatus.HardLogIn?n.Data.Account.SignedInStatus.SignedIn:r==n.Data.Account.Api.LoggedInStatus.SoftLogIn?n.Data.Account.SignedInStatus.SoftSignedIn:r==n.Data.Account.Api.LoggedInStatus.Passenger?n.Data.Account.SignedInStatus.PassengerSignIn:n.Data.Account.SignedInStatus.NotSignedIn;i._signInStateDetermined.resolve()},function(t,r,u){u||t===401||i._rootScope.$broadcast(n.Events.Names.Account.GetSignInStatusFailed)})},t.prototype.UsernameDataIsPopulated=function(){return!!this._usernameData},t._expiresCookieName="eJExpires",t.IsSignedIn=n.Data.Account.SignedInStatus.Unknown,t.ServiceName="Account_Service",t.$inject=["$rootScope","Account_Api","Error_Service","$q"],t}();t.AccountService=i})(i=t.Account||(t.Account={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r){var u=this;this._rootScope=t;this._accountService=i;this._clientSettings=r;this._timer=new Utilities.ExpiryTimer(this._clientSettings.ExpirySettings.InactivitySeconds*1e3+this._clientSettings.ExpirySettings.MessageSeconds*1e3,this.TimeLeftTillExpiry.bind(this),6e4);this._timer.AddExpiredCallback(this.OnExpired.bind(this));this._rootScope.$on(n.Events.Names.Account.ResetExpiryTimer,function(n,t){u._timer.Reset(t||!1)});this._rootScope.$on(n.Events.Names.Drawer.Scroll,function(){u._timer.ActivityReset()});this._accountService.IsSignedIn()&&this._timer.Reset(!1);this._rootScope.$on(n.Events.Names.Account.DeprecatedSignInStatusChanged,function(n,t){t?u._timer.Reset(!1):u._timer.Stop()})}return t.prototype.OnExpired=function(){n.Events.OpenDrawerWithOptions({SectionKey:"account-expiry",AllowBackOverride:n.Data.DrawerBackOverride.AlwaysHide})},t.prototype.TimeLeftTillExpiry=function(t){var i=this._clientSettings.ExpirySettings.InactivitySeconds*1e3;if(n.Services.Account.AccountService.HasExpiresCookie()){var r=n.Services.Account.AccountService.GetExpiresCookieValue(),u=moment.utc().toDate().getTime(),f=parseInt(r);i=f-u;i-=this._clientSettings.ExpirySettings.MessageSeconds*1e3;i-=t}return i},t.ServiceName="Account_LoginExpiryTimer",t.$inject=["$rootScope","Account_Service","Sitecore_AccountClientSettings"],t}();t.LoginExpiryTimer=i})(i=t.Account||(t.Account={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(n){function t(t,i,r){return n.call(this,t,i,r,null,null,null)||this}return __extends(t,n),t.prototype.GetHeaders=function(){return null},t.prototype.Send=function(n,t,i,r){var u={Data:t};this.AjaxRequest("POST","analytics/send"+n,u,function(n,t){var r={Timestamp:t("Timestamp"),AnalyticsId:t("AnalyticsId")};i(r)},this.ExtractKnownError(r),"Analytics.Send",!0)},t.ServiceName="Analytics_Api",t.$inject=["ClientApi_Service","$http","$httpParamSerializer"],t}(n.BaseClientApiService);t.AnalyticsApi=i})(t=n.Availability||(n.Availability={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this._apdTaxAmountDictionary=new Dictionary;this._messageCarouselService=n;this._flightCardCarouselMessageSettings=t}return t.prototype.ApdLiablePassengerCount=function(n){return n.Adults},t.prototype.SetFromFlights=function(n){var t=this;n.forEach(function(n){var i=n.DepartureIata,r=n.ArrivalIata,u,f;(!t.GetApdTaxAmount(i,r)||n.FlightTaxes.TaxAmount>0)&&(u=t.GetKey(i,r),f=n.FlightTaxes.ApplyApdRules?n.FlightTaxes.TaxAmount:0,t._apdTaxAmountDictionary.Set(u,f))})},t.prototype.GetApdTaxAmount=function(n,t){var i=this.GetKey(n,t);return this._apdTaxAmountDictionary.Get(i)},t.prototype.ShowApdMessageForFlights=function(t,i){var r=this,u;this._flightCardCarouselMessageSettings&&this._flightCardCarouselMessageSettings.ApdChildrenText&&(u=this.GetSingleFlightForEachUniqueRoute(i),u.AllValues().forEach(function(i){var u=i.DepartureIata,f=i.ArrivalIata,e=r.GetKey(u,f),s=r.IsApdApplicableForRequest(t),o=r.GetApdTaxAmount(u,f),h=r._flightCardCarouselMessageSettings.ApdChildrenText.htmlEncode().replace("{amount}",'<span ej-price="'+o+'" ej-price-hide-zero-minor="true" ej-price-apply-rounding="false"><\/span>');s&&o>0?r._messageCarouselService.AddMessage(e,n.Data.Controls.MessageCarousel.MessageKeys.Names.ChildApd,h):r._messageCarouselService.RemoveMessage(e,n.Data.Controls.MessageCarousel.MessageKeys.Names.ChildApd)}))},t.prototype.GetKey=function(n,t){return n+t},t.prototype.GetSingleFlightForEachUniqueRoute=function(n){var i=this,t=new Dictionary;return n.forEach(function(n){var r=i.GetKey(n.DepartureIata,n.ArrivalIata);t.ContainsKey(r)||t.Set(r,n)}),t},t.prototype.IsApdApplicableForRequest=function(n){var t=n.ChildSeats>0,i=n.AdultSeats==0;return t&&!i},t.ServiceName="Availability_ApdService",t.$inject=["Controls_MessageCarouselService","Sitecore_FlightCardCarouselMessageSettings"],t}();t.ApdService=i})(i=t.Availability||(t.Availability={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i,r,f,"DA-AVL",Main3.Cookies.CookieConstants.Names.AvailabilityPodIdentifier)||this;return e._routesService=new Main3.Routes.RoutesService(u),e}return __extends(t,n),t.prototype.GetHeaders=function(){return null},t.prototype.Query=function(n,t,i){var r=Utilities.Clone(n);r.DepartureIata=this._routesService.GetAvailabilityIata(n.DepartureIata);r.ArrivalIata=this._routesService.GetAvailabilityIata(n.ArrivalIata);this.AjaxRequest("GET","availability/query",r,t,this.ExtractKnownError(i),"Availability.Query",!0)},t.ServiceName="Availability_Api",t.$inject=["ClientApi_Service","$http","$httpParamSerializer","Sitecore_RoutesData","IAnalyticsTracker"],t}(n.BaseClientApiService);t.AvailabilityApi=i})(t=n.Availability||(n.Availability={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(){function t(t,i,r,u,f){this._availabilityApi=t;this._priceService=i;this._availabilityApdService=r;this._errorService=u;this._cachedAvailabilityApi=new Main3.FlightGrid.CachedAvailabilityApi(new Main3.Routes.RoutesService(f),this._availabilityApi);this._priceMapper=new n.Common.PriceDataMapper;this._flightAssembler=new n.Common.AvailabilityResponseToFlightMapper}return t.prototype.FindFlight=function(n,t,i,r,u,f,e,o,s,h,c,l,a){c===void 0&&(c=!1);l===void 0&&(l=!1);a===void 0&&(a=undefined);var v={AdultSeats:u,ChildSeats:f,Infants:e,AdditionalSeats:0,DepartureIata:n,ArrivalIata:t,CurrencyCode:a===undefined?this._priceService.GetCurrentCurrency().CurrencyCode:a,LanguageCode:h,MinDepartureDate:i.ToIso8601(),MaxDepartureDate:i.ToIso8601(),IncludePrices:!!h,IsTransfer:!1,IncludeFlexiFares:o,FlightNumbers:[r],IsPartOfReturnJourney:l,IncludeLowestFareSeats:!1,IncludeAdminFees:!0};c?(v.DepartureIata=t,v.ArrivalIata=n,v.MinReturnDate=i.ToIso8601(),v.MaxReturnDate=i.ToIso8601(),this.SingleFlightQueryApiRequest(v,s,n)):this.SingleFlightQueryApiRequest(v,s)},t.prototype.SingleFlightQueryApiRequest=function(n,t,i){var r=this;this._availabilityApi.Query(n,function(u){var f;if(u.AvailableFlights.length>0){var e=null,o=n.AdultSeats+n.ChildSeats+n.AdditionalSeats,s=n.IncludePrices;i&&u.AvailableFlights.length>1?(f=_(u.AvailableFlights).select(function(n){return n.DepartureIata===i}),f&&f.length>0&&(e=r._flightAssembler.CreateFlight(f[0],o,s))):e=r._flightAssembler.CreateFlight(u.AvailableFlights[0],o,s);t(e,u.DepartureBaseCurrencyCode)}else t(null,null)},this.HandleApiError.bind(this))},t.prototype.FindGridFlights=function(n,t,i){var r=this;this._cachedAvailabilityApi.Query(n,function(i){var u=[],f=n.AdultSeats+n.ChildSeats,e=n.IncludePrices;i.AvailableFlights.forEach(function(n){u.push(r._flightAssembler.CreateFlight(n,f,e))});r._availabilityApdService.SetFromFlights(u);r._availabilityApdService.ShowApdMessageForFlights(n,u);t({DepartureIata:n.DepartureIata,Flights:u,BaseCurrency:r.HandleBaseCurrency(i.DepartureBaseCurrencyCode,i.DisplayCurrencyCode)})},function(n,t,u){r.HandleApiError(n,t,u,i)})},t.prototype.HandleApiError=function(n,t,i,r){this._errorService.HandleApiError(n,t,i);!r||r()},t.prototype.HandleBaseCurrency=function(n,t){return n==null?t:n},t.ServiceName="Availability_AvailabilityService",t.$inject=["Availability_Api","Common_PriceService","Availability_ApdService","Error_Service","Sitecore_RoutesData"],t}();t.AvailabilityService=i})(t=n.Availability||(n.Availability={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.prototype.AlertReviewSectionChangedQueue=function(){Utilities.ScreenReader.AlertQueued("reviewSectionChanged")},n.prototype.QueueAlertReviewEditSelected=function(n){Utilities.ScreenReader.QueueAlert(n,"reviewSectionChanged")},n.prototype.AlertQueued=function(n){Utilities.ScreenReader.AlertQueued(n)},n.prototype.QueueAlert=function(n,t){Utilities.ScreenReader.QueueAlert(n,t)},n.ServiceName="Common_AccessibilityService",n}();n.AccessibilityService=t})(t=n.Common||(n.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i,null,null,null)||this;return e._qService=r,e._languageSettings=u,e._apiSettings=f,e}return __extends(t,n),t.prototype.GetAirportsInformation=function(n){var t=_.uniq(n).sort();return this.CallEndpoint(t)},t.prototype.CallEndpoint=function(n){var t=this._qService.defer(),i={scLang:this._languageSettings.SitecoreLanguageCode,iatas:n};return this.AjaxRequest("GET",this._apiSettings.ApiPath,i,function(n){return t.resolve(n)},function(){return t.reject()},null),t.promise},t.prototype.GetDistinctFlightAirportIatas=function(n){return _.chain(n).map(function(n){return[n.DepartureIata,n.ArrivalIata]}).flatten().uniq().value()},t.prototype.GetAirportsInformationFromIataList=function(n){var t=this._qService.defer(),i=[];return this.GetAirportsInformation(n).then(function(r){var u=r.AirportsInformation;n.map(function(n){var t=u.filter(function(t){return t.Iata===n})[0];!t||i.push(t)});t.resolve(i)}),t.promise},t.ServiceName="Common_AirportsInformationService",t.$inject=["$http","$httpParamSerializer","$q","Sitecore_SitecoreLanguageSettings","AirportsInformation_ApiSettings"],t}(n.BaseApiService);t.AirportInformationService=i})(t=n.Common||(n.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function i(){this.B2bSeatsAreAlwaysAvailableValue=9;this._priceMapper=new t.PriceDataMapper}return i.prototype.CreateFlight=function(t,i,r){var u=new n.Data.Common.Flight(System.Guid.Empty().ToString(),t.CarrierCode,t.FlightNumber,t.SegmentId,t.FlightKey,t.DepartureIata,t.ArrivalIata,t.LocalDepartureTime,t.LocalArrivalTime,t.IsDisrupted,n.Data.Common.PromotionalFareType.Parse(t.PromotionalFareType),!1,t.FlightTaxes);return!t.FlightFares||(u.FlightFares=this.AssembleFlightFares(t.FlightFares,i,r)),u},i.prototype.AssembleFlightFares=function(n,t,i){var u=this,r=[];return n.forEach(function(n){r.push(u.AssembleFlightFare(n,t,i))}),r},i.prototype.AssembleFlightFare=function(t,i,r){var u=new n.Data.Common.FlightFare(t.FareType);return u.SeatsAvailable=t.SeatsAvailable,u.LowestFareSeatsAvailable=t.LowestFareSeatsAvailable,u.HasEnoughSeatsForRequiredPassengers=this.HasEnoughSeatsForRequiredPassengers(t,i),u.IsMissingPrices=r&&!t.Prices,!t.Prices||(u.Prices=this._priceMapper.MapFlightPricesFromApi(t.Prices),u.FlightIdentification=t.FlightIdentification),u},i.prototype.HasEnoughSeatsForRequiredPassengers=function(n,t){return n.SeatsAvailable===this.B2bSeatsAreAlwaysAvailableValue?!0:n.SeatsAvailable>=t},i}();t.AvailabilityResponseToFlightMapper=i})(i=t.Common||(t.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._refreshInterval=n;this._hasStarted=!1;this._items=[]}return n.prototype.RegisterPeriodicRefresher=function(n){n.ResetRefreshSeconds(this._refreshInterval);this._items.push(n);this._hasStarted&&this.ResetRefreshAll()},n.prototype.RemovePeriodicRefresher=function(n){this._items=this._items.filter(function(t){return t!=n})},n.prototype.ResetRefreshAll=function(){this._items&&(this._items.forEach(function(n){return n.ResetRefresh()}),this._hasStarted=!0)},n.prototype.ImmediateRefreshAll=function(){this._items&&this._items.forEach(function(n){return n.ImmediateRefresh()})},n}();n.BaseSyncedRefreshService=t})(t=n.Common||(n.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){this._bookerDetails={Title:null,FirstName:null,LastName:null,Email:null,ResidentOfDisplayText:"",ResidentOfValue:"",ResidentOfIsoCode:"",Telephone:new n.Data.Common.PhoneNumber,EjPlusNumber:"",MemberId:"",Address1:null,Address2:null,City:null,StateProvince:null,PostalCode:null,OptInForEasyJetMailing:null,OptInForMailing:null,KeepMeSignedInMinutes:0}}return t.prototype.GetBookerDetails=function(){return this._bookerDetails},t.ServiceName="Common_BookerDetailsDataService",t}();t.BookerDetailsDataService=i})(i=t.Common||(t.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this._http=n;this._httpParamSerializer=t;this._bookingComApiSettings=i;this._sitecoreLanguageSettings=r}return n.prototype.GetAirportSettings=function(n){return this.GetAirportSettingsPromiseInternal(n).then(function(n){return n.data})},n.prototype.GetAirportSettingsPromiseInternal=function(n){var t={languageCode:this._sitecoreLanguageSettings.SitecoreLanguageCode,airportCode:n},i={method:"GET",url:this._bookingComApiSettings.AirportSettingsApiPath+"?"+this._httpParamSerializer(t),responseType:"json",withCredentials:!0};return this._http(i)},n.ServiceName="CommonApi_BookingComApiService",n.$inject=["$http","$httpParamSerializer","BookingCom_ApiSettings","Sitecore_SitecoreLanguageSettings"],n}();n.BookingComApiService=t})(t=n.Common||(n.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.prototype.GetCurrentBreakpointName=function(){return Main3.Common.BreakPointService.GetCurrentBreakpointName()},n.prototype.IsBasketAlwaysVisible=function(){return Main3.Common.BreakPointService.IsBasketAlwaysVisible()},n.prototype.IsDesktop=function(){return Main3.Common.BreakPointService.IsDesktop()},n.prototype.IsDrawerSingleColumn=function(){return Main3.Common.BreakPointService.IsDrawerSingleColumn()},n.prototype.IsMobile=function(){return Main3.Common.BreakPointService.IsMobile()},n.prototype.IsTablet=function(){return Main3.Common.BreakPointService.IsTablet()},n.ServiceName="ejBreakPointService",n}();n.BreakPointService=t})(t=n.Common||(n.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.prototype.GetBrowserName=function(){return bowser.name||"Unknown"},t.prototype.GetBrowserVersion=function(){return Number(bowser.version)},t.prototype.IsMobileBrowser=function(){return bowser.mobile||!1},t.prototype.IsTabletBrowser=function(){return bowser.tablet||!1},t.prototype.IsChrome=function(){return bowser.chrome||!1},t.prototype.IsFirefox=function(){return bowser.firefox||!1},t.prototype.IsInternetExplorer=function(){return bowser.msie||!1},t.prototype.IsEdge=function(){return bowser.msedge||!1},t.prototype.IsSafari=function(){return bowser.safari||!1},t.prototype.IsIOS=function(){return bowser.ios||!1},t.prototype.IsWindowsPhone=function(){return bowser.windowsphone||!1},t.prototype.IsBlackberry=function(){return bowser.blackberry||!1},t.prototype.IsMac=function(){return bowser.mac||!1},t.prototype.IsLinux=function(){return bowser.linux||!1},t.prototype.IsWindows=function(){return bowser.windows||!1},t.prototype.GetDeviceType=function(){return this.IsTabletBrowser()?n.Data.Common.DeviceType.Tablet:this.IsMobileBrowser()?n.Data.Common.DeviceType.Mobile:n.Data.Common.DeviceType.Desktop},t.ServiceName="Common_BrowserDetectionService",t}();t.BrowserDetectionService=i})(i=t.Common||(t.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var i=function(){function n(n,t){this._stream="CIP";this._settings=n;var i=t.GetCookie();this._stream=i&&i.length>0?i:t.DefaultCookieValue()}return n.prototype.GetApiUrlByName=function(n){var i=this,t=this._settings.Types.filter(function(t){return t.Name.toLowerCase()===n.toLowerCase()&&t.Stream===i._stream});return t.length>0?t[0].Url:null},n.prototype.GetApiUrlByMethod=function(n){for(var i,f,o=this,r=null,u=0,e=this._settings.Types.filter(function(n){return n.Stream===o._stream});u<e.length;u++){if(i=e[u],f=this.AnyMethodMatches(n,i.Methods),f===t.Exact)return i.Url+n;f===t.Wildcard&&(r=i.Url)}return!r?"unknown/"+n:r+n},n.prototype.AnyMethodMatches=function(n,i){var r=i.map(function(n){return{ContainsWildcard:n.indexOf("*")>-1,MethodMatchString:n,Regex:new RegExp(n.replace("*","(.+)"))}}).filter(function(t){return t.Regex.test(n)}),u;return r.length>0?(u=r.filter(function(n){return!n.ContainsWildcard}).length>0,u?t.Exact:t.Wildcard):t.None},n.ServiceName="ClientApi_Service",n.$inject=["Sitecore_ClientApiSettings","ClientApi_CookieService"],n}(),t;n.ClientApiService=i,function(n){n[n.None=0]="None";n[n.Wildcard=1]="Wildcard";n[n.Exact=2]="Exact"}(t||(t={}))})(t=n.Common||(n.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._settings=n;this._window=t;this._browserDetectionService=i;this._step1="Step1";this._dateFormat=n.DateFormat.toUpperCase()}return t.prototype.FromUrl=function(n){var i=n.split("?",2),r=i[0],u=i[1],t=$jq.deparam(u);return{BaseUrl:r,OriginalUrl:n,Language:this.GetPropertyAndRemove(t,this._settings.LanguageKey),Currency:this.GetPropertyAndRemove(t,this._settings.CurrencyKey),OriginIata:this.GetPropertyAndRemove(t,this._settings.OriginAirportKey),DestinationIata:this.GetPropertyAndRemove(t,this._settings.DestinationAirportKey),DepartureDate:this.ToDate(this.GetPropertyAndRemove(t,this._settings.DepartureDateKey)),ReturnDate:this.ToDate(this.GetPropertyAndRemove(t,this._settings.ReturnDateKey)),Adults:this.ToNumber(this.GetPropertyAndRemove(t,this._settings.AdultPassengersKey)),Children:this.ToNumber(this.GetPropertyAndRemove(t,this._settings.ChildPassengersKey)),Infants:this.ToNumber(this.GetPropertyAndRemove(t,this._settings.InfantPassengersKey)),FlexiFare:this.GetPropertyAndRemove(t,this._settings.ShowFlexiFaresKey),View:this.GetPropertyAndRemove(t,this._settings.ViewKey),ComponentSender:this.GetPropertyAndRemove(t,this._settings.ComponentSenderKey),InspireMePopupSender:this.GetPropertyAndRemove(t,this._settings.InspireMePopupSenderIdentifier),InspireMeScrollerSender:this.GetPropertyAndRemove(t,this._settings.InspireMeScrollerSenderIdentifier),DepartureFlightNumber:this.GetPropertyAndRemove(t,this._settings.DepartureFlightNumberKey),ReturnFlightNumber:this.GetPropertyAndRemove(t,this._settings.ReturnFlightNumberKey),OpenSearchPanel:this.ToBool(this.GetPropertyAndRemove(t,this._settings.OpenSearchPanelKey)),RemainOnStep1:this.ToBool(this.GetPropertyAndRemove(t,this._settings.EndPageKey),this._step1),PaymentType:this.GetPropertyAndRemove(t,this._settings.PaymentTypeCodeKey),FunnelJourney:this.GetPropertyAndRemove(t,this._settings.FunnelJourneyKey),OtherParameters:t}},t.prototype.ToUrl=function(n,t){var r,i,u;if(t===void 0&&(t=null),n=this.ApplyDeepLinkGeneratorSettingsToDeepLink(n,t),!n.ComponentSender||(n.ComponentSender=n.ComponentSender.replace("{url}",this._window.location.pathname)),r=n.OriginalUrl||n.BaseUrl||this._settings.DeepLinkUrl,i=new Urls.UrlBuilder(r),i.AddOptionalQueryParameter(this._settings.LanguageKey,this.GetLanguageCodeForDeepLink(n.Language,r)),i.AddOptionalQueryParameter(this._settings.CurrencyKey,n.Currency),i.AddOptionalQueryParameter(this._settings.OriginAirportKey,n.OriginIata),i.AddOptionalQueryParameter(this._settings.DestinationAirportKey,n.DestinationIata),i.AddOptionalQueryParameter(this._settings.DepartureDateKey,this.FromDate(n.DepartureDate)),i.AddOptionalQueryParameter(this._settings.ReturnDateKey,this.FromDate(n.ReturnDate)),i.AddOptionalQueryParameter(this._settings.AdultPassengersKey,n.Adults),i.AddOptionalQueryParameter(this._settings.ChildPassengersKey,n.Children),i.AddOptionalQueryParameter(this._settings.InfantPassengersKey,n.Infants),i.AddOptionalQueryParameter(this._settings.ShowFlexiFaresKey,!n.FlexiFare?null:n.FlexiFare?"Y":"N"),i.AddOptionalQueryParameter(this._settings.ViewKey,n.View),i.AddOptionalQueryParameter(this._settings.ComponentSenderKey,n.ComponentSender),i.AddOptionalQueryParameter(this._settings.InspireMePopupSenderIdentifier,n.InspireMePopupSender),i.AddOptionalQueryParameter(this._settings.InspireMeScrollerSenderIdentifier,n.InspireMeScrollerSender),i.AddOptionalQueryParameter(this._settings.DepartureFlightNumberKey,n.DepartureFlightNumber),i.AddOptionalQueryParameter(this._settings.ReturnFlightNumberKey,n.ReturnFlightNumber),i.AddOptionalQueryParameter(this._settings.OpenSearchPanelKey,this.FromBool(n.OpenSearchPanel)),i.AddOptionalQueryParameter(this._settings.EndPageKey,n.RemainOnStep1?this._step1:null),i.AddOptionalQueryParameter(this._settings.PaymentTypeCodeKey,this.PaymentTypeValue(n.PaymentType)),i.AddOptionalQueryParameter(this._settings.FunnelJourneyKey,n.FunnelJourney),i.AddOptionalQueryParameter(this._settings.DeviceTypeKey,this.GetDeviceType(n.DeviceType)),!!n.OtherParameters)for(u in n.OtherParameters)i.AddOptionalQueryParameter(u,n.OtherParameters[u]);return i.GetUrl()},t.prototype.ApplyDeepLinkGeneratorSettingsToDeepLink=function(n,t){return!t||(n.ComponentSender||!t.ComponentSender||(n.ComponentSender=t.ComponentSender),n.FunnelJourney||!t.FunnelJourney||(n.FunnelJourney=t.FunnelJourney),!t.PartnerId||(!n.OtherParameters||n.OtherParameters.pid?n.OtherParameters||(n.OtherParameters={pid:t.PartnerId}):n.OtherParameters.pid=t.PartnerId)),n},t.prototype.GetLanguageCodeForDeepLink=function(n,t){return n?n:t.toLowerCase().indexOf(this._settings.LegacyUrlMarker)>-1?this._settings.LegacyLanguageCode:this._settings.DeepLinkTargetRegion?this._settings.DeepLinkTargetRegion:this._settings.LanguageCode},t.prototype.GetDeviceType=function(t){if(t==null){var i=this._browserDetectionService.GetDeviceType();return n.Data.Common.DeviceType[i]}return n.Data.Common.DeviceType[t]},t.prototype.PaymentTypeValue=function(n){return n==null?null:n.valueOf()==1?"D":n.valueOf()==0?"C":null},t.prototype.GetPropertyAndRemove=function(n,t){var i=n[t];return delete n[t],i},t.prototype.ToNumber=function(n){if(n){var t=parseInt(n);if(!isNaN(t))return t}return null},t.prototype.ToDate=function(n){if(n){var t=moment(n,this._dateFormat);if(t.isValid())return Utilities.TimeAgnosticDate.FromMoment(t)}return null},t.prototype.ToBool=function(n,t){return t===void 0&&(t="1"),!n?null:n===t},t.prototype.FromDate=function(n){return n?n.Format(this._dateFormat):null},t.prototype.FromBool=function(n){return n===!0?"1":n===!1?"0":null},t.ServiceName="Common_DeepLinksService",t.$inject=["Sitecore_DeepLinkSettings","$window","Common_BrowserDetectionService"],t}();t.DeepLinksService=i})(i=t.Common||(t.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this._rootScope=n;this._window=t}return t.prototype.NavigateTo=function(t,i){var r=this;i===void 0&&(i=!1);this._rootScope.$evalAsync(function(){r._rootScope.$broadcast(n.Events.Names.NavigationService.ChangeStart,t).defaultPrevented||(i?r._window.open(t,"_blank","toolbar=yes,menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes"):r._window.location.href=t)});this._rootScope.$$phase||this._rootScope.$digest()},t.ServiceName="Common_NavigationService",t.$inject=["$rootScope","$window"],t}();t.NavigationService=i})(i=t.Common||(t.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._callbackUrl="/ejcms/nocache/jsCallbacks/NearestAirport.aspx";this._http=n;this._analytics=t}return n.prototype.GetNearestAirportCodeAsync=function(){var n=this;return this._callbackPromise||(this._callbackPromise=this._http({method:"GET",url:this._callbackUrl}).then(function(t){return n.TrackNearestAirportLookup(t.data.toString()),t.data.toString()})),this._callbackPromise},n.prototype.TrackNearestAirportLookup=function(n){var t=n||"[null]";this._analytics.TrackNonInteractionEvent("Personalisation","Nearest Airport",t)},n.ServiceName="Common_NearestAirport",n.$inject=["$http","IAnalyticsTracker"],n}();n.NearestAirportService=t})(t=n.Common||(n.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._validAgeSettings=n;this._defaultMaxAge=200}return t.prototype.GetLatestValidDateOfBirthForPassengerType=function(t,i,r){return t===n.Data.Common.PassengerDataType.Adult?r.SubtractYears(this._validAgeSettings.MinimumAdultAgeInYears):t===n.Data.Common.PassengerDataType.Child?r.SubtractYears(this._validAgeSettings.MinimumChildAgeInYears):i.SubtractDays(this._validAgeSettings.MinimumInfantAgeInDays)},t.prototype.GetEarliestValidDateOfBirthForPassengerType=function(t,i){return t===n.Data.Common.PassengerDataType.Child?i.SubtractYears(this._validAgeSettings.MaximumChildAgeInYears).AddDays(1):t===n.Data.Common.PassengerDataType.Infant?i.SubtractYears(this._validAgeSettings.MaximumInfantAgeInYears).AddDays(1):i.SubtractYears(this._defaultMaxAge)},t.ServiceName="Common_PassengerAgeService",t.$inject=["Sitecore_PassengerAgeValidationSettings",],t}();t.PassengerAgeService=i})(i=t.Common||(t.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._passengerDetailsPersonSettings=n}return t.prototype.NifSettings=function(){return this._passengerDetailsPersonSettings.NifNumber},t.prototype.PassengerShouldBeAnAdultBasedOnAge=function(t){return this._passengerDetailsPersonSettings.ChildAgeOptions.filter(function(t){return t.AssociatedPassengerType===n.Data.Common.PassengerDataType.Adult}).some(function(n){return n.DropDownOptionData.Value===t})},t.prototype.GetDisplayName=function(t){return(t=this.EnsureEnumTypeForPassenger(t),t.Type===n.Data.Common.PassengerDataType.Adult)?this.GetAdultDisplayName(t,1):t.Type===n.Data.Common.PassengerDataType.Child?this.GetChildDisplayName(t,1):t.Type===n.Data.Common.PassengerDataType.Infant?this.GetInfantDisplayName(t,1):""},t.prototype.GetAdultDisplayName=function(n,t){var i=this.GetPassengerSuppliedDisplayName(n,!1);return i?i:this._passengerDetailsPersonSettings.AdultTitleLabel.replace("{number}",t.toString())},t.prototype.GetChildDisplayName=function(n,t){var i=this.GetPassengerSuppliedDisplayName(n,!0);return i?i:this._passengerDetailsPersonSettings.ChildTitleLabel.replace("{number}",t.toString())},t.prototype.GetInfantDisplayName=function(n,t){if(n){if(n.FirstName&&n.LastName)return n.FirstName+" "+n.LastName;if(n.FirstName)return n.FirstName}return this._passengerDetailsPersonSettings.InfantTitleLabel.replace("{number}",t.toString())},t.prototype.GetPassengerSuppliedDisplayName=function(n,t){if(n){if(n.FirstName&&n.LastName)return n.FirstName+" "+n.LastName;if(n.Title&&n.LastName){var i=n.Title;if(i=t?this.GetChildTitle(n.Title):this.GetAdultTitle(n.Title),i)return i+" "+n.LastName}if(n.FirstName)return n.FirstName}return null},t.prototype.GetNonInfantPassengerSuppliedDisplayNameWithTitle=function(n){if(n=this.EnsureEnumTypeForPassenger(n),!!n&&n.Title&&n.FirstName&&n.LastName){var t=this.GetNonInfantPassengerTitle(n.Type,n.Title);return t+" "+n.FirstName+" "+n.LastName}return""},t.prototype.GetNonInfantPassengerTitle=function(t,i){return t==n.Data.Common.PassengerDataType.Child?this.GetChildTitle(i):this.GetAdultTitle(i)},t.prototype.GetChildTitle=function(n){if(n){var t=this._passengerDetailsPersonSettings.ChildTitleOptions.filter(function(t){return t.Value==n});return t.length>0?t[0].DisplayText:n}return""},t.prototype.GetAdultTitle=function(n){if(n){var t=this._passengerDetailsPersonSettings.AdultTitleOptions.filter(function(t){return t.Value==n});return t.length>0?t[0].DisplayText:n}return""},t.prototype.GetAdultTitleDropDownOptions=function(){return this._passengerDetailsPersonSettings.AdultTitleOptions},t.prototype.GetChildTitleDropDownOptions=function(){return this._passengerDetailsPersonSettings.ChildTitleOptions},t.prototype.GetInfantTitleDropDownOptions=function(){return this._passengerDetailsPersonSettings.InfantTitleOptions},t.prototype.GetAdultAgeOptions=function(){return this.MapAgeOptions(this._passengerDetailsPersonSettings.AdultAgeOptions)},t.prototype.GetChildAgeOptions=function(){return this.MapAgeOptions(this._passengerDetailsPersonSettings.ChildAgeOptions)},t.prototype.GetInfantAgeOptions=function(){return this.MapAgeOptions(this._passengerDetailsPersonSettings.InfantAgeOptions)},t.prototype.MapAgeOptions=function(n){return n.map(function(n){return n.DropDownOptionData})},t.prototype.GetPassengerAge=function(n){var t=n.Type;return n=this.EnsureEnumTypeForPassenger(n),this.GetAgeDisplayText(t,n.Age)},t.prototype.GetAgeDisplayText=function(t,i){var r,u;return!i?"":(r=[],t===n.Data.Common.PassengerDataType.Adult?r=this._passengerDetailsPersonSettings.AdultAgeOptions:t===n.Data.Common.PassengerDataType.Child?r=this._passengerDetailsPersonSettings.ChildAgeOptions:t===n.Data.Common.PassengerDataType.Infant&&(r=this._passengerDetailsPersonSettings.InfantAgeOptions),u=r.filter(function(n){return n.DropDownOptionData.Value==i}),u.length>0)?u[0].DropDownOptionData.DisplayText:i.toString()},t.prototype.GetPassengerInitials=function(n,t){var i,r;return n.FirstName&&n.FirstName.length>0&&(i=n.FirstName.charAt(0)),n.LastName&&n.LastName.length>0&&(r=n.LastName.charAt(0)),i||r?(i||"")+(r||""):""+(t+1)},t.prototype.EnsureEnumTypeForPassenger=function(t){return typeof t.Type=="string"&&(t.Type=n.Data.Common.PassengerDataType.Parse(t.Type)),t},t.ServiceName="Common_PassengerDisplayService",t.$inject=["Sitecore_FunnelPassengerDetailsPersonSettings"],t}();t.PassengerDisplayService=i})(i=t.Common||(t.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._apiPaymentMethodSettings=n;this._paymentCardSettings=t}return n.prototype.GetPaymentVendorName=function(n){return this.GetCardDisplayName(n)||this.GetOtherPaymentMethodDisplayName(n)||n},n.prototype.GetPaymentCardWithVendorCode=function(n){return _(this._paymentCardSettings.PaymentCards).find(function(t){return t.B2BCardCode===n})},n.prototype.GetPaymentCardWithPaymentMethodType=function(n){return _(this._paymentCardSettings.PaymentCards).find(function(t){return t.PaymentMethodType===n})},n.prototype.GetCardDisplayName=function(n){var t=this.GetPaymentCardWithVendorCode(n);return!t?null:t.PaymentCardDisplayName},n.prototype.GetOtherPaymentMethodDisplayName=function(n){var t=this.GetApiPaymentMethodWithVendorCode(n);return!t?null:t.DisplayName},n.prototype.GetApiPaymentMethodWithVendorCode=function(n){return _(this._apiPaymentMethodSettings.ApiPaymentMethods).find(function(t){return t.B2bCode===n})},n.ServiceName="Sitecore_PaymentSettingsService",n.$inject=["Sitecore_ApiPaymentMethodSettings","Sitecore_PaymentCardSettings"],n}();n.PaymentSettingsService=t})(t=n.Common||(n.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.prototype.MapFlightPricesToApi=function(n){return n?{Adult:this.MapToApi(n.Adult),Child:this.MapToApi(n.Child),Infant:this.MapToApi(n.Infant)}:null},t.prototype.MapFlightPricesFromApi=function(n){return n?{Adult:this.MapFromApi(n.Adult),Child:this.MapFromApi(n.Child),Infant:this.MapFromApi(n.Infant)}:null},t.prototype.MapToApi=function(t){return t?{PriceWithCreditCard:t[n.Data.Common.PaymentType.CreditCard],PriceWithDebitCard:t[n.Data.Common.PaymentType.DebitCard],Price:t[n.Data.Common.PaymentType.Base]}:null},t.prototype.MapFromApi=function(t){if(t){var i={};return i[n.Data.Common.PaymentType.CreditCard]=t.PriceWithCreditCard,i[n.Data.Common.PaymentType.DebitCard]=t.PriceWithDebitCard,i[n.Data.Common.PaymentType.Base]=t.Price,i}return null},t.prototype.MapFromApiKnownException=function(t){if(t){var i={};return i[n.Data.Common.PaymentType.CreditCard]=t.ValueWithCreditCard,i[n.Data.Common.PaymentType.DebitCard]=t.ValueWithDebitCard,i[n.Data.Common.PaymentType.Base]=t.Value,i}return null},t.prototype.MapFromNumber=function(t){if(this.HasNumericValue(t)){var i={};return i[n.Data.Common.PaymentType.CreditCard]=t,i[n.Data.Common.PaymentType.DebitCard]=t,i[n.Data.Common.PaymentType.Base]=t,i}return null},t.prototype.MapFromNumbers=function(t,i){if(this.HasNumericValue(i)&&this.HasNumericValue(t)){var r={};return r[n.Data.Common.PaymentType.CreditCard]=t,r[n.Data.Common.PaymentType.DebitCard]=i,r}return null},t.prototype.HasNumericValue=function(n){return n!=null&&!isNaN(n)},t.ServiceName="Funnel_PriceDataMapper",t}();t.PriceDataMapper=i})(i=t.Common||(t.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._moneySettings=n;var t=this._moneySettings.Currencies.filter(function(n){return n.IsDefaultForRegion});this._currencyCode=t&&t.length>0?t[0].CurrencyCode:this._moneySettings.Currencies[0].CurrencyCode}return t.prototype.GetPaymentType=function(){return this._paymentType==null||this._paymentType==undefined?this._moneySettings.AssumeCreditCardForPayment?n.Data.Common.PaymentType.CreditCard:n.Data.Common.PaymentType.DebitCard:this._paymentType},t.prototype.SetPaymentType=function(n){this._paymentType=n},t.prototype.GetNumericValue=function(n){var t=this.GetPaymentType();return n[t]},t.prototype.SetCurrencyCode=function(n){this.CurrencyCodeIsChangingFromOneValidCodeToAnother(n)&&(this._currencyCode=n)},t.prototype.CurrencyCodeIsChangingFromOneValidCodeToAnother=function(n){return!!this._currencyCode&&!!n&&n!==this._currencyCode},t.prototype.RenderPrice=function(n,t,i,r){return i===void 0&&(i=!0),n?this.Render(n[t],i,r):null},t.prototype.Render=function(n,t,i){var f,r,u,e;return t===void 0&&(t=!0),n!==null?(f=t?this.ApplyRoundingParameter(n):n,r=i?this.GetCurrencyForCode(i):this.GetCurrentCurrency(),u={CurrencyCode:r.CurrencyCode,Before:r.TextBefore,After:r.TextAfter,MajorNumber:"",MinorNumber:"",NumberSeparator:""},r.DecimalPlaces===0?u.MajorNumber=this.ApplyNumberFormatting(f.toFixed(0)):(e=f.toFixed(r.DecimalPlaces).split("."),u.NumberSeparator=this._moneySettings.CurrentCultureDecimalCharacter,u.MajorNumber=this.ApplyNumberFormatting(e[0]),u.MinorNumber=e[1]),u):null},t.prototype.ApplyNumberFormatting=function(n){var t=new Main3.Common.NumberFormatter(this._moneySettings.CurrentCultureNumberGroupSizes,this._moneySettings.CurrentCultureNumberGroupSeperator);return t.AddSeparators(n)},t.prototype.GetCurrentCurrency=function(){var t=this,n=this._moneySettings.Currencies.filter(function(n){return n.CurrencyCode===t._currencyCode});return n&&n.length>0?n[0]:this._moneySettings.Currencies[0]},t.prototype.GetCurrencyForCode=function(n){if(!n)return this.GetCurrentCurrency();var t=this._moneySettings.Currencies.filter(function(t){return t.CurrencyCode===n});return t&&t.length>0?t[0]:this.BuildNewCurrencyFromDefault(this._moneySettings.Currencies[0],n)},t.prototype.ApplyRoundingParameter=function(n,t){return t===void 0&&(t=this._moneySettings.RoundingParameter),!t||(n=Math.ceil(n/t)*t),n},t.prototype.Multiply=function(t,i){if(t){var r=new Big(t[n.Data.Common.PaymentType.CreditCard]||0),u=new Big(t[n.Data.Common.PaymentType.DebitCard]||0),f=new Big(t[n.Data.Common.PaymentType.Base]||0);return this.BuildPriceFromBigPrices(r.times(i),u.times(i),f.times(i))}return null},t.prototype.Divide=function(t,i){if(t){var r=new Big(t[n.Data.Common.PaymentType.CreditCard]||0),u=new Big(t[n.Data.Common.PaymentType.DebitCard]||0),f=new Big(t[n.Data.Common.PaymentType.Base]||0);return this.BuildPriceFromBigPrices(r.div(i),u.div(i),f.div(i))}return null},t.prototype.Add=function(){for(var f=[],t=0;t<arguments.length;t++)f[t]=arguments[t];var i=new Big(0),r=new Big(0),u=new Big(0);return f.forEach(function(t){t&&(i=i.plus(t[n.Data.Common.PaymentType.CreditCard]||0),r=r.plus(t[n.Data.Common.PaymentType.DebitCard]||0),u=u.plus(t[n.Data.Common.PaymentType.Base]||0))}),this.BuildPriceFromBigPrices(i,r,u)},t.prototype.Subtract=function(t){for(var f,r,e,u,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];for(f=[],r=0,e=o;r<e.length;r++)u=e[r],f.push(this.NewPrice(-u[n.Data.Common.PaymentType.CreditCard],-u[n.Data.Common.PaymentType.DebitCard],-u[n.Data.Common.PaymentType.Base]));return this.Add.apply(this,[t].concat(f))},t.prototype.BuildPriceFromBigPrices=function(t,i,r){r===void 0&&(r=null);var u={};return u[n.Data.Common.PaymentType.CreditCard]=Number(t),u[n.Data.Common.PaymentType.DebitCard]=Number(i),!r||(u[n.Data.Common.PaymentType.Base]=Number(r)),u},t.prototype.Compare=function(n,t){if(n&&t){var i=this.GetPaymentType(),r=n[i],u=t[i];return r>u?1:r<u?-1:0}return null},t.prototype.AreEqual=function(n,t){return this.Compare(n,t)===0},t.prototype.Difference=function(n,t){if(n&&t){var i=this.GetPaymentType(),r=n[i],u=t[i];return r-u}return null},t.prototype.NewPrice=function(t,i,r){t===void 0&&(t=null);i===void 0&&(i=null);r===void 0&&(r=null);t===null&&(t=0);i===null&&(i=t);var u={};return u[n.Data.Common.PaymentType.CreditCard]=t,u[n.Data.Common.PaymentType.DebitCard]=i,r!==null&&(u[n.Data.Common.PaymentType.Base]=r),u},t.prototype.RemoveCreditCardFee=function(t){if(!t)return null;var i=t[n.Data.Common.PaymentType.DebitCard];return this.NewPrice(i,i)},t.prototype.BuildNewCurrencyFromDefault=function(n,t){return{IsDefaultForRegion:!1,CurrencyCode:t,CurrencyId:0,TextBefore:n?t:"",TextAfter:n?t:"",DecimalPlaces:n.DecimalPlaces}},t.prototype.NumericPriceToString=function(n,t,i){var r=this.Render(n,t,i);return r.Before+r.MajorNumber+r.NumberSeparator+r.MinorNumber+r.After},t.ServiceName="Common_PriceService",t.$inject=["Sitecore_MoneySettings"],t}();t.PriceService=i})(i=t.Common||(t.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._window=n}return n.prototype.GetParameter=function(n){var t=new Urls.QueryString(this._window.location.href);return t.GetParameter(n)},n.ServiceName="Common_QueryStringService",n.$inject=["$window"],n}();n.QueryStringService=t})(t=n.Common||(n.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.prototype.PublishUpdate=function(n,t){var i,f,e,r,u,o;if(t===void 0&&(t=null),i=this.GetGroup(t),f=JSON.stringify(i.CurrentEventArgs),i.CurrentEventArgs=n(i.CurrentEventArgs),e=JSON.stringify(i.CurrentEventArgs),f!==e)for(r=0,u=i.Subscribers;r<u.length;r++)o=u[r],o(i.CurrentEventArgs)},n.prototype.Subscribe=function(n,t){if(t===void 0&&(t=null),!!n){var i=this.GetGroup(t);i.Subscribers.push(n);n(i.CurrentEventArgs)}},n.prototype.GetGroup=function(t){var r=t||"GLOBAL",i=Utilities.Arrays.FirstOrDefault(n._groups,function(n){return n.Key===r});return i||(i={Key:r,CurrentEventArgs:{},Subscribers:[]},n._groups.push(i)),i},n.ServiceName="Common_RuleBasedContentService",n.$inject=[],n._groups=[],n.SubscriberGroups={FlightGrid:"FlightGrid"},n}();n.RuleBasedContentService=t})(t=n.Common||(n.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(n){function t(t){var i=n.call(this)||this;return i._worldwideSettings=t,i}return __extends(t,n),t.prototype.OpenNewWindowWorldwideSearch=function(){Utilities.ScreenReader.Alert(this._worldwideSettings.OpenNewWindowAriaText,"openNewWindowWorldwideSearch")},t.prototype.WorldwideShowAllIncludingWorlwideByEasyJet=function(n){var t=n?this._worldwideSettings.ShowWorldwideAirportAriaText:this._worldwideSettings.HideWorldwideAirportsAriaText;!!t&&t.length>0&&Utilities.ScreenReader.Alert(t,"worldWideShowAllIncludingWorlwideByEasyJet")},t.ServiceName="Search_AccessibilityService",t.$inject=["Sitecore_WorldwideSettings"],t}(n.AccessibilityService);n.SearchAccessibilityService=t})(t=n.Common||(n.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._window=n}return n.prototype.GetRawItem=function(n){return this._window.sessionStorage.getItem(n)},n.prototype.GetItem=function(n){var t=this.GetRawItem(n);return t?JSON.parse(t):null},n.prototype.SetItem=function(n,t){var i=typeof t=="string"?t.toString():JSON.stringify(t);return this._window.sessionStorage.setItem(n,i)},n.prototype.RemoveItem=function(n){return this._window.sessionStorage.removeItem(n)},n.ServiceName="SessionStorage_Service",n.$inject=["$window"],n}();n.SessionStorageService=t})(t=n.Common||(n.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){this._store=[]}return n.prototype.Register=function(n){n.Scope=null;n.Options=null;this._store.push(n)},n.prototype.Get=function(n){var t=this._store.filter(function(t){return t.Key==n});return t&&t.length>0?t[0]:(console.warn("Drawer section with key '"+n+"' not found"),null)},n.prototype.Contains=function(n){return this._store.filter(function(t){return t.Key==n}).length>0},n.ServiceName="Controls_DrawerSectionStore",n}();n.DrawerSectionStore=t})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){this._messageIsOpen=!1;this._lastOpenedMessagePriority=0}return n.prototype.IsMessageOpen=function(){return this._messageIsOpen},n.prototype.IsHigherPriorityMessageOpen=function(n){return this._messageIsOpen?this._lastOpenedMessagePriority>n:!1},n.prototype.SetMessageOpen=function(n){this._messageIsOpen=!0;this._lastOpenedMessagePriority=!n?-1:n},n.prototype.SetMessageClosed=function(){this._messageIsOpen=!1},n.ServiceName="Controls_ErrorMessageService",n}();n.ErrorMessageService=t})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._priceService=n;this._routesService=new Main3.Routes.RoutesService(t)}return n.prototype.MapFlatListOfFlightsToPairs=function(n){for(var r,i=[],t=null,u=0;u<n.length;u++)r=n[u],t==null?t=r:this.IsFlightReturnPartOfOtherFlight(t,r)?(i.push({BaseCurrency:this._priceService.GetCurrentCurrency().CurrencyCode,IsPrimaryPair:i.length===0,OutboundFlight:t,ReturnFlight:r}),t=null):(i.push({BaseCurrency:this._priceService.GetCurrentCurrency().CurrencyCode,IsPrimaryPair:i.length===0,OutboundFlight:t,ReturnFlight:null}),t=r);return!t||i.push({BaseCurrency:this._priceService.GetCurrentCurrency().CurrencyCode,IsPrimaryPair:i.length===0,OutboundFlight:t,ReturnFlight:null}),i},n.prototype.IsFlightReturnPartOfOtherFlight=function(n,t){return this.IataIsSameAsOrInSameMarketGroupAsOther(n.DepartureIata,t.ArrivalIata)&&this.IataIsSameAsOrInSameMarketGroupAsOther(n.ArrivalIata,t.DepartureIata)},n.prototype.IataIsSameAsOrInSameMarketGroupAsOther=function(n,t){var i=this._routesService.GetMarketGroupCodeForIata(n),r=null;return r=i?this._routesService.GetIatasForMarketGroup(i):[n],r.filter(function(n){return n.toUpperCase()===t.toUpperCase()}).length>0},n}();n.FlightPairMapperService=t})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this.QuantityPlaceholder="{quantity}";this.WeightPlaceholder="{weight}";this.NamePlaceholder="{name}";this._luggageSettings=n}return t.prototype.CreateFormatBagText=function(n,t){return t=t.replaceAll(this.QuantityPlaceholder,n.Quantity.toString()),t.replaceAll(this.WeightPlaceholder,n.Description)},t.prototype.FormatBag=function(t){var i=t.Type===n.Data.Controls.DisplayItemType.SmallBag?this._luggageSettings.TextSettings.SmallBagFormat:this._luggageSettings.TextSettings.BagFormat;return this.CreateFormatBagText(t,i)},t.prototype.FormatSportsEquipment=function(n){var i=this.GetSportsEquipmentName(n),t;return n.Quantity?(t=this._luggageSettings.TextSettings.SportsEquipmentFormat,t=t.replaceAll(this.QuantityPlaceholder,n.Quantity.toString()),t.replaceAll(this.NamePlaceholder,i)):i},t.prototype.FormatCabinBags=function(n){var t=this._luggageSettings.TextSettings.CabinBagFormat;return t?t.replaceAll(this.QuantityPlaceholder,n.length.toString()):""},t.prototype.GetSportsEquipmentName=function(n){var t=this._luggageSettings.SportsEquipmentNameSettings.Names.filter(function(t){return t.CodeName==n.Description});return t.length>0?n.Quantity?t[0].SingularText:t[0].UnknownQuantityText:n.Description+(n.Quantity?"":"(s)")},t.ServiceName="Controls_LuggageService",t.$inject=["Sitecore_LuggageSettings"],t}();t.LuggageService=i})(i=t.Controls||(t.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){this._registeredCarousels=[];this._pendingMessages=[]}return n.prototype.RegisterCarousel=function(n){this.CarouselAlreadyRegistered(n.Key)&&this.PreserveMessagesAndRemoveExistingCarouselRegistration(n);this._registeredCarousels.push(n);this.ProcessPendingMessages(n)},n.prototype.AddMessage=function(n,t,i){var r=this.GetCarouselByKey(n);r?r.OnAdd(t,i):this.AddPendingMessage(n,t,i)},n.prototype.RemoveMessage=function(n,t){var i=this.GetCarouselByKey(n);i?i.OnRemove(t):this.RemovePendingMessage(n,t)},n.prototype.AddPendingMessage=function(n,t,i){var r={CarouselKey:n,Key:t,Message:i};this._pendingMessages.push(r)},n.prototype.RemovePendingMessage=function(n,t){this._pendingMessages=this._pendingMessages.filter(function(i){return i.CarouselKey!=n&&i.Key!=t})},n.prototype.CarouselAlreadyRegistered=function(n){return this._registeredCarousels.some(function(t){return t.Key==n})},n.prototype.GetCarouselByKey=function(n){return this._registeredCarousels.filter(function(t){return t.Key==n}).pop()},n.prototype.PreserveMessagesAndRemoveExistingCarouselRegistration=function(n){var t=this,i=this.GetCarouselByKey(n.Key);i.GetCurrentMessages().forEach(function(i){t.AddPendingMessage(n.Key,i.Key,i.Message)});this._registeredCarousels=this._registeredCarousels.filter(function(t){return n.Key!==t.Key})},n.prototype.ProcessPendingMessages=function(n){var t=this,i=this._pendingMessages.filter(function(t){return t.CarouselKey==n.Key});i.forEach(function(n){t.AddMessage(n.CarouselKey,n.Key,n.Message);t.RemovePendingMessage(n.CarouselKey,n.Key)})},n.ServiceName="Controls_MessageCarouselService",n.$inject=["$rootScope"],n}();n.MessageCarouselService=t})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.prototype.GetRandomPercentage=function(){return Math.random()*100},n.ServiceName="Controls_RandomNumberGeneratorService",n.$inject=[],n}();n.RandomNumberGeneratorService=t})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this._http=n;this._q=t;this._httpParamSerializer=i;this._apiSettings=r;this._cachedRouteDatePromises=new Dictionary}return n.prototype.GetCachedRouteDates=function(n,t){var i=n.join("|")+"_"+t.join("|"),r;return this._cachedRouteDatePromises.ContainsKey(i)?this._cachedRouteDatePromises.Get(i):(r=this.GetRouteDates(n,t),this._cachedRouteDatePromises.Set(i,r),r)},n.prototype.GetRouteDates=function(n,t){var i={originIata:n,destinationIata:t},r={method:"GET",url:this._apiSettings.ApiPath+"?"+this._httpParamSerializer(i),responseType:"json",withCredentials:!0};return this._http(r).then(function(n){return n.data})},n.ServiceName="Controls_RouteDatesApiService",n.$inject=["$http","$q","$httpParamSerializer","RouteDates_RouteDatesServiceApiSettings"],n}();n.RouteDatesApiService=t})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._routeDatesApiService=n;this._worldwideRouteDatesApiService=t;this._combinedRoutesService=i;this._cachedRouteDatePromises=new Dictionary}return n.prototype.GetDates=function(n,t,i){var r=n+"_"+t+"_"+(i?i.ToIso8601():""),u;return this._cachedRouteDatePromises.ContainsKey(r)?this._cachedRouteDatePromises.Get(r):(u=this.GetRouteDatesUncached(n,t,i),this._cachedRouteDatePromises.Set(r,u),u)},n.prototype.GetRouteDatesUncached=function(n,t,i){var e=this,r=[n||""],u=[t||""],f=this.IsWorldwideRouteSelected(n,t);return f||(this._combinedRoutesService.IsMarketGroup(n,!1)&&(r=this._combinedRoutesService.GetIatasForMarketGroup(n,!1)),this._combinedRoutesService.IsMarketGroup(t,!1)&&(u=this._combinedRoutesService.GetIatasForMarketGroup(t,!1))),this.GetRouteDatesFromApi(r,u,f).then(function(n){return e.TruncateRouteDates(angular.copy(n),i)})},n.prototype.GetRouteDatesFromApi=function(n,t,i){return i?this._worldwideRouteDatesApiService.GetCachedRouteDates(n,t):this._routeDatesApiService.GetCachedRouteDates(n,t)},n.prototype.IsWorldwideRouteSelected=function(n,t){return!n||!t?!1:this._combinedRoutesService.IsWorldwideRoute(n,t)},n.prototype.TruncateRouteDates=function(n,t){return!t||!n?n:(n.Months=n.Months.filter(function(n){return n.YearNumber>t.Year()||n.YearNumber===t.Year()&&n.MonthNumber>=t.Month()}),n.Months.length===0)?n:(n.Months[0].FlightDates=n.Months[0].FlightDates.filter(function(n){return n>=t.DayOfMonth()}),n)},n.ServiceName="Controls_RouteDatesService",n.$inject=["Controls_RouteDatesApiService","Controls_WorldwideRouteDatesApiService","Worldwide_CombinedRoutesService"],n}();n.RouteDatesService=t})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this._http=n;this._q=t;this._httpParamSerializer=i;this._apiSettings=r;this._cachedRouteDatePromises=new Dictionary}return n.prototype.GetCachedRouteDates=function(n,t){var i=n.join("|")+"_"+t.join("|"),r;return this._cachedRouteDatePromises.ContainsKey(i)?this._cachedRouteDatePromises.Get(i):(r=this.GetRouteDates(n,t),this._cachedRouteDatePromises.Set(i,r),r)},n.prototype.GetRouteDates=function(n,t){var i={originIata:n,destinationIata:t},r={method:"GET",url:this._apiSettings.WorldwideRoutesApiPath+"?"+this._httpParamSerializer(i),responseType:"json",withCredentials:!0};return this._http(r).then(function(n){return n.data})},n.ServiceName="Controls_WorldwideRouteDatesApiService",n.$inject=["$http","$q","$httpParamSerializer","RouteDates_RouteDatesServiceApiSettings"],n}();n.WorldwideRouteDatesApiService=t})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._priceService=n}return n.prototype.GetFallbackCurrencyCode=function(){return this._priceService.GetCurrentCurrency().CurrencyCode},n.prototype.MapFlight=function(n){return!n?null:{ArrivalIata:n.ArrivalIata,CarrierCode:n.CarrierCode,DepartureIata:n.DepartureIata,FlightNumber:n.FlightNumber,LocalArrivalTime:n.LocalArrivalTime,LocalDepartureTime:n.LocalDepartureTime}},n}();n.BaseBookingDataMapper=t})(t=n.BookingData||(n.BookingData={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._qService=n;this._expectedSources=[];this._mostReleventData=null;this._mostReleventDataSource=null;this._dataDelivered=!1;this._dataDeferred=this._qService.defer();this.DataPromise=this._dataDeferred.promise}return n.prototype.Expecting=function(n){if(this._dataDelivered)throw new Error("Adding expected booking data source after data has already been resolved");this._expectedSources.push(n)},n.prototype.Received=function(n,t){this._dataDelivered||!t||((!this._mostReleventDataSource||this._mostReleventDataSource<n)&&(this._mostReleventDataSource=n,this._mostReleventData=t),this._expectedSources=this._expectedSources.filter(function(t){return t!==n}),this._expectedSources.length!==0||!this._mostReleventData||(this._dataDeferred.resolve(this._mostReleventData),this._dataDelivered=!0))},n.ServiceName="Controls_BookingDataService",n.$inject=["$q"],n}();n.BookingDataService=t})(t=n.BookingData||(n.BookingData={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){n[n.FlightConfirmationCookie=1]="FlightConfirmationCookie";n[n.FunnelBasket=2]="FunnelBasket";n[n.FunnelBooking=3]="FunnelBooking";n[n.DisruptionBasket=4]="DisruptionBasket"})(t=n.BookingDataSource||(n.BookingDataSource={}))})(t=n.BookingData||(n.BookingData={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(i){var r=function(i){function r(n,r){var u=i.call(this,n)||this;return u._flightPairMapperService=new t.FlightPairMapperService(n,r),u}return __extends(r,i),r.prototype.Map=function(n){return!n?null:{BookingReference:n.BookingReference,CurrencyCode:this.GetFallbackCurrencyCode(),Passengers:Main3.Common.BookingPassengers.CreateFromBasket(n).PassengerComposition(),FlightPairs:this.MapFlightPairs(n),AddedAncillaries:this.MapAncillaries(n)}},r.prototype.MapFlightPairs=function(t){for(var i,u=[],r=0,f=t.Flights;r<f.length;r++)i=f[r],i.Modification!==n.Data.Rebooking.FlightModificationType.Refund&&u.push(i.ReplacementFlight||i);return this._flightPairMapperService.MapFlatListOfFlightsToPairs(u)},r.prototype.MapAncillaries=function(t){var i=[];return t.Ancillaries.HasCar&&i.push(n.Data.Funnel.AncillaryType.Car),t.Ancillaries.HasHotelBooking&&i.push(n.Data.Funnel.AncillaryType.Hotel),t.Ancillaries.HasTravelInsurance&&i.push(n.Data.Funnel.AncillaryType.Insurance),i},r.ServiceName="Controls_DisruptionBasketBookingDataMapper",r.$inject=["Common_PriceService","Sitecore_RoutesData"],r}(i.BaseBookingDataMapper);i.DisruptionBasketBookingDataMapper=r})(i=t.BookingData||(t.BookingData={}))})(i=t.Controls||(t.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(n){function t(t){var i=n.call(this,t)||this;return i.DefaultDepartureHour=8,i.DefaultArrivalHour=22,i}return __extends(t,n),t.prototype.Map=function(n){var t,i,r;return!n?null:(t=Utilities.ZonelessDateTime.FromIso8601(n.OutboundDate).Date(),i={BaseCurrency:this.GetFallbackCurrencyCode(),IsPrimaryPair:!0,OutboundFlight:{ArrivalIata:n.DestinationAirportCode,CarrierCode:null,DepartureIata:n.OriginAirportCode,FlightNumber:null,LocalArrivalTime:t.ToZonelessDateTime(this.DefaultArrivalHour),LocalDepartureTime:t.ToZonelessDateTime(this.DefaultDepartureHour)},ReturnFlight:null},!n.ReturnDate||(r=Utilities.ZonelessDateTime.FromIso8601(n.ReturnDate).Date(),i.ReturnFlight={ArrivalIata:n.OriginAirportCode,CarrierCode:null,DepartureIata:n.DestinationAirportCode,FlightNumber:null,LocalArrivalTime:r.ToZonelessDateTime(this.DefaultArrivalHour),LocalDepartureTime:r.ToZonelessDateTime(this.DefaultDepartureHour)}),{BookingReference:n.BookingReference,CurrencyCode:this.GetFallbackCurrencyCode(),Passengers:{Adults:parseInt(n.NumberOfAdults),Children:parseInt(n.NumberOfChildren),Infants:parseInt(n.NumberOfInfants)},FlightPairs:[i],AddedAncillaries:[]})},t.ServiceName="Controls_FlightConfirmationCookieBookingDataMapper",t.$inject=["Common_PriceService"],t}(n.BaseBookingDataMapper);n.FlightConfirmationCookieBookingDataMapper=t})(t=n.BookingData||(n.BookingData={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(t){function i(n){return t.call(this,n)||this}return __extends(i,t),i.prototype.Map=function(n){return!n?null:{BookingReference:n.BookingReference,CurrencyCode:n.Currency||this.GetFallbackCurrencyCode(),Passengers:Main3.Common.BookingPassengers.CreateFromBasket(n).PassengerComposition(),FlightPairs:this.MapFlightPairs(n),AddedAncillaries:this.MapAncillaries(n)}},i.prototype.MapFlightPairs=function(n){var t=this;return n.JourneyPairs.map(function(n){return{BaseCurrency:n.BaseCurrency||t.GetFallbackCurrencyCode(),IsPrimaryPair:n.IsPrimaryPair,OutboundFlight:t.MapFlightSlot(n.OutboundSlot),ReturnFlight:t.MapFlightSlot(n.ReturnSlot)}})},i.prototype.MapFlightSlot=function(n){return!!n&&!!n.Flight?this.MapFlight(n.Flight):null},i.prototype.MapAncillaries=function(t){var i=[];return!t.Car||i.push(n.Data.Funnel.AncillaryType.Car),!t.Hotel||i.push(n.Data.Funnel.AncillaryType.Hotel),!t.TravelInsurance||i.push(n.Data.Funnel.AncillaryType.Insurance),i},i.ServiceName="Controls_FunnelBasketBookingDataMapper",i.$inject=["Common_PriceService"],i}(t.BaseBookingDataMapper);t.FunnelBasketBookingDataMapper=i})(i=t.BookingData||(t.BookingData={}))})(i=t.Controls||(t.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(i){var r=function(i){function r(n,r){var u=i.call(this,n)||this;return u._flightPairMapperService=new t.FlightPairMapperService(n,r),u}return __extends(r,i),r.prototype.Map=function(n){return!n?null:{BookingReference:n.BookingReference,CurrencyCode:n.Currency||this.GetFallbackCurrencyCode(),Passengers:Main3.Common.BookingPassengers.CreateFromBasket(n).PassengerComposition(),FlightPairs:this.MapFlightPairs(n),AddedAncillaries:this.MapAncillaries(n)}},r.prototype.MapFlightPairs=function(n){var t=this;return this._flightPairMapperService.MapFlatListOfFlightsToPairs(n.Flights.map(function(n){return t.MapFlight(n)}))},r.prototype.MapAncillaries=function(t){var i=[];return!t.CarBooking||!t.CarBooking.BookingReference||i.push(n.Data.Funnel.AncillaryType.Car),!t.HotelBooking||!t.HotelBooking.BookingNumber||i.push(n.Data.Funnel.AncillaryType.Hotel),!t.TravelInsuranceBooking||!t.TravelInsuranceBooking.PolicyNumber||i.push(n.Data.Funnel.AncillaryType.Insurance),i},r.ServiceName="Controls_FunnelBookingDataMapper",r.$inject=["Common_PriceService","Sitecore_RoutesData"],r}(i.BaseBookingDataMapper);i.FunnelBookingDataMapper=r})(i=t.BookingData||(t.BookingData={}))})(i=t.Controls||(t.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this._http=n;this._httpParamSerializer=t;this._lowestFaresApiSettings=i;this._sitecoreLanguageSettings=r;this._cachedData=new Dictionary}return n.prototype.GetLowestFaresPromise=function(n,t,i,r){var u=n+"_"+t+"_"+(i?i.ToIso8601():null)+"_"+r,f;return this._cachedData.ContainsKey(u)?this._cachedData.Get(u):(f=this.GetLowestFaresPromiseInternal(n,t,i,r),this._cachedData.Set(u,f),f)},n.prototype.GetLowestFaresPromiseInternal=function(n,t,i,r){var u={languageCode:this._sitecoreLanguageSettings.SitecoreLanguageCode,originIata:n,destinationIata:t,startDate:(i||Utilities.TimeAgnosticDate.TodayUtc()).ToIso8601(),displayCurrencyId:r},f={method:"GET",url:this._lowestFaresApiSettings.ApiPath+"?"+this._httpParamSerializer(u),responseType:"json",withCredentials:!0};return this._http(f)},n.ServiceName="Controls_LowestFaresApiService",n.$inject=["$http","$httpParamSerializer","LowestFares_ApiSettings","Sitecore_SitecoreLanguageSettings"],n}();n.LowestFaresApiService=t})(t=n.LowestFares||(n.LowestFares={}))})(t=n.RouteDates||(n.RouteDates={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(){}return t.prototype.FirstAvailableFlight=function(n){return this.HasMonthData(n)&&this.HasDayData(n.months[0])?this.GetFirstAvailableFlight(n.months):null},t.prototype.LastAvailableFlight=function(n){return this.HasMonthData(n)&&this.HasDayData(n.months[n.months.length-1])?this.GetFirstAvailableFlight(n.months,!0):null},t.prototype.HasMonthData=function(n){return n&&n.months&&n.months.length>0},t.prototype.HasDayData=function(n){return n.days&&n.days.length>0},t.prototype.GetFirstAvailableFlight=function(t,i){var u=t.slice(),r,f,e;for(i&&u.reverse(),r=0;r<u.length;r++)for(f=u[r].days.slice(),i&&f.reverse(),e=0;e<f.length;e++)if(f[e].flightStatus!==n.Controllers.Controls.RouteDatePicker.LowestFaresFlightStatus.Unavailable)return Utilities.TimeAgnosticDate.FromParts(u[r].year,u[r].month,f[e].day);return null},t.ServiceName="Controls_LowestFaresDataFlightFinder",t}();t.LowestFaresDataFlightFinder=i})(i=t.LowestFares||(t.LowestFares={}))})(i=t.RouteDates||(t.RouteDates={}))})(i=t.Controls||(t.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._priceService=n}return n.prototype.FromLowestFaresData=function(n,t,i,r){var f=this,u;return t?(u=[],angular.forEach(t.months,function(e){var o=new Main3.RouteDatePicker.LowestFaresGraph(e,t.priceTicks,f.FormatPriceTicks(t.priceTicks),n,i,r);u.push(o)}),u):null},n.prototype.FormatPriceTicks=function(n){var i=this,t=[];return n.forEach(function(n){var r=i._priceService.GetCurrentCurrency(),u=r.TextBefore.concat(n+r.TextAfter);t.push(u)}),t},n.ServiceName="Controls_LowestFaresGraphAssembler",n.$inject=["Common_PriceService"],n}();n.LowestFaresGraphAssembler=t})(t=n.LowestFares||(n.LowestFares={}))})(t=n.RouteDates||(n.RouteDates={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){var i=function(n){function t(t,i,r,u){var f=n.call(this,t,i,r,"DA-RMG","CMSPOD")||this;return f._baseUrl=Urls.UrlBuilder.UrlWithTrailingSlash(u.ApiUrl),f}return __extends(t,n),t.prototype.GetHtmlForMessageIds=function(n,t,i,r){this.AjaxRequest("GET",this._baseUrl+"routemessages/get",{messageids:n.join("|"),sc_lang:t},function(n){i(n.Html)},r,"RouteMessages.Get",!0)},t.ServiceName="RouteMessages_Api",t.$inject=["$http","$httpParamSerializer","IAnalyticsTracker","RouteMessage_ClientApiSettings"],t.UseMocks=!1,t}(n.BaseApiService);t.RouteMessagesApi=i})(i=t.RouteMessages||(t.RouteMessages={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._messageRules=n}return n.prototype.GetMatchingMessageIds=function(n){var t=[],i,e,r,u,o,f;if(!n||n.length===0||!this._messageRules||this._messageRules.length===0)return t;for(i=0,e=n;i<e.length;i++)if(r=e[i],r.From||r.To)for(u=0,o=this._messageRules;u<o.length;u++)f=o[u],t.indexOf(f.Id)===-1&&this.PairMatchesRule(r,f)&&t.push(f.Id);return t.sort()},n.prototype.PairMatchesRule=function(n,t){if((!t.From||t.From.length===0)&&(!t.To||t.To.length===0))return!1;var i=this.IataMatchesRuleOptions(n.From,t.From),r=this.IataMatchesRuleOptions(n.To,t.To);return i&&r},n.prototype.IataMatchesRuleOptions=function(n,t){return(t=t||[],t=t.map(function(n){return n.toUpperCase()}),t.length===0)?!0:t.indexOf(n.toUpperCase())>-1},n.ServiceName="Controls_RouteMessagesService",n.$inject=["Sitecore_RouteMessageRules"],n}();n.RouteMessagesService=t})(t=n.RouteMessages||(n.RouteMessages={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i){this._routesService=new Main3.Routes.RoutesService(i);this._showAllRoutes=undefined;t.$on(n.Events.Names.Drawer.Closing,this.ResetAllRoutesValue.bind(this))}return t.prototype.GetCurrentShowAllRoutesValue=function(){return this._showAllRoutes==undefined&&(this._showAllRoutes=this._routesService.GetDefaultValueForShowAllRoutes()),this._showAllRoutes},t.prototype.SetShowAllRoutesValue=function(n){this._showAllRoutes=n},t.prototype.ResetAllRoutesValue=function(){this._showAllRoutes=undefined},t.ServiceName="Controls_AirportListDrawerAllRoutesService",t.$inject=["$rootScope","Sitecore_RoutesData"],t}();t.AirportListDrawerAllRoutesService=i})(i=t.RouteSearch||(t.RouteSearch={}))})(i=t.Controls||(t.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(t,i){this._routesService=new Main3.Routes.RoutesService(i);this._showDirectRoutesOnly=undefined;t.$on(n.Events.Names.Drawer.Closing,this.ResetDirectRoutesOnlyValue.bind(this))}return t.prototype.GetCurrentShowDirectRoutesOnlyValue=function(n){return n?(this._showDirectRoutesOnly==undefined&&(this._showDirectRoutesOnly=this._routesService.GetDefaultValueForShowDirectRoutesOnly(n)),this._showDirectRoutesOnly):!1},t.prototype.SetShowDirectRoutesOnlyValue=function(n){this._showDirectRoutesOnly=n},t.prototype.ResetDirectRoutesOnlyValue=function(){this._showDirectRoutesOnly=undefined},t.ServiceName="Controls_AirportListDrawerDirectRoutesOnlyService",t.$inject=["$rootScope","Sitecore_RoutesData"],t}();t.AirportListDrawerDirectRoutesOnlyService=i})(i=t.RouteSearch||(t.RouteSearch={}))})(i=t.Controls||(t.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.prototype.FirstAvailableFlight=function(n){return this.HasMonthData(n)&&this.HasDayData(n.Months[0])?this.GetFirstAvailableFlight(n.Months):null},n.prototype.LastAvailableFlight=function(n){return this.HasMonthData(n)&&this.HasDayData(n.Months[n.Months.length-1])?this.GetLastFlightInMonth(n):null},n.prototype.GetLastFlightInMonth=function(n){return this.GetFirstAvailableFlight(n.Months,!0)},n.prototype.HasMonthData=function(n){return n&&n.Months&&n.Months.length>0},n.prototype.HasDayData=function(n){return n.FlightDates&&n.FlightDates.length>0},n.prototype.GetFirstAvailableFlight=function(n,t){var r=n.slice(),i,u,f;for(t&&r.reverse(),i=0;i<r.length;i++)for(u=r[i].FlightDates.slice(),t&&u.reverse(),f=0;f<u.length;f++)return Utilities.TimeAgnosticDate.FromParts(r[i].YearNumber,r[i].MonthNumber,u[f]);return null},n.ServiceName="Controls_RouteDataFlightFinder",n}();n.RouteDataFlightFinder=t})(t=n.RouteSearch||(n.RouteSearch={}))})(t=n.RouteDates||(n.RouteDates={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){var i=function(n){function t(){return n.call(this)||this}return __extends(t,n),t.prototype.AlertInvalidEntry=function(n){Utilities.ScreenReader.Alert(n,Constants.Accessibility.Messages.RouteSearch.InvalidEntry)},t.ServiceName="Common_RouteSearchAccessibilityService",t}(n.Common.AccessibilityService);t.RouteSearchAccessibilityService=i})(i=t.RouteSearch||(t.RouteSearch={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._routesService=new Main3.Routes.RoutesService(n);this._searchCookieService=t;this._recentSearchesCookieService=i}return n.prototype.GetSearchCookie=function(){var n=this._searchCookieService.GetLastSearch();return n?this.ConvertToFlightSearch(n):null},n.prototype.GetRecentSearches=function(){var n=this,t=this._recentSearchesCookieService.GetRecentSearches();return _(t).map(function(t){return n.ConvertToFlightSearch(t)}).filter(function(n){return!!n})},n.prototype.ClearRecentSearchesCookie=function(){this._recentSearchesCookieService.Clear()},n.prototype.ConvertToFlightSearch=function(n){var t=n.OriginIata,i=n.DestinationIata;return this.InvalidAirport(t)||this.InvalidAirport(i)?null:{OriginAirportIata:t,DestinationAirportIata:i,OutboundDate:n.OutboundDate,ReturnDate:n.ReturnDate,IsOneWayFlight:n.ReturnDate?!1:!0,Adults:n.Adults,Children:n.Children,Infants:n.Infants}},n.prototype.InvalidAirport=function(n){return this._routesService.FindAirportByIata(n)===null},n.ServiceName="Controls_FlightSearchCookieService",n.$inject=["Sitecore_RoutesData","SearchCookie_Service","RecentSearchesCookie_Service"],n}();n.FlightSearchCookieService=t})(t=n.SearchPod||(n.SearchPod={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._packageHolidaySettings=n;this._routesService=new Main3.Routes.RoutesService(t)}return n.prototype.ToUrl=function(n){if(!!n.DepartureDate&&!!n.ReturnDate){var t=n.DepartureDate,i=n.ReturnDate,r=i.DifferenceInDays(t);return this._packageHolidaySettings.PackageHolidayDeepLinkUrl.replace("{departureAirports}",this.IncludeMarketGroups(n.OriginIata)).replace("{destinations}",this.DestinationIdsFromAirport(n.DestinationIata)).replace("{departureDate}",t.ToIso8601()).replace("{returndate}",i.ToIso8601()).replace("{duration}",r.toString()).replace("{travellersPerRoom}",this.BuildTravellersPerRoom(n.Passengers)).replace("{roomcount}","1").replace("{shouldOpenRoomsWidget}",this.IncludesChildrenOrInfants(n.Passengers))}return null},n.prototype.DestinationHasPackageHolidayId=function(n){return!!this.DestinationIdsFromAirport(n.DestinationIata)},n.prototype.IncludeMarketGroups=function(n){return this._routesService.GetIatasForMarketGroup(n).join()},n.prototype.DestinationIdsFromAirport=function(n){var t=this._routesService.FindAirportByIata(n);return!t?"":t.PackageHolidayDestinationIds},n.prototype.IncludesChildrenOrInfants=function(n){return Number(n.Children>0||n.Infants>0).toString()},n.prototype.BuildTravellersPerRoom=function(n){var t=String(n.Adults),i=this.Repeat(".11",n.Children),r=this.Repeat(".1",n.Infants);return""+t+i+r},n.prototype.Repeat=function(n,t){return t!==0?Array(t+1).join(n):""},n.ServiceName="PackageHolidayDeepLinkService",n.$inject=["Sitecore_PackageHolidaySettings","Sitecore_RoutesData"],n}();n.PackageHolidayDeepLinkService=t})(t=n.SearchPod||(n.SearchPod={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u,f,e){this._qService=n;this._combinedRoutesService=t;this._flightSearchCookieService=i;this._queryStringService=r;this._queryStringSettings=u;this._searchCookieService=f;this._routesService=new Main3.Routes.RoutesService(e)}return n.prototype.CleanupExpiredValues=function(n){var t=this.IsValidRoute(n.OriginAirportIata,n.DestinationAirportIata);return{OriginAirportIata:this.EnsureValidAirportCode(n.OriginAirportIata),DestinationAirportIata:t?n.DestinationAirportIata:null,OutboundDate:t?this.EnsureValidOutboundDate(n.OutboundDate):null,ReturnDate:t?this.EnsureValidReturnDate(n.OutboundDate,n.ReturnDate):null,IsOneWayFlight:!(n.OutboundDate&&n.ReturnDate),Adults:n.Adults,Children:n.Children,Infants:n.Infants}},n.prototype.ClearSearchHistory=function(){this._flightSearchCookieService.ClearRecentSearchesCookie()},n.prototype.StorePpcLastSearchFromQueryString=function(){var n=this,t=this._qService.defer(),i=this._queryStringService.GetParameter(this._queryStringSettings.PpcQueryStringKey);return i?this._searchCookieService.UpdateCookieFromQueryString(i).then(function(){return n._flightSearchCookieService.ConvertToFlightSearch(n._searchCookieService.GetLastSearch())}):(t.resolve(null),t.promise)},n.prototype.GetRecentSearches=function(n){var i=this,t;return n===void 0&&(n=!1),t=this._flightSearchCookieService.GetRecentSearches()||[],n?t:t.filter(function(n){return i.IsValidRoute(n.OriginAirportIata,n.DestinationAirportIata)})},n.prototype.GetRecentSearchesCount=function(n){return n===void 0&&(n=!1),(this.GetRecentSearches(n)||[]).length},n.prototype.GetMostRecentSearch=function(){return this._flightSearchCookieService.GetSearchCookie()},n.prototype.EnsureValidAirportCode=function(n){return!!n&&!!this._routesService.FindAirportByIata(n)?n:null},n.prototype.EnsureValidOutboundDate=function(n){return!!n&&n.IsTodayOrInTheFuture(!0)?n:null},n.prototype.EnsureValidReturnDate=function(n,t){return!!n&&!!t&&n.IsTodayOrInTheFuture(!0)&&t.IsTodayOrInTheFuture(!0)?t:null},n.prototype.IsValidRoute=function(n,t){var i=this._combinedRoutesService.FindAirportByIata(n,!1),r=this._combinedRoutesService.FindAirportByIata(t,!1);return i&&this._combinedRoutesService.IsValidRouteForFilter(i,r,!1)&&this._combinedRoutesService.IsValidRouteForPlatform(n,t,!1)},n.ServiceName="Controls_SearchHistoryService",n.$inject=["$q","Worldwide_CombinedRoutesService","Controls_FlightSearchCookieService","Common_QueryStringService","Sitecore_QueryStringSettings","SearchCookie_Service","Sitecore_RoutesData"],n}();n.SearchHistoryService=t})(t=n.SearchPod||(n.SearchPod={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this.$q=n;this._searchHistoryService=t;this._originCookieService=i;this._searchCookieService=r}return n.prototype.GetDefaultFlightSearch=function(){var t=this,n=this.$q.defer();return this._searchHistoryService.StorePpcLastSearchFromQueryString().then(function(i){i?(i=t._searchHistoryService.CleanupExpiredValues(i),n.resolve(i)):t._originCookieService.SetCookie().then(function(){var i=t.GetEmptyFlightSearch();i.OriginAirportIata=t._originCookieService.GetOrigin();n.resolve(i)},n.reject)},n.reject),n.promise},n.prototype.GetEmptyFlightSearch=function(){return{OriginAirportIata:"",DestinationAirportIata:"",OutboundDate:null,ReturnDate:null,IsOneWayFlight:!1,Adults:1,Children:0,Infants:0}},n.ServiceName="Controls_SearchPodDefaultValues",n.$inject=["$q","Controls_SearchHistoryService","OriginCookie_Service","SearchCookie_Service"],n}();n.SearchPodDefaultValuesService=t})(t=n.SearchPod||(n.SearchPod={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this._lowestFaresApiService=n;this._routeDatesService=t;this._priceService=i;this._q=r}return n.prototype.RouteSearchUpdated=function(n){var i=this.GetRouteDates(n.OriginIata,n.DestinationIata,null),r=this.GetReturnRouteDates(n),t=[];return i?(t.push(i),r&&t.push(r),this._q.all(t)):null},n.prototype.GetReturnRouteDates=function(n){return n.IsOneWayFlight?null:this.GetRouteDates(n.DestinationIata,n.OriginIata,n.DepartureDate)},n.prototype.GetRouteDates=function(n,t,i){return n&&t?this._routeDatesService.GetDates(n,t,i):null},n.ServiceName="Controls_SearchPodRouteDatesPreloader",n.$inject=["Controls_LowestFaresApiService","Controls_RouteDatesService","Common_PriceService","$q"],n}();n.SearchPodRouteDatesPreloader=t})(t=n.SearchPod||(n.SearchPod={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(){}return t.prototype.ShowInfoDrawersAndSubmitTheForm=function(n,i,r){this._searchPodModel=n;this._formAction=r;this._searchPodModel.DepartureDate.Equals(Utilities.TimeAgnosticDate.TodayLocal())?this.ConfigureTravellingTodayInfoDrawers(i):i&&this.SearchWithoutAdults()?this.OpenSingleInfoDrawer(t.ZeroAdultsDrawerName):i&&this.SearchWithInfants()?this.OpenSingleInfoDrawer(t.SearchWithInfantsDrawerName):this._formAction()},t.prototype.ConfigureTravellingTodayInfoDrawers=function(n){n&&this.SearchWithoutAdults()?this.OpenMultipleInfoDrawers(t.TravellingTodayDrawerName,t.ZeroAdultsDrawerName):n&&this.SearchWithInfants()?this.OpenMultipleInfoDrawers(t.TravellingTodayDrawerName,t.SearchWithInfantsDrawerName):this.OpenSingleInfoDrawer(t.TravellingTodayDrawerName)},t.prototype.OpenMultipleInfoDrawers=function(t,i){var r=this,u={SectionKey:t,OnConfirmCallback:function(){r.QueueInfoDrawer(i);n.Events.Fire(n.Events.Names.Drawer.Close)}};n.Events.OpenDrawerWithOptions(u)},t.prototype.OpenSingleInfoDrawer=function(t){n.Events.OpenDrawerWithOptions(this.FinalDrawOpenOptions(t))},t.prototype.QueueInfoDrawer=function(t){n.Events.QueueDrawerWithOptions(this.FinalDrawOpenOptions(t))},t.prototype.FinalDrawOpenOptions=function(n){var t=this;return{SectionKey:n,OnConfirmCallback:function(){return t._formAction()}}},t.prototype.SearchWithoutAdults=function(){return this._searchPodModel.Passengers.Adults===0},t.prototype.SearchWithInfants=function(){return this._searchPodModel.Passengers.Infants>0},t.TravellingTodayDrawerName="travelling-today",t.ZeroAdultsDrawerName="zero-adults",t.SearchWithInfantsDrawerName="search-with-infants",t.ServiceName="Controls_SearchPodSubmissionService",t.$inject=["$window"],t}();t.SearchPodSubmissionService=i})(i=t.SearchPod||(t.SearchPod={}))})(i=t.Controls||(t.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u){this._moneySettings=n;this._originCookieService=i;this._priceService=r;this._deepLinkService=u;this._routesService=new Main3.Routes.RoutesService(t)}return n.prototype.BuildSearchParametersFromFlightFilters=function(n){var i=this._priceService.GetCurrentCurrency(),t={MaxResults:4,OriginIatas:n.OriginIatas,PreferredOriginIatas:null,AllOrigins:n.AllOrigins,DestinationIatas:n.DestinationIatas,AllDestinations:n.AllDestinations,EndDate:n.EndDate?Utilities.ZonelessDateTime.FromIso8601(n.EndDate).Date():null,StartDate:n.StartDate?Utilities.ZonelessDateTime.FromIso8601(n.StartDate).Date():null,MaxPrice:n.MaximumPrice,CurrencyId:i.CurrencyId,AdminFeePerBooking:this._moneySettings.AdminFeePerBooking,CreditCardFeePercent:this.GetCreditCardFeePercentToApply(),AssumedPassengersPerBooking:this._moneySettings.AssumedPassengersPerBooking,AssumedSectorsPerBooking:this._moneySettings.AssumedSectorsPerBooking};return n.UserOriginPreferred&&(t.PreferredOriginIatas=this.PreferredOriginIatas()),t},n.prototype.GetCreditCardFeePercentToApply=function(){return this._moneySettings.AssumeCreditCardForPayment?this._moneySettings.CreditCardFeePercent:0},n.prototype.PreferredOriginIatas=function(){var n=this._originCookieService.GetOrigin();return n==""?null:this._routesService.GetIatasForMarketGroup(n)},n.prototype.BuildDeepLinkForFlight=function(n,t){var i={OriginIata:n.OriginIata,DestinationIata:n.DestinationIata,DepartureDate:Utilities.TimeAgnosticDate.FromIso8601(n.DepartureDate),Adults:this._moneySettings.AssumedPassengersPerBooking,Children:0,Infants:0};return this._deepLinkService.ToUrl(i,t)},n}();n.BaseFlightFilterDataLoader=t})(t=n.UberKahuna||(n.UberKahuna={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._settings=n}return n.prototype.GetCountdownText=function(n,t){t===void 0&&(t=null);t=t||Utilities.TimeAgnosticDate.TodayLocal();var i=n.DifferenceInDays(t);return i<1?this.ReplaceTokens(this._settings.TodayText,i):i==1?this.ReplaceTokens(this._settings.TomorrowText,i):i>1&&i<=this._settings.WeeksThreshold?this.ReplaceTokens(this._settings.DaysText,i):i>this._settings.WeeksThreshold&&i<=this._settings.MonthsThreshold?this.ReplaceTokens(this._settings.WeeksText,i):i>this._settings.MonthsThreshold?this.ReplaceTokens(this._settings.MonthsText,i):""},n.prototype.ReplaceTokens=function(n,t){var i=Math.round(t/7),r=Math.round(t/30);return n.replace("{days}",t.toString()).replace("{weeks}",i.toString()).replace("{months}",r.toString())},n.ServiceName="Controls_DateCountdownService",n.$inject=["Sitecore_DateCountdownSettings"],n}();n.DateCountdownService=t})(t=n.UberKahuna||(n.UberKahuna={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._qService=n;this._uberKahunaApiService=t;this._uberKahunaRulesService=i}return n.prototype.LoadDataForNextBestActions=function(n){var u=[],t,i,r,f,e,o;if(!!n)for(t=0,i=n;t<i.length;t++)r=i[t],f=new System.Guid(r.ItemId),this._uberKahunaRulesService.WeinerHasNextBestActionRules(f)&&(e=this.LoadNextBestActionOptionForWeiner(r),o=e.then(this.LoadAirportDataForWeiner.bind(this)),u.push(o));return this._qService.all(u)},n.prototype.LoadNextBestActionOptionForWeiner=function(n){var t=this,i=this._qService.defer();return this._uberKahunaRulesService.ResolveNextBestActionForWeiner(new System.Guid(n.ItemId)).then(function(r){!r||t._uberKahunaApiService.GetNextBestActionOptionData(r.MatchingOptionId).then(function(u){u.PersonalisationData=t.BuildNextBestPersonalisationDataFromRulesResult(r);n.NextBestAction=u;i.resolve(n)})}),i.promise},n.prototype.BuildNextBestPersonalisationDataFromRulesResult=function(n){if(!n.PersonalisationContext.NextFlight){if(!!n.RecentSearch)return{BookingReference:null,DepartureDate:n.RecentSearch.OutboundDate.Date(),DepartureAirportCode:n.RecentSearch.OriginIata,ArrivalAirportCode:n.RecentSearch.DestinationIata,ReturnDate:!n.RecentSearch.ReturnDate?null:n.RecentSearch.ReturnDate.Date(),NumberOfAdults:n.RecentSearch.Adults,NumberOfChildren:n.RecentSearch.Children,NumberOfInfants:n.RecentSearch.Infants}}else return{BookingReference:n.PersonalisationContext.NextFlight.BookingReference,DepartureDate:Utilities.ZonelessDateTime.FromIso8601(n.PersonalisationContext.NextFlight.DepartureDate).Date(),DepartureAirportCode:null,ArrivalAirportCode:n.PersonalisationContext.NextFlight.ArrivalAirportCode,NumberOfAdults:0,NumberOfChildren:0,NumberOfInfants:0};return null},n.prototype.LoadAirportDataForWeiner=function(n){var t=this._qService.defer();return!n||!n.NextBestAction||!n.NextBestAction.PersonalisationData||!n.NextBestAction.PersonalisationData.ArrivalAirportCode?t.resolve(n):this._uberKahunaApiService.GetAirportPersonalisationData(n.NextBestAction.PersonalisationData.ArrivalAirportCode).then(function(i){n.NextBestAction.DestinationAirportData=i;t.resolve(n)}),t.promise},n.ServiceName="Controls_UberKahunaNextBestActionDataLoader",n.$inject=["$q","Controls_UberKahunaApiService","Controls_UberKahunaRulesService"],n}();n.NextBestActionDataLoader=t})(t=n.UberKahuna||(n.UberKahuna={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._routesService=new Main3.Routes.RoutesService(n)}return n.prototype.ReplaceDestinationPlaceholders=function(n,t){return this.ReplaceText(n,"{destination}",this._routesService.FindAirportByIata(t).Name)},n.prototype.ReplaceOriginPlaceholders=function(n,t){return this.ReplaceText(n,"{origin}",this._routesService.FindAirportByIata(t).Name)},n.prototype.ReplaceText=function(n,t,i){return n?n.replaceAll(t,i):""},n.ServiceName="Controls_UberKahunaPlaceholderReplacementService",n.$inject=["Sitecore_RoutesData"],n}();n.PlaceholderReplacementService=t})(t=n.UberKahuna||(n.UberKahuna={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(n){function t(t,i,r,u,f,e){var o=n.call(this,i,r,u,f,e)||this;return o._pricingApi=t,o}return __extends(t,n),t.prototype.LoadDataForPricedOverlays=function(n){var t,r,u,i,f,e;if(!!n)for(t=0,r=n;t<r.length;t++)if(u=r[t],!!u.OverlayPanels)for(i=0,f=u.OverlayPanels;i<f.length;i++)e=f[i],e.FlightFilters&&this.LoadOverlayPrice(e)},t.prototype.LoadOverlayPrice=function(n){var t=this,i=this.BuildSearchParametersFromFlightFilters(n.FlightFilters);this._pricingApi.Search(i,function(i){return t.OnOverlayPriceDataLoaded(n,i)},null)},t.prototype.OnOverlayPriceDataLoaded=function(n,t){!!t&&!!t.Flights&&t.Flights.length>0&&(n.Price=t.Flights[0].Price,n.ButtonLink=this.BuildDeepLinkForFlight(t.Flights[0],n.DeepLinkGeneratorSettings))},t.ServiceName="Controls_UberKahunaPricedOverlayDataLoader",t.$inject=["Pricing_Api","Sitecore_MoneySettings","Sitecore_RoutesData","OriginCookie_Service","Common_PriceService","Common_DeepLinksService"],t}(n.BaseFlightFilterDataLoader);n.PricedOverlayDataLoader=t})(t=n.UberKahuna||(n.UberKahuna={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(n){function t(t,i,r,u,f,e,o,s,h){var c=n.call(this,i,u,f,s,r)||this;return c._pricingApi=t,c._flightSearchCookieService=e,c._placeholderReplacementService=o,c._uberKahunaSettings=h,c}return __extends(t,n),t.prototype.LoadDataForWeiners=function(n){var i,r,t;if(n)for(i=0,r=n;i<r.length;i++)t=r[i],t.FlightFilters&&(t.FlightFilters.ShowRetargettedDeal&&this.LoadRetargettedDeal(t),this.LoadDeals(t))},t.prototype.LoadRetargettedDeal=function(n){var i=this,t=this.LastSearch(),r=this._uberKahunaSettings.TradingSettings.RetargettedDealBackShiftWeeks,u=this._uberKahunaSettings.TradingSettings.RetargettedDealForwardShiftWeeks;if(t){var f=t.OutboundDate.Date().AddDays(7*r),e=t.OutboundDate.Date().AddDays(7*u),o=this._routesService.GetIatasForMarketGroup(t.OriginAirportIata),s=this._routesService.GetIatasForMarketGroup(t.DestinationAirportIata),h=this._priceService.GetCurrentCurrency(),c={MaxResults:1,OriginIatas:o,PreferredOriginIatas:null,AllOrigins:!1,DestinationIatas:s,AllDestinations:!1,StartDate:f,EndDate:e,MaxPrice:null,CurrencyId:h.CurrencyId,AdminFeePerBooking:this._moneySettings.AdminFeePerBooking,CreditCardFeePercent:this.GetCreditCardFeePercentToApply(),AssumedPassengersPerBooking:this._moneySettings.AssumedPassengersPerBooking,AssumedSectorsPerBooking:this._moneySettings.AssumedSectorsPerBooking};this._pricingApi.Search(c,function(t){return i.OnTradingWeinerRetargettedDealLoaded(n,t)},null)}},t.prototype.LoadDeals=function(n){var t=this,i=this.BuildSearchParametersFromFlightFilters(n.FlightFilters);this._pricingApi.Search(i,function(i){return t.OnTradingWeinerDataLoaded(n,i)},null)},t.prototype.LastSearch=function(){return this._flightSearchCookieService.GetSearchCookie()},t.prototype.OnTradingWeinerDataLoaded=function(n,t){n.Deals=n.Deals?n.Deals.concat(this.SearchResultsToDeals(t,n)).slice(0,4):this.SearchResultsToDeals(t,n)},t.prototype.OnTradingWeinerRetargettedDealLoaded=function(n,t){n.Deals=n.Deals?this.SearchResultsToDeals(t,n).concat(n.Deals).slice(0,4):this.SearchResultsToDeals(t,n)},t.prototype.SearchResultsToDeals=function(n,t){var i=this;return n.Flights.filter(function(n){return i.FlightHasValidIatas(n)}).map(function(r){var u=i._placeholderReplacementService.ReplaceDestinationPlaceholders(i._uberKahunaSettings.TradingSettings.DestinationText,r.DestinationIata),f=i._placeholderReplacementService.ReplaceOriginPlaceholders(i._uberKahunaSettings.TradingSettings.OriginText,r.OriginIata),e=n.Flights.indexOf(r)+1;return{Title:u,SubTitleLineOne:f,SubTitleLineTwo:Utilities.TimeAgnosticDate.FromIso8601(r.DepartureDate).Format(i._uberKahunaSettings.TradingSettings.DateFormat),CallToActionLink:i.BuildDeepLinkForFlight(r,t.DeepLinkGeneratorSettings),CallToActionPrice:r.Price,CallToActionText:i._uberKahunaSettings.TradingSettings.CallToActionText+" >",CallToActionTargetWindow:"",Path:t.Path+" - Deal Slot "+e}})},t.prototype.FlightHasValidIatas=function(n){return!!this._routesService.FindAirportByIata(n.OriginIata)&&!!this._routesService.FindAirportByIata(n.DestinationIata)},t.ServiceName="Controls_UberKahunaTradingWeinerDataLoader",t.$inject=["Pricing_Api","Sitecore_MoneySettings","Common_DeepLinksService","Sitecore_RoutesData","OriginCookie_Service","Controls_FlightSearchCookieService","Controls_UberKahunaPlaceholderReplacementService","Common_PriceService","Sitecore_UberKahunaSettings"],t}(n.BaseFlightFilterDataLoader);n.TradingWeinerDataLoader=t})(t=n.UberKahuna||(n.UberKahuna={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u){this._http=n;this._httpParamSerializer=t;this._qService=i;this._sitecoreLanguageSettings=r;this._uberKahunaSettings=u}return n.prototype.GetWeinerContent=function(n,t){var i=this,r={itemId:n,ids:t.map(function(n){return n.ToCleanString()}).join("|"),languageCode:this._sitecoreLanguageSettings.SitecoreLanguageCode};return this.CreateApiCall(this._uberKahunaSettings.ContentApiPath,r).then(function(n){return i._outstandingRequest=null,n.data})},n.prototype.GetNextBestActionOptionData=function(n){var t={optionId:n.ToString(),languageCode:this._sitecoreLanguageSettings.SitecoreLanguageCode};return this.CreateApiCall(this._uberKahunaSettings.NextBestActionOptionApiPath,t).then(function(n){return n.data})},n.prototype.GetAirportPersonalisationData=function(n){var t={airportCode:n,languageCode:this._sitecoreLanguageSettings.SitecoreLanguageCode};return this.CreateApiCall(this._uberKahunaSettings.AirportPersonalisationApiPath,t).then(function(n){return n.data})},n.prototype.CreateApiCall=function(n,t){var i=this._qService.defer(),r;return this._outstandingRequest=i,r={method:"GET",url:n+"?"+this._httpParamSerializer(t),responseType:"json",timeout:i.promise},this._http(r)},n.ServiceName="Controls_UberKahunaApiService",n.$inject=["$http","$httpParamSerializer","$q","Sitecore_SitecoreLanguageSettings","Sitecore_UberKahunaSettings"],n}();n.UberKahunaApiService=t})(t=n.UberKahuna||(n.UberKahuna={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u,f,e){this._qService=n;this._uberKahunaRules=t;this._uberKahunaSettings=i;this._originCookieService=r;this._accountService=u;this._personalisationDataService=f;this._recentSearchCookieService=e;this._nextBestOptionEvaluationCache=new Dictionary}return n.prototype.ResetPersonalisation=function(){this._nextBestOptionEvaluationCache=new Dictionary;this._personalisationDataService.ResetPersonalisation()},n.prototype.AnyWeinerInKahunaHasPossiblePersonalisation=function(n){var t=this.GetAllPossibleResultIdsFromFolderRules(this.GetRulesForKahuna(n));return this.AnyOfTheFirstNWeinersHasNextBestActionRules(t,t.length)},n.prototype.GetAllPossibleResultIdsFromFolderRules=function(n){for(var i,r,f,o,s,t=[],u=0,e=n.ItemRules;u<e.length;u++){if(i=e[u],!!i.SimpleRules)for(r=0,f=i.SimpleRules;r<f.length;r++)o=f[r],t.push(new System.Guid(o.ItemId));s=this.GetAllPossibleResultIdsFromGroupedRuleTypes.apply(this,i.GroupedRules);t=t.concat(s)}return t},n.prototype.GetAllPossibleResultIdsFromGroupedRuleTypes=function(){for(var t,r,f,n,u=[],i=0;i<arguments.length;i++)u[i]=arguments[i];if(t=[],!!u)for(r=0,f=u;r<f.length;r++)n=f[r],!n.LeftRuleType||t.push(new System.Guid(n.LeftRuleType.ItemId)),!n.RightRuleType||t.push(new System.Guid(n.RightRuleType.ItemId)),!n.LeftGroupedRuleType||(t=t.concat(this.GetAllPossibleResultIdsFromGroupedRuleTypes(n.LeftGroupedRuleType))),!n.RightGroupedRuleType||(t=t.concat(this.GetAllPossibleResultIdsFromGroupedRuleTypes(n.RightGroupedRuleType)));return t},n.prototype.ResolveKahunaWeiners=function(n){var t=this,i=this._qService.defer();return this._originCookieService.SetCookie().then(function(){var u=t.GetMaximumNumberOfSlidesForKahuna(n),f=Main3.SitecoreRules.Pipeline.PipelineRunner.RunPipeline(t.GetRulesForKahuna(n),new Main3.SitecoreRules.Rules.Pipelines.RulePipelineArgs(u*2)),r=f.ItemIds();t.AnyOfTheFirstNWeinersHasNextBestActionRules(r,u)?t.EvaluateNextBestActionRulesAndExcludeWeinersIfApplicable(r).then(function(n){n=n.slice(0,u);i.resolve(n)}):(r=r.slice(0,u),i.resolve(r))}),i.promise},n.prototype.GetMaximumNumberOfSlidesForKahuna=function(n){var i=3,t=Utilities.Arrays.FirstOrDefault(this._uberKahunaSettings.KahunaSettings,function(t){return new System.Guid(t.Kahuna).Equals(n)});return!!t&&!!t.MaximumSlidesAllowed&&t.MaximumSlidesAllowed>0&&(i=t.MaximumSlidesAllowed),i},n.prototype.GetRulesForKahuna=function(n){return!this._uberKahunaRules?null:Utilities.Arrays.FirstOrDefault(this._uberKahunaRules.KahunaRules,function(t){return new System.Guid(t.ItemId).Equals(n)})},n.prototype.AnyOfTheFirstNWeinersHasNextBestActionRules=function(n,t){var i=this,r=n.slice(0,t);return r.some(function(n){return i.WeinerHasNextBestActionRules(n)})},n.prototype.WeinerHasNextBestActionRules=function(n){return this._uberKahunaRules.NextBestActionRules.some(function(t){return new System.Guid(t.WeinerId).Equals(n)})},n.prototype.EvaluateNextBestActionRulesAndExcludeWeinersIfApplicable=function(n){for(var f,i=[],e=function(n){if(t.WeinerHasNextBestActionRules(n)){if(!t._uberKahunaSettings.DisablePersonalisation){var r=t.ResolveNextBestActionForWeiner(n).then(function(t){return!t?null:n});i.push(r)}}else i.push(t._qService.when(n))},t=this,r=0,u=n;r<u.length;r++)f=u[r],e(f);return this._qService.all(i).then(function(n){return n.filter(function(n){return!!n})})},n.prototype.ResolveNextBestActionForWeiner=function(n){var t=this.GetNextBestActionRulesForWeiner(n);return!t?this._qService.when(null):this.ResolveNextBestActionOption(t)},n.prototype.ResolveNextBestActionOption=function(n){var i=this,t=this._qService.defer();return!n||(this._nextBestOptionEvaluationCache.ContainsKey(n.ItemId)?t.resolve(this._nextBestOptionEvaluationCache.Get(n.ItemId)):this._accountService.WhenSignInStateDetermined().then(function(){i._personalisationDataService.GetPersonalisationContext().then(function(r){var u=i.EvaluateNextBestActionRulesForAllRecentSearches(n,r),f;!u||(f={MatchingOptionId:u.ItemIds()[0],PersonalisationContext:u.PersonalisationContext,RecentSearch:u.RecentSearch},i._nextBestOptionEvaluationCache.Set(n.ItemId,f),t.resolve(f));t.resolve(null)})})),t.promise},n.prototype.EvaluateNextBestActionRulesForAllRecentSearches=function(n,t){var u=this._recentSearchCookieService.GetRecentSearches(),f,r,e,o,i;if(!!u&&u.length>0){for(f=[],r=0,e=u;r<e.length;r++)o=e[r],i=new Main3.SitecoreRules.Rules.Pipelines.Args.OverlayPersonalisationRulePipelineArgs(t,o),i=Main3.SitecoreRules.Pipeline.PipelineRunner.RunPipeline(n,i),this.NextBestActionRulesArgsHaveValidResult(i)&&f.push(i);return this.FindResultForFirstMatchedRule(n,f)}return(i=new Main3.SitecoreRules.Rules.Pipelines.Args.OverlayPersonalisationRulePipelineArgs(t,null),i=Main3.SitecoreRules.Pipeline.PipelineRunner.RunPipeline(n,i),this.NextBestActionRulesArgsHaveValidResult(i))?i:null},n.prototype.FindResultForFirstMatchedRule=function(n,t){var i,r,u,f,e,o,s;if(!!n&&n.ItemRules.length>0){for(i=[],r=0,u=t;r<u.length;r++)f=u[r],e=this.GetMatchedItemId(f.ItemIds()),i.push(this.GetIndexForMatchingRule(n.ItemRules,e));if(i.length>0)return o=Math.min.apply(Math,i),s=i.indexOf(o),t[s]}return null},n.prototype.GetMatchedItemId=function(n){return!!n&&n.length>0?n[0]:System.Guid.Empty()},n.prototype.GetIndexForMatchingRule=function(n,t){for(var r,u=0,i=0,f=n;i<f.length;i++){if(r=f[i],this.SimpleRulesContainsAMatch(r.SimpleRules,t)||this.GroupedRulesContainAMatch(r.GroupedRules,t))return u;u++}},n.prototype.SimpleRulesContainsAMatch=function(n,t){return n.some(function(n){return new System.Guid(n.ItemId).Equals(t)})},n.prototype.GroupedRulesContainAMatch=function(n,t){var i=this;return n.some(function(n){return i.GroupedRuleContainsAMatch(n,t)})},n.prototype.GroupedRuleContainsAMatch=function(n,t){return n.ItemId===t||!!n.LeftRuleType&&new System.Guid(n.LeftRuleType.ItemId).Equals(t)||!!n.RightRuleType&&new System.Guid(n.RightRuleType.ItemId).Equals(t)||!!n.LeftGroupedRuleType&&this.GroupedRuleContainsAMatch(n.LeftGroupedRuleType,t)||!!n.RightGroupedRuleType&&this.GroupedRuleContainsAMatch(n.RightGroupedRuleType,t)},n.prototype.NextBestActionRulesArgsHaveValidResult=function(n){return!!n&&n.Matched&&n.ItemIds().length>0},n.prototype.GetNextBestActionRulesForWeiner=function(n){return!this._uberKahunaRules?null:Utilities.Arrays.FirstOrDefault(this._uberKahunaRules.NextBestActionRules,function(t){return new System.Guid(t.WeinerId).Equals(n)})},n.ServiceName="Controls_UberKahunaRulesService",n.$inject=["$q","Sitecore_UberKahunaRules","Sitecore_UberKahunaSettings","OriginCookie_Service","Account_Service","Personalisation_DataService","RecentSearchesCookie_Service"],n}();n.UberKahunaRulesService=t})(t=n.UberKahuna||(n.UberKahuna={}))})(t=n.Controls||(n.Controls={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._baseCookieService=n;this._cookieName=Main3.Cookies.CookieConstants.Names.FunnelAirPlus}return n.prototype.SetCookie=function(n){this._baseCookieService.SetCookie(this._cookieName,n)},n.prototype.RemoveCookie=function(){this._baseCookieService.DeleteCookieForAllDomains(this._cookieName)},n.prototype.CookieExsists=function(){return this._baseCookieService.HasCookie(this._cookieName)},n.ServiceName="AirPlusCookie_Service",n.$inject=["Cookies_BaseCookieService"],n}();n.AirPlusCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._windowService=n}return n.prototype.SetCookie=function(n,t,i){var r,u;i=i||{};t?(r=typeof t=="object"?JSON.stringify(t):t.toString(),r=i.Base64Encode?Base64.encode(r):r,r=i.UriEncode?encodeURIComponent(r):r,u=this.GetCookieOptions(i),u!=null?MambaCookies.setCookie(n,r,u):MambaCookies.setCookie(n,r)):MambaCookies.setCookie(n,t)},n.prototype.GetCookie=function(n,t){var i=this.GetRawCookie(n,t);return i?JSON.parse(i):null},n.prototype.GetCookieFromKeyValue=function(n,t){var i=this.GetRawCookie(n,t);return i?this.ConvertKeyValueToJson(i):null},n.prototype.ConvertKeyValueToJson=function(n){var i=n.split("&"),t={};return i.forEach(function(n){var i=n.split(/([^=]*)=(.*)/),r=i[1],u=Base64.decode(i[2]);t[r]=decodeURIComponent(u||"")}),t},n.prototype.GetRawCookie=function(n,t){t=t||{};var i=MambaCookies.getCookie(n);return i?(i=t.Base64Encode?Base64.decode(i):i,t.UriEncode?decodeURIComponent(i):i):""},n.prototype.GetCookieOptions=function(n){if(n.Expires||n.Domain){var t={};return n.Expires&&(t.expires=n.Expires),n.Domain&&(t.domain=n.Domain),t}return null},n.prototype.DeleteCookieForAllDomains=function(n){var r,t,i;for(MambaCookies.setCookie(n,null,{expires:-1}),r=["com","co.uk"],t=this._windowService.location.hostname.split(".");t.length>0;){if(i=t.join("."),r.indexOf(i)!==-1)break;MambaCookies.setCookie(n,null,{domain:i,expires:-1});MambaCookies.setCookie(n,null,{domain:"."+i,expires:-1});t.shift()}},n.prototype.HasCookie=function(n){return!!MambaCookies.getCookie(n)},n.ServiceName="Cookies_BaseCookieService",n.$inject=["$window"],n}();n.BaseCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._windowService=n;this._cookieService=t}return n.prototype.CanUseLocalStorage=function(){return!!this._windowService.localStorage},n.prototype.SetData=function(n,t,i){if(this.CanUseLocalStorage())if(t){var r=typeof t=="object"?JSON.stringify(t):t.toString();this._windowService.localStorage.setItem(n,r)}else this._windowService.localStorage.removeItem(n);else this._cookieService.SetCookie(n,t,i)},n.prototype.GetData=function(n,t){if(this.CanUseLocalStorage()){var i=this._windowService.localStorage.getItem(n);return i?JSON.parse(i):null}this._cookieService.GetCookie(n,t)},n.prototype.DeleteData=function(n){this.CanUseLocalStorage()?this._windowService.localStorage.removeItem(n):this._cookieService.DeleteCookieForAllDomains(n)},n.prototype.HasData=function(n){return this.CanUseLocalStorage()?!!this._windowService.localStorage.getItem(n):this._cookieService.HasCookie(n)},n.ServiceName="Cookies_BaseLocalStorageService",n.$inject=["$window","Cookies_BaseCookieService"],n}();n.BaseLocalStorageService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._cookieSettings=n;this._campaignQueryString=t;this._baseCookieService=i}return n.prototype.SetCookie=function(n){if(n){var t=this._campaignQueryString.FromQueryString(n,this._cookieSettings.CampaignDateFormat.toUpperCase());t=this.AddCampaignsFromTheCookie(t);this._baseCookieService.SetCookie(this._cookieSettings.CampaignCookieName,t,{Base64Encode:!0})}},n.prototype.ConvertCampaignDate=function(n){var t=moment(n,this._cookieSettings.CampaignDateFormat.toUpperCase(),"en",!0);return t.isValid()?Utilities.TimeAgnosticDate.FromMoment(t):null},n.prototype.GetCookie=function(){return this._baseCookieService.GetCookie(this._cookieSettings.CampaignCookieName,{Base64Encode:!0})},n.prototype.AddCampaignsFromTheCookie=function(n){var t=this.GetCookie();return t&&t.forEach(function(t){var i=n.filter(function(n){return n.c===t.c});i.length===0&&n.push(t)}),n},n.ServiceName="CampaignCookie_Service",n.$inject=["Sitecore_CookieSettings","CampaignQueryString","Cookies_BaseCookieService"],n}();n.CampaignCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.prototype.FromQueryString=function(n,t){var r=n.split("&"),i=[];return r.forEach(function(n){var r=n.split("|"),u,f,e;r.length===2&&(u=r[0],f=r[1]?new Utilities.TimeAgnosticDate(r[1]):null,u&&f&&!Utilities.StringValidator.ContainsOnlyPrintableAscii(u)&&f.IsValid()&&(e={c:u,d:f.Format(t)},i.push(e)))}),i},n.ServiceName="CampaignQueryString",n}();n.CampaignQueryString=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._baseStorageService=n;this._window=t;this.CheckInPassengersCookieName=Main3.Cookies.CookieConstants.Names.CheckInPassengers;this._blankCookie={Flights:[]};this._cookieOptions={UriEncode:!0}}return n.prototype.HasCookie=function(){return this._baseStorageService.HasData(this.CheckInPassengersCookieName)},n.prototype.ReadCookie=function(){var n=this._baseStorageService.GetData(this.CheckInPassengersCookieName,this._cookieOptions);return n||this._blankCookie},n.prototype.WriteCookie=function(n){var t={Flights:n};this._baseStorageService.SetData(this.CheckInPassengersCookieName,t,this._cookieOptions)},n.prototype.RemoveCookie=function(){this._baseStorageService.DeleteData(this.CheckInPassengersCookieName)},n.ServiceName="CheckInPassengersCookie_Service",n.$inject=["Cookies_BaseLocalStorageService","$window"],n}();n.CheckInPassengersCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._baseCookieService=n;this._cookieSettings=t}return n.prototype.DefaultCookieValue=function(){return this._cookieSettings.ClientApiDefaultCookieValue},n.prototype.SetCookie=function(){},n.prototype.GetCookie=function(){return this.DefaultCookieValue()},n.ServiceName="ClientApi_CookieService",n.$inject=["Cookies_BaseCookieService","Sitecore_CookieSettings"],n}();n.ClientApiCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._baseCookieService=n;this._commercialSoftLogInCookieName="ejCommercialLogInSoft"}return n.prototype.GetCookie=function(){return this._baseCookieService.GetCookie(this._commercialSoftLogInCookieName)},n.prototype.RemoveCookie=function(){this._baseCookieService.DeleteCookieForAllDomains(this._commercialSoftLogInCookieName)},n.prototype.HasCookie=function(){return this._baseCookieService.HasCookie(this._commercialSoftLogInCookieName)},n.prototype.IsSoftLoggedIn=function(){return this.HasCookie()&&!!this.GetCookie().UserName},n.ServiceName="CommercialSoftLogInCookie_Service",n.$inject=["Cookies_BaseCookieService"],n}();n.CommercialSoftLogInCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._cookieSettings=n;this._baseCookieService=t;this._cookieName=this._cookieSettings.FlightConfirmationCookieName}return n.prototype.SetFlightConfirmationCookie=function(n,t,i,r,u,f,e,o){var s="BookingReference="+Base64.encode(n);s+="&BookingDate="+Base64.encode(Utilities.TimeAgnosticDate.TodayUtc().ToIso8601()+"T00:00:00");s+="&OriginAirportCode="+Base64.encode(t);s+="&DestinationAirportCode="+Base64.encode(i);s+="&NumberOfAdults="+Base64.encode(r.toString());s+="&NumberOfChildren="+Base64.encode(u.toString());s+="&NumberOfInfants="+Base64.encode(f.toString());s+="&OutboundDate="+Base64.encode(e.ToIso8601()+"T00:00:00");!o||(s+="&ReturnDate="+Base64.encode(o.ToIso8601()+"T00:00:00"));this._baseCookieService.SetCookie(Main3.Cookies.CookieConstants.Names.FlightConfirmation,s,{Expires:this.GetCookieExpiryDays(e)})},n.prototype.SetCarConfirmationCookie=function(n,t){var i="BookingReference="+Base64.encode(n);this._baseCookieService.SetCookie("CarHireConfirmation",i,{Expires:this.GetCookieExpiryDays(t)})},n.prototype.GetOrigin=function(){var n=this._baseCookieService.GetRawCookie(this._cookieName),t;return n?(t=SubCookie.getSubCookies(n)[this._cookieSettings.FlightConfirmationOrigin],Base64.decode(t)):""},n.prototype.GetCookie=function(){return this._baseCookieService.GetCookieFromKeyValue(Main3.Cookies.CookieConstants.Names.FlightConfirmation,{UriEncode:!0})},n.prototype.GetCookieExpiryDays=function(n){var t=n.ToZonelessDateTime().Difference(Utilities.ZonelessDateTime.NowUtc(),Utilities.ZonelessDateTimePart.Days);return t+5},n.ServiceName="FlightConfirmationCookie_Service",n.$inject=["Sitecore_CookieSettings","Cookies_BaseCookieService"],n}();n.FlightConfirmationCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this.FunnelECommerceCookieName=Main3.Cookies.CookieConstants.Names.FunnelECommerce;this._baseCookieService=n}return n.prototype.HasCookie=function(){return this._baseCookieService.HasCookie(this.FunnelECommerceCookieName)},n.prototype.ReadCookie=function(){return this._baseCookieService.GetCookie(this.FunnelECommerceCookieName)},n.prototype.WriteCookie=function(n){this._baseCookieService.SetCookie(this.FunnelECommerceCookieName,n)},n.prototype.RemoveCookie=function(){this._baseCookieService.DeleteCookieForAllDomains(this.FunnelECommerceCookieName)},n.prototype.UpdateCookie=function(n,t){t===void 0&&(t=!0);var i=this.ReadCookie();!i&&t&&(i={AlreadySentForBookingRef:null,PaymentAnalytics:null,SeatingAnalytics:null});n(i);this.WriteCookie(i)},n.ServiceName="FunnelECommerceCookie_Service",n.$inject=["Cookies_BaseCookieService"],n}();n.FunnelECommerceCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this.FunnelJourneyCookieName=Main3.Cookies.CookieConstants.Names.FunnelJourney;this._blankJson={CorrelationToken:null,PaymentType:null,Origin:null,Destination:null,Outbound:null,Component:null,FlexiFares:null,Adults:null,Children:null,Infants:null,MemberEmailAddressKnown:!1,JourneyPairId:1,Pairs:[],FunnelJourney:null};this._baseCookieService=n}return n.prototype.HasCookie=function(){return this._baseCookieService.HasCookie(this.FunnelJourneyCookieName)},n.prototype.ReadCookie=function(){var i=this,n,t;return this._thisRequestJourneyState||(this._thisRequestJourneyState=this._baseCookieService.GetCookie(this.FunnelJourneyCookieName,{UriEncode:!0})),n=this._thisRequestJourneyState||this._blankJson,t=null,!n.CarSearchQuery||(t={Currency:n.CarSearchQuery.Currency,BaseCurrency:n.CarSearchQuery.BaseCurrency,AgeOfDriver:n.CarSearchQuery.DriverAge,PickUpIata:n.CarSearchQuery.PickUpIata,DropOffIata:n.CarSearchQuery.DropOffIata,PickUpStationCode:n.CarSearchQuery.PickUpStationCode,DropOffStationCode:n.CarSearchQuery.DropOffStationCode,PickUpLocationName:n.CarSearchQuery.PickUpLocationName,DropOffLocationName:n.CarSearchQuery.DropOffLocationName,OriginCountryCode:n.CarSearchQuery.OriginCountry,PickUpDateTime:Utilities.ZonelessDateTime.FromIso8601(n.CarSearchQuery.PickUpDateTime),DropOffDateTime:Utilities.ZonelessDateTime.FromIso8601(n.CarSearchQuery.DropOffDateTime),IsDefault:n.CarSearchQuery.IsDefault,IsOneWayFlight:n.CarSearchQuery.IsOneWayFlight}),{CorrelationToken:n.CorrelationToken?new System.Guid(n.CorrelationToken):null,PaymentType:n.PaymentType,OriginIata:n.Origin,DestinationIata:n.Destination,OutboundDate:n.Outbound?new Utilities.TimeAgnosticDate(n.Outbound):null,ReturnDate:n.Return?new Utilities.TimeAgnosticDate(n.Return):null,ComponentSender:n.Component,ShowFlexiFares:!!n.FlexiFares,NumberOfAdults:n.Adults,NumberOfChildren:n.Children,NumberOfInfants:n.Infants,CurrencyCode:n.CurrencyCode,CurrencyPriority:n.CurrencyPriority||1,NumberOfPaymentErrors:n.NumberOfPaymentErrors,HasSeenSeatingPage:n.HasSeenSeatingPage,HasSeenVouchersPage:n.HasSeenVouchersPage,MemberEmailAddressKnown:n.MemberEmailAddressKnown,ActiveJourneyPairId:n.JourneyPairId,LeadDriverPassengerInternalId:n.LeadDriverId,CarSearchQuery:t,CarSearchEquipment:n.CarSearchEquipment,SelectedCar:n.SelectedCar,JourneyPairs:!n.Pairs?[]:n.Pairs.map(function(n){return i.CreateJourneyPair(n)}),EnsightenCountryCache:n.EnsightenCountryCache,FunnelJourney:n.FunnelJourney,UsingFixedJourney:n.UsingFixedJourney,OpenChangeSearch:n.OpenChangeSearch,HasServerBasket:n.HasServerBasket}},n.prototype.WriteCookie=function(n){var r=this,i=null,t;!n.CarSearchQuery||(i={Currency:n.CarSearchQuery.Currency,BaseCurrency:n.CarSearchQuery.BaseCurrency,DriverAge:n.CarSearchQuery.AgeOfDriver,PickUpIata:n.CarSearchQuery.PickUpIata,DropOffIata:n.CarSearchQuery.DropOffIata,PickUpStationCode:n.CarSearchQuery.PickUpStationCode,DropOffStationCode:n.CarSearchQuery.DropOffStationCode,OriginCountry:n.CarSearchQuery.OriginCountryCode,PickUpLocationName:n.CarSearchQuery.PickUpLocationName,DropOffLocationName:n.CarSearchQuery.DropOffLocationName,PickUpDateTime:n.CarSearchQuery.PickUpDateTime.ToIso8601(),DropOffDateTime:n.CarSearchQuery.DropOffDateTime.ToIso8601(),IsDefault:n.CarSearchQuery.IsDefault,IsOneWayFlight:n.CarSearchQuery.IsOneWayFlight});t={CorrelationToken:n.CorrelationToken?n.CorrelationToken.ToString():null,PaymentType:n.PaymentType,Origin:n.OriginIata,Destination:n.DestinationIata,Outbound:n.OutboundDate?n.OutboundDate.ToIso8601():null,Return:n.ReturnDate?n.ReturnDate.ToIso8601():null,Component:n.ComponentSender,FlexiFares:!!n.ShowFlexiFares,Adults:n.NumberOfAdults,Children:n.NumberOfChildren,Infants:n.NumberOfInfants,CurrencyCode:n.CurrencyCode,CurrencyPriority:n.CurrencyPriority,MemberEmailAddressKnown:n.MemberEmailAddressKnown,JourneyPairId:n.ActiveJourneyPairId,NumberOfPaymentErrors:n.NumberOfPaymentErrors,HasSeenSeatingPage:n.HasSeenSeatingPage,HasSeenVouchersPage:n.HasSeenVouchersPage,LeadDriverId:n.LeadDriverPassengerInternalId,CarSearchQuery:i,CarSearchEquipment:n.CarSearchEquipment,SelectedCar:n.SelectedCar,Pairs:n.JourneyPairs.map(function(n){return r.CreateFunnelCookieJourneyPair(n)}),EnsightenCountryCache:n.EnsightenCountryCache,FunnelJourney:n.FunnelJourney,UsingFixedJourney:n.UsingFixedJourney,OpenChangeSearch:n.OpenChangeSearch,HasServerBasket:n.HasServerBasket};this._thisRequestJourneyState=t;this._baseCookieService.SetCookie(this.FunnelJourneyCookieName,t,{UriEncode:!0})},n.prototype.UpdateCookie=function(n){var t=this.ReadCookie();n(t);this.WriteCookie(t)},n.prototype.RemoveCookie=function(){this._baseCookieService.DeleteCookieForAllDomains(this.FunnelJourneyCookieName)},n.prototype.CreateFunnelCookieJourneyPair=function(n){return{Id:n.Id,IsPrimary:n.IsPrimaryPair,Outbound:n.OutboundRoute.Date.ToIso8601(),Return:!!n.ReturnRoute&&!!n.ReturnRoute.Date?n.ReturnRoute.Date.ToIso8601():null,Destination:n.OutboundRoute.DestinationIata,Origin:n.OutboundRoute.OriginIata,BaseCurrency:n.BaseCurrency}},n.prototype.CreateJourneyPair=function(n){var i={Date:new Utilities.TimeAgnosticDate(n.Outbound),DestinationIata:n.Destination,OriginIata:n.Origin},t=null;return!n.Return||(t={Date:new Utilities.TimeAgnosticDate(n.Return),DestinationIata:n.Origin,OriginIata:n.Destination}),{Id:n.Id,IsPrimaryPair:n.IsPrimary,OutboundRoute:i,ReturnRoute:t,BaseCurrency:n.BaseCurrency}},n.ServiceName="FunnelJourneyCookie_Service",n.$inject=["Cookies_BaseCookieService"],n}();n.FunnelJourneyCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this.FunnelQueryCookieName=Main3.Cookies.CookieConstants.Names.FunnelQuery;this._baseCookieService=n}return n.prototype.HasValidCookie=function(){var t=this._baseCookieService.HasCookie(this.FunnelQueryCookieName),n;return t?(n=this._baseCookieService.GetCookie(this.FunnelQueryCookieName,{UriEncode:!0}),typeof n.NumberOfAdults=="number"&&!!n.OriginIata&&!!n.DestinationIata&&!!n.OutboundDate):!1},n.prototype.ReadCookie=function(){var n=this._baseCookieService.GetCookie(this.FunnelQueryCookieName,{UriEncode:!0});return{NumberOfAdults:n.NumberOfAdults,NumberOfChildren:n.NumberOfChildren,NumberOfInfants:n.NumberOfInfants,OriginIata:n.OriginIata,DestinationIata:n.DestinationIata,OutboundDate:new Utilities.TimeAgnosticDate(n.OutboundDate),ReturnDate:n.ReturnDate?new Utilities.TimeAgnosticDate(n.ReturnDate):null,OutboundFlightNumber:n.OutboundFlightNumber,ReturnFlightNumber:n.ReturnFlightNumber,OpenSearchPanel:n.OpenSearchPanel,ShowFlexiFares:n.ShowFlexiFares,RemainOnStep1:n.RemainOnStep1,ComponentSender:n.ComponentSender,CurrencyCode:n.CurrencyCode,PaymentTypeCode:n.PaymentTypeCode,FunnelJourney:n.FunnelJourney,UsingFixedJourney:n.UsingFixedJourney}},n.prototype.RemoveCookie=function(){this._baseCookieService.DeleteCookieForAllDomains(this.FunnelQueryCookieName)},n.ServiceName="FunnelQuery_Service",n.$inject=["Cookies_BaseCookieService"],n}();n.FunnelQueryCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this.FunnelReasonCookieName=Main3.Cookies.CookieConstants.Names.FunnelReason;this._baseCookieService=n}return n.prototype.HasCookie=function(){return this._baseCookieService.HasCookie(this.FunnelReasonCookieName)},n.prototype.ReadCookie=function(){return this._baseCookieService.GetCookie(this.FunnelReasonCookieName)},n.prototype.WriteCookie=function(n){this._baseCookieService.SetCookie(this.FunnelReasonCookieName,n)},n.prototype.UpdateCookie=function(n,t){t===void 0&&(t=!0);var i=this.ReadCookie();!i&&t&&(i={});n(i);this.WriteCookie(i)},n.prototype.RemoveCookie=function(){this._baseCookieService.DeleteCookieForAllDomains(this.FunnelReasonCookieName)},n.ServiceName="FunnelReasonCookie_Service",n.$inject=["Cookies_BaseCookieService"],n}();n.FunnelReasonCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._cookieName=n.InspireMeCookieName;this._sitecoreCookieSettings=n;this._baseCookieService=t;this.InitialiseCookie()}return n.prototype.SetCookie=function(n){var t=this.GetCookieFromQueryString(n);t&&this.InternalSetCookie(t)},n.prototype.InitialiseCookie=function(){var n=this._baseCookieService.GetCookie(this._cookieName,{UriEncode:!0});n?this.ResetCookie(n):this.SetDefaultCookie()},n.prototype.GetRegion=function(){return this._sitecoreCookieSettings.LanguageCookieValue.toLowerCase()},n.prototype.ResetCookie=function(n){var t=this.GetRegion();n.region!==t&&(n.region=t,this.InternalSetCookie(n))},n.prototype.SetDefaultCookie=function(){var n={departure:null,when:null,flag:null,price:null,destination:null,fromDate:null,toDate:null,customDate:null,mapLocation:null,moveMap:null,region:this.GetRegion()};this.InternalSetCookie(n)},n.prototype.GetCookieFromQueryString=function(n){var t=n.split("|"),i;return t.length<5?null:(i={departure:this.GetDeparture(t[0],t[1]),when:this.GetWhen(t[2]),flag:this.GetFlag(t[3]),price:this.GetPrice(t[4]),fromDate:null,toDate:null,customDate:null,mapLocation:null,destination:null,moveMap:null,region:this.GetRegion()},t.length>=6&&(i.destination=this.GetDestination(t[5])),t.length>=7&&(i.fromDate=this.GetDateProperty(t[6])),t.length>=8&&(i.toDate=this.GetDateProperty(t[7])),i)},n.prototype.GetDeparture=function(n,t){return this.InvalidValue(n)||this.InvalidValue(t)?null:{origin:n,selected:t,date:Utilities.ZonelessDateTime.NowUtc().Format("YYYY-MM-DD HH:mm:ss\\\\Z")}},n.prototype.InternalSetCookie=function(n){this._baseCookieService.SetCookie(this._cookieName,n,{UriEncode:!0})},n.prototype.GetWhen=function(n){return this.InvalidValue(n)?null:{id:n}},n.prototype.GetFlag=function(n){return this.InvalidValue(n)?null:{code:n}},n.prototype.GetPrice=function(n){return this.InvalidValue(n)?null:{value:parseInt(n)}},n.prototype.GetDestination=function(n){return this.InvalidValue(n)?null:{destination:n}},n.prototype.GetDateProperty=function(n){return this.InvalidValue(n)?null:{value:n}},n.prototype.InvalidValue=function(n){return n===""||Utilities.StringValidator.ContainsOnlyPrintableAscii(n)},n.ServiceName="InspireMeCookie_Service",n.$inject=["Sitecore_CookieSettings","Cookies_BaseCookieService"],n}();n.InspireMeCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._baseCookieService=n;this._cookieSettings=t}return n.prototype.SetCookie=function(n){if(n){var t={Expires:365,Domain:this._cookieSettings.LookAndBookCookiesDomainName};this._baseCookieService.SetCookie(this._cookieSettings.LookAndBookCookieName,n,t)}},n.prototype.GetCookie=function(){return this._baseCookieService.GetRawCookie(this._cookieSettings.LookAndBookCookieName)},n.ServiceName="LookAndBookCookie_Service",n.$inject=["Cookies_BaseCookieService","Sitecore_CookieSettings"],n}();n.LookAndBookCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._baseCookieService=n;this.CookieName=Main3.Cookies.CookieConstants.Names.ManageBookingJourney;this._cookieOptions={UriEncode:!0}}return n.prototype.HasValidCookie=function(){var t=this._baseCookieService.HasCookie(this.CookieName),n;return t?(n=this._baseCookieService.GetCookie(this.CookieName,this._cookieOptions),!!n.BookingReference):!1},n.prototype.ReadCookie=function(){return this._baseCookieService.GetCookie(this.CookieName,this._cookieOptions)},n.prototype.WriteCookie=function(n){this._baseCookieService.SetCookie(this.CookieName,n,this._cookieOptions)},n.prototype.UpdateCookie=function(n){var t=this.ReadCookie();!t||(n(t),this.WriteCookie(t))},n.prototype.RemoveCookie=function(){this._baseCookieService.DeleteCookieForAllDomains(this.CookieName)},n.ServiceName="ManageBookingJourney_Service",n.$inject=["Cookies_BaseCookieService"],n}();n.ManageBookingJourneyCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._baseCookieService=n;this.CookieName=Main3.Cookies.CookieConstants.Names.ManageBookingQuery}return n.prototype.HasValidCookie=function(){var t=this._baseCookieService.HasCookie(this.CookieName),n;return t?(n=this._baseCookieService.GetCookie(this.CookieName,{UriEncode:!0}),!!n.BookingReference):!1},n.prototype.ReadCookie=function(){return this._baseCookieService.GetCookie(this.CookieName,{UriEncode:!0})},n.prototype.RemoveCookie=function(){this._baseCookieService.DeleteCookieForAllDomains(this.CookieName)},n.ServiceName="ManageBookingQuery_Service",n.$inject=["Cookies_BaseCookieService"],n}();n.ManageBookingQueryCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u,f,e){this._userLocationSettings=t;this._searchCookieService=i;this._flightConfirmationCookieService=r;this._nearestAirportService=u;this._qService=f;this._baseCookieService=e;this._cookieName=n.OriginCookieName}return n.prototype.GetOrigin=function(){return this._baseCookieService.GetRawCookie(this._cookieName)},n.prototype.SetCookie=function(){var n=this;return this._originCookieSetPromise||(this._originCookieSetPromise=this.GetOriginPromise().then(function(t){n._baseCookieService.SetCookie(n._cookieName,t)})),this._originCookieSetPromise},n.prototype.GetOriginPromise=function(){var i=this.GetDefaultOrigin(),n=this.ConvertToPromise(i),r=this._searchCookieService.GetLastSearch(),u=this._flightConfirmationCookieService.GetOrigin(),t;return r?n=this.ConvertToPromise(r.OriginIata):u?n=this.ConvertToPromise(u):this._userLocationSettings.NearestAirportEnabled&&(t=this._baseCookieService.GetRawCookie(this._cookieName),n=t&&t!==i?this.ConvertToPromise(t):this._nearestAirportService.GetNearestAirportCodeAsync()),n.then(function(n){return n?n:i})},n.prototype.GetDefaultOrigin=function(){return this._userLocationSettings.RegionalUserOrigin?this._userLocationSettings.RegionalUserOrigin:this._userLocationSettings.GlobalFallbackUserOrigin},n.prototype.ConvertToPromise=function(n){var t=this._qService.defer();return t.resolve(n),t.promise},n.ServiceName="OriginCookie_Service",n.$inject=["Sitecore_CookieSettings","Sitecore_UserLocationSettings","SearchCookie_Service","FlightConfirmationCookie_Service","Common_NearestAirport","$q","Cookies_BaseCookieService"],n}();n.OriginCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(){function t(n,t,i){this._cookieName=t.PersonalisationCookieName;this._queryStringSettings=n;this._baseCookieService=i}return t.prototype.SetCookie=function(t){var u=new Urls.QueryString(t),r=n.Cookies.PersonalisationQueryString.FromQueryString(u,this._queryStringSettings),i=this._baseCookieService.GetCookie(this._cookieName);i=i?i:{dest:"",seg:[]};i.dest=this.GetDestination(i.dest,r.Destination);i.seg=this.UpdateCookieFlags(i.seg,r.Flags);this._baseCookieService.SetCookie(this._cookieName,i)},t.prototype.GetDestination=function(n,t){return t?t:n?n:""},t.prototype.UpdateCookieFlags=function(n,t){return n=n||[],t&&t.forEach(function(t){var i=n.filter(function(n){return n.name===t.name});i&&i.length>0?i[0].value=t.value:n.push({name:t.name,value:t.value})}),n},t.ServiceName="PersonalisationCookie_Service",t.$inject=["Sitecore_QueryStringSettings","Sitecore_CookieSettings","Cookies_BaseCookieService"],t}();t.PersonalisationCookieService=i})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.FromQueryString=function(t,i){var r=new n;return r.Destination=this.GetDestinationFromQueryString(t,i.PersonalisationDestinationKey),r.Flags=this.GetFlagsFromQueryString(t,i.PersonalisationFlagsKey),r},n.GetDestinationFromQueryString=function(n,t){var i=n.GetParameter(t);return i&&!Utilities.StringValidator.ContainsOnlyPrintableAscii(i)?i:null},n.GetFlagsFromQueryString=function(n,t){var i=n.GetParameter(t),r;return i&&!Utilities.StringValidator.ContainsOnlyPrintableAscii(i)?(r=[],i.split("|").forEach(function(n){var t=n.split(":");if(t.length===2){var u=t[0]||"",i=parseInt(t[1]),f=i>=0?i:0;r.push({name:u,value:f})}}),r):null},n}();n.PersonalisationQueryString=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(n){function t(t,i){var r=n.call(this)||this;return r.RecentSearchLimit=4,r.ExpiryDays=30,r._cookieName=t.RecentSearchesCookieName,r._recentSearchesCookieDomainName=t.SearchesCookiesDomainName,r._baseCookieService=i,r}return __extends(t,n),t.prototype.UpdateCookie=function(n){var t=this.GetRecentSearches();t=this.RemoveDuplicateRecentSearches(n,t);t.unshift(n);this.SetCookie(t)},t.prototype.RemoveDuplicateRecentSearches=function(n,t){var i=this;return t.filter(function(t){return!i.Equal(n,t)})},t.prototype.GetRecentSearches=function(){return this.ToSearchCookies(this.GetCookieValues())},t.prototype.SetCookie=function(n){var i=this,r=[],u,f;n.forEach(function(n,u){if(u<i.RecentSearchLimit){n.SearchId=u;var f=i.ToString(n);r.push(t.CookieKey.format(u)+"="+f)}});u=r.join("&");f={Expires:this.ExpiryDays,Domain:this._recentSearchesCookieDomainName?this._recentSearchesCookieDomainName:null};this._baseCookieService.SetCookie(this._cookieName,u,f)},t.prototype.GetCookieValues=function(){var r=[],t=this._baseCookieService.GetRawCookie(this._cookieName),n,i;if(t&&t.length>0){n=SubCookie.getSubCookies(t);for(i in n)n.hasOwnProperty(i)&&r.push(n[i])}return r},t.prototype.Clear=function(){this._baseCookieService.DeleteCookieForAllDomains(this._cookieName)},t.CookieKey="ej20RecentSearch_{0}",t.ServiceName="RecentSearchesCookie_Service",t.$inject=["Sitecore_CookieSettings","Cookies_BaseCookieService"],t}(n.SearchCookieBase);n.RecentSearchesCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(t){function i(n,i,r){var u=t.call(this)||this;return u.ExpiryDays=365,u._cookieName=n.LastSearchCookieName,u._searchCookieDomainName=n.SearchesCookiesDomainName,u._baseCookieService=i,u._q=r,u}return __extends(i,t),i.prototype.UpdateCookieFromQueryString=function(t){if(!this._cookieUpdateDeferred){this._cookieUpdateDeferred=this._q.defer();var r=new Urls.QueryString(t),i=n.SearchQueryString.FromQueryString(r);this.SetCookie(i);this._cookieUpdateDeferred.resolve(i)}return this._cookieUpdateDeferred.promise},i.prototype.UpdateCookie=function(n){n.SearchId=0;var t=i.CookieKey+"="+this.ToString(n);this.SetCookie(t)},i.prototype.GetLastSearch=function(){var n=this._baseCookieService.GetRawCookie(this._cookieName).split("&")[0],t=n?n.split("=")[1]:"";return t?this.ToSearchCookie(t):null},i.prototype.SetCookie=function(n){var t={Expires:this.ExpiryDays,Domain:this._searchCookieDomainName?this._searchCookieDomainName:null};this._baseCookieService.SetCookie(this._cookieName,n,t)},i.CookieKey="ej20Search_0",i.ServiceName="SearchCookie_Service",i.$inject=["Sitecore_CookieSettings","Cookies_BaseCookieService","$q"],i}(n.SearchCookieBase);n.SearchCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function t(){}return t.FromQueryString=function(t){var r=t.GetParameter(n.SearchCookieService.CookieKey),i=this.ConvertStringToSearch(r);return i?(i=this.UpdateOutboundDate(i),i=this.UpdateReturnDate(i),this.ConvertSearchToString(i)):""},t.UpdateOutboundDate=function(n){if(!n.OutboundDate&&n.OutboundMinimumDaysAhead){var t=Utilities.TimeAgnosticDate.TodayUtc().AddDays(n.OutboundMinimumDaysAhead);n.OutboundDate=n.OutboundOnDay!==null?this.GetNextDayOfTheWeek(t,n.OutboundOnDay):t.ToZonelessDateTime()}return n},t.UpdateReturnDate=function(n){if(!n.ReturnDate&&n.ReturnMinimumDaysAfterOutbound){var t=n.OutboundDate.Date().AddDays(n.ReturnMinimumDaysAfterOutbound);n.ReturnDate=n.ReturnOnDay!==null?this.GetNextDayOfTheWeek(t,n.ReturnOnDay):t.ToZonelessDateTime()}return n},t.GetNextDayOfTheWeek=function(n,t){var i=n.DayOfTheWeek();return n=i<=t?n.AddDays(t-i):n.AddDays(7+t-i),n.ToZonelessDateTime()},t.ConvertStringToSearch=function(n){var i,t,r;return n?(i=n.split("@/"),t=i[0].split("|"),t.length<11)?null:(r={OriginAirportIata:t[0],DestinationAirportIata:t[1],OutboundDate:t[2]?new Utilities.TimeAgnosticDate(t[2]).ToZonelessDateTime():null,ReturnDate:t[3]?new Utilities.TimeAgnosticDate(t[3]).ToZonelessDateTime():null,IsOneWayFlight:t[3]?!0:!1,Adults:parseInt(t[4]),Children:parseInt(t[5]),Infants:parseInt(t[6]),DateCreated:moment(t[10]),OutboundMinimumDaysAhead:parseInt(i[1]),OutboundOnDay:parseInt(i[2]),ReturnMinimumDaysAfterOutbound:parseInt(i[3]),ReturnOnDay:parseInt(i[4])},this.IsValidSearch(r)?r:null):null},t.ConvertSearchToString=function(t){var i=t.ReturnDate?t.ReturnDate.Format("YYYY-MM-DDTHH:mm:ss"):"";return n.SearchCookieService.CookieKey+"="+t.OriginAirportIata+"|"+t.DestinationAirportIata+"|"+t.OutboundDate.Format("YYYY-MM-DDTHH:mm:ss")+"|"+i+"|"+t.Adults+"|"+t.Children+"|"+t.Infants+"|False||0|"+t.DateCreated.format("YYYY-MM-DD HH:mm:ss")+"Z"},t.IsValidSearch=function(n){return!n.OriginAirportIata||!n.DestinationAirportIata?!1:!n.OutboundDate&&!n.OutboundMinimumDaysAhead?!1:!0},t}();n.SearchQueryString=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._baseCookieService=n;this._cookieName=Main3.Cookies.CookieConstants.Names.SessionExpiry}return n.prototype.SetCookie=function(n){this._baseCookieService.SetCookie(this._cookieName,n)},n.prototype.RemoveCookie=function(){this._baseCookieService.DeleteCookieForAllDomains(this._cookieName)},n.prototype.CookieExists=function(){return this._baseCookieService.HasCookie(this._cookieName)},n.prototype.GetCookieValue=function(){return this._baseCookieService.GetCookie(this._cookieName)},n.ServiceName="SessionCookieExpiry_Service",n.$inject=["Cookies_BaseCookieService"],n}();n.SessionCookieExpiryService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._sitecorePageSettings=n;this._cookieSettings=t;this._baseCookieService=i}return n.prototype.EnsureCookie=function(){this._sitecorePageSettings&&this._sitecorePageSettings.IsHomePage&&this._baseCookieService.SetCookie(this._cookieSettings.LanguageCookieName,this._cookieSettings.LanguageCookieValue,{Expires:365})},n.ServiceName="Service_SitecoreLanguageCookie",n.$inject=["Sitecore_PageSettings","Sitecore_CookieSettings","Cookies_BaseCookieService"],n}();n.SitecoreLanguageCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function t(n,t){this._cookieSettings=n;this._baseCookieService=t}return t.prototype.SetCookie=function(t){var r=n.WishlistQueryString.FromQueryString(t),i;r&&(i=this._baseCookieService.GetRawCookie(this._cookieSettings.WishlistCookieName,{Base64Encode:!0}),i=i?this.AddWishToCookie(i,this.WishToString(r)):this.WishToString(r),this._baseCookieService.SetCookie(this._cookieSettings.WishlistCookieName,i,{Base64Encode:!0,Expires:this._cookieSettings.WishlistCookieExpiryDays}))},t.prototype.WishToString=function(n){return Object.keys(n).map(function(t){return n[t]}).join("_")},t.prototype.AddWishToCookie=function(n,t){var i=n.split("|");return i.push(t),this._cookieSettings.WishlistCookieWishLimit&&i.length>=this._cookieSettings.WishlistCookieWishLimit&&(i=i.slice(-this._cookieSettings.WishlistCookieWishLimit)),i.join("|")},t.ServiceName="WishlistCookie_Service",t.$inject=["Sitecore_CookieSettings","Cookies_BaseCookieService"],t}();n.WishlistCookieService=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.FromQueryString=function(n){var t=n.split("_");if(t.length<11)return null;var r=new Utilities.TimeAgnosticDate(t[4]),u=new Utilities.TimeAgnosticDate(t[7]),i=u.IsValid()&&this.IsValidFlightTime(t[8])&&this.IsValidFlightTime(t[9]),f={CreatedDateTime:this.IsValidCreatedDate(t[0])?t[0]:"",Origin:t[1],Destination:t[2],Flag:t[3],OutboundDate:r.IsValid()?r.Format("YYYY-MM-DD"):"",OutboundDepartureTime:this.IsValidFlightTime(t[5])?t[5]:"",OutboundArrivalTime:this.IsValidFlightTime(t[6])?t[6]:"",ReturnDate:i?u.Format("YYYY-MM-DD"):"",ReturnDepartureTime:i?t[8]:"",ReturnArrivalTime:i?t[9]:"",OriginalPrice:t[10],OutboundFlightNumber:t[11]||"",ReturnFlightNumber:t[12]||""};return this.IsValidWish(f)?f:null},n.IsValidWish=function(n){return n.CreatedDateTime&&n.Origin&&n.Destination&&n.OriginalPrice&&n.OutboundDate&&n.OutboundDepartureTime&&n.OutboundArrivalTime?!0:!1},n.IsValidFlightTime=function(n){return/^([01][0-9]|2[0-3]):[0-5][0-9]$/.test(n)},n.IsValidCreatedDate=function(n){return/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01]) ([01][0-9]|2[0-3]):[0-5][0-9]$/.test(n)},n}();n.WishlistQueryString=t})(t=n.Cookies||(n.Cookies={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._dataApi=n;this._errorService=t;this._q=i;this._apiDeferrs=new Dictionary}return n.prototype.GetCountryDataFromApi=function(n){var i=this,t;return this._apiDeferrs.ContainsKey(n)?this._apiDeferrs.Get(n).promise:(t=this._q.defer(),this._apiDeferrs.Set(n,t),this._dataApi.GetCountryData(n,function(n){n.CountryData=i.SortCountries(n.CountryData);t.resolve(n)},this._errorService.HandleApiError.bind(this._errorService)),t.promise)},n.prototype.SortCountries=function(n){return n.sort(function(n,t){return n.Name.localeCompare(t.Name)})},n.prototype.GetCountryData=function(n){return this.GetCountryDataFromApi(n)},n.prototype.PrioritiseCountries=function(n,t){for(var r,u=[],f=t.map(function(n){return Utilities.String.LowerAndTrim(n)}),e=n.map(function(n){return Utilities.String.LowerAndTrim(n.ISOCountryCode)}),i=0;i<f.length;i++)r=e.indexOf(f[i]),r>-1&&u.push(n[r]);return u},n.prototype.GetCountryDataModelForCountry=function(n,t){return this.GetCountryDataModelFor(n,function(n){return n.B2BName===t})},n.prototype.GetCountryDataModelForDialCode=function(n,t){var i=this;return this.GetCountryDataModelFor(n,function(n){return i.CleanDialCode(n.DialCode)===i.CleanDialCode(t)})},n.prototype.GetCountryDataModelForIsoCode=function(n,t){return this.GetCountryDataModelFor(n,function(n){return n.ISOCountryCode===t})},n.prototype.GetCountryDataModelFor=function(n,t){var i=this._q.defer(),r=this.GetCountryDataFromApi(n);return r.then(function(n){var r=_.find(n.CountryData,t);i.resolve(r)}),i.promise},n.prototype.CleanDialCode=function(n){return n?n.replace("+","").trim():""},n.ServiceName="Data_CountryDataService",n.$inject=["Data_Api","Error_Service","$q"],n}();n.CountryDataService=t})(t=n.DataProvider||(n.DataProvider={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(n){function t(t,i,r,u){return n.call(this,t,i,r,u,"DA-FUN",Main3.Cookies.CookieConstants.Names.RebookingPodIdentifier)||this}return __extends(t,n),t.prototype.GetCountryData=function(n,t,i){var r={LanguageCode:n};this.AjaxRequest("GET","data/getcountrydata",r,t,this.ExtractKnownError(i),"Data.GetCountryData",!0)},t.prototype.GetAvailableCurrencies=function(n,t){this.AjaxRequest("GET","data/getavailablecurrencies",null,n,this.ExtractKnownError(t),"Data.GetAvailableCurrencies",!0)},t.ServiceName="Data_Api",t.$inject=["ClientApi_Service","$http","$httpParamSerializer","IAnalyticsTracker"],t}(n.QueuedBaseApiService);t.DataApi=i})(t=n.DataProvider||(n.DataProvider={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(n){var i=t.call(this)||this;return i._screenreaderSettings=n,i._funnelBasketChangedAlertId="funnelBasketChanged",i}return __extends(i,t),i.prototype.AlertActivePairFlightsRemoved=function(){var n=this._screenreaderSettings.AllActiveJourneyFlightsRemovedAlertText;Utilities.ScreenReader.QueueAlert(n,this._funnelBasketChangedAlertId)},i.prototype.AlertLoadedExistingPair=function(){var n=this._screenreaderSettings.ReloadedExistingFlightsSearchAlertText;Utilities.ScreenReader.QueueAlert(n,this._funnelBasketChangedAlertId)},i.prototype.AlertAllFlightsRemoved=function(){var n=this._screenreaderSettings.AllFlightsRemovedAlertText;Utilities.ScreenReader.Alert(n,"funnelAllFlightsRemovedAlert")},i.prototype.AlertBasketChangedQueue=function(){Utilities.ScreenReader.AlertQueued(this._funnelBasketChangedAlertId)},i.prototype.AlertSelectedFareUnavailable=function(n){var t=this._screenreaderSettings.SelectedFareUnavailableAlertText;t=this.ReplaceFareTypeTokenInAlertMessage(t,n);Utilities.ScreenReader.Alert(t,"funnelSelectedFareUnavailable")},i.prototype.QueueFlightAddedAlert=function(n,t){var i=this._screenreaderSettings.FlightAddedAlertText;i=this.ReplaceFlightTypeTokenInAlertMessage(i,n);i=this.ReplaceFareTypeTokenInAlertMessage(i,t);Utilities.ScreenReader.QueueAlert(i,this._funnelBasketChangedAlertId)},i.prototype.QueueFlightRemovedAlert=function(n){var t=this._screenreaderSettings.FlightRemovedAlertText;t=this.ReplaceFlightTypeTokenInAlertMessage(t,n);Utilities.ScreenReader.QueueAlert(t,this._funnelBasketChangedAlertId)},i.prototype.QueueFlightReplacedAlert=function(n,t){var i=this._screenreaderSettings.FlightReplacedAlertText;i=this.ReplaceFlightTypeTokenInAlertMessage(i,n);i=this.ReplaceFareTypeTokenInAlertMessage(i,t);Utilities.ScreenReader.QueueAlert(i,this._funnelBasketChangedAlertId)},i.prototype.QueueBasketFareUpdatedAlert=function(n){var t=this._screenreaderSettings.BasketFareUpdatedAlertText;t=this.ReplaceFareTypeTokenInAlertMessage(t,n);Utilities.ScreenReader.QueueAlert(t,this._funnelBasketChangedAlertId)},i.prototype.QueueAddMoreFlightsLinkAppearanceAlert=function(){var n=this._screenreaderSettings.AddMoreFlightsLinkAppearanceAlertText;Utilities.ScreenReader.QueueAlert(n,this._funnelBasketChangedAlertId)},i.prototype.QueueAlertCurrencyChangedAlert=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.CurrencyChangedAlertText,"{currency code}",n.CurrencyCode,this._funnelBasketChangedAlertId)},i.prototype.QueueExtrasRemovedFromBasketAlert=function(n){n===void 0&&(n=this._funnelBasketChangedAlertId);var t=this._screenreaderSettings.ExtrasUpdatedOrRemovedFromBasketAlertText;Utilities.ScreenReader.QueueAlert(t,n)},i.prototype.QueueAlertLeadHotelGuestUpdated=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.HotelLeadGuestUpdatedAlertText,"{passenger name}",n,"reviewSectionChanged")},i.prototype.AlertHotelAddedToBasket=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.HotelAddedToBasketAlertText,"{HotelName}",n.Name,"hotelAddedToBasketAlert")},i.prototype.AlertHotelRemovedFromBasket=function(){var n=this._screenreaderSettings.HotelRemovedFromBasketAlertText;Utilities.ScreenReader.Alert(n,"hotelRemovedFromBasketAlert")},i.prototype.AlertHotelRoomSelectionChanged=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.HotelRoomSelectionChangedInBasketAlertText,"{HotelName}",n.Name,"hotelRoomSelectionChangedInBasketAlert")},i.prototype.AlertHotelReplacedInBasket=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.HotelReplacedInBasketAlertText,"{HotelName}",n.Name,"hotelReplacedInBasketAlert")},i.prototype.AlertPassengerSelected=function(n){var t=this;n.forEach(function(n){t.ReplaceTokenAndFireAlert(t._screenreaderSettings.SeatMapPassengerSelectedAlertText,"{passenger name}",n.FullDisplayName,"passengerSelectedAlert")})},i.prototype.AlertSeatSelected=function(n,t){var i=this._screenreaderSettings.SeatSelectedAlertText;i=this.ReplaceToken(i,"{SeatNumber}",n.SeatNumber);this.ReplaceTokenAndFireAlert(i,"{passenger name}",t.FullDisplayName,"seatSelectedAlert")},i.prototype.AlertSeatRemoved=function(n,t){var i=this._screenreaderSettings.SeatRemovedAlertText;i=this.ReplaceToken(i,"{SeatNumber}",n.SeatNumber);this.ReplaceTokenAndFireAlert(i,"{passenger name}",t.FullDisplayName,"seatRemovedAlert")},i.prototype.AlertNoSeatsInBasket=function(n,t){var i=this._screenreaderSettings.AllSeatsRemovedFromBasketAlertText;i=this.ReplaceToken(i,"{departure iata}",n);i=this.ReplaceToken(i,"{arrival iata}",t);Utilities.ScreenReader.Alert(i,"noSeatsInBasketText")},i.prototype.AlertSeatsInBasketForFlight=function(n,t,i){var r=this._screenreaderSettings.SeatAddedToBasketAlertText;r=this.ReplaceToken(r,"{departure iata}",n);r=this.ReplaceToken(r,"{arrival iata}",t);r=this.ReplaceToken(r,"{number of seats}",i.toString());Utilities.ScreenReader.Alert(r,"seatsInBasketForFlightText")},i.prototype.AlertVoucherRemovedFromBasketForFlight=function(n,t){var i=this._screenreaderSettings.VouchersRemovedFromBasketForAllPassengersOnFlightAlertText;i=this.ReplaceToken(i,"{voucher total}",t);i=this.ReplaceToken(i,"{route}",n);Utilities.ScreenReader.Alert(i,"vouchersRemovedFromBasketForAllPassengersOnFlightAlertText")},i.prototype.AlertMaximumVouchersAddedToBasketForPassenger=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.MaximumVouchersAddedToBasketForPassengerAlertText,"{passenger}",n,"maximumVouchersAddedToBasketForPassenger")},i.prototype.AlertVoucherAddedToBasketForPassenger=function(n,t,i){this.AlertVoucherBasketInteraction(this._screenreaderSettings.VoucherAddedToBasketForPassengerForAllFlightsAlertText,"voucherAddedToBasketForPassengerForAllFlightsAlert",n,t,i)},i.prototype.AlertVoucherRemovedFromBasketForPassenger=function(n,t,i){this.AlertVoucherBasketInteraction(this._screenreaderSettings.VoucherRemovedFromBasketForPassengerForAllFlightsAlertText,"voucherRemovedFromBasketForPassengerForAllFlightsAlert",n,t,i)},i.prototype.AlertVoucherAddedToBasketForPassengerOnFlight=function(n,t,i,r,u){this.AlertVoucherBasketInteraction(this._screenreaderSettings.VoucherAddedToBasketForPassengerForSpecificFlightAlertText,"voucherAddedToBasketForPassengerForAllFlightsAlert",n,i,r,t,u)},i.prototype.AlertVoucherRemovedFromBasketForPassengerOnFlight=function(n,t,i,r,u){this.AlertVoucherBasketInteraction(this._screenreaderSettings.VoucherRemovedFromBasketForPassengerForSpecificFlightAlertText,"voucherRemovedFromBasketForPassengerForAllFlightsAlert",n,i,r,t,u)},i.prototype.AlertDefaultVouchersAddedToBasket=function(){var n=this._screenreaderSettings.VouchersHaveBeenAddedToTheBasketAriaAlertText;Utilities.ScreenReader.Alert(n,"vouchersHaveBeenAddedToTheBasketAriaAlertText")},i.prototype.AlertVoucherBasketInteraction=function(n,t,i,r,u,f,e){var o=this.ReplaceToken(n,"{number of vouchers}",r.toString());o=this.ReplaceToken(o,"{voucher total}",u);o=this.ReplaceToken(o,"{route}",f);o=this.ReplaceToken(o,"{departure date}",e);this.ReplaceTokenAndFireAlert(o,"{passenger}",i,t)},i.prototype.AlertBagAddedToBasket=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.BagAddedToBasketAlertText,"{Weight}",n.Weight.toString(),"bagAddedToBasketAlert")},i.prototype.AlertBagRemovedFromBasket=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.BagRemovedFromBasketAlertText,"{Weight}",n.Weight.toString(),"bagRemovedFromBasketAlert")},i.prototype.AlertBagWeightChangedInBasket=function(n,t){var i=this._screenreaderSettings.BagWeightChangedInBasketAlertText;i=this.ReplaceToken(i,"{FromWeight}",n.Weight.toString());this.ReplaceTokenAndFireAlert(i,"{ToWeight}",t.Weight.toString(),"bagWeightChangedInBasketAlert")},i.prototype.AlertSportsEquipmentAddedToBasket=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.SportsEquipmentAddedToBasketAlertText,"{EquipmentType}",n.Name,"sportsEquipmentAddedToBasketAlert")},i.prototype.AlertSportsEquipmentRemovedFromBasket=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.SportsEquipmentRemovedFromBasketAlertText,"{EquipmentType}",n.Name,"sportsEquipmentRemovedFromBasketAlert")},i.prototype.AlertCarRemovedFromBasket=function(){var n=this._screenreaderSettings.CarRemovedFromBasketAlertText;Utilities.ScreenReader.Alert(n,"carRemovedFromBasketAlert")},i.prototype.TravelInsuranceProductAddedAlert=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.TravelInsuranceAddedToBasketText,"{product name}",n.Name,"travelInsuranceSelectionAddedAlert")},i.prototype.TravelInsuranceProductReplacedAlert=function(n,t){var i=this.ReplaceToken(this._screenreaderSettings.TravelInsuranceReplacedInBasketText,"{previous product name}",n.Name);i=this.ReplaceToken(i,"{product name}",t.Name);Utilities.ScreenReader.Alert(i,"travelInsuranceSelectionReplacedAlert")},i.prototype.TravelInsuranceProductRemovedAlert=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.TravelInsuranceRemovedFromBasketText,"{product name}",n,"travelInsuranceSelectionRemoveAlert")},i.prototype.TravelInsuranceOptionalExtraAddedAlert=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.TravelInsuranceOptionalExtraAddedToBasketText,"{extra name}",n.Name,"travelInsuranceExtraAddedAlert")},i.prototype.TravelInsuranceOptionalExtraRemovedAlert=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.TravelInsuranceOptionalExtraRemovedFromBasketText,"{extra name}",n.Name,"travelInsuranceExtraRemovedAlert")},i.prototype.TravelInsurancePassengerRemovedAlert=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.TravelInsurancePassengerRemovedFromBasketText,"{passenger name}",n,"travelInsurancePassengerRemoveAlert")},i.prototype.TravelInsurancePassengerAddedAlert=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.TravelInsurancePassengerAddedToBasketText,"{passenger name}",n,"travelInsurancePassengerRemoveAlert")},i.prototype.TravelInsuranceTotalCostAlert=function(n){this.ReplaceTokenAndFireAlert(this._screenreaderSettings.TravelInsuranceTotalCostOfInsuranceText,"{price}",n.toString(),"travelInsuranceTotalCostAlert")},i.prototype.AlertAllFlightsAndExtrasRemovedFromBasket=function(){var n=this._screenreaderSettings.AllFlightsAndExtrasRemovedFromBasketAlertText;Utilities.ScreenReader.Alert(n,"allFlightsAndExtrasRemovedFromBasketAlertText")},i.prototype.AlertChangeSearchPassengerCompositionChangedWarning=function(n){Utilities.ScreenReader.Alert(n,"alertChangeSearchPassengerCompositionChangedWarning")},i.prototype.ReplaceToken=function(n,t,i){var r=!i?"":i;return!n?"":n.replace(new RegExp(t,"g"),r)},i.prototype.ReplaceTokenAndFireAlert=function(n,t,i,r){n=this.ReplaceToken(n,t,i);Utilities.ScreenReader.Alert(n,r)},i.prototype.ReplaceFlightTypeTokenInAlertMessage=function(t,i){var r=i===n.Data.Common.RouteDirection.Outbound?this._screenreaderSettings.OutboundFlightTypeText:this._screenreaderSettings.ReturnFlightTypeText;return t.replace("{flight type}",r)},i.prototype.ReplaceFareTypeTokenInAlertMessage=function(t,i){var r=i===n.Data.Common.FlightFareType.Standard?this._screenreaderSettings.StandardFareTypeText:this._screenreaderSettings.FlexiFareTypeText;return t.replace("{fare type}",r)},i.ServiceName="Funnel_AccessibilityService",i.$inject=["Sitecore_FunnelScreenreaderSettings"],i}(t.Common.AccessibilityService);i.AccessibilityService=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._sitecoreLanguageSettings=n;this._bookingComApiSettings=t;this._routesData=i;this._qService=r}return t.prototype.ReplaceDeepLinkUrlTokens=function(t,i,r,u,f){var s=this,e,o;return f===void 0&&(f=new Dictionary),e={UrlFormat:i,DateFormat:r,TimeFormat:u,BookingData:t,RoutesData:this._routesData,HotelAffiliateId:f.Get(n.Data.Common.UrlTokens.HotelAffiliateId),SitecoreLanguageCode:this._sitecoreLanguageSettings.SitecoreLanguageCode,GetHotelDisplayName:function(n){return s._bookingComApiSettings.GetAirportSettings(n).then(function(n){return n.DisplayName||""})}},o=new Main3.Funnel.UpsellTokenReplacer(e,this._qService),o.ReplaceDeepLinkUrlTokens()},t.ServiceName="Funnel_AncillaryUpsellTokenReplacementService",t.$inject=["Sitecore_SitecoreLanguageSettings","CommonApi_BookingComApiService","Sitecore_RoutesData","$q"],t}();t.AncillaryUpsellTokenReplacementService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._funnelBasketService=n;this._funnelCurrencyService=t}return n.prototype.GetCurrencyCodeForAvailabilityRequest=function(){return this._funnelCurrencyService.GetCurrency(3)},n.prototype.GetBaseCurrencyCodeForAvailabilityRequest=function(){return this._funnelBasketService.GetPrimaryJourneyPair().BaseCurrency},n.prototype.GridFlightsRetrieved=function(n){var i,t,r,u,f;if(!!n.DepartureIata&&!!n.BaseCurrency){if(i=this._funnelBasketService.GetJourneyPairs(),!!i)for(t=0,r=i;t<r.length;t++)u=r[t],f=u.OutboundSlot.Route.OriginIata.toUpperCase()===n.DepartureIata.toUpperCase(),f&&(u.BaseCurrency=n.BaseCurrency);this._funnelBasketService.HasAnyFlights()?this._funnelCurrencyService.UpdateCurrencyToMatchPrimaryPair(2):this._funnelCurrencyService.SetCurrency(n.BaseCurrency,2)}},n.ServiceName="Funnel_AvailabilityCurrencyService",n.$inject=["Funnel_BasketService","Funnel_CurrencyService"],n}();n.AvailabilityCurrencyService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f,e,o,s,h,c,l,a){this._analyticsSettings=n;this._sitecorePageSettings=t;this._accountService=i;this._countryDataService=r;this._funnelJourneyCookieService=u;this._funnelBasketService=f;this._funnelCurrencyService=e;this._funnelPriceService=o;this._funnelBasketHotelsService=s;this._priceService=h;this._deepLinkSettings=c;this._funnelRootSettings=l;this._funnelVouchersAssociationsService=a;this._delimiter="|"}return t.prototype.GetEnsightenData=function(){return this._journeyCookie=this._funnelJourneyCookieService.ReadCookie(),this._ensightenData=this.InitialiseEnsightenData(),this._fareTypeBasket=this._funnelBasketService.GetFareType(),this.SetEmail(),this.ShouldPullDataFromBasket()?(this.SetFlightDataFromBasket(),this.SetMemberDetails(),this.SetBookingReference(),this.SetLuggageData(),this.SetHotelData(),this.SetCarData(),this.SetVouchersData()):this.SetFlightDataFromJourneyCookie(),this._ensightenData},t.prototype.InitialiseEnsightenData=function(){return{pageName:this._sitecorePageSettings.PageSitecoreItemName||"",category:"Book a Flight",country:this._analyticsSettings.EnsightenLanguageCode,language:this._deepLinkSettings.LanguageCode||"",device:Main3.Common.BreakPointService.GetCurrentBreakpointName(),currency:this._funnelCurrencyService.GetCurrency()||"",email:"",tran_departure_point:"",destination:"",product_type:"",number_adults:this.GetPassengerQuantityString(this._journeyCookie.NumberOfAdults),number_children:this.GetPassengerQuantityString(this._journeyCookie.NumberOfChildren),number_infants:this.GetPassengerQuantityString(this._journeyCookie.NumberOfInfants),select_outbound_date:"",select_outbound_faretype:"",select_inbound_date:"",select_inbound_faretype:"",passenger_quantity:this.GetPassengerQuantityString(this.GetPassengerQuantity()),flight_cost:"",unit_cost:"",user_country:"",user_city:"",qty:this.GetPassengerQuantityString(this.GetPassengerQuantity()),luggage_cost:"",luggage_weight:"",hotel_name:"",hotel_cost:"",nights:"",levordref:"",total_flight_cost:"",total_price:"",number_selected_seats:"",selected_seats_band:"",selected_seats_cost:"",total_allocated_seat_cost:"",car_type:"",car_cost:"",vouchers_cost:"",vouchers_quantity:"",vouchers_subtotal:""}},t.prototype.SetEmail=function(){var n=this;this._accountService.GetUsername(function(t){t.Username&&(n._ensightenData.email=t.Username)},function(){n._ensightenData.email=""})},t.prototype.ShouldPullDataFromBasket=function(){var n=this._funnelBasketService.GetPrimaryJourneyPair();return this._funnelBasketService.JourneyPairHasOutboundFlightSelected(n)},t.prototype.SetFlightDataFromBasket=function(){this._ensightenData.product_type="Flight";this._ensightenData.qty=this.GetPassengerQuantityString(this.GetPassengerQuantity()*this.GetSlotQuantity());this._primaryJourneyPair=this._funnelBasketService.GetPrimaryJourneyPair();this.SetSeatingProperties();!this._primaryJourneyPair.OutboundSlot||(this.SetFlightDataFromBasketOutboundSlot(),!this._primaryJourneyPair.OutboundSlot.Flight||this.SetFlightDataFromBasketOutboundFlight());!this._primaryJourneyPair.ReturnSlot||(this.SetFlightDataFromBasketReturnSlot(),!this._primaryJourneyPair.ReturnSlot.Flight||this.SetFlightDataFromBasketReturnFlight())},t.prototype.SetFlightDataFromBasketOutboundSlot=function(){this._ensightenData.select_outbound_faretype=this.GetFareTypeStringViaBasket()},t.prototype.SetFlightDataFromBasketOutboundFlight=function(){var n=this._primaryJourneyPair.OutboundSlot.Flight;this._ensightenData.tran_departure_point=n.DepartureIata||"";this._ensightenData.destination=n.ArrivalIata||"";this._ensightenData.select_outbound_date=this.GetLocalDepartureTimeStringFromFlight(n);this._ensightenData.flight_cost=this.GetFlightCost(n.FlightFares);this._ensightenData.total_flight_cost=this.GetTotalFlightCostString();this._ensightenData.total_price=this.GetTotalPrice();this._ensightenData.unit_cost=this.GetUnitCost(n.FlightFares)},t.prototype.SetFlightDataFromBasketReturnSlot=function(){this._ensightenData.select_inbound_faretype=this.GetFareTypeStringViaBasket();this._ensightenData.flight_cost+=this._delimiter;this._ensightenData.unit_cost+=this._delimiter},t.prototype.SetFlightDataFromBasketReturnFlight=function(){var n=this._primaryJourneyPair.ReturnSlot.Flight;this._ensightenData.select_inbound_date=this.GetLocalDepartureTimeStringFromFlight(n);this._ensightenData.flight_cost+=this.GetFlightCost(n.FlightFares);this._ensightenData.total_flight_cost=this.GetTotalFlightCostString();this._ensightenData.total_price=this.GetTotalPrice();this._ensightenData.unit_cost+=this.GetUnitCost(n.FlightFares)},t.prototype.SetFlightDataFromJourneyCookie=function(){this._ensightenData.tran_departure_point=this._journeyCookie.OriginIata||"";this._ensightenData.destination=this._journeyCookie.DestinationIata||"";this._ensightenData.select_outbound_date=this.GetDateString(this._journeyCookie.OutboundDate);this._ensightenData.select_outbound_faretype=this.GetFareTypeStringViaJourneyCookie();this._ensightenData.qty=this.GetPassengerQuantityString(this.GetPassengerQuantity());!this._journeyCookie.ReturnDate||(this._ensightenData.select_inbound_date=this.GetDateString(this._journeyCookie.ReturnDate),this._ensightenData.select_inbound_faretype=this.GetFareTypeStringViaJourneyCookie(),this._ensightenData.qty=this.GetPassengerQuantityString(this.GetPassengerQuantity()*2))},t.prototype.GetSlotQuantity=function(){var t=this._funnelBasketService.GetJourneyPairs(),n=0;return t.forEach(function(t){t.ReturnSlot?n+=2:!t.OutboundSlot||n++}),n},t.prototype.GetPassengerQuantity=function(){var n=this._journeyCookie.NumberOfAdults,t=this._journeyCookie.NumberOfChildren;return this.ThereIsAtLeastOneValidPassengerCount(n,t)?this.GetSafeNumber(this._journeyCookie.NumberOfAdults)+this.GetSafeNumber(this._journeyCookie.NumberOfChildren):NaN},t.prototype.ThereIsAtLeastOneValidPassengerCount=function(n,t){return!!n||n===0||!!t||t===0},t.prototype.GetFareTypeStringViaJourneyCookie=function(){return this._journeyCookie.ShowFlexiFares?"flexi":"regular"},t.prototype.GetFareTypeStringViaBasket=function(){return this._fareTypeBasket===n.Data.Common.FlightFareType.Flexi?"flexi":"regular"},t.prototype.GetTotalPrice=function(){return this.GetPriceString(this._priceService.Subtract(this._funnelPriceService.TotalPrice(),this._funnelPriceService.GetPriceOfHotelInBasketCurrency()))},t.prototype.GetTotalFlightCostString=function(){return this.HasAnyFlightPrices()?this.GetPriceString(this._funnelPriceService.GetPriceOfFlights()):""},t.prototype.HasAnyFlightPrices=function(){var n=null,t=null;return!this._primaryJourneyPair.OutboundSlot||!this._primaryJourneyPair.OutboundSlot.Flight||(n=this.GetFlightPrice(this._primaryJourneyPair.OutboundSlot.Flight.FlightFares)),!this._primaryJourneyPair.ReturnSlot||!this._primaryJourneyPair.ReturnSlot.Flight||(t=this.GetFlightPrice(this._primaryJourneyPair.ReturnSlot.Flight.FlightFares)),!!n||!!t},t.prototype.GetFlightCost=function(n){var t=this.GetFlightPrice(n);return this.GetPriceString(t)},t.prototype.GetFlightPrice=function(n){var t=this.GetFarePrices(n),i,r,u;return!!t&&this.ThereIsAtLeastOneFarePrice(t)?(i=this._priceService.NewPrice(0,0),!t.Adult||(i=this._priceService.Multiply(t.Adult,this.GetSafeNumber(this._journeyCookie.NumberOfAdults))),r=this._priceService.NewPrice(0,0),!t.Child||(r=this._priceService.Multiply(t.Child,this.GetSafeNumber(this._journeyCookie.NumberOfChildren))),u=this._priceService.NewPrice(0,0),!t.Infant||(u=this._priceService.Multiply(t.Infant,this.GetSafeNumber(this._journeyCookie.NumberOfInfants))),this._priceService.Add(i,r,u)):null},t.prototype.ThereIsAtLeastOneFarePrice=function(n){return!!n.Adult||!!n.Child||!!n.Infant},t.prototype.GetUnitCost=function(n){var t=this.GetFarePrices(n);return(!!t&&this.GetPriceString(t.Adult)||"").toString()},t.prototype.GetFarePrices=function(n){var i=this,t;return!!n&&(t=n.filter(function(n){return n.FareType===i._fareTypeBasket})[0],!!t)?t.Prices:null},t.prototype.GetPassengerQuantityString=function(n){return n===0?n.toString():(n||"").toString()},t.prototype.GetPriceString=function(n){return!n?"":this._priceService.GetNumericValue(n).toString()},t.prototype.GetSafeNumber=function(n){return!n?0:n},t.prototype.GetLocalDepartureTimeStringFromFlight=function(n){return!n.LocalDepartureTime?"":n.LocalDepartureTime.Date().ToIso8601()},t.prototype.GetDateString=function(n){return!n?"":n.ToIso8601()},t.prototype.SetSeatingProperties=function(){this.GetAssignedSeats()&&this.GetAssignedSeats().length>0&&(this._ensightenData.number_selected_seats=this.GetAssignedSeats().length.toString(),this._ensightenData.selected_seats_band=_(this.GetAssignedSeats()).map(function(n){return n.PriceBandId}).join("|"),this._ensightenData.selected_seats_cost=this.GetSeatsCost(),this._ensightenData.total_allocated_seat_cost=this.GetPriceString(this._funnelPriceService.GetPriceOfSeats()),this._ensightenData.product_type+="|Seats")},t.prototype.GetAssignedSeats=function(){var n=this._funnelBasketService.GetBasket().Associations;return n=_(n).select(function(n){return!!n.Seat}),_(n).map(function(n){return n.Seat})},t.prototype.GetSeatsCost=function(){var n=this,t=this._funnelBasketService.GetBasket().Associations,i=t.filter(function(n){return!!n.Seat}).map(function(t){return n._funnelPriceService.GetSeatBandPrice(t.Seat,n._funnelPriceService.PassengerForAssociationHasEjPlusCard(t))});return i.map(function(t){return n.GetPriceString(t)}).join("|")},t.prototype.SetBookingReference=function(){this._ensightenData.levordref=this._funnelBasketService.GetBasket().BookingReference||""},t.prototype.SetMemberDetails=function(){var t=this,n=this._funnelBasketService.GetBasket().BookerDetails;!n||(!n.ResidentOfValue||this.GetCookieCachedCountryCode(n.ResidentOfValue,function(n){t._ensightenData.user_country=n}),this._ensightenData.email=n.Email?n.Email:"",this._ensightenData.user_city=n.City?n.City:"")},t.prototype.GetCookieCachedCountryCode=function(n,t){var u=this,r=!1,i;!this._journeyCookie.EnsightenCountryCache||(i=this._journeyCookie.EnsightenCountryCache.split(":"),i.length==2&&i[0]===n&&(t(i[1]),r=!0));r||this._countryDataService.GetCountryDataModelForCountry(this._funnelRootSettings.EResLanguageCode,n).then(function(i){var r=!!i&&i.ISOCountryCode?i.ISOCountryCode:"";u._funnelJourneyCookieService.UpdateCookie(function(t){return t.EnsightenCountryCache=n+":"+r});t(r)})},t.prototype.SetLuggageData=function(){var n=this._funnelBasketService.GetBasket().Luggage,t,i;!n||(t=0,n.HoldBags.forEach(function(n){return t+=n.TotalWeight}),this._ensightenData.luggage_weight=t.toString(),i=this._funnelPriceService.GetPriceOfHoldBags(),this._ensightenData.luggage_cost=this.GetPriceString(i),n.HoldBags.length>=1&&(this._ensightenData.product_type+="|Hold Baggage"))},t.prototype.SetHotelData=function(){var t=this._funnelBasketService.GetBasket().Hotel,i;!t||(this._ensightenData.hotel_name=t.Name,this._ensightenData.nights=this._funnelBasketHotelsService.GetNights().toString(),i=this._funnelPriceService.GetPriceOfHotelInBasketCurrency(),this._ensightenData.hotel_cost=this.GetPriceString(i),t.BookingType===n.Data.Common.HotelBookingType.BookNowPayNow?this._ensightenData.product_type+="|Hotel(PayNow)":t.BookingType===n.Data.Common.HotelBookingType.BookNowPayLater&&(this._ensightenData.product_type+="|Hotel(PayLater)"))},t.prototype.SetCarData=function(){var n=this._funnelBasketService.GetBasket().Car;!n||(this._ensightenData.car_type=n.CarCategory,this._ensightenData.car_cost=this.GetPriceString(n.TotalPrice),this._ensightenData.product_type+="|Car")},t.prototype.SetVouchersData=function(){var n=this._funnelVouchersAssociationsService.GetVouchersSummaryForAllFlights();!!n&&n.Quantity>0&&(this._ensightenData.vouchers_cost=this.GetPriceString(n.Cost),this._ensightenData.vouchers_quantity=n.Quantity.toString(),this._ensightenData.vouchers_subtotal=this.GetPriceString(this._priceService.Multiply(n.Cost,n.Quantity)),this._ensightenData.product_type+="|Vouchers")},t.ServiceName="EnsightenData_Service",t.$inject=["Sitecore_AnalyticsSettings","Sitecore_PageSettings","Account_Service","Data_CountryDataService","FunnelJourneyCookie_Service","Funnel_BasketService","Funnel_CurrencyService","Funnel_PriceService","Funnel_BasketHotelsService","Common_PriceService","Sitecore_DeepLinkSettings","Sitecore_FunnelRootSettings","Funnel_VouchersAssociationsService"],t}();t.EnsightenDataService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._funnelBasketService=n;this._accessibilityService=t;this._funnelJourneyCookieService=i}return t.prototype.GetActiveJourneyPair=function(){var n=this._funnelBasketService.GetJourneyPairs(),t=this._funnelJourneyCookieService.ReadCookie().ActiveJourneyPairId;return!!n&&t!=null?n.filter(function(n){return n.Id==t})[0]:null},t.prototype.GetInactiveJourneyPairs=function(){var n=this.GetActiveJourneyPair();return this._funnelBasketService.GetJourneyPairs().filter(function(t){return t.Id!==n.Id})},t.prototype.GetInactiveJourneyPairFlights=function(){var n=this.GetInactiveJourneyPairs();return this._funnelBasketService.GetFlightsForJourneyPairs(n)},t.prototype.UpdateActiveJourneyPair=function(t,i){i===void 0&&(i=!0);this._funnelJourneyCookieService.UpdateCookie(function(n){n.ActiveJourneyPairId=t});this.UpdateJourneyCookieFromActiveJourneyPair();i&&n.Events.Fire(n.Events.Names.Funnel.ActiveJourneyPairChanged)},t.prototype.ActivePairHasReturnLeg=function(){return!!this.GetActiveJourneyPair().ReturnSlot},t.prototype.HasReturnSlotButOnlyOutboundFlightSelected=function(){var n=this.GetActiveJourneyPair();return this._funnelBasketService.JourneyPairHasOutboundFlightSelected(n)&&this._funnelBasketService.JourneyPairHasReturnSlot(n)&&!this._funnelBasketService.JourneyPairHasReturnFlightSelected(n)},t.prototype.OnlyContainsReturnFlight=function(){var n=this.GetActiveJourneyPair();return!this._funnelBasketService.JourneyPairHasOutboundFlightSelected(n)&&this._funnelBasketService.JourneyPairHasReturnFlightSelected(n)},t.prototype.ActivePairHasNoFlights=function(){var n=this.GetActiveJourneyPair();return!this._funnelBasketService.JourneyPairHasOutboundFlightSelected(n)&&!this._funnelBasketService.JourneyPairHasReturnFlightSelected(n)},t.prototype.SetLastJourneyPairAsActivePair=function(){var n=this._funnelBasketService.GetJourneyPairs().slice(-1)[0].Id;return this.UpdateActiveJourneyPair(n,!0),n},t.prototype.SetFirstIncompleteAsActivePair=function(){var n=this._funnelBasketService.GetFirstIncompleteJourneyPairId();n!=null&&this.UpdateActiveJourneyPair(n)},t.prototype.SetPrimaryJourneyPairAsActivePair=function(){var n=this._funnelBasketService.GetPrimaryJourneyPair();this.UpdateActiveJourneyPair(n.Id,!1)},t.prototype.UpdateJourneyCookieFromActiveJourneyPair=function(){var n=this.GetActiveJourneyPair(),t=this._funnelJourneyCookieService.ReadCookie();t.OriginIata=n.OutboundSlot.Route.OriginIata;t.DestinationIata=n.OutboundSlot.Route.DestinationIata;t.OutboundDate=n.OutboundSlot.Flight?n.OutboundSlot.Flight.LocalDepartureTime.Date():n.OutboundSlot.Route.Date;t.ReturnDate=n.ReturnSlot?n.ReturnSlot.Flight?n.ReturnSlot.Flight.LocalDepartureTime.Date():n.ReturnSlot.Route.Date:null;this._funnelJourneyCookieService.WriteCookie(t)},t.prototype.FlightIsSelectedInOtherPairs=function(t,i){var u=this.GetInactiveJourneyPairFlights(),r;if(!!u&&!!i&&!!t){if(r=u.some(function(n){return i.SegmentId===n.SegmentId}),r&&t.FareType===this._funnelBasketService.GetFareType())return n.Data.Controls.FlightGridSelectedInOtherPairResult.Selected;if(r&&t.FareType!==this._funnelBasketService.GetFareType())return n.Data.Controls.FlightGridSelectedInOtherPairResult.OtherFareTypeSelected}return n.Data.Controls.FlightGridSelectedInOtherPairResult.NotSelected},t.ServiceName="Funnel_ActivePairService",t.$inject=["Funnel_BasketService","Funnel_AccessibilityService","FunnelJourneyCookie_Service"],t}();t.FunnelActivePairService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(n,i,r,u){return t.call(this,n,i,r,u,"DA-FUN",Main3.Cookies.CookieConstants.Names.RebookingPodIdentifier)||this}return __extends(i,t),i.prototype.GetHeaders=function(){return null},i.prototype.SetBasketJourneyPairs=function(n,t,i){this.AjaxRequest("POST","funnel/setbasketflights",n,t,this.ExtractKnownError(i),"Funnel.SetBasketFlights",!0)},i.prototype.GetFlightCharges=function(n,t,i,r,u){var f={FlightSegmentIds:i,LanguageCode:t,CurrencyCode:n};this.AjaxRequest("POST","funnel/getflightcharges",f,r,this.ExtractKnownError(u),"Funnel.GetFlightCharges")},i.prototype.ChangeBasketCurrency=function(t,i,r,u,f,e){var o={Flights:i,FareType:n.Data.Common.FlightFareType.ToString(r),CurrencyCode:t,SeatAssignments:u};this.AjaxRequest("POST","funnel/changebasketcurrency",o,f,this.ExtractKnownError(e),"Funnel.ChangeBasketCurrency",!0)},i.prototype.ChangeReasonForTravel=function(n,t,i){var r={ReasonForTravelCode:n};this.AjaxRequest("POST","funnel/changereasonfortravel",r,t,this.ExtractKnownError(i),"Funnel.ChangeReasonForTravel")},i.prototype.KeepSessionAlive=function(n,t){this.AjaxRequest("POST","funnel/keepsessionalive",{},n,this.ExtractKnownError(t),"Funnel.KeepSessionAlive")},i.prototype.UpdatePassengerDetails=function(n,t,i){var r={Updates:n};this.AjaxRequest("POST","funnel/updatepassengerdetails",r,t,this.ExtractKnownError(i),"Funnel.UpdatePassengerDetails")},i.prototype.UpdateMemberDetails=function(n,t,i){this.AjaxRequest("POST","funnel/updatememberdetails",n,t,this.ExtractKnownError(i),"Funnel.UpdateMemberDetails")},i.prototype.SetNewMemberEmailAddress=function(n,t,i){this.AjaxRequest("POST","funnel/setnewmemberemailaddress",n,t,this.ExtractKnownError(i),"Funnel.SetNewMemberEmailAddress")},i.prototype.VerifyUsernameWithForgottenPassword=function(n,t,i){this.AjaxRequest("POST","account/verifyusernamewithforgottenpassword",n,t,this.ExtractKnownError(i),"Account.VerifyUsernameWithForgottenPassword")},i.prototype.Finalize=function(n,t,i,r,u,f,e,o,s,h,c){c===void 0&&(c=null);var l={PaymentMethod:n,PaymentCard:t,SepaPayment:i,AllowDuplicateBooking:r,DisplayedTotalBasketPrice:u,AddNewMember:f,AddNewMemberPassword:e,CultureCode:o,SecurePaymentParameters:c};this.AuthenticatedAjaxRequest("POST","funnel/finalize",l,s,this.ExtractKnownError(h),"Funnel.Finalize")},i.prototype.GetBasket=function(n,t){this.AjaxRequest("GET","funnel/getbasket",null,n,this.ExtractKnownError(t),"Funnel.GetBasket",!0)},i.prototype.EmptyBasket=function(n,t){this.AjaxRequest("POST","funnel/emptybasket",null,n,this.ExtractKnownError(t),"Funnel.GetBasket",!0)},i.prototype.GetBasketWithMemberDetails=function(n,t){this.AjaxRequest("GET","funnel/getbasketwithmemberdetails",null,n,this.ExtractKnownError(t),"Funnel.GetBasketWithMemberDetails",!0)},i.prototype.GetBooking=function(n,t){this.AjaxRequest("GET","funnel/getbooking",null,n,this.ExtractKnownError(t),"Funnel.GetBooking",!0)},i.prototype.UpdateSeatAssignments=function(n,t,i){var r={Updates:n};this.AjaxRequest("POST","funnel/updateseatassignments",r,t,this.ExtractKnownError(i),"Funnel.UpdateSeatAssignments")},i.prototype.UpdateVoucherAssignments=function(n,t,i){var r={Updates:n};this.AjaxRequest("POST","funnel/updatevoucherassignments",r,t,this.ExtractKnownError(i),"Funnel.UpdateVoucherAssignments")},i.prototype.UpdateLuggage=function(n,t,i){this.AjaxRequest("POST","funnel/updateluggage",n,t,this.ExtractKnownError(i),"Funnel.UpdateLuggage")},i.prototype.AddLuggage=function(n,t,i){this.AjaxRequest("POST","funnel/addluggage",n,t,this.ExtractKnownError(i),"Funnel.AddLuggage")},i.prototype.RemoveLuggage=function(n,t,i){this.AjaxRequest("POST","funnel/removeluggage",n,t,this.ExtractKnownError(i),"Funnel.RemoveLuggage")},i.prototype.UpdateHotel=function(n,t,i){this.AjaxRequest("POST","funnel/updatehotel",n,t,this.ExtractKnownError(i),"Funnel.UpdateHotel")},i.prototype.UpdateCar=function(n,t,i){this.AjaxRequest("POST","funnel/updatecar",n,t,this.ExtractKnownError(i),"Funnel.UpdateCar")},i.prototype.UpdateTravelInsurance=function(n,t,i){this.AjaxRequest("POST","funnel/updatetravelinsurance",n,t,this.ExtractKnownError(i),"Funnel.UpdateTravelInsurance")},i.prototype.VerifyEjPlusNumber=function(n,t,i){this.AjaxRequest("POST","funnel/verifyejpluscard",n,t,this.ExtractKnownError(i),"Funnel.VerifyEjPlusCard")},i.prototype.GetBasketFlightsCharges=function(n,t,i){var r={IncludeSeatCharges:n};this.AjaxRequest("GET","funnel/getbasketflightscharges",r,t,this.ExtractKnownError(i),"Funnel.GetBasketFlightsCharges")},i.prototype.GetAdminFee=function(n,t,i,r){var u={CurrencyCode:n,LanguageCode:t};this.AjaxRequest("GET","funnel/getadminfee",u,i,this.ExtractKnownError(r),"Funnel.GetAdminFee",!0)},i.ServiceName="Funnel_Api",i.$inject=["ClientApi_Service","$http","$httpParamSerializer","IAnalyticsTracker"],i}(t.AuthenticatedBaseApiService);i.FunnelApi=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._funnelBasketService=n;this._funnelPriceService=t;this._accessibilityService=i}return n.prototype.SetSeatAssignment=function(n,t){var i=this.GetFlightAssociationForPassengerAndFlight(n,t.Passenger.Id),r;i&&(r={Price:t.Seat.Price,PriceBand:t.Seat.PriceBand,PriceBandId:t.Seat.PriceBandId,PriceBandDisplayName:t.Seat.PriceBandDisplayName,PriceWithCreditCardFee:t.Seat.PriceWithCreditCardFee,SeatNumber:t.Seat.SeatNumber,IsRestricted:t.Seat.SeatAccess==="Restricted"},i.Seat=r)},n.prototype.AlertSeatsInBasketUpdated=function(n){var t=this._funnelBasketService.GetFlights().filter(function(t){return t.InternalId===n})[0],i;!t||(i=this.GetFlightAssociations().filter(function(t){return t.FlightInternalId===n&&!!t.Seat&&!!t.Seat.SeatNumber}),this._funnelBasketService.HasAnySeatsAssigned()?this._accessibilityService.AlertSeatsInBasketForFlight(t.DepartureIata,t.ArrivalIata,i.length):this._accessibilityService.AlertNoSeatsInBasket(t.DepartureIata,t.ArrivalIata))},n.prototype.GetSeatAssociationsUpdateRequest=function(n){for(var i,u,r=[],t=0;t<n.length;t++)i={FlightInternalId:n[t].FlightInternalId,PassengerInternalId:n[t].PassengerInternalId,CarriedInfantId:n[t].CarriedInfantId,Seat:null},n[t].Seat&&(u={PriceBand:n[t].Seat.PriceBand,PriceBandDisplayName:n[t].Seat.PriceBandDisplayName,Price:n[t].Seat.Price,PriceWithCreditCardFee:n[t].Seat.PriceWithCreditCardFee,SeatNumber:n[t].Seat.SeatNumber,IsRestricted:n[t].Seat.IsRestricted,PriceBandId:n[t].Seat.PriceBandId},i.Seat=u),r.push(i);return r},n.prototype.GetFlightAssociations=function(){return this._funnelBasketService.GetBasket().Associations},n.prototype.GetFlightAssociationsForFlight=function(n){var t=this.GetFlightAssociations();return t&&(t=t.filter(function(t){return t.FlightInternalId===n})),t},n.prototype.SetFlightAssociations=function(n){this._funnelBasketService.GetBasket().Associations=n},n.prototype.ClearSeatsForFlight=function(n){var t=this.GetFlightAssociations();t.filter(function(t){return t.FlightInternalId===n}).forEach(function(n){n.Seat=null});this.SetFlightAssociations(t)},n.prototype.GetSeatBandSummaryForAllFlights=function(){var n=this.GetFlightAssociations().filter(function(n){return n.Seat&&n.Seat.SeatNumber?n.Seat!=null:!1});return this.GetSeatBandSummaryForAssociations(!0,n)},n.prototype.GetSeatBandSummaryForFlight=function(n){var t=this.GetFlightAssociations().filter(function(t){return t.Seat&&t.Seat.SeatNumber?t.FlightInternalId===n&&t.Seat!=null:!1});return this.GetSeatBandSummaryForAssociations(!0,t)},n.prototype.GetSeatBandSummaryFromBooking=function(n,t,i){var r=i.Associations.filter(function(t){return t.Seat&&t.Seat.SeatNumber?t.FlightInternalId===n&&t.Seat!=null:!1});return this.GetSeatBandSummaryForAssociations(t,r)},n.prototype.GetSeatBandSummaryForAssociations=function(n,t){var r=this,i=new Dictionary;return t.forEach(function(t){var u=r._funnelPriceService.PassengerForAssociationHasEjPlusCard(t),f=n?t.Seat.PriceBandDisplayName+"_"+t.Seat.Price+"_"+u:t.Seat.PriceBandDisplayName,e;i.ContainsKey(f)?i.Get(f).Quantity++:(e={PriceBand:t.Seat.PriceBand,PriceBandDisplayName:t.Seat.PriceBandDisplayName,Quantity:1,Price:r._funnelPriceService.GetSeatBandPrice(t.Seat,u),IsEjPlus:u},i.Set(f,e))}),i.AllValues()},n.prototype.GetFlightAssociationForPassengerAndFlight=function(n,t){var i=this.GetFlightAssociations().filter(function(i){return n===i.FlightInternalId&&t===i.PassengerInternalId});return i.length===1?i[0]:null},n.ServiceName="Funnel_AssociationsService",n.$inject=["Funnel_BasketService","Funnel_PriceService","Funnel_AccessibilityService"],n}();n.FunnelAssociationsService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.prototype.CreateClientBasketPassengerDataFromFunnelQuery=function(t,i){for(var u=[],r=0;r<t;r++)u.push(this.CreateClientBasketPassenger(n.Data.Common.PassengerDataType.Adult));for(r=0;r<i;r++)u.push(this.CreateClientBasketPassenger(n.Data.Common.PassengerDataType.Child));return u},t.prototype.CreateClientBasketInfantDataFromFunnelQuery=function(t){for(var i=[],r=0;r<t;r++)i.push(this.CreateClientBasketPassenger(n.Data.Common.PassengerDataType.Infant));return i},t.prototype.CreateClientBasketPassenger=function(n){return{Type:n,HasSpecialServiceFlags:!1,EjPlusNumber:"",FirstName:"",LastName:"",Title:"",Age:null,InternalId:System.Guid.MakeNew().ToString()}},t.prototype.CreateInitialJourneyPairs=function(n,t){return[{Id:1,IsPrimaryPair:!0,BaseCurrency:n.BaseCurrencyCode,OutboundSlot:this.CreateJourneySlot(n.Outbound,!1,t),ReturnSlot:this.CreateJourneySlot(n.Return,!0,t)}]},t.prototype.CreateJourneySlot=function(n,t,i){if(!i.ReturnDate&&t)return null;var r={Date:t?i.ReturnDate:i.OutboundDate,OriginIata:t?i.DestinationIata:i.OriginIata,DestinationIata:t?i.OriginIata:i.DestinationIata};return{Flight:this.CreateClientBasketFlight(n),Route:r}},t.prototype.CreateClientBasketFlight=function(n){return n?{InternalId:n.InternalId,ArrivalIata:n.ArrivalIata,ArrTerminalName:n.ArrivalTerminalName,CarrierCode:n.CarrierCode,DepartureIata:n.DepartureIata,DepTerminalName:n.DepartureTerminalName,FlightNumber:n.FlightNumber,LocalDepartureTime:Utilities.ZonelessDateTime.FromIso8601(n.LocalDepartureTime),LocalArrivalTime:Utilities.ZonelessDateTime.FromIso8601(n.LocalArrivalTime),IsCancelled:!1,IsDisrupted:!1,SegmentId:n.SegmentId,FlightKey:n.FlightKey,CanCheckIn:n.CanCheckIn,FlightFares:this.MapClientFares(n.FlightFares),FlightTaxes:n.FlightTaxes}:null},t.prototype.MapClientFares=function(n){return _(n).map(function(n){return{FareType:n.FareType,Prices:n.Prices,FlightIdentification:n.FlightIdentification}})},t.ServiceName="Funnel_BasketBuilder",t}();t.FunnelBasketBuilder=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._funnelBasketService=n}return t.prototype.RemoveExtrasFromClientBasket=function(){this.RemoveHotelFromClientBasket();this.RemoveCarFromClientBasket();this.RemoveAllLuggageFromClientBasket();this.RemoveAllSeatsFromClientBasket();this.RemoveAllVouchersFromClientBasket();this.RemoveTravelInsuranceFromClientBasket()},t.prototype.RemoveCarFromClientBasket=function(){var n=this._funnelBasketService.GetBasket();!n||(n.Car=null)},t.prototype.RemoveAllLuggageFromClientBasket=function(){var t=this._funnelBasketService.GetBasket();!t||(t.Luggage={HoldBags:[],SportsEquipment:[]},n.Events.Fire(n.Events.Names.Funnel.LuggageUpdated),n.Events.Fire(n.Events.Names.Basket.HeightModified))},t.prototype.RemoveHotelFromClientBasket=function(){var n=this._funnelBasketService.GetBasket();n&&(n.Hotel=null)},t.prototype.RemoveAllSeatsFromClientBasket=function(){var t=this._funnelBasketService.GetBasket(),n;return!t?!1:(n=!1,t.Associations.forEach(function(t){t.Seat!==null&&(n=!0,t.Seat=null)}),n)},t.prototype.RemoveAllVouchersFromClientBasket=function(){var n=this,t=this._funnelBasketService.GetFlights();t.forEach(function(t){n.RemoveVouchersFromAllPassengers(t.InternalId)})},t.prototype.RemoveVouchersFromAllPassengers=function(n){var t=this._funnelBasketService.GetBasket().Associations.filter(function(t){return t.FlightInternalId===n});t.forEach(function(n){n.Vouchers!=null&&(n.Vouchers.Quantity=0)})},t.prototype.RemoveTravelInsuranceFromClientBasket=function(){var n=this._funnelBasketService.GetBasket();!n||(n.TravelInsurance=null)},t.ServiceName="Funnel_BasketExtrasRemovalService",t.$inject=["Funnel_BasketService"],t}();t.FunnelBasketExtrasRemovalService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._allowIcons=!0;this._allowDeleteFlights=!1;this._allowDeleteSeats=!1;this._allowDeleteLuggage=!1;this._allowDeleteHotels=!1;this._allowDeleteCars=!1;this._allowDeleteTravelInsurance=!1;this._allowDeleteVouchers=!1;this._funnelBasketService=n;this._funnelActivePairService=t}return n.prototype.HideAllIcons=function(){this._allowIcons=!1},n.prototype.AllowDeleteFlights=function(){this._allowDeleteFlights=!0},n.prototype.AllowDeleteSeats=function(){this._allowDeleteSeats=!0},n.prototype.AllowDeleteLuggage=function(){this._allowDeleteLuggage=!0},n.prototype.AllowDeleteHotels=function(){this._allowDeleteHotels=!0},n.prototype.AllowDeleteCars=function(){this._allowDeleteCars=!0},n.prototype.AllowDeleteTravelInsurance=function(){this._allowDeleteTravelInsurance=!0},n.prototype.AllowDeleteVouchers=function(){this._allowDeleteVouchers=!0},n.prototype.CanDeleteFlights=function(){return this._allowDeleteFlights},n.prototype.GetQueries=function(){return{ShowFlightEditIcon:this.ShowFlightEditIcon.bind(this),ShowFlightDeleteIcon:this.ShowFlightDeleteIcon.bind(this),ShowSeatEditIcon:this.ShowSeatEditIcon.bind(this),ShowLuggageEditIcon:this.ShowLuggageEditIcon.bind(this),ShowHotelEditIcon:this.ShowHotelEditIcon.bind(this),ShowHotelDeleteIcon:this.ShowHotelDeleteIcon.bind(this),ShowCarEditIcon:this.ShowCarEditIcon.bind(this),ShowCarDeleteIcon:this.ShowCarDeleteIcon.bind(this),ShowTravelInsuranceDeleteIcon:this.ShowTravelInsuranceDeleteIcon.bind(this),ShowTravelInsuranceEditIcon:this.ShowTravelInsuranceEditIcon.bind(this),ShowVouchersEditIcon:this.ShowVouchersEditIcon.bind(this),ShowVouchersDeleteIcon:this.ShowVouchersDeleteIcon.bind(this)}},n.prototype.ShowFlightDeleteIcon=function(n){return this._allowDeleteFlights&&this._allowIcons?this._funnelActivePairService.GetActiveJourneyPair().Id===n:!1},n.prototype.ShowFlightEditIcon=function(n){if(this._allowIcons)if(this._allowDeleteFlights){var t=this._funnelActivePairService.GetActiveJourneyPair().Id===n,i=this._funnelBasketService.GetPrimaryJourneyPair(),r=i.Id===n;if(r&&!t||this.PrimaryPairIsComplete(i)&&!t)return!0}else return!0;return!1},n.prototype.PrimaryPairIsComplete=function(n){var t=!!n.ReturnSlot;return t?this._funnelBasketService.JourneyPairHasOutboundFlightSelected(n)&&this._funnelBasketService.JourneyPairHasReturnFlightSelected(n):this._funnelBasketService.JourneyPairHasOutboundFlightSelected(n)},n.prototype.ShowTravelInsuranceEditIcon=function(){return this._allowIcons&&!this._allowDeleteTravelInsurance},n.prototype.ShowTravelInsuranceDeleteIcon=function(){return this._allowIcons&&this._allowDeleteTravelInsurance},n.prototype.ShowVouchersEditIcon=function(){return this._allowIcons&&!this._allowDeleteVouchers},n.prototype.ShowVouchersDeleteIcon=function(){return this._allowIcons&&this._allowDeleteVouchers},n.prototype.ShowSeatEditIcon=function(){return this._allowIcons&&!this._allowDeleteSeats},n.prototype.ShowLuggageEditIcon=function(){return this._allowIcons&&!this._allowDeleteLuggage},n.prototype.ShowHotelEditIcon=function(){return this._allowIcons&&!this._allowDeleteHotels},n.prototype.ShowHotelDeleteIcon=function(){return this._allowIcons&&this._allowDeleteHotels},n.prototype.ShowCarEditIcon=function(){return this._allowIcons&&!this._allowDeleteCars},n.prototype.ShowCarDeleteIcon=function(){return this._allowIcons&&this._allowDeleteCars},n.ServiceName="Funnel_BasketIconService",n.$inject=["Funnel_BasketService","Funnel_ActivePairService"],n}();n.FunnelBasketIconService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function i(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){this._qService=t;this._funnelBasketService=i;this._luggageLimitsService=r;this._funnelApi=u;this._luggageRulesService=f;this._priceService=e;this._errorService=o;this._funnelLuggageDataMapper=s;this._funnelLuggageRepricingService=h;this._funnelPriceService=c;this._commonPriceService=l;this._dataMapper=a;this._funnelBasketUpdateService=v;this._funnelBasketExtrasRemovalService=y}return i.prototype.AddBagToServerBasket=function(n){var i=this,t=this._qService.defer(),r=this.GetLuggageAddRequest(n,null);return this._funnelApi.AddLuggage(r,function(n){var r=i._dataMapper.CreateClientBasket(n);t.resolve(r)},this.DeferredBasketResponseError(t)),t.promise},i.prototype.RemoveBagFromServerBasket=function(n){var i=this,t=this._qService.defer(),r=this.GetRemoveLuggageRequest(n);return this._funnelApi.RemoveLuggage(r,function(n){var r=i._dataMapper.CreateClientBasket(n);t.resolve(r)},this.DeferredBasketResponseError(t)),t.promise},i.prototype.AddSportsEquipmentToServerBasket=function(n){var i=this,t=this._qService.defer(),r=this.GetLuggageAddRequest(null,n);return this._funnelApi.AddLuggage(r,function(n){var r=i._dataMapper.CreateClientBasket(n);t.resolve(r)},this.DeferredBasketResponseError(t)),t.promise},i.prototype.RemoveSportsEquipmentFromServerBasket=function(n){var i=this,t=this._qService.defer(),u=this.GetClientBasketSportsEquipment(),r=this.GetRemoveLuggageRequest(null,n);return this._funnelApi.RemoveLuggage(r,function(n){var r=i._dataMapper.CreateClientBasket(n);t.resolve(r)},this.DeferredBasketResponseError(t)),t.promise},i.prototype.DeferredBasketResponseError=function(n){var t=this;return function(i,r,u){t._errorService.HandleApiError(i,r,u);n.reject()}},i.prototype.GetRemoveLuggageRequest=function(n,t){var i={Bag:null,SportsEquipment:null},r,u;return!n||(r=this._funnelLuggageDataMapper.ToApiHoldBagModel(n,n.PassengerInternalId),i.Bag=r),!t||(u=this._funnelLuggageDataMapper.ToApiSportsEquipmentModel(t,t.PassengerInternalId),i.SportsEquipment=u),i},i.prototype.GetLuggageAddRequest=function(n,t){var e=this,r={Bag:null,SportsEquipment:null},f;if(!!n){var o=this.GetClientBasketBags(),s=this.MapFunnelBagToHoldBagModel(o),u=this.FindValidPassengerIdForBag(this.PassengerIds(),s,n);u&&(f=this._funnelLuggageDataMapper.ToApiHoldBagModel(n,u),r.Bag=f)}if(!!t){var h=this.GetClientBasketSportsEquipment(),c=this.MapFunnelSportsEquipmentToSportsEquipmentModel(h),i=null;_(this.PassengerIds()).forEach(function(n){i||(i=e.TryAssignSportsEquipmentToPassenger(n,t,c),!i||(r.SportsEquipment=i))})}return r},i.prototype.UpdateLuggageOnServer=function(n,t){var r=this,i=this._qService.defer();return this.GetLuggageUpdateRequestFromModels(n,t).then(function(n){r._funnelApi.UpdateLuggage(n,function(){return i.resolve()},r.DeferredError(i))}),i.promise},i.prototype.GetLuggageUpdateRequest=function(){var n=this.GetClientBasketBags(),t=this.GetClientBasketSportsEquipment();return this.GetLuggageUpdateRequestFromModels(n,t)},i.prototype.GetLuggageUpdateRequestFromModels=function(n,t){var i=this,r;return n.length==0&&t.length==0?(r={Bags:[],SportsEquipment:[]},this._qService.now(r)):this._luggageLimitsService.Initialize().then(function(){return{Bags:i.MapFunnelBagToHoldBagModel(n),SportsEquipment:i.MapFunnelSportsEquipmentToSportsEquipmentModel(t)}})},i.prototype.UpdateClientBasketFromServer=function(t){var i=this._funnelBasketService.GetBasket();i.Luggage=t;n.Events.Fire(n.Events.Names.Funnel.LuggageUpdated);n.Events.Fire(n.Events.Names.Basket.HeightModified)},i.prototype.UpdateClientBasket=function(t,i){var r=this._funnelBasketService.GetBasket();r.Luggage=this._funnelLuggageDataMapper.ToClientBasketLuggage(t,i);n.Events.Fire(n.Events.Names.Funnel.LuggageUpdated);n.Events.Fire(n.Events.Names.Basket.HeightModified)},i.prototype.ResetLuggageToDefaults=function(t){var r=this,i;return(t===void 0&&(t=!1),this._funnelBasketService.GetFareType()===n.Data.Common.FlightFareType.Flexi)?(i=this._qService.defer(),this.CreateFreeFlexiFareBags().then(function(n){r.UpdateClientBasket(n,[]);t?r.UpdateLuggageOnServer(n,[]).then(function(){i.resolve()}):i.resolve()}),i.promise):this.ClientHasAnyLuggage()?(this._funnelBasketExtrasRemovalService.RemoveAllLuggageFromClientBasket(),this._qService.now()):void 0},i.prototype.ClientHasAnyLuggage=function(){return this.GetClientBasketBags().length>0||this.GetClientBasketSportsEquipment().length>0},i.prototype.ClientHasPaidLuggage=function(){return this.GetClientBasketBags().some(function(n){return!n.IsFlexiFareBag})||this.GetClientBasketSportsEquipment().length>0},i.prototype.GetNumberOfFreeBagsRequired=function(){if(this._funnelBasketService.HasAnyFlights()){var n=this._funnelBasketService.GetPassengerComposition();return n.Adults+n.Children}return 0},i.prototype.CreateFreeFlexiFareBags=function(){var t=this,i=this.GetNumberOfFreeBagsRequired();return this._luggageRulesService.GetLuggageRules().then(function(r){for(var u=[],f=t._priceService.NewPrice(0,0),e=0;e<i;e++)u.push({AverageFlightPrice:f,Price:f,Weight:r.LuggageRules.Bags.DefaultWeightPerBag,ExcessWeightSteps:0,IsFlexiFareBag:!0,Type:n.Data.Funnel.BagType.StandardHoldBag});return u})},i.prototype.DeferredError=function(n){var t=this;return function(i,r,u){t._errorService.HandleApiError(i,r,u);n.reject()}},i.prototype.GetClientBasketBags=function(){var n=this._funnelBasketService.GetBasket();if(!(n.Luggage&&n.Luggage.HoldBags))return[];var i=this._funnelBasketService.GetFlights().length,t=this._funnelLuggageDataMapper.MapBasketHoldBagsToFunnelBags(n.Luggage.HoldBags,i),r=_(t).chain().filter(function(n){return n.IsFlexiFareBag}).sortBy(function(n){return n.PassengerInternalId}).value(),u=_(t).filter(function(n){return!n.IsFlexiFareBag});return r.concat(u)},i.prototype.GetClientBasketSportsEquipment=function(){if(!(this._funnelBasketService.GetBasket().Luggage&&this._funnelBasketService.GetBasket().Luggage.SportsEquipment))return[];var n=this._funnelBasketService.GetFlights().length;return this._funnelLuggageDataMapper.MapSportEquipmentToFunnelSportsEquipment(this._funnelBasketService.GetBasket().Luggage.SportsEquipment,n)},i.prototype.MapFunnelBagToHoldBagModel=function(n){var t=this,i=[],r=_(n).sortBy(function(n){return n.IsFlexiFareBag?0:1});return r.forEach(function(n){var r=n.PassengerInternalId||t.FindValidPassengerIdForBag(t.PassengerIds(),i,n);r&&i.push(t._funnelLuggageDataMapper.ToApiHoldBagModel(n,r))}),i},i.prototype.FindValidPassengerIdForBag=function(n,t,i){for(var u,e=function(r){var u=n[r],e=t.filter(function(n){return n.PassengerInternalId===u}),o=f.GetBagLimitForPassenger(u),s=f.GetFlexiFareBagLimitForPassenger(u);if(e.length<o&&(!i.IsFlexiFareBag||e.filter(function(n){return n.IsFlexiFareBag}).length<s))return{value:u}},f=this,r=0;r<n.length;r++)if(u=e(r),typeof u=="object")return u.value;return null},i.prototype.MapFunnelSportsEquipmentToSportsEquipmentModel=function(n){var t=[];return this.AssignSportsEquipmentToPassengers(n,t),t},i.prototype.AssignSportsEquipmentToPassengers=function(n,t){var i=this;_(this.PassengerIds()).forEach(function(r){for(var u=0,e=i.GetSportsEquipmentLimitForPassenger(r),f;i.PassengerCanHaveMoreItems(t.length,n.length,u,e);)f=n[t.length],t.push(i._funnelLuggageDataMapper.ToApiSportsEquipmentModel(f,r)),u++})},i.prototype.TryAssignSportsEquipmentToPassenger=function(n,t,i){var r=i.filter(function(t){return t.PassengerInternalId===n}).length||0,u=this.GetSportsEquipmentLimitForPassenger(n);return this.PassengerCanHaveMoreItems(i.length,i.length+1,r,u)?this._funnelLuggageDataMapper.ToApiSportsEquipmentModel(t,n):null},i.prototype.PassengerCanHaveMoreItems=function(n,t,i,r){return n<t&&i<r},i.prototype.PassengerIds=function(){return this._funnelBasketService.GetBasket().Passengers.map(function(n){return n.InternalId})},i.prototype.AdultPassengerIds=function(){return _(this._funnelBasketService.GetBasket().Passengers).select(function(t){return t.Type===n.Data.Common.PassengerDataType.Adult}).map(function(n){return n.InternalId})},i.prototype.ChildPassengerIds=function(){return _(this._funnelBasketService.GetBasket().Passengers).select(function(t){return t.Type===n.Data.Common.PassengerDataType.Child}).map(function(n){return n.InternalId})},i.prototype.InfantPassengerIds=function(){return _(this._funnelBasketService.GetBasket().CarriedInfants).map(function(n){return n.InternalId})},i.prototype.GetSportsEquipmentLimitForPassenger=function(n){var i=this.GetBasketPassengerById(n),t;return i?(t=this._luggageLimitsService.GetSportsEquipmentAllowedForPassenger(i.Type),this.PassengerIsCarryingInfant(n)&&(t+=this._luggageLimitsService.GetSportsEquipmentAllowedForInfant()),t):0},i.prototype.GetBagLimitForPassenger=function(n){var i=this.GetBasketPassengerById(n),t;return i?(t=this._luggageLimitsService.GetBagsAllowedForPassenger(i.Type),this.PassengerIsCarryingInfant(n)&&(t+=this._luggageLimitsService.GetBagsAllowedForInfant()),t):0},i.prototype.GetFlexiFareBagLimitForPassenger=function(i){var u=this.GetBasketPassengerById(i),r;return u?(r=u.Type===n.Data.Common.PassengerDataType.Adult?t.Luggage.LuggageLimitsService.FlexiFareBagsLimitPerAdult:t.Luggage.LuggageLimitsService.FlexiFareBagsLimitPerChild,this.PassengerIsCarryingInfant(i)&&(r+=t.Luggage.LuggageLimitsService.FlexiFareBagsLimitPerInfant),r):0},i.prototype.PassengerIsCarryingInfant=function(n){var t=_(this._funnelBasketService.GetBasket().Associations).select(function(t){return t.PassengerInternalId===n});return t&&t.length>0?!!t[0].CarriedInfantId:!1},i.prototype.GetBasketPassengerById=function(n){var t=_(this._funnelBasketService.GetBasket().Passengers).select(function(t){return t.InternalId===n});return t&&t.length>0?t[0]:null},i.prototype.RepriceLuggageOnClient=function(){var n=this;return this.ClientHasPaidLuggage()?this._funnelLuggageRepricingService.GetFlightChargesFromServerForBasketFlights().then(function(t){n._funnelBasketUpdateService.SetBasketFlightItemCharges(t);var r=n.GetClientBasketBags(),u=n.GetClientBasketSportsEquipment(),i=n._qService.defer(),f=n._funnelPriceService.GetPriceOfAllLuggage();return n._funnelLuggageRepricingService.GetRepricedLuggage(r,u).then(function(t){n.UpdateClientBasket(t.Bags,t.SportsEquipment);n.TriggerPriceChangeDrawerIfApplicable(f);i.resolve()},n.RepriceLuggageDeferredError(i)),i.promise}):this._qService.now()},i.prototype.TriggerPriceChangeDrawerIfApplicable=function(t){var i=this._funnelPriceService.GetPriceOfAllLuggage(),r,u;this._commonPriceService.Difference(i,t)>0&&(r={OldPrice:t,NewPrice:i},u={SectionKey:"funnel-luggage-price-increase-drawer",Parameters:r},n.Events.QueueDrawerWithOptions(u))},i.prototype.RepriceLuggageDeferredError=function(n){var t=this;return function(){t._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.RepricingLuggage);n.reject()}},i.ServiceName="Funnel_BasketLuggageService",i.$inject=["$rootScope","$q","Funnel_BasketService","Funnel_LuggageLimitsService","Funnel_Api","Funnel_LuggageRulesService","Common_PriceService","Error_Service","Funnel_LuggageDataMapper","Funnel_LuggageRepricingService","Funnel_PriceService","Common_PriceService","Funnel_FunnelDataMapper","Funnel_BasketUpdateService","Funnel_BasketExtrasRemovalService"],i}();t.FunnelBasketLuggageService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f,e){this._rootScope=n;this._rootSettings=t;this._funnelJourneyCookieService=r;this._priceService=u;this._accessibilityService=f;this._ruleBasedContentService=e;this._routesService=new Main3.Routes.RoutesService(i);this.InitialisePassengerComposition()}return t.prototype.InitialisePassengerComposition=function(){this._passengerComposition={Adults:0,Children:0,Infants:0}},t.prototype.GetBasket=function(){return this._clientBasket},t.prototype.ServerBasketExists=function(){return!!this._funnelJourneyCookieService.ReadCookie().HasServerBasket},t.prototype.SetServerBasketExists=function(){this._funnelJourneyCookieService.UpdateCookie(function(n){return n.HasServerBasket=!0})},t.prototype.SetServerBasketRemoved=function(){this._funnelJourneyCookieService.UpdateCookie(function(n){return n.HasServerBasket=!1})},t.prototype.UpdateClientBasketFromServer=function(t){this._clientBasket.BookerDetails=t.BookerDetails;this._clientBasket.Passengers=t.Passengers;this._clientBasket.CarriedInfants=t.CarriedInfants;this._clientBasket.TravelInsurance=t.TravelInsurance;!t.FixedCharges||!t.FixedCharges.AdminFee||(this._clientBasket.FixedCharges=t.FixedCharges);n.Events.Fire(n.Events.Names.Funnel.ServerBasketCreated)},t.prototype.SetClientBasket=function(n){this._clientBasket=n;this.UpdateBookingPassengersFromClientBasket();this.SetPaymentTypeFromJourneyCookie();!this._rootScope||this._rootScope.$watch(this.BuildBasketRuleBasedContentKey.bind(this),this.PublishUpdateForRuleBasedContent.bind(this))},t.prototype.SetPaymentTypeFromJourneyCookie=function(){var n=this._funnelJourneyCookieService.ReadCookie();this._priceService.SetPaymentType(n.PaymentType)},t.prototype.UpdateBookingPassengersFromClientBasket=function(){this._bookingPassengers=Main3.Common.BookingPassengers.CreateFromBasket(this._clientBasket)},t.prototype.BuildBasketRuleBasedContentKey=function(){return JSON.stringify(this.BuildBookingRulesArgsFromBasket())},t.prototype.PublishUpdateForRuleBasedContent=function(){var n=this;!this._ruleBasedContentService||this._ruleBasedContentService.PublishUpdate(function(){return n.BuildBookingRulesArgsFromBasket()})},t.prototype.BuildBookingRulesArgsFromBasket=function(){var i={},r,u,t;for(i.IsWorldwideRoute=!1,i.RoutePairs=[],i.NumberOfPassengers=this.GetPassengerComposition(),i.FlightFareType=this._clientBasket.FareType,r=0,u=this.GetJourneyPairs();r<u.length;r++)t=u[r],!t.OutboundSlot||!t.OutboundSlot.Flight||i.RoutePairs.push({From:t.OutboundSlot.Flight.DepartureIata,To:t.OutboundSlot.Flight.ArrivalIata,LocalDepartureTime:t.OutboundSlot.Flight.LocalDepartureTime,Direction:n.Data.Common.RouteDirection.Outbound}),!t.ReturnSlot||!t.ReturnSlot.Flight||i.RoutePairs.push({From:t.ReturnSlot.Flight.DepartureIata,To:t.ReturnSlot.Flight.ArrivalIata,LocalDepartureTime:t.ReturnSlot.Flight.LocalDepartureTime,Direction:n.Data.Common.RouteDirection.Return});return i},t.prototype.GetPassengerComposition=function(){return this.EnsurePassengerCompositionFromBookingPassengers(),this._passengerComposition},t.prototype.EnsurePassengerCompositionFromBookingPassengers=function(){if(!!this._bookingPassengers){var n=this._bookingPassengers.PassengerComposition();this._passengerComposition.Adults=n.Adults;this._passengerComposition.Children=n.Children;this._passengerComposition.Infants=n.Infants}},t.prototype.AllPairsHaveFlightsSelected=function(){var n,t,i;if(this.HasBasket()){for(n=0,t=this.GetJourneyPairs();n<t.length;n++)if(i=t[n],!this.JourneyPairHasFlightsSelected(i))return!1;return!0}return!1},t.prototype.JourneyPairHasFlightsSelected=function(n){return!!n.OutboundSlot.Flight&&(!n.ReturnSlot||!!n.ReturnSlot.Flight)},t.prototype.FlightSlotsInBasket=function(){var n=0;return this.HasBasket()&&this.GetJourneyPairs().forEach(function(t){t.OutboundSlot&&n++;t.ReturnSlot&&n++}),n},t.prototype.GetFixedCharges=function(){return this.HasBasket()?this._clientBasket.FixedCharges:null},t.prototype.HasBasket=function(){return!!this._clientBasket},t.prototype.GetFlights=function(){return this.GetFlightsForJourneyPairs(this.GetJourneyPairs())},t.prototype.GetFlightsForJourneyPair=function(n){return this.GetFlightsForJourneyPairs([n])},t.prototype.GetFlightsForJourneyPairs=function(n){return _.chain(n).map(function(n){return[n.OutboundSlot,n.ReturnSlot]}).flatten().filter(function(n){return n!=null}).map(function(n){return n.Flight}).filter(function(n){return n!=null}).value()},t.prototype.GetJourneyPairs=function(){return this.HasBasket()?this._clientBasket.JourneyPairs:null},t.prototype.GetAllSlots=function(){return this.HasBasket()?_.chain(this._clientBasket.JourneyPairs).map(function(n){return[n.OutboundSlot,n.ReturnSlot]}).flatten().filter(function(n){return n!=null}).value():[]},t.prototype.GetFirstAdditionalPair=function(){return this.GetJourneyPairs()[1]},t.prototype.HasMultipleJourneyPairs=function(){return this._clientBasket.JourneyPairs.length>1},t.prototype.GetGroupedLuggage=function(){var i=this,n,t;return this._clientBasket&&this._clientBasket.Luggage?(n=_(this._clientBasket.Luggage.HoldBags).chain().groupBy(function(n){return i.BuildBagIdentifier(n)}).map(function(n){return{PassengerInternalId:null,TotalWeight:n[0].TotalWeight,TotalPrice:n[0].TotalPrice,ExcessWeightSteps:n[0].ExcessWeightSteps,Quantity:n.length,IsFlexiFareBag:!1,Type:n[0].Type}}).sortBy(function(n){return n.TotalWeight}).value(),t=_(this._clientBasket.Luggage.SportsEquipment).chain().groupBy(function(n){return n.Type}).map(function(n){return{PassengerInternalId:null,DisplayName:n[0].DisplayName,Quantity:n.length,Type:n[0].Type,Price:n[0].Price,IsLarge:n[0].IsLarge,TotalWeight:n[0].TotalWeight}}).sortBy(function(n){return n.Type}).value(),{HoldBags:n,SportsEquipment:t}):null},t.prototype.BuildBagIdentifier=function(n){return n.TotalWeight+"-"+this._priceService.GetNumericValue(n.TotalPrice)},t.prototype.GetCurrencyCode=function(){return this.HasBasket()?this._clientBasket.Currency:""},t.prototype.GetFareType=function(){return this.HasBasket()?this._clientBasket.FareType:null},t.prototype.BasketContainsAncillary=function(t){if(this.HasBasket()&&t!==n.Data.Funnel.AncillaryType.None){var i=this.GetBasket();if(t===n.Data.Funnel.AncillaryType.Car)return!!i.Car;if(t===n.Data.Funnel.AncillaryType.Hotel)return!!i.Hotel;if(t===n.Data.Funnel.AncillaryType.Insurance)return!!i.TravelInsurance}return!1},t.prototype.BasketContainsExtras=function(){if(this._clientBasket){var n=_(this._clientBasket.Associations).any(function(n){return!!n.Seat});return n||this.BasketContainsLuggage()||!!this._clientBasket.Hotel||!!this._clientBasket.Car}return!1},t.prototype.BasketContainsLuggage=function(){return this._clientBasket&&this._clientBasket.Luggage?this._clientBasket.Luggage.SportsEquipment.length>0||this._clientBasket.Luggage.HoldBags.length>0:!1},t.prototype.BasketContainsHoldBags=function(){return this._clientBasket&&this._clientBasket.Luggage?this._clientBasket.Luggage.HoldBags.length>0:!1},t.prototype.FlightIsOnLegRoute=function(n,t,i){return this._routesService.IsIataInMarketGroup(n.DepartureIata,t)&&this._routesService.IsIataInMarketGroup(n.ArrivalIata,i)},t.prototype.GetEResLanguageCode=function(){return this._rootSettings.EResLanguageCode},t.prototype.GetBasketAsDeepLink=function(t){var i=this.GetPrimaryJourneyPair(),u=this.GetPassengerComposition(),r={BaseUrl:t.BaseUrl,Language:this._rootSettings.EResLanguageCode,Currency:this._clientBasket.Currency,OriginIata:i.OutboundSlot.Route.OriginIata,DestinationIata:i.OutboundSlot.Route.DestinationIata,DepartureDate:i.OutboundSlot.Route.Date,Adults:u.Adults,Children:u.Children,Infants:u.Infants,FlexiFare:this._clientBasket.FareType===n.Data.Common.FlightFareType.Flexi,ComponentSender:t.ComponentSender,RemainOnStep1:t.RemainOnStep1,PaymentType:t.PaymentType};return t.ExcludeFlightNumbers||!i.OutboundSlot.Flight||(r.DepartureFlightNumber=i.OutboundSlot.Flight.FlightNumber.toString()),!i.ReturnSlot||(r.ReturnDate=i.ReturnSlot.Route.Date,t.ExcludeFlightNumbers||!i.ReturnSlot.Flight||(r.ReturnFlightNumber=i.ReturnSlot.Flight.FlightNumber.toString())),r},t.prototype.JourneyPairHasOutboundFlightSelected=function(n){return!!n&&!!n.OutboundSlot&&!!n.OutboundSlot.Flight},t.prototype.JourneyPairHasReturnSlot=function(n){return!!n&&!!n.ReturnSlot},t.prototype.JourneyPairHasReturnFlightSelected=function(n){return this.JourneyPairHasReturnSlot(n)&&!!n.ReturnSlot.Flight},t.prototype.HasAnyFlights=function(){return this.GetFlights().length>0},t.prototype.JourneyPairHasAnyFlightsSelected=function(n){return!n?!1:this.JourneyPairHasOutboundFlightSelected(n)||this.JourneyPairHasReturnFlightSelected(n)},t.prototype.PrimaryJourneyPairHasAnyFlightsSelected=function(){if(this.HasBasket()){var n=this.GetPrimaryJourneyPair();return this.JourneyPairHasAnyFlightsSelected(n)}return!1},t.prototype.GetPrimaryJourneyPair=function(){var t=this.GetJourneyPairs(),n;return t?(n=this.GetJourneyPairs().filter(function(n){return n.IsPrimaryPair}),!n?null:n[0]):null},t.prototype.HasAnySeatsAssigned=function(){return this.HasBasket()&&this._clientBasket.Associations.some(function(n){return!!n.Seat})},t.prototype.AnyFlightsHaveHigherAdultPriceThanChildPrice=function(){var n=this;return this.GetFlights().some(function(t){var i=t.FlightFares[n.GetFareType()].Prices;return!!i.Child&&n._priceService.Compare(i.Adult,i.Child)>0})},t.prototype.GetFirstIncompleteJourneyPairId=function(){var t=null,n;return this.HasBasket()&&(n=this._clientBasket.JourneyPairs.filter(function(n){return n.OutboundSlot.Route&&!n.OutboundSlot.Flight||n.ReturnSlot&&n.ReturnSlot.Route&&!n.ReturnSlot.Flight}),n.length>0&&(t=n[0].Id)),t},t.prototype.GetJourneyPairsWithFlights=function(){var t=this,n=[];return this.GetJourneyPairs().forEach(function(i){t.GetFlightsForJourneyPair(i).length>0&&n.push(i)}),n},t.prototype.GetPrimaryPairOutboundDepartureCountryCode=function(){var n=this.GetPrimaryJourneyPair(),t;return n&&n.OutboundSlot&&n.OutboundSlot.Flight?(t=n.OutboundSlot.Flight.DepartureIata,this._routesService.FindCountryByIata(t).Code):null},t.prototype.GetPrimaryPairOutboundDestinationCountryCode=function(){var n=this.GetPrimaryJourneyPair(),t;return n&&n.OutboundSlot&&n.OutboundSlot.Flight?(t=n.OutboundSlot.Flight.ArrivalIata,this._routesService.FindCountryByIata(t).Code):null},t.ServiceName="Funnel_BasketService",t.$inject=["$rootScope","Sitecore_FunnelRootSettings","Sitecore_RoutesData","FunnelJourneyCookie_Service","Common_PriceService","Funnel_AccessibilityService","Common_RuleBasedContentService"],t}();t.FunnelBasketService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._funnelBasketExtrasRemovalService=n;this._funnelJourneyCookieService=t;this._funnelBasketService=i;this._routesService=new Main3.Routes.RoutesService(r)}return t.prototype.ResetPassengerCompositionInClientBasket=function(n,t,i,r){var u=this._funnelBasketService.GetBasket(),f;!u||(f=this.CreateJourneyPair(n,r,!0),this.ResetClientBasket(f),u.Passengers=t,u.CarriedInfants=i,this._funnelBasketService.UpdateBookingPassengersFromClientBasket())},t.prototype.ResetClientBasket=function(t){this.RemoveAllFlightsFromClientBasket();this.RemoveAllFlightAssociationsFromClientBasket();this._funnelBasketExtrasRemovalService.RemoveExtrasFromClientBasket();this.SetClientBasketInitialJourneyPair(t);n.Events.Fire(n.Events.Names.Funnel.ActiveJourneyPairChanged)},t.prototype.SetClientBasketInitialJourneyPair=function(n){var t=this._funnelBasketService.GetBasket();!t||(t.JourneyPairs=[n])},t.prototype.ReplaceClientBasketJourneyPair=function(n,t){var r=this._funnelBasketService.GetBasket(),i;!r||(i=[],r.JourneyPairs.forEach(function(r){r.Id===t?i.push(n):i.push(r)}),r.JourneyPairs=i)},t.prototype.CreateJourneyPair=function(n,t,i){return{Id:t,IsPrimaryPair:i,BaseCurrency:null,OutboundSlot:this.CreateJourneySlot(!1,n),ReturnSlot:this.CreateJourneySlot(!0,n)}},t.prototype.CreateJourneySlot=function(n,t){if(!t.ReturnDate&&n)return null;var i={Date:n?t.ReturnDate:t.OutboundDate,OriginIata:n?t.DestinationIata:t.OriginIata,DestinationIata:n?t.OriginIata:t.DestinationIata};return{Flight:null,Route:i}},t.prototype.RemoveAllJourneyPairs=function(){var n=this._funnelBasketService.GetBasket();!n||(n.JourneyPairs=[])},t.prototype.RemoveAllFlightAssociationsFromClientBasket=function(){var n=this._funnelBasketService.GetBasket();!n||(n.Associations=[])},t.prototype.RemoveAllFlightsFromClientBasket=function(){var n=this,t=this._funnelBasketService.GetJourneyPairs();t.forEach(function(t){!t.OutboundSlot||!t.OutboundSlot.Flight||n.RemoveFlightFromSlot(t.OutboundSlot);!t.ReturnSlot||!t.ReturnSlot.Flight||n.RemoveFlightFromSlot(t.ReturnSlot)})},t.prototype.RemoveJourneyPair=function(n){var t=this._funnelBasketService.GetBasket();!t||(t.JourneyPairs=t.JourneyPairs.filter(function(t){return t.Id!==n}))},t.prototype.RemoveFlight=function(n){var t=this,r=this._funnelBasketService.GetBasket(),i;n&&!!r&&(i=this._funnelBasketService.GetJourneyPairs(),i.forEach(function(i){!i.OutboundSlot||!i.OutboundSlot.Flight||i.OutboundSlot.Flight.SegmentId!==n.SegmentId||t.RemoveFlightFromSlot(i.OutboundSlot);!i.ReturnSlot||!i.ReturnSlot.Flight||i.ReturnSlot.Flight.SegmentId!==n.SegmentId||t.RemoveFlightFromSlot(i.ReturnSlot)}))},t.prototype.RemoveFlightFromSlot=function(n){!n||!n.Flight||(this.RemoveFlightAssociations(n.Flight.InternalId),n.Flight=null)},t.prototype.RemoveFlightAssociations=function(n){var t=this._funnelBasketService.GetBasket();!!t&&t.Associations&&(t.Associations=t.Associations.filter(function(t){return t.FlightInternalId!==n}))},t.prototype.SetPairFlight=function(t,i,r,u,f){var e=i===n.Data.Common.RouteDirection.Outbound,l=e?t.OutboundSlot:t.ReturnSlot,s=e?t.ReturnSlot:t.OutboundSlot,h=e?u:f,c=e?f:u,o;this.RemoveFlightFromSlot(l);o={Flight:r,Route:{Date:r.LocalDepartureTime.Date(),OriginIata:h,DestinationIata:c}};e?t.OutboundSlot=o:t.ReturnSlot=o;!s||this.EnsureFlightOnRoute(s,c,h)},t.prototype.EnsureFlightOnRoute=function(n,t,i){!n||!n.Flight||this._routesService.IsIataInMarketGroup(n.Flight.DepartureIata,t)&&this._routesService.IsIataInMarketGroup(n.Flight.ArrivalIata,i)||this.RemoveFlightFromSlot(n)},t.prototype.SetFareType=function(n){var t=this._funnelBasketService.GetBasket();!t||(t.FareType=n)},t.prototype.RemoveIncompletePairs=function(){var r=this._funnelBasketService.GetBasket(),n,t,i;if(!!r)for(n=0,t=this._funnelBasketService.GetJourneyPairs();n<t.length;n++)i=t[n],this._funnelBasketService.JourneyPairHasFlightsSelected(i)||this.RemoveJourneyPair(i.Id)},t.prototype.SetReasonForTravelCode=function(n){var t=this._funnelBasketService.GetBasket();!t||(t.ReasonForTravelCode=n)},t.prototype.UpdatePassengerCompositionInJourneyCookie=function(){var n=this._funnelBasketService.GetPassengerComposition();this._funnelJourneyCookieService.UpdateCookie(function(t){t.NumberOfAdults=n.Adults;t.NumberOfChildren=n.Children;t.NumberOfInfants=n.Infants})},t.prototype.UpdateCurrency=function(n,t){t===void 0&&(t=null);var i=this._funnelBasketService.GetBasket();!i||(i.Currency=n,t!=null&&(i.FixedCharges=t))},t.prototype.UpdateJourneyPairFlights=function(n,t){for(var f,e=function(n){!!n&&n.Flight&&(i=t.filter(function(t){return t.DepartureIata===n.Flight.DepartureIata}),i.length>0&&o.UpdateFlightPriceBySlot(n,i[0]))},o=this,i,r=0,u=[n.OutboundSlot,n.ReturnSlot];r<u.length;r++)f=u[r],e(f)},t.prototype.UpdateFlightPriceBySlot=function(t,i){var r=this;i&&t.Flight&&n.Data.Common.FlightFareType.GetValues().forEach(function(n){var f=r.GetFareFromBasketFlight(t.Flight,n),u=r.GetFareFromFlight(i,n);!f&&u?t.Flight.FlightFares.push(r.MapFareToBasketFare(u)):f&&u&&(f.Prices=u.Prices,f.FlightIdentification=u.FlightIdentification);t.Flight.FlightTaxes=i.FlightTaxes})},t.prototype.GetFareFromBasketFlight=function(n,t){return n&&n.FlightFares?n.FlightFares.filter(function(n){return n.FareType===t})[0]:null},t.prototype.GetFareFromFlight=function(n,t){return n&&n.FlightFares?n.FlightFares.filter(function(n){return n.FareType===t})[0]:null},t.prototype.MapFareToBasketFare=function(n){return{FareType:n.FareType,Prices:n.Prices,FlightIdentification:n.FlightIdentification}},t.prototype.UpdateFlightPriceBySegmentId=function(n,t,i){var r=this;_(this._funnelBasketService.GetFlights()).select(function(t){return t.SegmentId===n}).forEach(function(n){_(n.FlightFares).select(function(n){return n.FareType===r._funnelBasketService.GetFareType()}).forEach(function(n){t&&(n.Prices.Adult=t);i&&(n.Prices.Child=i)})})},t.prototype.CreateNewJourneyPair=function(n,t){var r=this._funnelBasketService.GetBasket(),i;return!r?null:(i={Id:this.CreateNewJourneyPairId(),IsPrimaryPair:!1,OutboundSlot:this.CreateEmptyJourneySlot(n),ReturnSlot:this.CreateEmptyJourneySlot(t),BaseCurrency:null},r.JourneyPairs.push(i),i.Id)},t.prototype.CreateNewJourneyPairId=function(){return this._funnelBasketService.GetJourneyPairs().slice(-1)[0].Id+1},t.prototype.CreateEmptyJourneySlot=function(n){return!n?null:{Flight:null,Route:n}},t.prototype.UpdateCarLeadDriverInternalIdInJourneyCookie=function(n){this._funnelJourneyCookieService.UpdateCookie(function(t){t.LeadDriverPassengerInternalId=n})},t.prototype.SetBasketFlightItemCharges=function(n){var t=this._funnelBasketService.GetBasket();!t||(t.FlightItemCharges=n)},t.prototype.SetFirstPairAsPrimaryPair=function(){var t=this._funnelBasketService.GetBasket(),n;!t||(n=this._funnelBasketService.GetJourneyPairs()[0],n.IsPrimaryPair||(n.IsPrimaryPair=!0))},t.ServiceName="Funnel_BasketUpdateService",t.$inject=["Funnel_BasketExtrasRemovalService","FunnelJourneyCookie_Service","Funnel_BasketService","Sitecore_RoutesData"],t}();t.FunnelBasketUpdateService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._qService=n;this._funnelApi=t;this._errorService=i;this._dataMapper=r}return t.prototype.GetBooking=function(n){var t=this;this._booking!==undefined?n(this._booking):this._funnelApi.GetBooking(function(i){t._booking=t._dataMapper.CreateClientBooking(i);n(t._booking)},this.HandleApiError.bind(this))},t.prototype.HandleApiError=function(n,t,i){this._errorService.HandleApiError(n,t,i)},t.prototype.BookingContainsAncillary=function(t){if(!!this._booking&&t!==n.Data.Funnel.AncillaryType.None){if(t===n.Data.Funnel.AncillaryType.Car)return this._booking.Ancillaries.HasCar&&!!this._booking.CarBooking&&!!this._booking.CarBooking.BookingReference;if(t===n.Data.Funnel.AncillaryType.Hotel)return this._booking.Ancillaries.HasHotelBooking&&!!this._booking.HotelBooking&&!!this._booking.HotelBooking.BookingNumber;if(t===n.Data.Funnel.AncillaryType.Insurance)return this._booking.Ancillaries.HasTravelInsurance&&!!this._booking.TravelInsuranceBooking&&!!this._booking.TravelInsuranceBooking.PolicyNumber}return!1},t.prototype.GetSeatNumbersForFlight=function(n){var i=[];return this._booking&&this._booking.Associations.forEach(function(r){r.FlightInternalId===n&&r.Seat&&r.Seat.SeatNumber&&i.push({SeatNumber:r.Seat.SeatNumber,OrderId:t.GetSeatOrderIndex(r.Seat.SeatNumber)})}),i.sort(function(n,t){return n.OrderId<t.OrderId?-1:n.OrderId>t.OrderId?1:0}).map(function(n){return n.SeatNumber})},t.GetSeatOrderIndex=function(n){if(!n||n.length<2)return 0;var t=n.substr(0,n.length-1),i=n.substr(n.length-1,1).charCodeAt(0);return Number(t+"."+i)},t.ServiceName="Funnel_BookingService",t.$inject=["$q","Funnel_Api","Funnel_ErrorService","Funnel_FunnelDataMapper"],t}();t.FunnelBookingService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._funnelJourneySettings=n;this._funnelBasketService=t;this._ancillariesSettings=i}return t.prototype.BuildBypassRules=function(){return{SkipCarsPage:this.SkipCarsPage.bind(this),SkipHotelsPage:this.SkipHotelsPage.bind(this),SkipSeatingPage:this.SkipSeatingPage.bind(this),SkipTravelInsurancePages:this.SkipTravelInsurancePages.bind(this),SkipVouchers:this.SkipVouchers.bind(this),SkipOffersPage:this.SkipOffersPage.bind(this)}},t.prototype.SkipOffersPage=function(){return this.SkipVouchers()&&this.SkipTravelInsurancePages()},t.prototype.SkipVouchers=function(){return this.BookingIsFlexi()||this.ThereAreMorePassengersInBookingThan(this._funnelJourneySettings.VouchersMaximumNumberOfPassengers)||this.BasketCurrencyIsNot(this._funnelJourneySettings.VouchersEnabledForCurrencies)||this.ShouldBypassVouchersDueToRules()},t.prototype.SkipCarsPage=function(){return this.ThereAreNoAdultsInBooking()||this.ThereAreMorePassengersInBookingThan(5)||this.DifferenceBetweenOutboundArrivalDateTimeAndReturnDepartureDateTimeIsMoreThanXDays(28)||this._ancillariesSettings.DisableCarsStep},t.prototype.SkipHotelsPage=function(){return this.ThereAreNoAdultsInBooking()||this.DifferenceBetweenFlightDepartureDatesIsMoreThanXCalendarDays(this._ancillariesSettings.HotelsMaximumNumberOfDaysBetweenFlights)||this.FlightsAreOnTheSameDay()||this._ancillariesSettings.DisableHotelsStep},t.prototype.SkipTravelInsurancePages=function(){var n=this._funnelJourneySettings.TravelInsuranceMaximumDaysBetweenDepartureAndArrival-1;return this._ancillariesSettings.DisableTravelInsuranceSteps||this.IsTravelInsuranceDisabledForPrimaryOutboundFlightsCountry()||this.ThereAreNoAdultsInBooking()||this.BasketCurrencyIsDifferentToDefaultCurrencyForDepartureAirport()||this.BookingContainsAdditionalJourneyPairs()||this.DifferenceBetweenOutboundArrivalDateTimeAndReturnDepartureDateTimeIsMoreThanXDays(n)||this.ThereAreMorePassengersInBookingThan(this._funnelJourneySettings.TravelInsuranceMaximumNumberOfPassengers)},t.prototype.SkipSeatingPage=function(){var n;return n=Main3.Common.BreakPointService.IsMobile()?this._funnelJourneySettings.SeatingMobileMaxPassengers:this._funnelJourneySettings.SeatingDesktopAndTabletMaxPassengers,this.ThereAreMorePassengersInBookingThan(n)},t.prototype.BookingContainsAdditionalJourneyPairs=function(){return this._funnelBasketService.HasMultipleJourneyPairs()},t.prototype.BookingIsFlexi=function(){return this._funnelBasketService.GetFareType()===n.Data.Common.FlightFareType.Flexi},t.prototype.PrimaryPairIsOneWayFlight=function(){var n=this._funnelBasketService.GetPrimaryJourneyPair();return!this._funnelBasketService.JourneyPairHasReturnSlot(n)},t.prototype.BasketCurrencyIsDifferentToDefaultCurrencyForDepartureAirport=function(){var n=this._funnelBasketService.GetPrimaryJourneyPair().BaseCurrency,t=this._funnelBasketService.GetCurrencyCode();return n!==t},t.prototype.BasketCurrencyIsNot=function(n){var t=this._funnelBasketService.GetCurrencyCode(),i=n.filter(function(n){return n===t}).length>0;return!i},t.prototype.ThereAreNoAdultsInBooking=function(){return!this._funnelBasketService.GetPassengerComposition().Adults},t.prototype.ThereAreMorePassengersInBookingThan=function(n){var t=this._funnelBasketService.GetPassengerComposition(),i=t.Adults+t.Children+t.Infants;return i>n},t.prototype.FlightsAreOnTheSameDay=function(){var n=this._funnelBasketService.GetPrimaryJourneyPair(),t=!!n.OutboundSlot,i=!!n.ReturnSlot;return t&&i&&n.OutboundSlot.Flight.LocalDepartureTime.Date().Equals(n.ReturnSlot.Flight.LocalDepartureTime.Date())},t.prototype.DifferenceBetweenOutboundArrivalDateTimeAndReturnDepartureDateTimeIsMoreThanXDays=function(n){return this.DifferenceBetweenFlightsIsMoreThanXDays(n,!1,!0,!1)},t.prototype.DifferenceBetweenFlightDepartureDatesIsMoreThanXCalendarDays=function(n){return this.DifferenceBetweenFlightsIsMoreThanXDays(n,!0,!0,!0)},t.prototype.DifferenceBetweenFlightsIsMoreThanXDays=function(n,t,i,r){var u,f,e;return(t===void 0&&(t=!1),i===void 0&&(i=!1),r===void 0&&(r=!1),u=this._funnelBasketService.GetPrimaryJourneyPair(),!!u.OutboundSlot&&!!u.ReturnSlot)?(f=t?u.OutboundSlot.Flight.LocalDepartureTime:u.OutboundSlot.Flight.LocalArrivalTime,e=i?u.ReturnSlot.Flight.LocalDepartureTime:u.ReturnSlot.Flight.LocalArrivalTime,this.NumberOfDaysDifference(f,e,r)>n):!1},t.prototype.NumberOfDaysDifference=function(n,t,i){return i?this.CalendarDayDifference(n.Date(),t.Date()):this.DateTimeDifference(n,t)},t.prototype.CalendarDayDifference=function(n,t){return t.DifferenceInDays(n)},t.prototype.DateTimeDifference=function(n,t){return t.Difference(n,Utilities.ZonelessDateTimePart.Days)},t.prototype.ShouldBypassVouchersDueToRules=function(){if(!!this._funnelJourneySettings.VoucherBypassRules){var n=this._funnelBasketService.BuildBookingRulesArgsFromBasket(),t=System.Guid.MakeNew(),i={ItemId:t.ToCleanString(),ItemRules:[this._funnelJourneySettings.VoucherBypassRules]},r=Main3.SitecoreRules.Pipeline.PipelineRunner.RunPipeline(i,new Main3.SitecoreRules.Rules.Pipelines.Args.BookingRulePipelineArgs(n));return r.Matched}return!1},t.prototype.IsTravelInsuranceDisabledForPrimaryOutboundFlightsCountry=function(){var n=this._funnelJourneySettings.TravelInsuranceDisabledForCountries;return n.indexOf(this._funnelBasketService.GetPrimaryPairOutboundDepartureCountryCode())>=0},t.ServiceName="Funnel_BypassService",t.$inject=["Sitecore_FunnelJourneySettings","Funnel_BasketService","Ancillaries_Settings"],t}();t.FunnelBypassService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){this._qService=n;this._tracker=t;this._funnelApi=i;this._funnelJourneyCookieService=r;this._funnelBasketService=u;this._priceService=f;this._errorService=e;this._availabilityService=o;this._moneySettings=s;this._rootSettings=h;this._funnelBasketAssociationsService=c;this._funnelBasketLuggageService=l;this._funnelBasketHotelsService=a;this._dataMapper=v;this._travelInsuranceBasketService=y;this._funnelBasketUpdateService=p;this._funnelBasketExtrasRemovalService=w;this._preServerCurrencyUpdateHandlers=[]}return t.prototype.GetCurrency=function(n){n===void 0&&(n=1);var t=this._funnelJourneyCookieService.ReadCookie();return t.CurrencyPriority>=n?t.CurrencyCode:null},t.prototype.GetDefaultCurrencyForRegion=function(){var n=this._moneySettings.Currencies.filter(function(n){return n.IsDefaultForRegion});return n&&n.length>0?n[0].CurrencyCode:this._moneySettings.Currencies[0].CurrencyCode},t.prototype.SetCurrencyPriority=function(n,t){t===void 0&&(t=5);this._funnelJourneyCookieService.UpdateCookie(function(i){i.CurrencyPriority<=t&&(i.CurrencyPriority=n)})},t.prototype.EnsureDisplayCurrencyIsUpToDate=function(){this._funnelJourneyCookieService.HasCookie()&&this._priceService.SetCurrencyCode(this.GetCurrency())},t.prototype.NotifyUserOfAdminFeeChangeDueToPrimaryPairChange=function(){var t=this._funnelBasketService.PrimaryJourneyPairHasAnyFlightsSelected(),u=this.GetCurrency(),f=t?3:2,i=this.UpdateCurrencyToMatchPrimaryPair(f),r;i?this._tracker.TrackEvent(Tracking.EventConstants.Categories.ChooseFlights,Tracking.EventConstants.Actions.AddMore,Tracking.EventConstants.Labels.BaseCurrencySwitched):n.Events.Fire(n.Events.Names.AvailabilityFlightsProvider.ForceBasketRefresh,!0);t&&this._funnelBasketService.GetFareType()===n.Data.Common.FlightFareType.Standard&&(r={AdminFee:this._funnelBasketService.GetFixedCharges().AdminFee,AdminFeeCurrency:u,HasCurrencyChanged:i},n.Events.OpenDrawerWithOptions({SectionKey:"funnel-admin-fee-changed",ShowAfterActionComplete:!0,Parameters:r,OnConfirmCallback:function(){n.Events.Fire(n.Events.Names.Drawer.Close);n.Events.Fire(n.Events.Names.Basket.ResetFocus,!0)}}))},t.prototype.ResetBaseCurrencyCodeForJourneyPair=function(n){var r=this._qService.defer();if(this._funnelBasketService.JourneyPairHasAnyFlightsSelected(n)){var t=this._funnelJourneyCookieService.ReadCookie(),u=n.OutboundSlot.Flight?n.OutboundSlot.Flight.LocalDepartureTime.Date().ToIso8601():null,i=n.ReturnSlot?n.ReturnSlot.Flight?n.ReturnSlot.Flight.LocalDepartureTime.Date().ToIso8601():null:null,f={AdditionalSeats:0,AdultSeats:t.NumberOfAdults,ArrivalIata:n.OutboundSlot.Route.DestinationIata,ChildSeats:t.NumberOfChildren,Infants:t.NumberOfInfants,DepartureIata:n.OutboundSlot.Route.OriginIata,IncludeFlexiFares:t.ShowFlexiFares,IncludePrices:!0,IsPartOfReturnJourney:!!n.ReturnSlot&&!!n.ReturnSlot.Flight,IsTransfer:!1,LanguageCode:this._rootSettings.EResLanguageCode,MinDepartureDate:u||i,MaxDepartureDate:u||i,MinReturnDate:i,MaxReturnDate:i,FlightNumbers:this._funnelBasketService.GetFlightsForJourneyPair(n).map(function(n){return n.FlightNumber}),IncludeLowestFareSeats:!1,IncludeAdminFees:n.IsPrimaryPair};this._availabilityService.FindGridFlights(f,function(t){n.BaseCurrency=t.BaseCurrency;r.resolve()})}else r.resolve();return r.promise},t.prototype.UpdateCurrencyToMatchPrimaryPair=function(t){var i=!1,r=this._funnelBasketService.GetPrimaryJourneyPair(),u;return r.BaseCurrency?i=this.SetCurrency(r.BaseCurrency,t,!0):(u=this.GetDefaultCurrencyForRegion(),this.SetClientCurrencyState(u,1),n.Events.Fire(n.Events.Names.Funnel.CurrencyUpdated),i=!0),i},t.prototype.SetCurrency=function(t,i,r,u,f){var l=this,o,h,s,e,c;return r===void 0&&(r=!1),u===void 0&&(u=null),f===void 0&&(f=null),u||(u=i),o=!1,h=this._funnelJourneyCookieService.ReadCookie(),h.CurrencyPriority<=u&&(s=this._priceService.GetCurrentCurrency(),this.SetClientCurrencyState(t,i),e=this._funnelBasketService.GetBasket(),!e||e.Currency===t?(n.Events.Fire(n.Events.Names.Funnel.CurrencyUpdated),!f||f()):(o=!0,e.Currency=t,n.Events.Fire(n.Events.Names.Funnel.CurrencyIsUpdating),this.RemoveExtrasFromClientBasket(),this._funnelBasketUpdateService.UpdateCurrency(t),this.UpdateBasketCurrencies(t).then(function(){l.SetFreeLuggageForFare();n.Events.Fire(n.Events.Names.Funnel.CurrencyUpdated);!f||f()})),c=(s?s.CurrencyCode:"")!==t,r||!c||!e||n.Events.Fire(n.Events.Names.AvailabilityFlightsProvider.ForceGridRefresh)),o},t.prototype.SetClientCurrencyState=function(n,t){this._funnelJourneyCookieService.UpdateCookie(function(i){i.CurrencyCode=n;i.CurrencyPriority=t});this._priceService.SetCurrencyCode(n)},t.prototype.AddPreServerCurrencyUpdateHandler=function(n){this._preServerCurrencyUpdateHandlers.push(n)},t.prototype.GetPreServerUpdateHandlerPromises=function(n){for(var u,i=[],t=0,r=this._preServerCurrencyUpdateHandlers;t<r.length;t++)u=r[t],i.push(u(n));return i},t.prototype.UpdateBasketCurrencies=function(n){var t=this,i=this._qService.defer(),r;return this._funnelBasketService.ServerBasketExists()?(r=this.GetPreServerUpdateHandlerPromises(n),this._qService.all(r).then(function(){var u=t._funnelBasketService.GetJourneyPairs(),r=t._funnelBasketService.GetFareType(),f=_(u).map(function(n){return t._dataMapper.ConvertToApiJourneyPair(n,r)}),e=t._funnelBasketAssociationsService.GetSeatAssociationsUpdateRequest(t._funnelBasketAssociationsService.GetFlightAssociations());t._funnelApi.ChangeBasketCurrency(n,f,r,e,function(n){t.HandleBasketCurrencyChangeSuccess(n);i.resolve()},t.HandleBasketCurrencyChangeError.bind(t))})):i.resolve(),i.promise},t.prototype.HandleBasketCurrencyChangeSuccess=function(t){var i=this._dataMapper.CreateClientBasket(t);this._funnelBasketUpdateService.UpdateCurrency(i.Currency,i.FixedCharges);n.Events.Fire(n.Events.Names.Funnel.CurrencyUpdated)},t.prototype.HandleBasketCurrencyChangeError=function(n,t,i){this._errorService.HandleApiError(n,t,i)},t.prototype.RemoveExtrasFromClientBasket=function(){this._funnelBasketExtrasRemovalService.RemoveExtrasFromClientBasket()},t.prototype.SetFreeLuggageForFare=function(){this._funnelBasketService.GetFareType()===n.Data.Common.FlightFareType.Flexi&&this._funnelBasketLuggageService.ResetLuggageToDefaults(!0)},t.ServiceName="Funnel_CurrencyService",t.$inject=["$q","IAnalyticsTracker","Funnel_Api","FunnelJourneyCookie_Service","Funnel_BasketService","Common_PriceService","Error_Service","Availability_AvailabilityService","Sitecore_MoneySettings","Sitecore_FunnelRootSettings","Funnel_AssociationsService","Funnel_BasketLuggageService","Funnel_BasketHotelsService","Funnel_FunnelDataMapper","Funnel_TravelInsuranceBasketService","Funnel_BasketUpdateService","Funnel_BasketExtrasRemovalService"],t}();t.FunnelCurrencyService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function r(n,r){this._funnelCarDataMapper=n;this._flightFaresMapper=new i.Flight.FlightFaresDataMapper;this._priceMapper=new t.Common.PriceDataMapper;this._basketFlightItemChargesDataMapper=new i.Flight.FlightItemChargesDataMapper;this._funnelHotelDataMapper=new i.FunnelHotelsDataMapper;this._funnelTravelInsuranceDataMapper=r}return r.prototype.ClientBasketFlightFromGridFlight=function(n){return{ArrivalIata:n.ArrivalIata,CarrierCode:n.CarrierCode,DepartureIata:n.DepartureIata,FlightNumber:n.FlightNumber,LocalDepartureTime:n.LocalDepartureTime,LocalArrivalTime:n.LocalArrivalTime,SegmentId:n.SegmentId,FlightKey:n.FlightKey,FlightFares:this.GetFlightFares(n),CanCheckIn:!0,IsCancelled:!1,IsDisrupted:!1,InternalId:System.Guid.MakeNew().ToString().toLowerCase(),FlightTaxes:n.FlightTaxes}},r.prototype.GetFlightFares=function(n){return _(n.FlightFares).map(function(n){return{FareType:n.FareType,Prices:n.Prices,FlightIdentification:n.FlightIdentification}})},r.prototype.CreateClientBooking=function(t){return t?{BookingReference:t.BookingReference,Currency:t.CurrencyCode,Passengers:this.CreateFlightPassengers(t.Passengers),Associations:t.Associations,CarriedInfants:this.CreateFlightInfants(t.CarriedInfants||[]),Luggage:{HoldBags:this.CreateClientBags(t.Bags),SportsEquipment:this.CreateClientSportsEquipments(t.SportsEquipment)},Ancillaries:this.GetAncillariesFromBasketResponse(t.Ancillaries),FareType:n.Data.Common.FlightFareType.Parse(t.FareType),TotalPaidPrice:this._priceMapper.MapFromNumber(t.TotalPaidPrice),BookerDetails:this.MapBookerDetails(t.MemberDetails),Flights:this.CreateClientFlightsFromBooking(t),Vouchers:this.MapVoucherAssociations(t.Associations),CardLastFourDigits:t.CardLastFourDigits,CardVendorCode:t.CardVendorCode,CarBooking:t.CarBooking,HotelBooking:t.HotelBooking,TravelInsuranceBooking:t.TravelInsuranceBooking,AirPlusSupplementaryDataSupplied:t.AirPlusSupplementaryDataSupplied}:null},r.prototype.CreateClientBasket=function(t){return{BookingReference:t.BookingReference,Currency:t.CurrencyCode,CanBeFinalised:t.CanBeFinalised,HasBeenFinalised:t.HasBeenFinalised,Passengers:this.CreateFlightPassengers(t.Passengers),Associations:t.Associations,CarriedInfants:this.CreateFlightInfants(t.CarriedInfants),Luggage:{HoldBags:this.CreateClientBags(t.Bags),SportsEquipment:this.CreateClientSportsEquipments(t.SportsEquipment)},FixedCharges:this.CreateFixedCharges(t.AdminFee),FareType:n.Data.Common.FlightFareType.Parse(t.FareType),ReasonForTravelCode:t.ReasonForTravelCode,BookerDetails:this.MapBookerDetails(t.MemberDetails),JourneyPairs:this.CreateClientJourneyPairs(t),FlightItemCharges:this._basketFlightItemChargesDataMapper.MapFromBasketFlightChargeListApi(t.FlightItemChargesList),Hotel:this._funnelHotelDataMapper.FromHotelModelToHotel(t.Hotel),Car:this._funnelCarDataMapper.FromCarModelToCar(t.Car),TravelInsurance:this._funnelTravelInsuranceDataMapper.ToClientBasketFromModel(t.TravelInsurance)}},r.prototype.CreateFixedCharges=function(n){return n==null?null:{AdminFee:this._priceMapper.MapFromApi(n.AdminFee)}},r.prototype.MapBookerDetails=function(t){var i,r,u;return t||(t={}),i=new n.Data.Common.PhoneNumber,t.Telephone&&(i.DialingCode=t.Telephone.DialingCode,i.PhoneNumberWithoutDialingCode=t.Telephone.PhoneNumberWithoutDialingCode),r={Title:t.Title,FirstName:t.FirstName,LastName:t.LastName,ResidentOfDisplayText:t.Country,ResidentOfValue:t.Country,ResidentOfIsoCode:t.CountryIsoCode,Address1:t.Address1,Address2:t.Address2,City:t.City,PostalCode:t.PostalCode,StateProvince:t.StateProvince,Telephone:i,EjPlusNumber:t.EjPlusNumber,MemberId:t.MemberId,Email:t.Email,Password:"",KeepMeSignedInMinutes:0,OptInForEasyJetMailing:t.OptInForEasyJetMailing,OptInForMailing:t.OptInForMailing},t.SavedPaymentCard&&(u={LastFourDigits:t.SavedPaymentCard.LastFourDigits,CardVendorCode:t.SavedPaymentCard.CardVendorCode,ExpirationMonth:t.SavedPaymentCard.ExpirationMonth,ExpirationYear:t.SavedPaymentCard.ExpirationYear},r.SavedPaymentCard=u),r},r.prototype.GetAncillariesFromBasketResponse=function(n){var t;return n?{HasCar:n.CarHire,HasHotelBooking:n.HotelBooking,HasTravelInsurance:n.TravelInsurance}:t},r.prototype.CreateClientBags=function(n){var t=this;return _(n).map(function(n){return t.CreateClientBag(n)})},r.prototype.CreateClientBag=function(t){return{PassengerInternalId:t.PassengerInternalId,TotalWeight:t.TotalWeight,TotalPrice:this._priceMapper.MapFromNumbers(t.TotalPriceWithCreditCard,t.TotalPrice),ExcessWeightSteps:t.ExcessWeightSteps,Quantity:t.Quantity,IsFlexiFareBag:t.IsFlexiFareBag,Type:n.Data.Funnel.BagType.Parse(t.Type)}},r.prototype.CreateClientSportsEquipments=function(n){var t=this;return _(n).map(function(n){return t.CreateClientSportsEquipment(n)})},r.prototype.CreateClientSportsEquipment=function(n){return{PassengerInternalId:n.PassengerInternalId,DisplayName:n.DisplayName,Quantity:n.Quantity,Type:n.Type,Price:this._priceMapper.MapFromNumbers(n.PriceWithCreditCard,n.Price),IsLarge:n.IsLarge,TotalWeight:n.TotalWeight}},r.prototype.CreateClientFlightsFromBooking=function(n){var t=this;return _(n.Flights).map(function(n){return t.CreateClientBasketFlight(n)})},r.prototype.CreateClientJourneyPairs=function(n){var t=this;return _(n.JourneyPairs).map(function(n){return t.CreateClientJourneyPair(n)})},r.prototype.CreateClientJourneyPair=function(n){return{Id:n.Id,IsPrimaryPair:n.IsPrimaryPair,BaseCurrency:n.BaseCurrency,OutboundSlot:this.CreateJourneySlot(n.OutboundSlot),ReturnSlot:this.CreateJourneySlot(n.ReturnSlot)}},r.prototype.CreateJourneySlot=function(n){return n?{Flight:this.CreateClientBasketFlight(n.Flight)}:null},r.prototype.CreateClientBasketFlight=function(n){return n?{InternalId:n.InternalId,ArrivalIata:n.ArrivalIata,ArrTerminalName:n.ArrTerminalName,CarrierCode:n.CarrierCode,DepartureIata:n.DepartureIata,DepTerminalName:n.DepTerminalName,FlightNumber:n.FlightNumber,LocalDepartureTime:Utilities.ZonelessDateTime.FromIso8601(n.LocalDepartureTime),LocalArrivalTime:Utilities.ZonelessDateTime.FromIso8601(n.LocalArrivalTime),IsCancelled:!1,IsDisrupted:!1,SegmentId:n.SegmentId,FlightKey:n.FlightKey,CanCheckIn:n.CanCheckIn,FlightFares:this._flightFaresMapper.MapFromApiToClient(n.FlightFares),FlightTaxes:n.FlightTaxes}:null},r.prototype.CreateApiBasketFlight=function(n,t){return n?{InternalId:n.InternalId,ArrivalIata:n.ArrivalIata,ArrTerminalName:n.ArrTerminalName,CarrierCode:n.CarrierCode,DepartureIata:n.DepartureIata,DepTerminalName:n.DepTerminalName,FlightNumber:n.FlightNumber,LocalDepartureTime:n.LocalDepartureTime.ToIso8601(),LocalArrivalTime:n.LocalArrivalTime.ToIso8601(),SegmentId:n.SegmentId,FlightKey:n.FlightKey,CanCheckIn:n.CanCheckIn,FlightFares:this._flightFaresMapper.MapFromClientToApi(n.FlightFares),Disruption:null,BasePrice:this._flightFaresMapper.MapFromClientToBasePrice(n.FlightFares,t),FlightTaxes:n.FlightTaxes}:null},r.prototype.MapVoucherAssociations=function(n){var t;return!n?null:(t=n.filter(function(n){return!!n.Vouchers&&n.Vouchers.Quantity>0}).map(function(n){return{Quantity:n.Vouchers.Quantity,Cost:n.Vouchers.Cost,CostWithCreditCardFee:n.Vouchers.CostWithCreditCardFee,RedeemableAmount:n.Vouchers.RedeemableAmount}}),t.length>0?t:null)},r.prototype.CreateFlightPassengers=function(n){var t=this;return _(n).map(function(n){return t.CreateClientPassenger(n)})},r.prototype.CreateClientPassenger=function(t){return{InternalId:t.InternalId,Age:t.Age,Title:t.Title,FirstName:t.FirstName,LastName:t.LastName,Type:n.Data.Common.PassengerDataType.Parse(t.Type),HasSpecialServiceFlags:t.HasSpecialServiceFlags,EjPlusNumber:t.EjPlusNumber,NifNumber:t.NifNumber,SpecialServiceRequestCodes:t.SpecialServiceRequestCodes}},r.prototype.CreateFlightInfants=function(t){return!t?[]:t.map(function(t){return{Age:t.Age,FirstName:t.FirstName,LastName:t.LastName,InternalId:t.InternalId,Title:t.Title,Type:n.Data.Common.PassengerDataType.Infant}})},r.prototype.ConvertToApiJourneyPair=function(n,t){return{Id:n.Id,IsPrimaryPair:n.IsPrimaryPair,BaseCurrency:n.BaseCurrency,OutboundSlot:this.ConvertToApiJourneySlot(n.OutboundSlot,t),ReturnSlot:n.ReturnSlot?this.ConvertToApiJourneySlot(n.ReturnSlot,t):null}},r.prototype.ConvertToApiJourneySlot=function(n,t){return{Flight:n.Flight?this.CreateApiBasketFlight(n.Flight,t):null}},r.ServiceName="Funnel_FunnelDataMapper",r.$inject=["Funnel_CarsDataMapper","Funnel_TravelInsuranceDataMapper"],r}();i.FunnelDataMapper=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.prototype.IsStaffCard=function(n){return n.toLowerCase().charAt(0)==="s"&&n.length===8},n.ServiceName="Funnel_EjPlusService",n}();n.FunnelEjPlusService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function i(n,t,i,r,u){this._tracker=n;this._funnelBasketService=t;this._navigationService=i;this._journeyService=r;this._funnelTravelInsuranceBasketService=u}return i.prototype.HandleFlightPriceChange=function(t){this._tracker.TrackEvent(Tracking.EventConstants.Categories.Checkout,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.FareChange);var i=this.MapErrorDataToFlightPriceChanges(t),r={FlightPriceChanges:i},u={SectionKey:"funnel-finaliseflightpriceschanged",Parameters:r};n.Events.OpenDrawerWithOptions(u)},i.prototype.MapErrorDataToFlightPriceChanges=function(n){var i=new t.Common.PriceDataMapper;return n.map(function(n){return{SegmentId:n.SegmentId,NewPrices:{Adult:i.MapFromApiKnownException(n.NewAdultPrice),Child:i.MapFromApiKnownException(n.NewChildPrice)},OldPrices:{Adult:i.MapFromApiKnownException(n.OldAdultPrice),Child:i.MapFromApiKnownException(n.OldChildPrice)}}})},i.prototype.HandleBasketPriceChange=function(t){var i=this,r;this._tracker.TrackEventWithValue(Tracking.EventConstants.Categories.Checkout,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.BasketPriceChange,"Currency: "+this._funnelBasketService.GetCurrencyCode()+" Price Increase: "+t);r={SectionKey:"funnel-finalisebasketpricechanged",OnConfirmCallback:function(){i._funnelTravelInsuranceBasketService.RemoveSelectedPolicy();i._navigationService.NavigateTo(i._journeyService.GetEditFlightsStepUrl())}};n.Events.OpenDrawerWithOptions(r)},i.ServiceName="Funnel_FinalisePriceChangeHandlerService",i.$inject=["IAnalyticsTracker","Funnel_BasketService","Common_NavigationService","Funnel_JourneyService","Funnel_TravelInsuranceBasketService"],i}();i.FunnelFinalisePriceChangeHandlerService=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._funnelBasketService=n;this._priceService=t}return n.prototype.GetBasketTaxes=function(){var t=this,i=this._funnelBasketService.GetFlights(),r=i.map(function(n){return t.GetFlightTaxes(n)}),n;return(n=this._priceService).Add.apply(n,r)},n.prototype.GetFlightTaxes=function(n){if(!!n.FlightTaxes){var t=this.GetTaxLiablePassengerCount(n.FlightTaxes.ApplyApdRules),i=this._priceService.NewPrice(n.FlightTaxes.TaxAmount);return this._priceService.Multiply(i,t)}return this._priceService.NewPrice()},n.prototype.GetTaxLiablePassengerCount=function(n){var t=this._funnelBasketService.GetPassengerComposition();return n?t.Adults:t.Adults+t.Children},n.ServiceName="Funnel_FlightTaxCalculator",n.$inject=["Funnel_BasketService","Common_PriceService"],n}();n.FunnelFlightTaxCalculator=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){}return t.prototype.FromHotelModelToHotel=function(t){return t?{Id:t.Id,Name:t.Name,HotelLeadGuestInternalId:t.HotelLeadGuestInternalId,CheckInDateTime:Utilities.ZonelessDateTime.FromIso8601(t.CheckInDateTime),CheckOutDateTime:Utilities.ZonelessDateTime.FromIso8601(t.CheckOutDateTime),BookingType:n.Data.Common.HotelBookingType[t.BookingType],LocalCurrencyCode:t.LocalCurrencyCode,IsSmoking:t.IsSmoking,Rooms:this.FromRoomModelToRoom(t.Rooms)}:null},t.prototype.FromHotelToHotelData=function(n){return n?{Id:n.Id,Name:n.Name,HotelLeadGuestInternalId:n.HotelLeadGuestInternalId,CheckInDateTime:n.CheckIn,CheckOutDateTime:n.CheckOut,BookingType:n.BookingType,LocalCurrencyCode:n.LocalCurrency,IsSmoking:n.IsSmoking,Rooms:this.FromRoomToRoomData(n.Rooms)}:null},t.prototype.FromHotelDataToHotel=function(n){return n?{Id:n.Id,Name:n.Name,HotelLeadGuestInternalId:n.HotelLeadGuestInternalId,CheckIn:n.CheckInDateTime,CheckOut:n.CheckOutDateTime,BookingType:n.BookingType,LocalCurrency:n.LocalCurrencyCode,IsSmoking:n.IsSmoking,Rooms:this.FromRoomDataToRoom(n.Rooms)}:null},t.prototype.ToHotel=function(n){if(!n||!n.hotelRes||n.hotelRes.length===0)return null;var t=n.hotelRes[0];return t.error==="1"?null:{Id:t.hotel_id,Name:t.hotel_name,HotelLeadGuestInternalId:null,CheckIn:Utilities.ZonelessDateTime.FromIso8601(t.begin_date+"T"+t.begin_time+":00"),CheckOut:Utilities.ZonelessDateTime.FromIso8601(t.end_date+"T"+t.end_time+":00"),BookingType:this.GetBookingTypeForFirstRoom(t.deposit_required),LocalCurrency:t.hotel_currency,IsSmoking:t.smoking==="1",Rooms:this.ToHotelRooms(t)}},t.prototype.ToUpdateHotelRequestData=function(t){return t?{Hotel:{Id:t.Id,Name:t.Name,HotelLeadGuestInternalId:t.HotelLeadGuestInternalId,CheckInDateTime:t.CheckInDateTime.ToIso8601(),CheckOutDateTime:t.CheckOutDateTime.ToIso8601(),BookingType:n.Data.Common.HotelBookingType[t.BookingType],LocalCurrencyCode:t.LocalCurrencyCode,IsSmoking:t.IsSmoking,Rooms:this.ToHotelRoomModels(t.Rooms)}}:{Hotel:null}},t.prototype.FromRoomModelToRoom=function(n){return _(n).map(function(n){return{Id:n.Id,Description:n.Description,Quantity:n.Quantity,LocalPrice:n.LocalPrice,GuestLimit:n.GuestLimit,BasketPrice:n.BasketPrice}})},t.prototype.FromRoomToRoomData=function(n){return _(n).map(function(n){return{Id:n.Id,Description:n.Description,Quantity:n.Quantity,LocalPrice:n.LocalPrice,GuestLimit:n.GuestLimit,BasketPrice:n.BasketPrice}})},t.prototype.FromRoomDataToRoom=function(n){return _(n).map(function(n){return{Id:n.Id,Description:n.Description,Quantity:n.Quantity,LocalPrice:n.LocalPrice,GuestLimit:n.GuestLimit,BasketPrice:n.BasketPrice}})},t.prototype.GetBookingTypeForFirstRoom=function(t){return t[0]==="1"?n.Data.Common.HotelBookingType.BookNowPayNow:n.Data.Common.HotelBookingType.BookNowPayLater},t.prototype.GetRoomDetail=function(n,t){return n.split(",")[t]},t.prototype.GetRoomGuestLimit=function(n,t){var i=n.guest_qty.split(","),r=_(n.block_qty.split(",")).take(t),u=_(r).reduce(function(n,t){return n+parseInt(t)},0);return parseInt(i[u])},t.prototype.ToHotelRoomModels=function(n){return _(n).map(function(n){return{Id:n.Id,Description:n.Description,Quantity:n.Quantity,LocalPrice:n.LocalPrice,GuestLimit:n.GuestLimit,BasketPrice:n.BasketPrice}})},t.prototype.ToHotelRooms=function(n){for(var i=[],r=n.block_id.split(","),t=0;t<r.length;t++)i.push({Id:r[t],Description:this.GetRoomDetail(n.room_name,t),Quantity:parseInt(this.GetRoomDetail(n.block_qty,t)),LocalPrice:parseFloat(this.GetRoomDetail(n.incremental_prices,t)),BasketPrice:parseFloat(this.GetRoomDetail(n.incremental_prices_currency,t)),GuestLimit:this.GetRoomGuestLimit(n,t)});return i},t.ServiceName="Funnel_HotelsDataMapper",t}();t.FunnelHotelsDataMapper=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var r=function(){function t(n,t,i,r,u,f,e,o,s){this._funnelJourneySettings=n;this._funnelBasketService=t;this._funnelJourneyCookieService=i;this._sitecorePageSettings=r;this._deepLinksService=u;this._priceService=f;this._popUnderService=e;this._bypassService=o;this._funnelQueryCookieService=s;this._bypassRules=this._bypassService.BuildBypassRules()}return t.prototype.GetByPassRules=function(){return this._bypassRules},t.prototype.DisableDeepLinkToStepTwo=function(){var n=this.GetCurrentJourneyModel();return n.DisableDeepLinkToStepTwo},t.prototype.RemoveLinkFromEjLogo=function(){var n=this.GetCurrentJourneyModel();return n.RemoveLinkFromEjLogo},t.prototype.GetEditFlightsStepUrl=function(){return this.GetStepEditUrl(this.GetCurrentJourneyModel().EditFlightsStep)},t.prototype.GetEditSeatingUrl=function(){return this.GetStepEditUrl(this.GetCurrentJourneyModel().EditSeatsStep)},t.prototype.GetEditLuggageUrl=function(){return this.GetStepEditUrl(this.GetCurrentJourneyModel().EditLuggageStep)},t.prototype.GetEditTravelInsuranceStepUrl=function(){var n=this.GetCurrentJourneyModel().EditTravelInsuranceStep,t=Utilities.Arrays.FirstOrDefault(this.GetCurrentJourneyModel().Steps,function(t){return t.StepId===n}),i;return!t?null:(i=t.ApplyOffersBypassRules,i?this.GetStepEditUrl(n)+"?focus=insurance":this.GetStepEditUrl(n))},t.prototype.GetEditHotelUrl=function(){return this.GetStepEditUrl(this.GetCurrentJourneyModel().EditHotelStep)},t.prototype.GetEditCarUrl=function(){return this.GetStepEditUrl(this.GetCurrentJourneyModel().EditCarStep)},t.prototype.GetEditVouchersUrl=function(){var n=this.GetCurrentJourneyModel().EditVouchersStep,t=Utilities.Arrays.FirstOrDefault(this.GetCurrentJourneyModel().Steps,function(t){return t.StepId===n});return!t?null:this.GetStepEditUrl(this.GetCurrentJourneyModel().EditVouchersStep)+"?focus=vouchers"},t.prototype.GetStepEditUrl=function(n){var t=this.GetStepInJourneyById(n,i.Forward,!1);return this.GetSafeStepPageUrl(t)},t.prototype.GetStepOnLoadInvalidFlightRedirect=function(n){return this._funnelBasketService.AllPairsHaveFlightsSelected()?null:{TargetUrl:this.GetFirstStepUrl(),EventCategory:n,EventAction:Tracking.EventConstants.Actions.Redirect,EventLabel:Tracking.EventConstants.Labels.InvalidFlight}},t.prototype.GetContinueToNextStepUrl=function(){var r=this.GetCurrentStepInJourney(),t=this.GetNextStep(r,i.Forward,null),n;return t?(n=this.GetSafeStepPageUrl(t),t.ApplyDeepLinkParametersToUrl&&(n=this.GenerateDeepLinkFromContinueUrl(n)),n):this.GetFirstStepUrl()},t.prototype.GetSkipToNextStepUrl=function(){var n=this.GetCurrentStepInJourney(),t;return n?(t=this.GetNextStep(n,i.Forward,n.SkipStepOverride),!t)?this.GetFirstStepUrl():this.GetSafeStepPageUrl(t):this.GetFirstStepUrl()},t.prototype.GetBypassNextStepUrl=function(){var n=this.GetCurrentStepInJourney(),t;return n?(t=this.GetNextStep(n,i.Forward,n.BypassStepOverride),!t)?this.GetFirstStepUrl():this.GetSafeStepPageUrl(t):this.GetFirstStepUrl()},t.prototype.GetBackStepUrl=function(){var n=this.GetCurrentStepInJourney(),t;return n?(t=this.GetNextStep(n,i.Backward,n.BackStepOverride),!t)?this.GetFirstStepUrl():this.GetSafeStepPageUrl(t):this.GetFirstStepUrl()},t.prototype.GetNextStepUrlIfOnLoadRedirectRequired=function(){var t=this.GetCurrentStepIndexInJourney(),n=this.GetStepInJourneyByIndex(t,i.Forward);return!!n&&n.PageId!==this._sitecorePageSettings.CurrentPageId?this.GetSafeStepPageUrl(n):null},t.prototype.GetCurrentStepInJourney=function(){var t=this,i=this.GetCurrentJourneyModel(),n=Utilities.Arrays.FirstOrDefault(i.Steps,function(n){return n.PageId===t._sitecorePageSettings.CurrentPageId});return n?n:(console.warn("Could not find current step in Funnel Journey for this page"),null)},t.prototype.ShowPopUnderOnContinue=function(){this.GetCurrentStepInJourney().EnablePopUnderOnContinue&&this._popUnderService.ShouldShowPopUnder()&&this.RenderPopUnder()},t.prototype.ShowPopUnderOnSkip=function(){return this.GetCurrentStepInJourney().EnablePopUnderOnSkip&&this._popUnderService.ShouldShowPopUnder()?(this.RenderPopUnder(),!0):!1},t.prototype.RenderPopUnder=function(){this._popUnderService.ShowPopUnder(this.GetSkipToNextStepUrl())},t.prototype.UpdateJourneyOnMissingStepOrJourney=function(){this.EnsureCurrentJourneyIsValid(!1)},t.prototype.UpdateJourneyOnContinue=function(){this._funnelJourneyCookieService.ReadCookie().UsingFixedJourney||this.EnsureCurrentJourneyIsValid(!0)},t.prototype.EnsureCurrentJourneyIsValid=function(n){var u=this.GetCurrentJourneyKeyFromCookie(),t=Utilities.Arrays.FirstOrDefault(this._funnelJourneySettings.Journeys,function(n){return n.JourneyKey===u}),r,i;t&&!n||!this._funnelJourneySettings.JourneyRules||(r=this._funnelBasketService.BuildBookingRulesArgsFromBasket(),i=Main3.SitecoreRules.Pipeline.PipelineRunner.RunPipeline(this._funnelJourneySettings.JourneyRules,new Main3.SitecoreRules.Rules.Pipelines.Args.BookingRulePipelineArgs(r)),t=i.Matched&&i.ItemIds().length>0?Utilities.Arrays.FirstOrDefault(this._funnelJourneySettings.Journeys,function(n){return new System.Guid(n.JourneyId).Equals(i.ItemIds()[0])}):null);t||(t=this.GetJourneyModelWithKeyOrDefault(""));!t||this.SetNewJourney(t)},t.prototype.HasValidFunnelJourneySelected=function(){var n=this.GetCurrentJourneyKeyFromCookie();return this._funnelJourneySettings.Journeys.filter(function(t){return t.JourneyKey===n}).length>0},t.prototype.GetFirstStepUrl=function(){var n=this.GetStepInJourneyByIndex(0,i.Forward);return this.GetSafeStepPageUrl(n)},t.prototype.GetSafeStepPageUrl=function(n){return!n?null:n.PageUrl},t.prototype.GetNextStep=function(n,t,r){if(!r){var u=this.GetIndexOfStepInJourney(n);return t===i.Backward?this.GetStepInJourneyByIndex(u-1,t):this.GetStepInJourneyByIndex(u+1,t)}return this.GetStepInJourneyById(r,t)},t.prototype.GetCurrentJourneyModel=function(){var n=this.GetCurrentJourneyKeyFromCookie();return this.GetJourneyModelWithKeyOrDefault(n)},t.prototype.GetCurrentJourneyKeyFromCookie=function(){var n="";return this._funnelQueryCookieService.HasValidCookie()&&(n=this._funnelQueryCookieService.ReadCookie().FunnelJourney),!n&&this._funnelJourneyCookieService.HasCookie()&&(n=this._funnelJourneyCookieService.ReadCookie().FunnelJourney),n},t.prototype.GetJourneyModelWithKeyOrDefault=function(n){var i=this,t=null;return!n||(t=Utilities.Arrays.FirstOrDefault(this._funnelJourneySettings.Journeys,function(t){return t.JourneyKey===n})),!t&&!!this._funnelJourneySettings.Journeys&&this._funnelJourneySettings.Journeys.length>0&&(!this._funnelJourneySettings.DefaultFunnelJourneyKey||(t=Utilities.Arrays.FirstOrDefault(this._funnelJourneySettings.Journeys,function(n){return n.JourneyKey===i._funnelJourneySettings.DefaultFunnelJourneyKey})),t||(t=this._funnelJourneySettings.Journeys[0])),t},t.prototype.SetNewJourney=function(t){!t||t.JourneyKey===this._funnelJourneyCookieService.ReadCookie().FunnelJourney||(this._funnelJourneyCookieService.UpdateCookie(function(n){return n.FunnelJourney=t.JourneyKey}),n.Events.Fire(n.Events.Names.Funnel.JourneyChanged))},t.prototype.GetStepInJourneyByIndex=function(n,t,r){var f,u;return(r===void 0&&(r=!0),f=this.GetCurrentJourneyModel(),n<0||n>=f.Steps.length)?null:(u=f.Steps[n],r&&this.ShouldBypassStep(u)?this.GetNextStep(u,t,t===i.Forward?u.BypassStepOverride:u.BackStepOverride):u)},t.prototype.GetStepInJourneyById=function(n,t,i){var r,u,f;return i===void 0&&(i=!0),r=this.GetCurrentJourneyModel(),u=Utilities.Arrays.FirstOrDefault(r.Steps,function(t){return t.StepId===n}),u?(f=this.GetIndexOfStepInJourney(u),this.GetStepInJourneyByIndex(f,t,i)):(console.warn("Could not find step with ID '"+n+"' in Funnel Journey '"+r.JourneyKey+"'"),null)},t.prototype.GetCurrentStepIndexInJourney=function(){var n=this.GetCurrentStepInJourney();return this.GetIndexOfStepInJourney(n)},t.prototype.GetIndexOfStepInJourney=function(n){if(!!n){var i=this.GetCurrentJourneyModel(),t=i.Steps.indexOf(n);if(t>-1)return t}return-99},t.prototype.ShouldBypassStep=function(n){return n.ApplySeatingBypassRules&&this._bypassRules.SkipSeatingPage()||n.ApplyCarsBypassRules&&this._bypassRules.SkipCarsPage()||n.ApplyHotelsBypassRules&&this._bypassRules.SkipHotelsPage()||n.ApplyTravelInsuranceBypassRules&&this._bypassRules.SkipTravelInsurancePages()||n.ApplyOffersBypassRules&&this._bypassRules.SkipOffersPage()},t.prototype.GenerateDeepLinkFromContinueUrl=function(n){var t={BaseUrl:n,ComponentSender:"Digital Acceleration",PaymentType:this._priceService.GetPaymentType()},i=this._funnelBasketService.GetBasketAsDeepLink(t);return this._deepLinksService.ToUrl(i)},t.ServiceName="Funnel_JourneyService",t.$inject=["Sitecore_FunnelJourneySettings","Funnel_BasketService","FunnelJourneyCookie_Service","Sitecore_PageSettings","Common_DeepLinksService","Common_PriceService","Funnel_PopUnderService","Funnel_BypassService","FunnelQuery_Service"],t}(),i;t.FunnelJourneyService=r,function(n){n[n.Forward=0]="Forward";n[n.Backward=1]="Backward"}(i||(i={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._qService=n;this._funnelLuggageChargesService=t;this._commonPriceService=i}return t.prototype.GetFlightChargesFromServerForBasketFlights=function(){return this._funnelLuggageChargesService.GetFlightItemChargesFromServer()},t.prototype.GetRepricedLuggage=function(n,t){var u=this,r=this._qService.defer(),i={Bags:n,SportsEquipment:t},f,e;return this.HasLuggageRequiringRepricing(n,t)?(f=this._funnelLuggageChargesService.GetWeightList(),e=this._funnelLuggageChargesService.GetSportsEquipmentList(),this._qService.all([f,e]).then(function(n){i=u.RepriceBags(i,n[0]);i=u.RepriceSportsEquipment(i,n[1]);r.resolve(i)},r.reject)):r.resolve(i),r.promise},t.prototype.HasLuggageRequiringRepricing=function(n,t){return n.some(function(n){return!n.IsFlexiFareBag})||t.length>0},t.prototype.RepriceBags=function(n,t){return n.Bags.forEach(function(n){var i,r;if(!n.IsFlexiFareBag)if(i=t.filter(function(t){return t.Weight==n.Weight}),i.length>0)r=i[0],n.AverageFlightPrice=r.AverageFlightPrice,n.Price=r.Price;else throw new Error("Could not find equivalent bag in prices");}),n},t.prototype.RepriceSportsEquipment=function(n,t){return n.SportsEquipment.forEach(function(n){var r=t.filter(function(t){return t.Code==n.Code}),i;if(r.length>0)i=r[0],n.AverageFlightPrice=i.AverageFlightPrice,n.Price=i.Price;else throw new Error("Could not find equivalent sports equipment in prices");}),n},t.ServiceName="Funnel_LuggageRepricingService",t.$inject=["$q",n.DynamicDependencyKeys.LuggageChargesService,"Common_PriceService"],t}();t.FunnelLuggageRepricingService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._vouchersBasketService=n;this._travelInsuranceBasketService=t}return n.prototype.GetState=function(){var n=this._travelInsuranceBasketService.HasTravelInsuranceInClientBasket(),t=this._vouchersBasketService.ThereAreVouchersInTheBasket();return t&&n?3:t&&!n?2:n&&!t?1:0},n.ServiceName="Funnel_OffersBasketStateService",n.$inject=["Funnel_VouchersBasketService","Funnel_TravelInsuranceBasketService"],n}();n.FunnelOffersBasketStateService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._funnelBasketService=n;this._funnelTravelInsuranceBasketService=t;this._passengerDisplayService=i}return t.prototype.EnsureAssociations=function(){var i=this,t=this._funnelBasketService.GetBasket(),r=this._funnelBasketService.GetFlights();r.forEach(function(r){t.CarriedInfants.forEach(function(u){if(i.BasketDoesNotContainAssociationForInfant(t,u,r)){console.warn("Association not correctly set for infant '"+u.InternalId+"' on flight '"+r.InternalId+"', attempting to reset");var f=!1;t.Passengers.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Adult}).forEach(function(n){if(!f){var i=t.Associations.filter(function(t){return t.PassengerInternalId===n.InternalId&&t.FlightInternalId===r.InternalId});i.length===1&&(i[0].CarriedInfantId||(i[0].CarriedInfantId=u.InternalId,f=!0))}});f||console.error("Unable to correct the association for infant '"+u.InternalId+"' on flight '"+r.InternalId+"'")}})})},t.prototype.GetPassengersFromBasket=function(){return this._funnelBasketService.GetBasket().Passengers},t.prototype.GetAdultPassengers=function(){return this.GetPassengersFromBasket().filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Adult})},t.prototype.PassengerShouldBeAnAdultBasedOnAge=function(n){return this._passengerDisplayService.PassengerShouldBeAnAdultBasedOnAge(n)},t.prototype.GetPassengerAge=function(n){return this._passengerDisplayService.GetPassengerAge(n)},t.prototype.GetDisplayName=function(t){for(var u,f,e,r=this._funnelBasketService.GetBasket(),o=r.Passengers.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Adult}),s=r.Passengers.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Child}),i=0;i<o.length;i++)if(u=o[i],u.InternalId===t)return this._passengerDisplayService.GetAdultDisplayName(u,i+1);for(i=0;i<s.length;i++)if(f=s[i],f.InternalId===t)return this._passengerDisplayService.GetChildDisplayName(f,i+1);for(i=0;i<r.CarriedInfants.length;i++)if(e=r.CarriedInfants[i],e.InternalId===t)return this._passengerDisplayService.GetInfantDisplayName(e,i+1);return""},t.prototype.GetPassengerFromBasketForId=function(n){return this._funnelBasketService.GetBasket().Passengers.filter(function(t){return t.InternalId===n})[0]},t.prototype.PassengerHasTravelInsurance=function(n){return this._funnelTravelInsuranceBasketService.PassengerHasTravelInsurance(n)},t.prototype.GetAdultForInfant=function(n,t){var u=this._funnelBasketService.GetBasket(),i=u.Associations.filter(function(t){return t.CarriedInfantId===n}),f,r;return(t&&i.filter(function(n){return n.FlightInternalId===t}),i.length>0&&(f=i[0].PassengerInternalId,r=u.Passengers.filter(function(n){return n.InternalId===f}),r.length>0))?r[0]:null},t.prototype.GetInfantForPassenger=function(n,t){var u=this._funnelBasketService.GetBasket(),i=u.Associations.filter(function(t){return t.PassengerInternalId===n}),f,r;return(t&&i.filter(function(n){return n.FlightInternalId===t}),i.length>0&&(f=i[0].CarriedInfantId,r=u.CarriedInfants.filter(function(n){return n.InternalId===f}),r.length>0))?r[0]:null},t.prototype.BasketDoesNotContainAssociationForInfant=function(n,t,i){return n.Associations.filter(function(n){return n.CarriedInfantId===t.InternalId&&n.FlightInternalId===i.InternalId}).length===0},t.prototype.OrderPassengers=function(){var t=this._funnelBasketService.GetBasket(),i=t.Passengers.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Adult}),r=t.Passengers.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Child});t.Passengers=i.concat(r);n.Events.Fire(n.Events.Names.Basket.PassengersOrdered)},t.ServiceName="Funnel_PassengerService",t.$inject=["Funnel_BasketService","Funnel_TravelInsuranceBasketService","Common_PassengerDisplayService"],t}();t.FunnelPassengerService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f){this._priceService=n;this._funnelBasketService=t;this._funnelBasketHotelsService=i;this._travelInsurancePriceService=r;this._flightTaxCalculator=u;this._vouchersBasketAssociationsService=f}return t.prototype.TotalPrice=function(){var n=this.TotalPriceExcludingHotels(),t=this.GetPriceOfHotelInBasketCurrency();return this._priceService.Add(n,t)},t.prototype.TotalPriceExcludingHotels=function(){var n=this.GetPriceOfHoldBags(),t=this.GetPriceOfFlights(),i=this.GetPriceOfSeats(),r=this.GetPriceOfSportsEquipment(),u=this.GetPriceOfCar(),f=this.GetPriceOfTravelInsurance(),e=this.GetPriceOfVouchers();return this._priceService.Add(t,i,n,r,u,f,e)},t.prototype.GetBasePriceOfFlightsAndFlightAncillariesWithoutVouchers=function(){var t=this.GetPriceOfFlights(),i=this.GetPriceOfSeats(),r=this.GetPriceOfHoldBags(),u=this.GetPriceOfSportsEquipment(),f=this._priceService.Add(i,r,u),e=new Big(t[n.Data.Common.PaymentType.Base]).plus(f[n.Data.Common.PaymentType.DebitCard]);return Number(e)},t.prototype.GetPriceOfFlights=function(){var n=this,t=null,i=null,r=null,u=this._funnelBasketService.GetPassengerComposition();return _(this._funnelBasketService.GetJourneyPairs()).map(function(n){return[n.OutboundSlot,n.ReturnSlot]}).forEach(function(f){n.GetFlightFaresForSlots(f).forEach(function(f){n.GetPricesForFlightFares(f).forEach(function(f){var e=n._priceService.Multiply(f.Adult,u.Adults),o=n._priceService.Multiply(f.Child,u.Children),s=n._priceService.Multiply(f.Infant,u.Infants);t=n._priceService.Add(t,e);i=n._priceService.Add(i,o);r=n._priceService.Add(r,s)})})}),this._priceService.Add(t,i,r)},t.prototype.GetFlightFaresForSlots=function(n){return _(n).select(function(n){return n!=null&&n.Flight!=null}).map(function(n){return n.Flight.FlightFares})},t.prototype.GetPricesForFlightFares=function(n){var t=this;return _.chain(n).select(function(n){return!!n.Prices&&n.FareType===t._funnelBasketService.GetFareType()}).map(function(n){return n.Prices}).value()},t.prototype.GetPricesForSelectedFareType=function(n){var t=this._funnelBasketService.GetFareType();return _(n).select(function(n){return n.FareType==t})[0].Prices},t.prototype.GetPriceOfSeats=function(){var n=this,i=this._funnelBasketService.GetBasket().Associations,t=this._priceService.NewPrice(0,0,0);return i.forEach(function(i){if(i.Seat){var r=n.PassengerForAssociationHasEjPlusCard(i),u=n.GetSeatBandPrice(i.Seat,r);t=n._priceService.Add(t,u)}}),t},t.prototype.PassengerForAssociationHasEjPlusCard=function(n){var t=this._funnelBasketService.GetBasket().Passengers.filter(function(t){return t.InternalId===n.PassengerInternalId});return t&&t.length==1?!!t[0].EjPlusNumber:!1},t.prototype.GetSeatBandPrice=function(t,i){var r={};return i?(r[n.Data.Common.PaymentType.DebitCard]=0,r[n.Data.Common.PaymentType.CreditCard]=0):(r[n.Data.Common.PaymentType.DebitCard]=t.Price,r[n.Data.Common.PaymentType.CreditCard]=t.PriceWithCreditCardFee),r},t.prototype.GetPriceOfHoldBags=function(){var i=this,t=this._priceService.NewPrice(0,0),n=this._funnelBasketService.GetBasket();return n&&n.Luggage&&n.Luggage.HoldBags&&n.Luggage.HoldBags.forEach(function(n){t=i._priceService.Add(t,n.TotalPrice)}),t},t.prototype.GetPriceOfSportsEquipment=function(){var i=this,t=this._priceService.NewPrice(0,0),n=this._funnelBasketService.GetBasket();return n&&n.Luggage&&n.Luggage.SportsEquipment&&n.Luggage.SportsEquipment.forEach(function(n){t=i._priceService.Add(t,n.Price)}),t},t.prototype.GetPriceOfAllLuggage=function(){return this._priceService.Add(this.GetPriceOfHoldBags(),this.GetPriceOfSportsEquipment())},t.prototype.GetPriceOfHotelInLocalCurrency=function(){var i=this,n=this._priceService.NewPrice(0,0),t=this._funnelBasketService.GetBasket();return!t||!t.Hotel||_(t.Hotel.Rooms).forEach(function(t){var r=i._priceService.NewPrice(t.LocalPrice,t.LocalPrice);n=i._priceService.Add(n,r)}),n},t.prototype.GetPriceOfHotelInBasketCurrency=function(){var n=this._funnelBasketHotelsService.TotalBasketPrice();return this._priceService.NewPrice(n,n)},t.prototype.GetPriceOfTravelInsurance=function(){var t=this._priceService.NewPrice(),n=this._funnelBasketService.GetBasket();return!n||!n.TravelInsurance||(t=this._travelInsurancePriceService.GetTotalPrice(n.TravelInsurance.Policy)),t},t.prototype.GetPriceOfVouchers=function(){return this._vouchersBasketAssociationsService.GetTotalPrice()},t.prototype.GetVoucherCost=function(){return this._vouchersBasketAssociationsService.GetVoucherCost()},t.prototype.GetInFlightAmount=function(){return this._vouchersBasketAssociationsService.GetVoucherRedeemableAmount()},t.prototype.GetTravelInsuranceCostOfTrip=function(){return this.GetBasePriceOfFlightsAndFlightAncillariesWithoutVouchers()},t.prototype.GetPriceOfCar=function(){var n=this._funnelBasketService.GetBasket();return!!n&&!!n.Car?n.Car.TotalPrice:this._priceService.NewPrice()},t.ServiceName="Funnel_PriceService",t.$inject=["Common_PriceService","Funnel_BasketService","Funnel_BasketHotelsService","Funnel_TravelInsurancePriceService","Funnel_FlightTaxCalculator","Funnel_VouchersAssociationsService"],t}();t.FunnelPriceService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this._funnelBasketService=n;this._funnelService=t;this._paymentPageSettings=i;this._priceService=r}return n.prototype.SepaPaymentApplicableForBooking=function(){var n=this._funnelBasketService.GetPrimaryJourneyPair();if(this._funnelBasketService.JourneyPairHasOutboundFlightSelected(n)){var t=n.OutboundSlot.Flight.LocalDepartureTime,i=this._funnelService.GetUrlLanguage(),r=this._priceService.GetCurrentCurrency();if(!!i&&!!r&&!!t)return this.LanguageIsValidForSepa(i)&&this.CurrencyIsValidForSepa(r)&&this.DatesAreValidForSepa(t)}return!1},n.prototype.CurrencyIsValidForSepa=function(n){return n.CurrencyCode.toLowerCase()===this._paymentPageSettings.SepaCurrencyCode.toLowerCase()},n.prototype.LanguageIsValidForSepa=function(n){return this._paymentPageSettings.SepaLanguageUrl.toLowerCase().indexOf("/"+n.toLowerCase())!==-1},n.prototype.DatesAreValidForSepa=function(n){return n>=Utilities.TimeAgnosticDate.TodayUtc().AddDays(this._paymentPageSettings.SepaDaysAhead).ToZonelessDateTime()},n.ServiceName="Funnel_SepaPaymentService",n.$inject=["Funnel_BasketService","Funnel_Service","Payment_PageSettings","Common_PriceService"],n}();n.FunnelSepaPaymentService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function i(t,i,r,u,f,e,o,s,h,c,l,a,v,y){this._qService=t;this._api=r;this._rootSettings=u;this._tracker=f;this._funnelJourneyCookieService=e;this._funnelBasketService=o;this._priceService=s;this._errorService=h;this._funnelPriceService=c;this._funnelECommerceCookieService=l;this._funnelAssociationsService=a;this._funnelVouchersAssociationsService=v;this._funnelBasketExtrasRemovalService=y;this._currencyChangeInProgress=!1;this._finalizeInProgress=!1;this.ShouldShowPaymentTypePickerInBasket=!1;this.ShouldShowAddMoreFlightsLink=!1;this.ShouldReloadPageOnSignIn=!1;i.$on(n.Events.Names.Funnel.CurrencyIsUpdating,this.OnCurrencyIsUpdating.bind(this));i.$on(n.Events.Names.Funnel.CurrencyUpdated,this.OnJourneyPairsPricesRefreshedAfterCurrencyChange.bind(this));i.$on(n.Events.Names.Account.DeprecatedSignInStatusChanged,this.OnSignInStatusChanged.bind(this))}return i.prototype.OnSignInStatusChanged=function(n,t,i){this.ShouldReloadPageOnSignIn&&!this._finalizeInProgress&&i!==null&&i===!1&&t===!0&&window.location.reload()},i.prototype.OnCurrencyIsUpdating=function(){this._currencyChangeInProgress=!0},i.prototype.OnJourneyPairsPricesRefreshedAfterCurrencyChange=function(){this._currencyChangeInProgress=!1},i.prototype.CurrencyChangeInProgress=function(){return this._currencyChangeInProgress},i.prototype.SetReasonForTravelServer=function(n){var t=this._qService.defer();return this._api.ChangeReasonForTravel(n,this.DeferredSuccess(t),this._errorService.HandleDeferredError(t)),t.promise},i.prototype.SetPaymentType=function(n){this._funnelJourneyCookieService.UpdateCookie(function(t){return t.PaymentType=n});this._priceService.SetPaymentType(n)},i.prototype.GetUrlLanguage=function(){var n=/^\/([a-z]{2})\//.exec(window.location.pathname);return n&&n.length===2?n[1]:"en"},i.prototype.SendSiteSearchAnalytics=function(n,t,i){var f=this.GetUrlLanguage(),r=this._funnelBasketService.GetPassengerComposition(),e=this._funnelJourneyCookieService.ReadCookie().ShowFlexiFares,u=this._funnelJourneyCookieService.ReadCookie().ComponentSender||"",o="f:"+n.OriginIata.toUpperCase()+"-t:"+n.DestinationIata.toUpperCase()+"-o:"+t.ToCompressedString()+"-r:"+(i?i.ToCompressedString():"null")+"-a:"+r.Adults.toString()+"-c:"+r.Children.toString()+"-i:"+r.Infants.toString()+"-Type:"+(e?"Flexi":"Standard")+"&cat="+u;this._tracker.TrackSiteSearch(f,o,u)},i.prototype.MomentDateFormat=function(n){return n.replace("dd","DD")},i.prototype.DeferredSuccess=function(n){return function(){n.resolve()}},i.prototype.HasAnyRequestsPending=function(){return this._api.HasAnyRequestsPending()},i.prototype.FinaliseBasket=function(i,r,u,f,e,o,s,h,c,l,a,v){var y=this,p,w;i===n.Data.Funnel.PaymentMethod.SEPA?p={AccountHoldersName:f.AccountHoldersName,IBAN:f.IBAN}:w={CardNumber:u.CardNumber,ExpirationMonth:u.ExpiryDateMonth,ExpirationYear:u.ExpiryDateYear,IssueNumber:u.IssueNumber,NameOnCard:u.CardHoldersName,SecurityCode:u.SecurityNumber,StartMonth:u.StartDateMonth,StartYear:u.StartDateYear,IsCreditCard:r.CreditCardFeesApply,CardVendorCode:r.B2BCardCode,SavePaymentCard:u.SavePaymentCard,UseSavedPaymentCard:i===n.Data.Funnel.PaymentMethod.SavedCard};var b=this._funnelPriceService.TotalPriceExcludingHotels(),k=function(n,t,i,r){var u=!r?null:r.KnownErrorAdditionalData;y._errorService.HandleApiErrorOnFinalize(n,t,i,u);l(n,t,i,r)},d=new t.Common.PriceDataMapper,g=d.MapToApi(b);this._finalizeInProgress=!0;this._api.Finalize(this.GetApiPaymentMethod(i),w,p,e,g,o,s,h,function(n){y.StoreECommerceData(b,i,r);n.RequireSecurePayment?a(n.SecurePaymentParameters):v()},k.bind(this),c)},i.prototype.StoreECommerceData=function(t,i,r){var u=n.Data.Cookies.FunnelPaymentAnalyticsPaymentMethod.Unknown,f="",e,o;i===n.Data.Funnel.PaymentMethod.SEPA?u=n.Data.Cookies.FunnelPaymentAnalyticsPaymentMethod.Sepa:(i===n.Data.Funnel.PaymentMethod.NewCard||i===n.Data.Funnel.PaymentMethod.SavedCard)&&(!r||(u=r.CreditCardFeesApply?n.Data.Cookies.FunnelPaymentAnalyticsPaymentMethod.CreditCard:n.Data.Cookies.FunnelPaymentAnalyticsPaymentMethod.DebitCard,f=r.PaymentCardDisplayName));e=t[n.Data.Common.PaymentType.CreditCard]-t[n.Data.Common.PaymentType.DebitCard];o={Method:u,CardName:f,CreditCardFee:e};this._funnelECommerceCookieService.UpdateCookie(function(n){return n.PaymentAnalytics=o})},i.prototype.GetApiPaymentMethod=function(t){return t===n.Data.Funnel.PaymentMethod.SEPA?n.Data.Common.Api.PaymentMethod.Sepa:n.Data.Common.Api.PaymentMethod.Card},i.prototype.HandlePotentialDuplicateBooking=function(t){n.Events.Fire(n.Events.Names.Drawer.Close);t?n.Events.Fire(n.Events.Names.Funnel.ReFinaliseAllowDuplicateBooking):this._errorService.Exit("FunnelService - DuplicateBooking")},i.prototype.UpdatePassengerDetails=function(t){for(var u,r=this._qService.defer(),f=[],i=0;i<t.length;i++)u={InternalId:t[i].InternalId,Age:t[i].Age,FirstName:t[i].FirstName,LastName:t[i].LastName,Title:t[i].Title,EjPlusNumber:t[i].EjPlusNumber,NifNumber:t[i].NifNumber,SpecialServiceRequestCodes:t[i].SpecialServiceRequestCodes},t[i].Type!==n.Data.Common.PassengerDataType.Infant&&(u.Type=t[i].Type),f.push(u);return this._api.UpdatePassengerDetails(f,this.DeferredSuccess(r),this._errorService.HandleDeferredError(r)),r.promise},i.prototype.UpdateMemberDetails=function(n){var i=this._qService.defer(),t=this._funnelBasketService.GetBasket().BookerDetails,r={Title:t.Title,FirstName:t.FirstName,LastName:t.LastName,Address1:t.Address1,Address2:t.Address2,City:t.City,PostalCode:t.PostalCode,Country:t.ResidentOfValue,CountryIsoCode:t.ResidentOfIsoCode,Telephone:t.Telephone.FullPhoneNumber(),EjPlusNumber:t.EjPlusNumber,AddNewMember:n,OptInForEasyJetMailing:t.OptInForEasyJetMailing,OptInForMailing:t.OptInForMailing,KeepMeSignedInMinutes:t.KeepMeSignedInMinutes};return r.AddNewMember&&(r.Email=t.Email),this._api.UpdateMemberDetails(r,this.DeferredSuccess(i),this._errorService.HandleDeferredError(i)),i.promise},i.prototype.VerifyEjPlusNumber=function(t,i,r,u){var f={LastName:t,CardNumber:i};u||(u=function(){return r(n.Data.Common.EjPlusCardStatus.InvalidNumber)});this._api.VerifyEjPlusNumber(f,function(t){return r(n.Data.Common.EjPlusCardStatus.Parse(t.Status))},u)},i.prototype.RemoveAllSeatsFromAllSegments=function(){if(this._funnelBasketService.ServerBasketExists()){var n=this._funnelBasketExtrasRemovalService.RemoveAllSeatsFromClientBasket();n&&this.UpdateSeatAssignments(this._funnelBasketService.GetBasket().Associations)}},i.prototype.UpdateSeatAssignments=function(n){var t=this._qService.defer(),i=this._funnelAssociationsService.GetSeatAssociationsUpdateRequest(n);return this._api.UpdateSeatAssignments(i,this.DeferredSuccess(t),this._errorService.HandleDeferredError(t)),t.promise},i.prototype.UpdateVoucherAssignments=function(n){var t=this._qService.defer(),i=this._funnelVouchersAssociationsService.GetVouchersAssociationsUpdateRequest(n);return this._api.UpdateVoucherAssignments(i,this.DeferredSuccess(t),this._errorService.HandleDeferredError(t)),t.promise},i.prototype.KeepSessionAlive=function(){var n=this._qService.defer();return this._api.KeepSessionAlive(this.DeferredSuccess(n),this._errorService.HandleDeferredError(n)),n.promise},i.ServiceName="Funnel_Service",i.$inject=["$q","$rootScope","Funnel_Api","Sitecore_FunnelRootSettings","IAnalyticsTracker","FunnelJourneyCookie_Service","Funnel_BasketService","Common_PriceService","Funnel_ErrorService","Funnel_PriceService","FunnelECommerceCookie_Service","Funnel_AssociationsService","Funnel_VouchersAssociationsService","Funnel_BasketExtrasRemovalService"],i}();i.FunnelService=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function r(t,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut){this._rootScope=t;this._qService=r;this._funnelApi=u;this._rootSettings=f;this._funnelQueryCookieService=e;this._searchCookieService=o;this._recentSearchesCookieService=s;this._funnelJourneyCookieService=h;this._funnelBasketService=c;this._availabilityService=l;this._errorService=a;this._funnelCurrencyService=y;this._availabilityCurrencyService=p;this._funnelBasketLuggageService=w;this._funnelDataMapper=b;this._funnelService=k;this._basketFlightSelectionService=d;this._funnelJourneyService=g;this._navigationService=nt;this._clientBasketBuilder=tt;this._searchPassengersSettings=it;this._bookingDataService=rt;this._basketBookingDataMapper=ut;this._routesService=new Main3.Routes.RoutesService(v);this._startedUp=!1;this._flightFaresMapper=new i.Flight.FlightFaresDataMapper;this._rootScope.$on(n.Events.Names.Funnel.ServerBasketCreated,this.OnServerBasketCreated.bind(this))}return r.prototype.StartUp=function(n,t,i,r,u){var e=this,f;if(this._startedUp){console.warn("Funnel start up has already been called, ignoring duplicate");return}this._startedUp=!0;this._includeMemberDetails=n;this._checkEasyJetPlusNumberStatus=t;this._allowFinalizedBasket=r;f=this.DetermineCookieStateAndWhetherIsStartingUpFromDeepLink();f&&(this._funnelQueryCookie=this._funnelQueryCookieService.ReadCookie(),this.SetSearchCookies(this._funnelQueryCookie));this._funnelCurrencyService.EnsureDisplayCurrencyIsUpToDate();this.SignInOrSignUp().then(function(){f?e.InitialiseFunnelWithoutExistingBasket(i,u):e.InitialiseFunnelWithExistingBasket(i)})},r.prototype.DetermineCookieStateAndWhetherIsStartingUpFromDeepLink=function(){var n=!1;return this._funnelQueryCookieService.HasValidCookie()?(this.FunnelJourneyCookieMissing()||!this._funnelBasketService.ServerBasketExists())&&(n=!0):(this._funnelQueryCookie=null,this.FunnelJourneyCookieMissing()&&this._errorService.Exit("FunnelStartupService - FunnelJourneyCookieMissing")),n},r.prototype.InitialiseFunnelWithoutExistingBasket=function(t,i){var r=this;this.HandleMarketGroupQueriesOnUnsupportedPlatforms().then(function(){r.CreateJourneyCookie();r.UpdateApiCorrelationToken();r.EmptyServerBasket().then(function(){r.PreloadGridFlights(t).then(function(t){var u=r.GetPreSelectedFlights(t);r.SetFunnelCurrency(t,u);r.SetUpBasketFromFunnelQuery(u).then(function(){r.RedirectIfInvalidFunnelJourney()||(n.Events.Fire(n.Events.Names.Funnel.FunnelReady),r.ValidatePassengerComposition()&&r.ShouldContinueToNextStep(i,u)&&r.AddPreselectedFlightsToServer(u).then(function(){i()}))})})})})},r.prototype.ValidatePassengerComposition=function(){var t=this._funnelJourneyCookieService.ReadCookie(),u=t.NumberOfAdults,f=t.NumberOfChildren,e=t.NumberOfInfants,r,n;if(i.PassengerComposition.IsChildLimitExceeded(u,f,this._searchPassengersSettings)&&(r=this._funnelJourneyService.GetCurrentStepInJourney(),n=this._funnelJourneyService.GetEditFlightsStepUrl(),!!r&&!!n))if(r.PageUrl!==n)this._navigationService.NavigateTo(n);else return this.OpenTooManyChildrenDrawer(),!1;return!0},r.prototype.OpenTooManyChildrenDrawer=function(){n.Events.OpenDrawerWithOptions({SectionKey:"funnel-change-search",PreventOpenAnimation:!0,Parameters:{NestedDrawer:"too-many-children-for-number-of-adults"}})},r.prototype.AddPreselectedFlightsToServer=function(n){return!n.Outbound&&!n.Return?this._qService.now():this._basketFlightSelectionService.SynchroniseClientBasketWithServer()},r.prototype.InitialiseFunnelWithExistingBasket=function(i){var r=this,u;this._bookingDataService.Expecting(t.Controls.BookingData.BookingDataSource.FunnelBasket);this.UpdateApiCorrelationToken();u=this.PreloadGridFlights(i);this.GetBasket().then(function(t){u.then(function(i){r.OnServerBasketCreated();r._funnelBasketService.SetClientBasket(t);r.SetFunnelBasket(t);r.SetFunnelCurrency(i);r.RedirectIfInvalidFunnelJourney()||n.Events.Fire(n.Events.Names.Funnel.FunnelReady)})})},r.prototype.SetFunnelBasket=function(n){var i=this._basketBookingDataMapper.Map(n);this._bookingDataService.Received(t.Controls.BookingData.BookingDataSource.FunnelBasket,i)},r.prototype.SetFunnelCurrency=function(n,t){var i,r;t===void 0&&(t=null);i=this.GetDeepLinkCurrencyCodeOrNull();i?this._funnelCurrencyService.SetCurrency(i,4):!!t&&(t.Outbound||t.Return)?this._funnelCurrencyService.SetCurrency(t.BaseCurrencyCode,3,!0,2):n.BaseCurrency?this._availabilityCurrencyService.GridFlightsRetrieved(n):(r=this._funnelCurrencyService.GetDefaultCurrencyForRegion(),this._funnelCurrencyService.SetCurrency(r,1))},r.prototype.EmptyServerBasket=function(){var n=this._qService.defer();return this._funnelApi.EmptyBasket(n.resolve,this._errorService.HandleDeferredError(n)),n.promise},r.prototype.PreloadGridFlights=function(n){var t=this._qService.defer(),i;return n?this.PreloadAvailabilityResponseFromJourneyCookie(t):(i={BaseCurrency:null,DepartureIata:null,Flights:[]},t.resolve(i)),t.promise},r.prototype.GetDeepLinkCurrencyCodeOrNull=function(){return this._funnelQueryCookie?this._funnelQueryCookie.CurrencyCode:null},r.prototype.PreloadAvailabilityResponseFromJourneyCookie=function(n){if(this._funnelQueryCookie||!this.FunnelJourneyCookieMissing()){var t=this._funnelJourneyCookieService.ReadCookie(),i=this.GetDeepLinkCurrencyCodeOrNull(),r=i||this._funnelCurrencyService.GetCurrency(3),u={AdditionalSeats:0,AdultSeats:t.NumberOfAdults,ArrivalIata:t.DestinationIata,ChildSeats:t.NumberOfChildren,Infants:t.NumberOfInfants,CurrencyCode:r,DepartureIata:t.OriginIata,IncludeFlexiFares:t.ShowFlexiFares,IncludePrices:!0,IsTransfer:!1,LanguageCode:this._rootSettings.EResLanguageCode,MinDepartureDate:t.OutboundDate.AddDays(-1).ToIso8601(),MaxDepartureDate:t.OutboundDate.AddDays(1).ToIso8601(),MinReturnDate:t.ReturnDate?t.ReturnDate.AddDays(-1).ToIso8601():null,MaxReturnDate:t.ReturnDate?t.ReturnDate.AddDays(1).ToIso8601():null,IncludeLowestFareSeats:!0,IncludeAdminFees:!0};this._availabilityService.FindGridFlights(u,function(t){n.resolve(t)})}},r.prototype.SetSearchCookies=function(n){var t={OriginIata:n.OriginIata,DestinationIata:n.DestinationIata,OutboundDate:n.OutboundDate?n.OutboundDate.ToZonelessDateTime():null,ReturnDate:n.ReturnDate?n.ReturnDate.ToZonelessDateTime():null,Adults:n.NumberOfAdults,Children:n.NumberOfChildren,Infants:n.NumberOfInfants,FlexibleOnDates:!1,SearchDate:moment()};this._searchCookieService.UpdateCookie(t);this._recentSearchesCookieService.UpdateCookie(t)},r.prototype.SignInOrSignUp=function(){var i=this,t=this._qService.defer(),r;return this._includeMemberDetails?(r=this._rootScope.$on(n.Events.Names.Account.DeprecatedSignInStatusChanged,function(n,u,f){i.OnSignInStatusChanged(u,f,r,t)}),this._rootScope.$on(n.Events.Names.Funnel.SignUpContinue,function(n,u){i.OnSignUpContinue(r,t,u)}),this._rootScope.$on(n.Events.Names.Account.GetSignInStatusFailed,function(){i._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Account,Tracking.EventConstants.GenericErrorDrawerLabels.SignInStatusFailed)})):t.resolve(),t.promise},r.prototype.MemberEmailAddressKnown=function(){if(!this.FunnelJourneyCookieMissing()){var n=this._funnelJourneyCookieService.ReadCookie();return n.MemberEmailAddressKnown}return!1},r.prototype.OnSignUpContinue=function(t,i,r){var u=this,f={Username:r,CultureCode:this._rootSettings.SitecoreLanguageCode,LanguageCode:this._rootSettings.EResLanguageCode};this._funnelApi.VerifyUsernameWithForgottenPassword(f,function(f){if(f)n.Events.Fire(n.Events.Names.Funnel.SignUpMemberExists,r);else{u._funnelJourneyCookieService.UpdateCookie(function(n){return n.MemberEmailAddressKnown=!0});var e={EmailAddress:r};u._funnelApi.SetNewMemberEmailAddress(e,function(){t();n.Events.Fire(n.Events.Names.Drawer.Close);i.resolve()},u.DeferredError(i))}},this.DeferredError(i))},r.prototype.DeferredError=function(n){var t=this;return function(i,r,u){t._errorService.HandleApiError(i,r,u);n.reject()}},r.prototype.OnSignInStatusChanged=function(t,i,r,u){if(this.MemberEmailAddressKnown())u.resolve();else if(t||i)t&&!i&&(this._funnelJourneyCookieService.UpdateCookie(function(n){return n.MemberEmailAddressKnown=!0}),r(),u.resolve());else{var f={AfterSignIn:this.AfterSignIn.bind(this),UserInitiatedSignIn:!1},e={SectionKey:"funnel-sign-in-or-sign-up",PreventDismissOverride:!0,Parameters:f};n.Events.OpenDrawerWithOptions(e)}},r.prototype.AfterSignIn=function(){this._rootScope.$emit(n.Events.Names.Drawer.Close)},r.prototype.HandleMarketGroupQueriesOnUnsupportedPlatforms=function(){var t=this,n=this._qService.defer();return Main3.Common.BreakPointService.IsMobile()||this.Ie8OrOlder()?this.HandleMarketGroupQuery(!1).then(function(){t.HandleMarketGroupQuery(!0).then(function(){n.resolve()})}):n.resolve(),n.promise},r.prototype.HandleMarketGroupQuery=function(t){var i=this._qService.defer(),r=t?this._funnelQueryCookie.DestinationIata:this._funnelQueryCookie.OriginIata,u;return!!r&&this._routesService.IsMarketGroup(r)?(u=this.GetMarketGroupDrawerOptions(t,i),n.Events.OpenDrawerWithOptions(u)):i.resolve(),i.promise},r.prototype.GetMarketGroupDrawerOptions=function(t,i){var r=this,u={FilterIata:t?this._funnelQueryCookie.OriginIata:this._funnelQueryCookie.DestinationIata,MarketGroupCode:t?this._funnelQueryCookie.DestinationIata:this._funnelQueryCookie.OriginIata,IsOriginSelection:!t,AfterSelectAction:function(){n.Events.Fire(n.Events.Names.Drawer.Close);i.resolve()},SetOriginAirport:function(n){r._funnelQueryCookie.OriginIata=n.Iata},SetDestinationAirport:function(n){r._funnelQueryCookie.DestinationIata=n.Iata}};return{SectionKey:t?"market-group-destination-drawer":"market-group-origin-drawer",PreventDismissOverride:!0,ShowAfterActionComplete:t,Parameters:u}},r.prototype.FlightMatches=function(n,t,i){if(n.FlightNumber===t){var r=Utilities.TimeAgnosticDate.FromMoment(moment(n.LocalDepartureTime));if(r.Equals(i))return!0}return!1},r.prototype.FlightAvailable=function(n,t){if(n.IsDisrupted)return!1;if(n.HasFares()){var i=_(n.FlightFares).detect(function(n){return n.FareType==t});if(i.SeatsAvailable)return!0}return!1},r.prototype.GetPreSelectedFlights=function(t){var i=this,r={Outbound:null,Return:null,BaseCurrencyCode:null},u;return t&&t.Flights&&(u=this._funnelQueryCookie.ShowFlexiFares?n.Data.Common.FlightFareType.Flexi:n.Data.Common.FlightFareType.Standard,this._funnelQueryCookie.OutboundFlightNumber&&(r.Outbound=_(t.Flights).detect(function(n){return i.FlightAvailable(n,u)&&i.FlightMatches(n,i._funnelQueryCookie.OutboundFlightNumber,i._funnelQueryCookie.OutboundDate)})),this._funnelQueryCookie.ReturnFlightNumber&&(r.Return=_(t.Flights).detect(function(n){return i.FlightAvailable(n,u)&&i.FlightMatches(n,i._funnelQueryCookie.ReturnFlightNumber,i._funnelQueryCookie.ReturnDate)}))),(r.Outbound||r.Return)&&(r.BaseCurrencyCode=t.BaseCurrency),r},r.prototype.SetUpBasketFromFunnelQuery=function(t){var r=this,u=this._funnelQueryCookie.ShowFlexiFares?n.Data.Common.FlightFareType.Flexi:n.Data.Common.FlightFareType.Standard,f={CanBeFinalised:!0,HasBeenFinalised:!1,Currency:this._funnelCurrencyService.GetCurrency(),Passengers:this._clientBasketBuilder.CreateClientBasketPassengerDataFromFunnelQuery(this._funnelQueryCookie.NumberOfAdults,this._funnelQueryCookie.NumberOfChildren),Associations:[],CarriedInfants:this._clientBasketBuilder.CreateClientBasketInfantDataFromFunnelQuery(this._funnelQueryCookie.NumberOfInfants),Luggage:{HoldBags:[],SportsEquipment:[]},FixedCharges:null,FareType:u,BookerDetails:null,JourneyPairs:this._clientBasketBuilder.CreateInitialJourneyPairs(t,this._funnelQueryCookie),FlightItemCharges:[],Hotel:null,Car:null,TravelInsurance:null,BookingReference:null,ReasonForTravelCode:null},i;return this._funnelBasketService.SetClientBasket(f),this._funnelBasketLuggageService.ResetLuggageToDefaults(),!t.Outbound&&!t.Return?(i=this._qService.defer(),this._funnelApi.GetAdminFee(this._funnelCurrencyService.GetCurrency(),this._rootSettings.EResLanguageCode,function(n){var t=r._funnelDataMapper.CreateFixedCharges(n);r._funnelBasketService.GetBasket().FixedCharges=t;i.resolve()},this._errorService.HandleDeferredError(i)),i.promise):this._basketFlightSelectionService.SynchroniseClientBasketWithServer()},r.prototype.OnServerBasketCreated=function(){this._funnelBasketService.SetServerBasketExists();this._funnelQueryCookieService.RemoveCookie()},r.prototype.CreateJourneyCookie=function(){var t=this.PaymentTypeFromFunnelQueryCookie(),i={CorrelationToken:System.Guid.MakeNew(),PaymentType:t,OriginIata:this._funnelQueryCookie.OriginIata,DestinationIata:this._funnelQueryCookie.DestinationIata,OutboundDate:this._funnelQueryCookie.OutboundDate,ReturnDate:this._funnelQueryCookie.ReturnDate,ComponentSender:this._funnelQueryCookie.ComponentSender,ShowFlexiFares:this._funnelQueryCookie.ShowFlexiFares,NumberOfAdults:this._funnelQueryCookie.NumberOfAdults,NumberOfChildren:this._funnelQueryCookie.NumberOfChildren,NumberOfInfants:this._funnelQueryCookie.NumberOfInfants,ActiveJourneyPairId:1,JourneyPairs:[],FunnelJourney:this._funnelQueryCookie.FunnelJourney,UsingFixedJourney:this._funnelQueryCookie.UsingFixedJourney,OpenChangeSearch:this._funnelQueryCookie.OpenSearchPanel};this._funnelJourneyCookieService.WriteCookie(i);n.Events.Fire(n.Events.Names.Funnel.JourneyCookieShowFlexiFaresUpdated)},r.prototype.UpdateApiCorrelationToken=function(){var t=this._funnelJourneyCookieService.ReadCookie();!t||!t.CorrelationToken||(n.Services.BaseApiService.ApiCorrelationToken=t.CorrelationToken)},r.prototype.PaymentTypeFromFunnelQueryCookie=function(){var t=null;return this._funnelQueryCookie&&(this._funnelQueryCookie.PaymentTypeCode==="C"?t=n.Data.Common.PaymentType.CreditCard:this._funnelQueryCookie.PaymentTypeCode==="D"&&(t=n.Data.Common.PaymentType.DebitCard)),t},r.prototype.ShouldContinueToNextStep=function(n,t){if(!n||this._funnelQueryCookie.RemainOnStep1)return!1;var i=!!this._funnelQueryCookie.ReturnDate;return t.Outbound?i&&!t.Return?!1:this._funnelJourneyService.DisableDeepLinkToStepTwo()?!1:!0:!1},r.prototype.GetBasket=function(){var r=this,i=this._qService.defer();return this._includeMemberDetails&&t.Account.AccountService.IsSignedIn==n.Data.Account.SignedInStatus.SignedIn?this._funnelApi.GetBasketWithMemberDetails(function(n){return r.GotBasket(n,i)},this.HandleApiError.bind(this)):this._funnelApi.GetBasket(function(n){return r.GotBasket(n,i)},this.HandleApiError.bind(this)),i.promise},r.prototype.HandleApiError=function(n,t,i){this._errorService.HandleApiError(n,t,i)},r.prototype.GotBasket=function(t,i){var u=this.BasketMissingOrInvalid(t),r;u?this._errorService.Exit("FunnelStartupService - "+u):(r=this.PopulateClientBasketWithJourneyCookie(t),!this._checkEasyJetPlusNumberStatus||!r.BookerDetails||!r.BookerDetails.EjPlusNumber?i.resolve(r):this._funnelService.VerifyEjPlusNumber(r.BookerDetails.LastName,r.BookerDetails.EjPlusNumber,function(n){r.BookerDetails.InitialEjPlusNumberStatus=n;i.resolve(r)},function(){r.BookerDetails.InitialEjPlusNumberStatus=n.Data.Common.EjPlusCardStatus.InvalidNumber;i.resolve(r)}))},r.prototype.PopulateClientBasketWithJourneyCookie=function(n){var i=this,t=this._funnelDataMapper.CreateClientBasket(n),r=this._funnelJourneyCookieService.ReadCookie();return r.JourneyPairs.forEach(function(n){var u=t.JourneyPairs.filter(function(t){return t.Id===n.Id}),r;i.PairExistsInBasket(t.JourneyPairs,n.Id)?(r=i.GetPairFromBasket(t.JourneyPairs,n.Id),r.OutboundSlot.Route=n.OutboundRoute,r.BaseCurrency=n.BaseCurrency,!n.ReturnRoute||(r.ReturnSlot?r.ReturnSlot.Route=n.ReturnRoute:r.ReturnSlot={Route:n.ReturnRoute})):t.JourneyPairs.push({BaseCurrency:n.BaseCurrency,Id:n.Id,IsPrimaryPair:n.IsPrimaryPair,OutboundSlot:{Route:n.OutboundRoute},ReturnSlot:n.ReturnRoute?{Route:n.ReturnRoute}:null})}),this.PopulateClientBasketWithPassengersFromJourneyCookie(t,r),t},r.prototype.PopulateClientBasketWithPassengersFromJourneyCookie=function(t,i){var r;if(this.PassengersNotPopulatedInBasket(t)){for(r=0;r<i.NumberOfAdults;r++)t.Passengers.push(this._clientBasketBuilder.CreateClientBasketPassenger(n.Data.Common.PassengerDataType.Adult));for(r=0;r<i.NumberOfChildren;r++)t.Passengers.push(this._clientBasketBuilder.CreateClientBasketPassenger(n.Data.Common.PassengerDataType.Child));for(r=0;r<i.NumberOfInfants;r++)t.CarriedInfants.push(this._clientBasketBuilder.CreateClientBasketPassenger(n.Data.Common.PassengerDataType.Infant))}},r.prototype.PassengersNotPopulatedInBasket=function(n){return!!n.Passengers&&n.Passengers.length===0},r.prototype.PairExistsInBasket=function(n,t){var i=this.GetBasketPairsById(n,t);return i.length===1},r.prototype.GetPairFromBasket=function(n,t){var i=this.GetBasketPairsById(n,t);return i[0]},r.prototype.GetBasketPairsById=function(n,t){return n.filter(function(n){return n.Id===t})},r.prototype.BasketMissingOrInvalid=function(n){return n?n.HasBeenFinalised&&!this._allowFinalizedBasket?"Finalized basket is not allowed at this step":!n.HasBeenFinalised&&this._allowFinalizedBasket?"Finalized basket is required at this step":!!n.WebsiteRegionCode&&n.WebsiteRegionCode.toUpperCase()!=this._rootSettings.WebsiteRegionCode.toUpperCase()?"WebsiteRegionCode has changed":null:"Basket is null"},r.prototype.FunnelJourneyCookieMissing=function(){return!this._funnelJourneyCookieService.HasCookie()},r.prototype.Ie8OrOlder=function(){return bowser.msie&&bowser.version<9},r.prototype.RedirectIfInvalidFunnelJourney=function(){if(!this._funnelJourneyService.HasValidFunnelJourneySelected()||!this._funnelJourneyService.GetCurrentStepInJourney()){this._funnelJourneyService.UpdateJourneyOnMissingStepOrJourney();var n=this._funnelJourneyService.GetFirstStepUrl();return this._navigationService.NavigateTo(n),!0}return!1},r.ServiceName="Funnel_StartupService",r.$inject=["$rootScope","$q","Funnel_Api","Sitecore_FunnelRootSettings","FunnelQuery_Service","SearchCookie_Service","RecentSearchesCookie_Service","FunnelJourneyCookie_Service","Funnel_BasketService","Availability_AvailabilityService","Funnel_ErrorService","Sitecore_RoutesData","Funnel_CurrencyService","Funnel_AvailabilityCurrencyService","Funnel_BasketLuggageService","Funnel_FunnelDataMapper","Funnel_Service","Funnel_BasketFlightSelectionService","Funnel_JourneyService","Common_NavigationService","Funnel_BasketBuilder","Sitecore_SearchPassengersSettings","Controls_BookingDataService","Controls_FunnelBasketBookingDataMapper"],r}();i.FunnelStartupService=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._funnelBasketService=n;this._priceService=t}return n.prototype.SetVoucherAssignment=function(n,t,i,r,u){var f=this.GetFlightAssociationForPassengerAndFlight(n,t),e;f&&(e={RedeemableAmount:u,Cost:r,CostWithCreditCardFee:r,Quantity:i},f.Vouchers=e)},n.prototype.RemoveVouchersForFlight=function(n){var t=this.GetFlightAssociations().filter(function(t){return t.FlightInternalId===n});t.forEach(function(n){n.Vouchers.Quantity=0})},n.prototype.GetTotalPrice=function(){var n=this.GetVouchersSummaryForAllFlights();return this.BasketHasValidVouchers(n)?this._priceService.Multiply(n.Cost,n.Quantity):this._priceService.NewPrice()},n.prototype.GetVoucherCost=function(){var n=this.GetVouchersSummaryForAllFlights();return this.BasketHasValidVouchers(n)?n.Cost:this._priceService.NewPrice()},n.prototype.GetVoucherRedeemableAmount=function(){var n=this.GetVouchersSummaryForAllFlights();return!!n&&!!n.Cost&&!!n.Quantity&&n.Quantity>0?n.InFlightAmount:this._priceService.NewPrice()},n.prototype.GetVouchersSummaryForAllFlights=function(){var n=this.GetFlightAssociations().filter(function(n){return n.Vouchers?n.Vouchers!=null:!1});return this.GetVouchersSummaryForAssociations(n)},n.prototype.BasketHasValidVouchers=function(n){return!!n&&!!n.Cost&&!!n.Quantity&&n.Quantity>0},n.prototype.GetVouchersSummary=function(n){var t=this.GetFlightAssociations().filter(function(t){return t.Vouchers?t.FlightInternalId===n&&t.Vouchers!=null:!1});return this.GetVouchersSummaryForAssociations(t)},n.prototype.GetVouchersSummaryForAssociations=function(n){if(!!n&&n.length>0){var t={Quantity:0,Cost:this._priceService.NewPrice(n[0].Vouchers.Cost),InFlightAmount:this._priceService.NewPrice(n[0].Vouchers.RedeemableAmount)};return n.forEach(function(n){t.Quantity+=n.Vouchers.Quantity}),t}return{Quantity:0,InFlightAmount:this._priceService.NewPrice(),Cost:this._priceService.NewPrice()}},n.prototype.GetVouchersAssociationsUpdateRequest=function(n){for(var r,i=[],t=0;t<n.length;t++)!n[t].Vouchers||(r={FlightInternalId:n[t].FlightInternalId,PassengerInternalId:n[t].PassengerInternalId,Quantity:n[t].Vouchers.Quantity,VoucherCost:n[t].Vouchers.Cost,VoucherCostWithCreditCardFee:n[t].Vouchers.CostWithCreditCardFee,VoucherRedeemableAmount:n[t].Vouchers.RedeemableAmount},i.push(r));return i},n.prototype.GetFlightAssociations=function(){return this._funnelBasketService.GetBasket().Associations},n.prototype.GetFlightAssociationForPassengerAndFlight=function(n,t){var i=this.GetFlightAssociations().filter(function(i){return n===i.FlightInternalId&&t===i.PassengerInternalId});return i.length===1?i[0]:null},n.prototype.PassengerHasInFlightVouchers=function(n){var t=this._funnelBasketService.GetBasket().Associations,i=t.filter(function(t){return t.PassengerInternalId===n&&!!t.Vouchers&&t.Vouchers.Quantity>0});return i.length>0},n.prototype.ThereAreVouchersInTheBasket=function(){return this.GetFlightAssociations().some(function(n){return!!n.Vouchers&&n.Vouchers.Quantity>0})},n.ServiceName="Funnel_VouchersAssociationsService",n.$inject=["Funnel_BasketService","Common_PriceService"],n}();n.FunnelVouchersAssociationsService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u,f,e,o){this._qService=n;this._funnelService=t;this._funnelBasketService=i;this._passengerService=r;this._associationService=u;this._priceService=f;this._funnelVouchersChargesService=e;this._vouchersSettings=o;this._defaultNumberOfVouchersToAssign=1}return n.prototype.ResetPassengerVouchers=function(){var n=this;this._passengerVouchers.forEach(function(t){t.NumberOfVouchers=n._defaultNumberOfVouchersToAssign;n.UpdatePassengerVouchersInBasket(t)})},n.prototype.UpdatePassengerVouchersOnEveryFlightInTheBasket=function(n,t){var i=this;this._passengerVouchers.forEach(function(r){r.PassengerInternalId===n.PassengerInternalId&&(r.NumberOfVouchers+=t,i.UpdatePassengerVouchersInBasket(r))})},n.prototype.PassengerCanBeAssignedMoreVouchers=function(n){return!this.PassengerVoucherLimitReached(n)},n.prototype.PassengerVoucherLimitReached=function(n){return n.NumberOfVouchers===this._vouchersSettings.MaximumVouchersPerPassenger},n.prototype.AdjustVouchersForPassenger=function(n,t){n.NumberOfVouchers+=t;this.UpdatePassengerVouchersInBasket(n)},n.prototype.PassengerHasVouchersAssigned=function(n){return n.NumberOfVouchers>0},n.prototype.UpdatePassengerVouchersInBasket=function(n){this._associationService.SetVoucherAssignment(n.FlightInternalId,n.PassengerInternalId,n.NumberOfVouchers,this._priceService.GetNumericValue(this._voucherCost),this._priceService.GetNumericValue(this._voucherRedeemableAmount));this.ThereAreVouchersInTheBasket()||this.SaveToServerBasket()},n.prototype.GetTotalNumberOfVouchersAddedToBasket=function(){var n=0;return!this._passengerVouchers||this._passengerVouchers.forEach(function(t){n+=t.NumberOfVouchers}),n},n.prototype.GetTotalNumberOfVouchersAddedToBasketForFlight=function(n){var t=0;return!this._passengerVouchers||this._passengerVouchers.forEach(function(i){i.FlightInternalId===n&&(t+=i.NumberOfVouchers)}),t},n.prototype.RemoveVouchersFromAllPassengers=function(n){this._passengerVouchers.forEach(function(t){t.FlightInternalId===n&&(t.NumberOfVouchers=0)});this._associationService.RemoveVouchersForFlight(n)},n.prototype.Initialise=function(){var t=this,n=this._qService.defer();return this._passengerVouchers=this.InitializePassengers(),this._funnelVouchersChargesService.GetVoucherCharges().then(function(i){t._voucherCost=i.Cost;t._voucherRedeemableAmount=i.InFlightValue;n.resolve()}).catch(function(){n.reject()}),n.promise},n.prototype.SaveToServerBasket=function(){var n=this._qService.defer(),t=this._associationService.GetFlightAssociations();return this._funnelService.UpdateVoucherAssignments(t).then(function(){n.resolve()}),n.promise},n.prototype.GetPassengerVouchers=function(){return this._passengerVouchers},n.prototype.ThereAreVouchersInTheBasket=function(){return this._associationService.ThereAreVouchersInTheBasket()},n.prototype.GetTotalCost=function(){return this._priceService.Multiply(this._voucherCost,this.GetTotalNumberOfVouchersAddedToBasket())},n.prototype.GetTotalCostForFlight=function(n){return this._priceService.Multiply(this._voucherCost,this.GetTotalNumberOfVouchersAddedToBasketForFlight(n))},n.prototype.GetTotalRedeemableAmountPerFlight=function(){return this._priceService.Multiply(this._voucherRedeemableAmount,this.GetNumberOfVouchersPerFlight())},n.prototype.GetTotalRedeemableAmountForFlight=function(n){return this._priceService.Multiply(this._voucherRedeemableAmount,this.GetTotalNumberOfVouchersAddedToBasketForFlight(n))},n.prototype.GetNumberOfVouchersPerFlight=function(){return this.GetTotalNumberOfVouchersAddedToBasket()/this._funnelBasketService.GetFlights().length},n.prototype.GetFlight=function(n){return this._funnelBasketService.GetFlights().filter(function(t){return t.InternalId==n})[0]},n.prototype.InitializePassengers=function(){var n=[],t=this._passengerService.GetPassengersFromBasket(),i=this._funnelBasketService.GetFlights(),r=this._associationService.GetFlightAssociations().filter(function(n){return!!n.Vouchers&&n.Vouchers.Quantity>0});return i.forEach(function(i){t.forEach(function(t){var u=r.filter(function(n){return n.PassengerInternalId===t.InternalId&&n.FlightInternalId===i.InternalId&&!!n.Vouchers&&n.Vouchers.Quantity>0}),f={PassengerInternalId:t.InternalId,NumberOfVouchers:u.length>0?u[0].Vouchers.Quantity:0,FlightInternalId:i.InternalId};n.push(f)})}),n},n.ServiceName="Funnel_VouchersBasketService",n.$inject=["$q","Funnel_Service","Funnel_BasketService","Funnel_PassengerService","Funnel_VouchersAssociationsService","Common_PriceService","Funnel_VouchersPriceService","Sitecore_FunnelVouchersSettings"],n}();n.FunnelVouchersBasketService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._qService=n;this._basketFlightItemChargeService=t;this._funnelPriceService=i}return n.prototype.GetVoucherCharges=function(n){var i=this,t;return n===void 0&&(n=!1),t=this._qService.defer(),this._flightVoucherCharges?t.resolve(this._flightVoucherCharges):this._basketFlightItemChargeService.GetFlightItemCharges(!1,n).then(function(n){if(!n||!n[0].VouchersCost||!n[0].VouchersRedeemableAmount)t.reject();else{var r={Cost:n[0].VouchersCost.Amount,InFlightValue:n[0].VouchersRedeemableAmount.Amount};i._flightVoucherCharges=r;t.resolve(r)}}).catch(function(){t.reject()}),t.promise},n.ServiceName="Funnel_VouchersPriceService",n.$inject=["$q","Funnel_BasketFlightItemChargeService","Funnel_PriceService"],n}();n.FunnelVouchersChargesService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._http=n;this._baseUrl=t.LookAndBookApiUrl}return n.prototype.StoreSearch=function(n){var t=this.BuildSearchUrl(this._baseUrl+"/StoreSearch",n);return this._http.jsonp(t,{responseType:"json"})},n.prototype.BuildSearchUrl=function(n,t){var i=[n,t.TimeStamp,t.Identifier,t.From,t.To,t.OutboundDate,t.ReturnDate,t.NumberOfAdults,t.NumberOfChildren,t.NumberOfInfants,t.FlexibleOnDates,t.Language,t.Currency,t.Source];return i.join("/")+("?ref="+t.Ref+"&callback=JSON_CALLBACK")},n.prototype.StoreBooking=function(n){var t=this.BuildBookingUrl(this._baseUrl+"/StoreBooking",n);return this._http.jsonp(t,{responseType:"json"})},n.prototype.BuildBookingUrl=function(n,t){var i=[n,t.TimeStamp,t.Identifier,t.MemberID,t.Source,t.SeatsSold,t.BookingRef,t.Flights];return i.join("/")+("?ref="+t.Ref)},n.ServiceName="LookAndBookApi",n.$inject=["$http","Sitecore_LookAndBookClientSettings"],n}();n.LookAndBookApi=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=System.Guid,r=function(){function t(n,t,i,r,u,f,e,o){this._lookAndBookApi=n;this._cookieService=t;this._clientSettings=i;this._analyticsApi=r;this._messageCarouselService=u;this._flightCardCarouselMessageSettings=f;this._tracking=e;this._datetimeFormat="YYYY-MM-DD-HH-mm-ss";this._routesService=new Main3.Routes.RoutesService(o);this._identifier=this.GetIdentifier()}return t.prototype.StoreSearch=function(n){var t=this,i=n.From+n.To+n.OutboundDate.ToIso8601()+n.ReturnDate.ToIso8601()+n.FlexibleOnDates+n.IsOneWayJourney+n.Currency+this._identifier,r;i!=this._latestSearchRequest&&(this._latestSearchRequest=i,r=this.GetDataForApiSendSearch(n),this._analyticsApi.Send("search",r,function(i){var r=t.CreateLookAndBookSearchRequest(i,n);t._lookAndBookApi.StoreSearch(r).then(function(n){t.ProcessLookAndBookSearchResponse(n)},t.OnLookAndBookApiError.bind(t))},this.OnStimsonApiError.bind(this)))},t.prototype.CreateLookAndBookSearchRequest=function(n,i){var r=this.GetExpandedRouteData(i);return{Identifier:this._identifier,From:r.Origin,To:r.Destination,OutboundDate:i.OutboundDate.ToIso8601().toString(),ReturnDate:i.IsOneWayJourney?i.OutboundDate.AddDays(-1).ToIso8601():i.ReturnDate.ToIso8601(),NumberOfAdults:i.NumberOfAdults,NumberOfChildren:i.NumberOfChildren,NumberOfInfants:i.NumberOfInfants,FlexibleOnDates:this.GetSafeBoolean(i.FlexibleOnDates),Language:i.Language,Currency:i.Currency,Source:t.SourceValue,TimeStamp:n.Timestamp,Ref:n.AnalyticsId}},t.prototype.StoreBooking=function(n){var t=this,i=n.MemberID+n.SeatsSold+n.Flights+n.BookingRef+this._identifier,r;i!=this._latestBookingRequest&&(this._latestBookingRequest=i,r=this.GetDataForApiSendBooking(n),this._analyticsApi.Send("booking",r,function(i){var r=t.CreateLookAndBookBookingRequest(i,n);t._lookAndBookApi.StoreBooking(r).then(function(n){t.ProcessLookAndBookBookingResponse(n)},t.ProcessLookAndBookBookingResponse.bind(t))},this.OnStimsonApiError.bind(this)))},t.prototype.CreateLookAndBookBookingRequest=function(n,i){return{Identifier:this._identifier,MemberID:i.MemberID,BookingRef:i.BookingRef,Flights:i.Flights,SeatsSold:i.SeatsSold,Source:t.SourceValue,TimeStamp:n.Timestamp,Ref:n.AnalyticsId}},t.prototype.ProcessLookAndBookSearchResponse=function(n){var i=this,t;n.status==200?(t=n.data,t&&t.GridResults&&t.GridResults.forEach(function(n){i.ProcessLookAndBookGridInformation(n)})):this.OnLookAndBookApiError(n)},t.prototype.ProcessLookAndBookBookingResponse=function(n){n.status!==200&&n.status!==0&&this.OnLookAndBookApiError(n)},t.prototype.ProcessLookAndBookGridInformation=function(n){this.ProcessCurrentlyLookingMessage(n.Sector,n.CurrentlyLooking);this.ProcessLastBookedMessage(n.Sector,n.LastBooked)},t.prototype.OnStimsonApiError=function(n,t,i){var r="Stimson | "+n+" | "+t;i&&(r=r+" | "+i);this.LogApiFailure(r)},t.prototype.OnLookAndBookApiError=function(n){var t="LookAndBook | "+n.status+" | "+n.statusText;this.LogApiFailure(t)},t.prototype.LogApiFailure=function(n){this._tracking.TrackEvent(Tracking.EventConstants.Categories.LookAndBook,Tracking.EventConstants.Actions.Error,n)},t.prototype.ProcessCurrentlyLookingMessage=function(t,i){var u=n.Data.Controls.MessageCarousel.MessageKeys.Names.CurrentlyLooking,r;i&&i.Count>0&&i.Message?(r=i.Message,!this._flightCardCarouselMessageSettings||!this._flightCardCarouselMessageSettings.CurrentlyLookingText||(r=this._flightCardCarouselMessageSettings.CurrentlyLookingText.htmlEncode().replace("{amount}",i.Count.toString())),this._messageCarouselService.AddMessage(t,u,r)):this._messageCarouselService.RemoveMessage(t,u)},t.prototype.ProcessLastBookedMessage=function(t,i){var u=n.Data.Controls.MessageCarousel.MessageKeys.Names.LastBooked,r;i&&i.MinutesAgo>0&&i.Message?(r=i.Message,!this._flightCardCarouselMessageSettings||!this._flightCardCarouselMessageSettings.LastBookedText||(r=this._flightCardCarouselMessageSettings.LastBookedText.htmlEncode().replace("{minutes ago}",i.MinutesAgo.toString())),this._messageCarouselService.AddMessage(t,u,r)):this._messageCarouselService.RemoveMessage(t,u)},t.prototype.GetIdentifier=function(){var n=this._cookieService.GetCookie();return n||(n=i.MakeNew().ToString().toLowerCase(),this._cookieService.SetCookie(n)),n.toLowerCase()},t.prototype.GetExpandedRouteData=function(n){var t=this._routesService.GetValidRoutesForMarketGroups(n.From,n.To,n.OutboundDate),i=_.uniq(t.map(function(n){return n.OriginIata})),r=_.uniq(t.map(function(n){return n.DestinationIata}));return{Origin:this.FormatExpandedIata(n.From,i),Destination:this.FormatExpandedIata(n.To,r)}},t.prototype.FormatExpandedIata=function(n,t){if(this._routesService.IsMarketGroup(n)){var i=this.GetSafeMarketGroupCode(n);return i+("_"+t.join("_"))}return n},t.prototype.GetSafeMarketGroupCode=function(n){return n.replace("*","^")},t.prototype.GetSafeBoolean=function(n){return n?"True":"False"},t.prototype.GetDataForApiSendSearch=function(n){var i=[this._identifier,this.GetSafeMarketGroupCode(n.From),this.GetSafeMarketGroupCode(n.To),n.NumberOfAdults,n.NumberOfChildren,n.NumberOfInfants,this.GetSafeBoolean(n.FlexibleOnDates),n.Language,n.Currency,t.SourceValue];return i.join("/")},t.prototype.GetDataForApiSendBooking=function(n){var i=[this._identifier,n.MemberID,n.SeatsSold,n.BookingRef,n.Flights,t.SourceValue];return i.join("/")},t.SourceValue=1,t.ServiceName="LookAndBookService",t.$inject=["LookAndBookApi","LookAndBookCookie_Service","Sitecore_LookAndBookClientSettings","Analytics_Api","Controls_MessageCarouselService","Sitecore_FlightCardCarouselMessageSettings","IAnalyticsTracker","Sitecore_RoutesData",],t}();t.LookAndBookService=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.IsChildLimitExceeded=function(n,t,i){return this.IsChildOnlyBookingLimitExceeded(t,i.MaxNumberOfChildrenInAChildOnlyBooking)&&this.IsChildrenPerAdultLimitExceeded(n,t,i.MaxNumberOfChildrenPerAdult)},n.IsChildOnlyBookingLimitExceeded=function(n,t){return n>t},n.IsChildrenPerAdultLimitExceeded=function(n,t,i){return t>i*n},n}();n.PassengerComposition=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this._funnelHelpingHandMessages=n;this._journeyService=t}return t.prototype.PickFlightsInitialise=function(){n.Events.Fire(n.Events.Names.HelpingHand.SetOriginalText,"")},t.prototype.PickFlightsHelpingHandForEmptyBasket=function(){Main3.Common.BreakPointService.IsMobile()?this.ShowText(this._funnelHelpingHandMessages.MobileHelpingHandPageLoadText,!1):this.ShowText(this._funnelHelpingHandMessages.NonMobileHelpingHandPageLoadText,!0)},t.prototype.PickFlightsHelpingHandForBasketWithReturnSlotThatContainsOnlyOutboundFlight=function(){Main3.Common.BreakPointService.IsMobile()?this.PickFlightsShowAddMobileReturnFlightsHelpingHand():this.ShowText(this._funnelHelpingHandMessages.OutboundFlightSelectedText,!0)},t.prototype.PickFlightsShowAddMobileReturnFlightsHelpingHand=function(){var n={Title:this._funnelHelpingHandMessages.MobileOutboundFlightSelectedText,ButtonText:this._funnelHelpingHandMessages.MobileOutboundFlightSelectedContinueButtonText,ButtonEvent:this.PickFlightsMobileContinueToReturnFlightsButtonClicked.bind(this),ButtonEnabledWatch:function(){return!0}};this.ShowTextWithButton(n)},t.prototype.PickFlightsMobileContinueToReturnFlightsButtonClicked=function(){n.Events.Fire(n.Events.Names.Funnel.ScrollToReturnLeg,!0);this.ShowText(this._funnelHelpingHandMessages.OutboundFlightSelectedText,!1)},t.prototype.PickFlightsHelpingHandForBasketThatContainsOnlyReturnFlight=function(){this.ShowText(this._funnelHelpingHandMessages.ReturnFlightSelectedFirstText,!0)},t.prototype.PickFlightsHelpingHandForInvalidAdditionalFlightPairs=function(n){var t={Title:this._journeyService.GetCurrentStepInJourney().HelpingHandSkipText,ButtonText:this._journeyService.GetCurrentStepInJourney().HelpingHandSkipButtonText,ButtonEvent:n,ButtonEnabledWatch:function(){return!0},IsALink:!0};this.ShowTextWithButton(t)},t.prototype.ShowText=function(t,i){n.Events.Fire(n.Events.Names.HelpingHand.ShowText,t,i)},t.prototype.ShowTextWithButton=function(t){n.Events.Fire(n.Events.Names.HelpingHand.ShowTextWithButton,t)},t.ServiceName="PickFlightsHelpingHand_Service",t.$inject=["Sitecore_HelpingHandMessages","Funnel_JourneyService"],t}();t.PickFlightsHelpingHandService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u,f,e,o,s){this._popUnderSettings=n;this._basketService=t;this._popUnderUrlBuilderService=i;this._tracking=r;this._browserDetectionService=u;this._countryCode=f.IetfLanguageCode;this._navigationService=e;this._log=o;this._window=s}return n.prototype.ShowPopUnder=function(n){this._tracking.TrackEvent(Tracking.EventConstants.Categories.ChooseFlights,Tracking.EventConstants.Actions.PopUnder,this._browserDetectionService.GetBrowserName()+" | "+this._browserDetectionService.GetBrowserVersion());var t=this._window.open(n,"_blank","toolbar=yes,menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes");t==null?this._navigationService.NavigateTo(n):this._navigationService.NavigateTo(this.GetPopUnderUrl())},n.prototype.GetPopUnderUrl=function(){var n=this._popUnderSettings.PopUnderBaseUrl;return this._popUnderUrlBuilderService.BuildFromBaseUrl(n)},n.prototype.ShouldShowPopUnder=function(){return this._popUnderSettings.ShowPopUnder?this._popUnderSettings.PopUnderBaseUrl?this.UsingTouchDevice()?!1:this.CurrentBrowserIsEnabled()?this.NoAdultPassengers()?!1:this.FlightDatesSuggestNoNeedForHotels()?!1:this.MoreThanOneJourneyPair()?!1:this.IsCountryCodeAllowed()?!0:!1:!1:!1:!1},n.prototype.IsCountryCodeAllowed=function(){for(var n=0;n<this._popUnderSettings.AllowedCountryCodes.length;n++)if(this._popUnderSettings.AllowedCountryCodes[n].toLowerCase()===this._countryCode.toLowerCase())return!0;return!1},n.prototype.MoreThanOneJourneyPair=function(){var n=this._basketService.GetJourneyPairs();return n.length>1},n.prototype.UsingTouchDevice=function(){return Main3.Common.BreakPointService.IsMobile()||Main3.Common.BreakPointService.IsTablet()||this._browserDetectionService.IsMobileBrowser()||this._browserDetectionService.IsTabletBrowser()},n.prototype.CurrentBrowserIsEnabled=function(){var n=!1;return this._browserDetectionService.IsChrome()?n=this.CheckBrowserVersions(this._popUnderSettings.EnabledChromeVersions):this._browserDetectionService.IsFirefox()?n=this.CheckBrowserVersions(this._popUnderSettings.EnabledFirefoxVersions):this._browserDetectionService.IsInternetExplorer()?n=this.CheckBrowserVersions(this._popUnderSettings.EnabledInternetExplorerVersions):this._browserDetectionService.IsEdge()?n=this.CheckBrowserVersions(this._popUnderSettings.EnabledMicrosoftEdgeVersions):this._browserDetectionService.IsSafari()&&(n=this.CheckBrowserVersions(this._popUnderSettings.EnabledSafariVersions)),n},n.prototype.CheckBrowserVersions=function(n){return n.indexOf(Math.floor(this._browserDetectionService.GetBrowserVersion()))!==-1},n.prototype.NoAdultPassengers=function(){var n=this._basketService.GetPassengerComposition();return n.Adults<1},n.prototype.FlightDatesSuggestNoNeedForHotels=function(){var n=this._basketService.GetPrimaryJourneyPair(),t=!n.OutboundSlot.Flight?null:n.OutboundSlot.Flight.LocalArrivalTime.Date(),i=!!n.ReturnSlot&&!!n.ReturnSlot.Flight?n.ReturnSlot.Flight.LocalDepartureTime.Date():null;return!!t&&!!i&&(this.FlightDatesAreTheSame(t,i)||this.FlightDatesAreTooFarApart(t,i))?!0:!1},n.prototype.FlightDatesAreTheSame=function(n,t){return t.Equals(n)},n.prototype.FlightDatesAreTooFarApart=function(n,t){return t.DifferenceInDays(n)>this._popUnderSettings.MaxAllowedDurationBetweenFlightsInDays},n.ServiceName="Funnel_PopUnderService",n.$inject=["Sitecore_PopUnderSettings","Funnel_BasketService","Funnel_PopUnderUrlBuilderService","IAnalyticsTracker","Common_BrowserDetectionService","Sitecore_SitecoreLanguageSettings","Common_NavigationService","$log","$window"],n}();n.PopUnderService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._tripLengthIfNoReturnFlight=7;this._basketService=n}return n.prototype.BuildFromBaseUrl=function(n){var e=this._basketService.GetEResLanguageCode(),r=this._basketService.GetPrimaryJourneyPair(),u=r.OutboundSlot.Flight,o=u.ArrivalIata,t=u.LocalArrivalTime.Date(),f=this.GetCheckoutDate(r,t),i=this._basketService.GetPassengerComposition();return n.replace("{LanguageCode}",e).replace("{IataCode}",o).replace("{CheckinDay}",t.Format("DD")).replace("{CheckinYearMonth}",t.Format("YYYY-MM")).replace("{CheckoutDay}",f.Format("DD")).replace("{CheckoutYearMonth}",f.Format("YYYY-MM")).replace("{NumberOfAdults}",i.Adults.toString()).replace("{NumberOfChildren}",""+(i.Children+i.Infants))},n.prototype.GetCheckoutDate=function(n,t){var i=!!n.ReturnSlot;return i?n.ReturnSlot.Flight.LocalDepartureTime.Date():t.AddDays(this._tripLengthIfNoReturnFlight)},n.ServiceName="Funnel_PopUnderUrlBuilderService",n.$inject=["Funnel_BasketService"],n}();n.PopUnderUrlBuilderService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(t){function i(i,r){var u=t.call(this,r.DataRefreshSeconds)||this;return i.$on(n.Events.Names.Funnel.FunnelReady,u.ResetRefreshAll.bind(u)),u}return __extends(i,t),i.ServiceName="Funnel_SyncedRefreshService",i.$inject=["$rootScope","Sitecore_FunnelRootSettings"],i}(t.Common.BaseSyncedRefreshService);i.SyncedRefreshService=r})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){var i=function(n){function t(t,i,r,u,f,e,o){var s=n.call(this,t,u,f,e,"","")||this;return s._dataMapper=i,s._errorService=r,s._qService=o,s}return __extends(t,n),t.prototype.LookupAirPlusFieldsForAccount=function(n){var i=this,r={CompanyAccount:n},t=this._qService.defer();return this.AjaxRequest("POST","uatp/lookupairplusfields",r,function(n){t.resolve(i._dataMapper.ToAirPlusLookupResponse(n))},this.ExtractKnownError(function(n,i,r){t.reject(r)}),"Uatp.LookupAirPlusFields"),t.promise},t.prototype.UpdateAirPlusFields=function(n){var i=this,t=this._qService.defer(),r=this._dataMapper.ToAirPlusUpdateRequestModel(n);return this.AjaxRequest("POST","uatp/updateairplusfields",r,function(n){t.resolve(i._dataMapper.ToAirPlusUpdateResponse(n))},this.ExtractKnownError(function(n,i,r){t.reject(r)}),"Uatp.UpdateAirPlusFields"),t.promise},t.ServiceName="Funnel_AirPlusApiService",t.$inject=["ClientApi_Service","Funnel_AirPlusDataMapper","Funnel_AirPlusErrorService","$http","$httpParamSerializer","IAnalyticsTracker","$q"],t}(n.BaseClientApiService);t.AirPlusApiService=i})(i=t.AirPlus||(t.AirPlus={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n){this._airPlusFieldNameSettings=n}return t.prototype.ToAirPlusUpdateRequestModel=function(n){var t=this;return{AirPlusFieldUpdates:n.AirPlusFields.filter(function(n){return!!n.Value}).map(function(n){return t.ToAirPlusFieldUpdateModel(n)}),BookingReference:n.BookingReference,CompanyAccount:n.CompanyAccount}},t.prototype.ToAirPlusFieldUpdateModel=function(n){var t=n.Value;return{Code:n.Code,Value:n.Value}},t.prototype.ToAirPlusUpdateResponse=function(n){var t=this;return n?{AirPlusFieldUpdateResults:n.AirPlusFieldUpdateResults.map(function(n){return t.ToAirPlusFieldUpdateResult(n)})}:null},t.prototype.ToAirPlusFieldUpdateResult=function(n){return{Code:n.Code,Success:n.Success}},t.prototype.ToAirPlusLookupResponse=function(n){var t=this;return n?{AirPlusFields:n.AirPlusFields.map(function(n){return t.ToAirPlusField(n)})}:null},t.prototype.ToAirPlusField=function(t){return{Code:t.Code,FieldRule:n.Data.Funnel.AirPlus.AirPlusFieldRule.Parse(t.FieldRule),FieldType:n.Data.Funnel.AirPlus.AirPlusFieldType.Parse(t.FieldType),FullName:this.GetFullNameForFieldCode(t.Code),MaxLength:t.MaxLength,MinimumObligatoryFields:t.MinimumObligatoryFields,MinLength:t.MinLength,Value:""}},t.prototype.GetFullNameForFieldCode=function(n){return n==="AE"?this._airPlusFieldNameSettings.AccountingUnitNameText:n==="AK"?this._airPlusFieldNameSettings.ActionCodeNameText:n==="AU"?this._airPlusFieldNameSettings.OrderNumberNameText:n==="BD"?this._airPlusFieldNameSettings.DepartmentDateNameText:n==="DS"?this._airPlusFieldNameSettings.DepartmentCodeNameText:n==="IK"?this._airPlusFieldNameSettings.InternalAccountNameText:n==="KS"?this._airPlusFieldNameSettings.CostCentreNameText:n==="PK"?this._airPlusFieldNameSettings.EmployeeNumberNameText:n==="PR"?this._airPlusFieldNameSettings.ProjectNumberNameText:n==="RZ"?this._airPlusFieldNameSettings.DestinationNameText:""},t.ServiceName="Funnel_AirPlusDataMapper",t.$inject=["Sitecore_AirPlusFieldNameSettings",],t}();t.AirPlusDataMappper=i})(i=t.AirPlus||(t.AirPlus={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(){}return t.prototype.HandleApiError=function(t){t===n.Data.Rebooking.KnownError.AirPlusUpdateNotAvailableForAccount?this.ShowAirPlusErrorDrawer(n.Data.Funnel.AirPlus.AirPlusErrorDrawerType.UpdateNotAvailableError):this.ShowAirPlusErrorDrawer(n.Data.Funnel.AirPlus.AirPlusErrorDrawerType.GenericError)},t.prototype.ShowAirPlusErrorDrawer=function(t){var i={Error:t},r={SectionKey:"airplus-error-drawer",Parameters:i};n.Events.OpenDrawerWithOptions(r)},t.ServiceName="Funnel_AirPlusErrorService",t}();t.AirPlusErrorService=i})(i=t.AirPlus||(t.AirPlus={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){var i=function(n){function t(t,i,r,u){return n.call(this,t,i,r,u,"DA-AVL",Main3.Cookies.CookieConstants.Names.AvailabilityPodIdentifier)||this}return __extends(t,n),t.prototype.GetHeaders=function(){return null},t.prototype.GetCars=function(n,t,i){this.AjaxRequest("GET","cars/getcars",n,t,this.ExtractKnownError(i),"Cars.GetCars",!0)},t.prototype.GetCarQuote=function(n,t,i){this.AjaxRequest("POST","cars/quote",n,t,this.ExtractKnownError(i),"Cars.Quote",!0)},t.prototype.GetStations=function(n,t,i){this.AjaxRequest("GET","cars/stations",n,t,this.ExtractKnownError(i),"Cars.GetStations",!0)},t.ServiceName="Cars_Api",t.$inject=["ClientApi_Service","$http","$httpParamSerializer","IAnalyticsTracker"],t}(n.BaseClientApiService);t.CarsApi=i})(i=t.Cars||(t.Cars={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._carAncillarySettings=n;this._priceService=t}return n.prototype.GetTheBestNCarOffers=function(n,t){var i=[],r;if(!!t&&n>0)for(i.push(this.SortByPriceCheapestFirst(t)[0]),r=0;r<n-1;r++)i.push(this.GetNextBestCarOffer(t,i));return i},n.prototype.SortByPriceCheapestFirst=function(n){return n.sort(this.IsCheaper.bind(this))},n.prototype.IsCheaper=function(n,t){return this._priceService.Compare(n.Price,t.Price)},n.prototype.GetNextBestCarOffer=function(n,t){for(var u,f,i=0,r=this._carAncillarySettings.CarClassesOrder;i<r.length;i++)if(u=r[i],this.CarClassHasNoneOfItsPreferredVehiclesSelected(u,t)&&(f=this.GetMatchingVehicles(n,u),f.length>0))return f[0];return this.GetFirstNotAlreadySelected(n,t)},n.prototype.CarClassHasNoneOfItsPreferredVehiclesSelected=function(n,t){return!n.PreferredVehiclesOrder.some(function(n){return t.some(function(t){return t.CategoryCode===n.VehicleCode})})},n.prototype.GetMatchingVehicles=function(n,t){var i=t.PreferredVehiclesOrder.filter(function(t){return n.some(function(n){return n.CategoryCode===t.VehicleCode})});return i.map(function(t){return n.filter(function(n){return t.VehicleCode===n.CategoryCode})[0]})},n.prototype.GetFirstNotAlreadySelected=function(n,t){return Utilities.Arrays.FirstOrDefault(n,function(n){return!t.some(function(t){return n.CategoryCode===t.CategoryCode})})},n.ServiceName="Cars_CategoriserService",n.$inject=["Sitecore_EuropcarAncillarySettings","Common_PriceService"],n}();n.CarsCategoriserService=t})(t=n.Cars||(n.Cars={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t){this._priceMapper=new n.Common.PriceDataMapper;this._priceService=t}return t.prototype.FromCarModelToCar=function(n){var t=this;return n?{LeadDriverAge:n.LeadDriverAge,LeadDriverPassengerInternalId:n.LeadDriverPassengerInternalId,RateId:n.RateId,CarName:n.CarName,CarCategory:n.CarCategory,CarPrice:this._priceMapper.MapFromApi(n.CarPrice),PickUpDateTime:Utilities.ZonelessDateTime.FromIso8601(n.PickUpDateTime),PickUpStationId:n.PickUpStationId,PickUpLocationName:n.PickUpLocationName,DropOffDateTime:Utilities.ZonelessDateTime.FromIso8601(n.DropOffDateTime),DropOffStationId:n.DropOffStationId,DropOffLocationName:n.DropOffLocationName,SelectedInsuranceOption:this.FromInsuranceModelToInsurance(n.SelectedInsuranceOption),SelectedExtras:n.SelectedEquipment.map(function(n){return{Code:n.Code,IsMandatory:n.IsMandatory,Quantity:n.Quantity,UsesQuantitySelection:n.MultipleItemsAllowed,TotalPrice:t._priceMapper.MapFromApi(n.TotalPrice)}}),BookingDurationDays:n.BookingDurationDays,TotalPrice:this._priceMapper.MapFromApi(n.TotalPrice)}:null},t.prototype.FromInsuranceModelToInsurance=function(n){return!n?null:{GroupId:n.GroupId,Codes:n.Codes,TotalPrice:this._priceMapper.MapFromApi(n.TotalPrice)}},t.prototype.MapApiResponseToCarListData=function(n){return{Cars:this.MapApiResponseToCarsList(n),PickUpStationCode:n.PickUpStationID,DropOffStationCode:n.DropOffStationID,Equipment:this.MapApiResponseToCarsEquipmentList(n)}},t.prototype.MapApiResponseToQuoteData=function(n){return{RateId:n.Car.RateId,Car:this.MapQuoteApiCarToCar(n),Equipment:this.MapQuoteApiResponseToCarsEquipmentList(n),BasicInsuranceOptions:this.MapQuoteApiResponseToCarBasicInsuranceList(n),UpgradeInsuranceOptions:this.MapQuoteApiResponseToCarUpgradeInsuranceList(n)}},t.prototype.MapQuoteApiResponseToCarBasicInsuranceList=function(n){return this.MapInsurance(n.BasicInsuranceOptions)},t.prototype.MapQuoteApiResponseToCarUpgradeInsuranceList=function(n){return this.MapInsurance(n.UpgradeInsuranceOptions)},t.prototype.MapInsurance=function(n){var t=this;return n.map(function(n){return{ExcessWithInsuranceInDisplayCurrency:t._priceMapper.MapFromApi(n.ExcessWithInsuranceInDisplayCurrency),Included:n.Included,Mandatory:n.Mandatory,InsuranceCode:n.InsuranceCode,DailyPriceInDisplayCurrency:t._priceMapper.MapFromApi(n.DailyPriceInDisplayCurrency),TotalPriceInDisplayCurrency:t._priceMapper.MapFromApi(n.TotalPriceInDisplayCurrency)}})},t.prototype.MapQuoteApiResponseToCarsEquipmentList=function(n){return this.MapEquipment(n.EquipmentList)},t.prototype.MapApiResponseToCarsEquipmentList=function(n){return this.MapEquipment(n.EquipmentList)},t.prototype.MapEquipment=function(n){var t=this;return n?n.map(function(n){var i={EquipmentCode:n.EquipmentCode,TotalPrice:t._priceMapper.MapFromApi(n.TotalPrice),DailyPrice:t._priceMapper.MapFromApi(n.DailyPrice)};return!n.MandatoryItem||(i.MandatoryItem=n.MandatoryItem),i}):[]},t.prototype.MapApiResponseToCarsList=function(n){var t=this;return n.Cars.map(function(n){return t.MapApiCarToListCar(n)})},t.prototype.MapApiCarToListCar=function(n){return{RateId:n.RateId,Name:n.SampleCar,DiscountRateString:n.DiscountRate,DiscountRateValue:parseFloat(n.DiscountRate),Doors:n.NumberDoors,Seats:n.NumberSeats,HasAirConditioning:n.AirCon,CategoryCode:n.CategoryCode,IsAutomatic:n.Automatic,MinimumHireAge:n.MinimumAgeForCar,HasMileageLimit:!n.UnlimitedMileage,MileageLimitKilometers:n.IncludedKm,PricePerDay:this._priceMapper.MapFromApi(n.DailyPriceInDisplayCurrency),PriceForBookingDuration:this._priceMapper.MapFromApi(n.TotalPriceInDisplayCurrency),BookingDurationDays:n.RentalPeriodInDays,ImageUrl:Urls.UrlBuilder.MakeSecure(n.ImageRef)}},t.prototype.MapQuoteApiCarToCar=function(n){var t=n.Car;return{Name:t.SampleCar,Doors:t.NumberDoors,Seats:t.NumberSeats,HasAirConditioning:t.AirCon,CategoryCode:t.CategoryCode,CategoryName:t.CategoryName,IsAutomatic:t.Automatic,MinimumHireAge:t.MinimumAgeForCar,HasMileageLimit:!t.UnlimitedMileage,MileageLimitKilometers:t.IncludedKm,PricePerDay:this._priceMapper.MapFromApi(t.DailyPriceInDisplayCurrency),PriceForBookingDuration:this._priceMapper.MapFromApi(t.TotalPriceInDisplayCurrency),PriceWithoutExtrasPerDay:this._priceMapper.MapFromApi(t.CarOnlyDailyPriceInDisplayCurrency),PriceWithoutExtrasForBookingDuration:this._priceMapper.MapFromApi(t.CarOnlyTotalPriceInDisplayCurrency),BookingDurationDays:t.RentalPeriodInDays,ImageUrl:Urls.UrlBuilder.MakeSecure(t.ImageRef)}},t.prototype.MapApiResponseToStationsList=function(n){return n.Stations.map(function(n){return{Name:n.StationName,Code:n.StationCode}})},t.ServiceName="Funnel_CarsDataMapper",t.$inject=["Common_PriceService"],t}();t.CarsDataMapper=i})(i=t.Cars||(t.Cars={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r;(function(i){var r=function(t){function i(n,i){return t.call(this,n,i)||this}return __extends(i,t),i.prototype.HandleApiError=function(n,t,i,r,u){var f=this;u===void 0&&(u=null);this.HandleApiErrorWithAdditionalChecks({HttpCode:n,StatusText:t,KnownError:i,KnownErrorJson:r,KnownErrorCallback:u},function(n){f.HandleCarsAvailability(n);f.HandleCarPriceChanged(n)})},i.prototype.HandleCarsAvailability=function(t){if(t.KnownError===n.Data.Rebooking.KnownError.CarAvailability){var r=JSON.parse(t.KnownErrorJson),i={OverrideId:r.EiErrorDescription,OverrideDoSubmitAction:t.KnownErrorCallback};this._tracker.TrackEvent(Tracking.EventConstants.Categories.Cars,Tracking.EventConstants.Actions.Error,Tracking.EventConstants.Labels.General+" | "+i.OverrideId);n.Events.OpenDrawerWithOptions({SectionKey:"cars-errors",Parameters:i})}},i.prototype.HandleCarPriceChanged=function(t){t.KnownError===n.Data.Rebooking.KnownError.CarPriceChanged&&this.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.GenericErrorDrawerLabels.CarPriceChanged)},i.ServiceName="Cars_ErrorService",i.$inject=["IAnalyticsTracker","Cookies_BaseCookieService"],i}(t.Common.ErrorService);i.CarsErrorService=r})(r=i.Cars||(i.Cars={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._analyticsTracker=n;this._carsSettings=t;this._listEquipment=i.ReadCookie().CarSearchEquipment}return n.prototype.BuildExtrasOptions=function(){for(var u,i=[],f=function(t){var f=n._carsSettings.ExtraOptions.filter(function(n){return n.Code===t.EquipmentCode}),r,u;f&&f.length>0?(r=f[0],u=t.MandatoryItem||!1,i.push({IsMandatory:u,Quantity:u?1:0,DailyPrice:t.DailyPrice,TotalPrice:t.TotalPrice,UsesQuantitySelection:r.UseQuantitySelection||!1,QuantitySelectorSource:_.range(0,r.MaximumQuantity+1),HasMandatoryDrawer:r.MandatoryDrawer!=="00000000-0000-0000-0000-000000000000",Code:r.Code,Name:u?r.MandatoryName:r.Name,PriceLabel:r.PriceLabel,Description:u?r.MandatoryDescription:r.Description,DrawerLinkText:r.MandatoryDrawerLinkText,RentalDetailsSummaryText:r.RentalDetailsSummaryText,MandatoryRentalDetailsSummaryText:r.MandatoryRentalDetailsSummaryText})):n.IsChildSeatEquipmentCode(t.EquipmentCode)||n._analyticsTracker.TrackNonInteractionEvent(Tracking.EventConstants.Categories.Funnel,"Funnel.MissingSitecoreExtra",t.EquipmentCode)},n=this,t=0,r=this._listEquipment;t<r.length;t++)u=r[t],f(u);return i},n.prototype.BuildChildSeatOptions=function(){var t=this,n=[];return!this._carsSettings.ChildSeatSettings.SeatTypes||this._carsSettings.ChildSeatSettings.SeatTypes.length==0?n:(this._carsSettings.ChildSeatSettings.SeatTypes.map(function(i){var r=t._listEquipment.filter(function(n){return n.EquipmentCode===i.Code});r&&r.length>0&&n.push({Quantity:0,Code:i.Code,TotalPrice:r[0].TotalPrice,PricePerDay:r[0].DailyPrice})}),n)},n.prototype.IsChildSeatEquipmentCode=function(n){var t=this._carsSettings.ChildSeatSettings.SeatTypes.filter(function(t){return t.Code===n});return t&&t.length>0},n.prototype.GetSelectedExtraOptionsForQuote=function(n){return n.filter(function(n){return n.Quantity>0}).map(function(n){return{Code:n.Code,Quantity:n.Quantity,PricePerDay:n.DailyPrice,TotalPrice:n.TotalPrice}})},n.prototype.GetSelectedChildSeatOptionsForQuote=function(n){return n.filter(function(n){return n.Quantity>0})},n.prototype.NumberOfSelectedChildSeatsForCode=function(n,t){var i=n.filter(function(n){return n.Code===t})[0];return!i?0:i.Quantity},n.ServiceName="Cars_ExtrasService",n.$inject=["IAnalyticsTracker","Sitecore_CarsSettingsData","FunnelJourneyCookie_Service"],n}();n.CarsExtrasService=t})(t=n.Cars||(n.Cars={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t){this._analyticsTracker=n;this._funnelCarsSettings=t}return t.prototype.BuildInsuranceOptions=function(t,i){var r={Basic:null,Medium:null,Premium:null};return!i||(r.Basic=this.BuildInsuranceGroup(t,i.CarsBasicInsuranceGroupId,n.Data.Funnel.Cars.CarInsuranceTypeIndex.Basic),r.Medium=this.BuildInsuranceGroup(t,i.CarsMediumInsuranceGroupId,n.Data.Funnel.Cars.CarInsuranceTypeIndex.Medium),r.Premium=this.BuildInsuranceGroup(t,i.CarsPremiumInsuranceGroupId,n.Data.Funnel.Cars.CarInsuranceTypeIndex.Premium)),r},t.prototype.BuildInsuranceGroup=function(t,i,r){var e,u,o,f;if(!!i)if(e=t.BasicInsuranceOptions.concat(t.UpgradeInsuranceOptions),u=this._funnelCarsSettings.InsuranceOptions.InsuranceGroups.filter(function(n){return n.Id===i}),u.length>0){if(o=u[0].InsuranceTypes.map(function(n){return n.Code}),f=e.filter(function(n){return o.indexOf(n.InsuranceCode)>-1}),f.length>0)return{Id:u[0].Id,TitleText:u[0].TitleText,DetailsDrawerLinkText:u[0].DetailsDrawerLinkText,Index:r,Options:this.MapToInsuranceOptions(f,u[0],r)};this._analyticsTracker.TrackNonInteractionEvent(Tracking.EventConstants.Categories.Cars,Tracking.EventConstants.Actions.Error,"No codes for "+n.Data.Funnel.Cars.CarInsuranceTypeIndex.ToString(r)+" insurance group not found in API")}else this._analyticsTracker.TrackNonInteractionEvent(Tracking.EventConstants.Categories.Cars,Tracking.EventConstants.Actions.Error,n.Data.Funnel.Cars.CarInsuranceTypeIndex.ToString(r)+" insurance group not found in sitecore");return null},t.prototype.MapToInsuranceOptions=function(n,t,i){var r=this;return n.map(function(n){return r.CreateInsuranceOption(n,t,i)})},t.prototype.CreateInsuranceOption=function(n,t,i){var r=t.InsuranceTypes.filter(function(t){return t.Code===n.InsuranceCode});return{Code:n.InsuranceCode,Description:r[0].Description,VehicleInformationDrawerDescription:r[0].VehicleInformationDrawerDescription,InsuranceSummaryDrawerPolicyIncludesText:r[0].InsuranceSummaryDrawerPolicyIncludesText,Excess:n.ExcessWithInsuranceInDisplayCurrency,PricePerDay:n.DailyPriceInDisplayCurrency,TotalPrice:n.TotalPriceInDisplayCurrency,TypeIndex:i}},t.ServiceName="Cars_InsuranceService",t.$inject=["IAnalyticsTracker","Sitecore_CarsSettingsData"],t}();t.CarsInsuranceService=i})(i=t.Cars||(t.Cars={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n){this._priceService=n}return t.prototype.GetTotalCost=function(n,t,i,r){return!n?this._priceService.NewPrice():this._priceService.Add(n.Car.PriceWithoutExtrasForBookingDuration,this.GetTotalCostOfInsurance(t,function(n){return n.TotalPrice}),this.GetTotalCostOfExtras(i,function(n){return n.TotalPrice}),this.GetTotalCostOfEquipment(r,function(n){return n.TotalPrice}))},t.prototype.GetTotalCostPerDay=function(n,t,i,r){return!n?this._priceService.NewPrice():this._priceService.Add(n.Car.PriceWithoutExtrasPerDay,this.GetTotalCostOfInsurance(t,function(n){return n.PricePerDay}),this.GetTotalCostOfExtras(i,function(n){return n.DailyPrice}),this.GetTotalCostOfEquipment(r,function(n){return n.PricePerDay}))},t.prototype.GetTotalCostOfInsurance=function(t,i){var u=t.filter(function(t){return t.TypeIndex!==n.Data.Funnel.Cars.CarInsuranceTypeIndex.Basic}).map(function(n){return i(n)}),r;return(r=this._priceService).Add.apply(r,u)},t.prototype.GetTotalCostOfExtras=function(n,t){var r=this,u=n.filter(function(n){return n.Quantity>0}).map(function(n){return r._priceService.Multiply(t(n),n.Quantity)}),i;return(i=this._priceService).Add.apply(i,u)},t.prototype.GetTotalCostOfEquipment=function(n,t){var r=this,u=n.filter(function(n){return n.Quantity>0}).map(function(n){return r._priceService.Multiply(t(n),n.Quantity)}),i;return(i=this._priceService).Add.apply(i,u)},t.ServiceName="Cars_PriceService",t.$inject=["Common_PriceService"],t}();t.CarsPriceService=i})(i=t.Cars||(t.Cars={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this._http=n;this._httpParamSerializer=t;this._carsPromotionsApiSettings=i;this._sitecoreLanguageSettings=r}return n.prototype.GetPromotions=function(n){return this.GetPromotionsPromiseInternal(n).then(function(n){return n.data})},n.prototype.GetPromotionsPromiseInternal=function(n){var t={languageCode:this._sitecoreLanguageSettings.SitecoreLanguageCode,countryCode:n},i={method:"GET",url:this._carsPromotionsApiSettings.CarsPromotionsApiPath+"?"+this._httpParamSerializer(t),responseType:"json",withCredentials:!0};return this._http(i)},n.ServiceName="CommonApi_CarsPromotionsApiService",n.$inject=["$http","$httpParamSerializer","CarsPromotions_ApiSettings","Sitecore_SitecoreLanguageSettings"],n}();n.CarsPromotionsApiService=t})(t=n.Common||(n.Common={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e,o){this._api=t;this._funnelApi=i;this._errorService=r;this._qService=u;this._languageSettings=f;this._carDataMapper=o;this._routesService=new Main3.Routes.RoutesService(e);this._priceMapper=new n.Common.PriceDataMapper}return t.prototype.GetCarList=function(n){var i=this,r=this.BuildCarsApiRequest(n),t=this._qService.defer();return this._api.GetCars(r,function(n){var r=i._carDataMapper.MapApiResponseToCarListData(n);t.resolve(r)},function(n,i,r,u){var f=!u?null:u.KnownErrorAdditionalData,e={HttpCode:n,StatusText:i,KnownError:r,KnownErrorJson:f};t.reject(e)}),t.promise},t.prototype.GetQuote=function(n){var i=this,r=this.BuildCarQuoteApiRequest(n),t=this._qService.defer();return this._api.GetCarQuote(r,function(n){var r=i._carDataMapper.MapApiResponseToQuoteData(n);t.resolve(r)},function(n,i,r,u){var f=!u?null:u.KnownErrorAdditionalData,e={HttpCode:n,StatusText:i,KnownError:r,KnownErrorJson:f};t.reject(e)}),t.promise},t.prototype.UpdateCurrentSelectedLeadDriverInternalId=function(n){this._currentSelectedLeadDriverPassengerInternalId=n},t.prototype.GetCurrentSelectedLeadDriverInternalId=function(){return this._currentSelectedLeadDriverPassengerInternalId},t.prototype.GetCurrentSearchQuery=function(n,t){return this._currentSearchQuery||this.SetDefaultSearchQuery(n,t),this._currentSearchQuery},t.prototype.SetDefaultSearchQuery=function(n,t){var i=this.GetDefaultSearchQuery(n,t);this._currentSearchQuery?(this._currentSearchQuery.Currency=i.Currency,this._currentSearchQuery.BaseCurrency=i.BaseCurrency,this._currentSearchQuery.AgeOfDriver=i.AgeOfDriver,this._currentSearchQuery.PickUpIata=i.PickUpIata,this._currentSearchQuery.DropOffIata=i.DropOffIata,this._currentSearchQuery.PickUpStationCode=i.PickUpStationCode,this._currentSearchQuery.DropOffStationCode=i.DropOffStationCode,this._currentSearchQuery.PickUpLocationName=i.PickUpLocationName,this._currentSearchQuery.DropOffLocationName=i.DropOffLocationName,this._currentSearchQuery.PickUpDateTime=i.PickUpDateTime,this._currentSearchQuery.DropOffDateTime=i.DropOffDateTime,this._currentSearchQuery.OriginCountryCode=i.OriginCountryCode,this._currentSearchQuery.IsOneWayFlight=i.IsOneWayFlight,this._currentSearchQuery.IsDefault=i.IsDefault):this._currentSearchQuery=i},t.prototype.GetDefaultSearchQuery=function(n,t){var i=Utilities.Arrays.FirstOrDefault(t.FlightPairs,function(n){return n.IsPrimaryPair}),r=i.OutboundFlight.ArrivalIata,u=!i.ReturnFlight?r:i.ReturnFlight.DepartureIata,f=this.GetDefaultPickupTime(i.OutboundFlight),e=this.GetDefaultDropOffTime(i);return{Currency:t.CurrencyCode,BaseCurrency:i.BaseCurrency,AgeOfDriver:n,PickUpIata:r,PickUpLocationName:this.GetLocationDisplayNameByIata(r),PickUpDateTime:f,DropOffIata:u,DropOffLocationName:this.GetLocationDisplayNameByIata(u),DropOffDateTime:e,OriginCountryCode:this._routesService.FindCountryByIata(i.OutboundFlight.DepartureIata).Code,IsDefault:!0,IsOneWayFlight:!i.ReturnFlight}},t.prototype.GetDefaultPickupTime=function(n){var t=n.LocalArrivalTime.AddMinutes(30);return t.RoundUpToMinuteInterval(5)},t.prototype.GetDefaultDropOffTime=function(n){return n.ReturnFlight?n.ReturnFlight.LocalDepartureTime.AddMinutes(-60):this.GetDefaultPickupTime(n.OutboundFlight).AddDays(1)},t.prototype.GetStationsList=function(n){var i=this,t=this._qService.defer(),r=this._routesService.FindCountryByIata(n),u;return r?(u=this.BuildStationsApiRequest(r,n),this._api.GetStations(u,function(n){var r=i._carDataMapper.MapApiResponseToStationsList(n);t.resolve(r)},function(n,r,u,f){var e=!f?null:f.KnownErrorAdditionalData;i._errorService.HandleApiError(n,r,u,e);t.reject()})):t.reject(),t.promise},t.prototype.GetLocationDisplayNameByIata=function(n){return this._routesService.GetLocationDisplayNameByIata(n)},t.prototype.GetPickUpLocationDisplayName=function(n,t){return n?!!t&&!!n.PickUpStationCode?this.GetLocationDisplayNameByStationCode(n.PickUpStationCode,t):this.GetLocationDisplayNameByIata(n.PickUpIata):""},t.prototype.GetDropOffLocationDisplayName=function(n,t){return n?!!t&&!!n.DropOffStationCode?this.GetLocationDisplayNameByStationCode(n.DropOffStationCode,t):this.GetLocationDisplayNameByIata(n.DropOffIata):""},t.prototype.GetLocationDisplayNameByStationCode=function(n,t){var i=t.filter(function(t){return t.Code===n});return!!i&&i.length===1?i[0].Name:n},t.prototype.BuildCarsApiRequest=function(n){var t={AgeOfDriver:n.AgeOfDriver,OriginCountryCode:n.OriginCountryCode,Locale:this.GetCorrectlyFormattedLocale(),CurrencyCode:n.Currency,BaseCurrencyCode:n.BaseCurrency,PickUpDateTime:n.PickUpDateTime.ToIso8601(),DropOffDateTime:n.DropOffDateTime.ToIso8601()};return n.DropOffStationCode?t.DropOffStation=n.DropOffStationCode:t.DropOffAirport=n.DropOffIata,n.PickUpStationCode?t.PickUpStation=n.PickUpStationCode:t.PickUpAirport=n.PickUpIata,t},t.prototype.BuildCarQuoteApiRequest=function(n){return{RateId:n.RateId,AgeOfDriver:n.AgeOfDriver,Locale:this.GetCorrectlyFormattedLocale(),CurrencyCode:n.Currency,BaseCurrencyCode:n.BaseCurrency,PickUpDateTime:n.PickUpDateTime.ToIso8601(),DropOffDateTime:n.DropOffDateTime.ToIso8601(),PickUpStation:n.PickUpStationCode,DropOffStation:n.DropOffStationCode,Category:n.SelectedCategory,SelectedEquipment:!n.SelectedEquipment?null:n.SelectedEquipment.map(function(n){return{Code:n.Code,Quantity:n.Quantity}}),SelectedInsurance:n.SelectedInsurance}},t.prototype.BuildStationsApiRequest=function(n,t){return{Locale:this.GetCorrectlyFormattedLocale(),CountryCode:n.CarsCode,PickUpIata:t}},t.prototype.GetCorrectlyFormattedLocale=function(){return this._languageSettings.SitecoreLanguageCode.replace("-","_")},t.prototype.UpdateCarToRemoveFromBasket=function(){return this.UpdateCarViaApi({QuoteRequest:null})},t.prototype.UpdateCar=function(n,t,i,r,u,f,e){var o={LeadDriverPassengerInternalId:t,PickUpLocationName:n.PickUpLocationName,DropOffLocationName:n.DropOffLocationName,SelectedInsuranceIsBasic:i,SelectedInsuranceGroupId:u,SelectedInsuranceCodes:r,ExtrasDisplayInformation:f,TotalPriceDisplayed:this._priceMapper.MapToApi(e),QuoteRequest:this.BuildCarQuoteApiRequest(n)};return this.UpdateCarViaApi(o)},t.prototype.UpdateCarViaApi=function(n){var i=this,t=this._qService.defer();return this._funnelApi.UpdateCar(n,function(){!t||t.resolve()},function(n,r,u,f){var e=!f?null:f.KnownErrorAdditionalData;i._errorService.HandleApiError(n,r,u,e);!t||t.reject()}),t.promise},t.ServiceName="Cars_Service",t.$inject=["Cars_Api","Funnel_Api","Cars_ErrorService","$q","Sitecore_LanguageSettings","Sitecore_RoutesData","Funnel_CarsDataMapper"],t}();t.CarsService=i})(i=t.Cars||(t.Cars={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.prototype.GetPassengersWithVouchersForFlight=function(n,t){var i=this.GetPassengerIdsForFlightWithVouchers(n,t);return this.GetMatchingPassengers(i,t)},n.prototype.GetPassengerIdsForFlightWithVouchers=function(n,t){var i=this;return t.Associations.filter(function(t){return t.FlightInternalId===n&&i.AssociationHasValidVouchers(t)}).map(function(n){return n.PassengerInternalId})},n.prototype.GetMatchingPassengers=function(n,t){return t.Passengers.filter(function(t){return n.indexOf(t.InternalId)!==-1})},n.prototype.GetBookingTotalVouchers=function(n){var t=0;return n.Associations.filter(function(n){return!!n.Vouchers}).forEach(function(n){t+=n.Vouchers.Quantity}),t},n.prototype.GetFirstAssociationWithVouchers=function(n){var t=this;return n.Associations.filter(function(n){return t.AssociationHasValidVouchers(n)})[0]},n.prototype.AssociationHasValidVouchers=function(n){return!!n.Vouchers&&n.Vouchers.Quantity>0},n.ServiceName="Funnel_BookingVouchersAssociationsService",n}();n.BookingVouchersAssociationsService=t})(t=n.Confirmation||(n.Confirmation={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function t(n,t,i,r,u,f,e,o){this._tracker=n;this._sitecoreLanguageSettings=t;this._funnelPriceService=i;this._priceService=r;this._funnelECommerceCookieService=u;this._gbpExchangeRates=f;this._basketService=e;this._routesService=new Main3.Routes.RoutesService(o)}return t.prototype.SendAnalytics=function(n,t){var r=this,i;try{this.ShouldSendAnalytics(n.BookingReference)&&(i=this.BuildAnalyticsData(n,t),this._tracker.TrackECommerce(i,function(){r._funnelECommerceCookieService.UpdateCookie(function(t){return t.AlreadySentForBookingRef=n.BookingReference})}))}catch(u){this._tracker.TrackEvent(Tracking.EventConstants.Categories.Funnel,Tracking.EventConstants.Actions.ECommerce,"Fail | "+(u.message||"unknown").substring(0,100))}},t.prototype.ShouldSendAnalytics=function(n){if(this._funnelECommerceCookieService.HasCookie()){var t=this._funnelECommerceCookieService.ReadCookie(),i=t.AlreadySentForBookingRef===n;return!i}return!0},t.prototype.BuildAnalyticsData=function(t,i){var f=this._priceService.GetPaymentType(),e=this._sitecoreLanguageSettings.SitecoreLanguageCode,o=this.GetTotalBasketPrice(i),u=this._funnelECommerceCookieService.ReadCookie(),r={Data:{TransactionId:null,Transaction:null,Items:[],Dimensions:null},PaymentType:f,Basket:t,GbpExchangeRates:this._gbpExchangeRates},s=[new n.DataBuilders.TransactionECommerceDataBuilder(r,e,o),new n.DataBuilders.DimensionsECommerceDataBuilder(r),new n.DataBuilders.FlightECommerceDataBuilder(r,this._routesService),new n.DataBuilders.SeatAvailabilityECommerceDataBuilder(r,u),new n.DataBuilders.PaymentChargeECommerceDataBuilder(r,u),new n.DataBuilders.SeatECommerceDataBuilder(r),new n.DataBuilders.HoldBagsECommerceDataBuilder(r),new n.DataBuilders.SportsEquipmentECommerceDataBuilder(r),new n.DataBuilders.CarsECommerceDataBuilder(r,this._basketService,this._priceService,this._routesService),new n.DataBuilders.HotelsECommerceDataBuilder(r,this._priceService),new n.DataBuilders.InsuranceECommerceDataBuilder(r,this._basketService,this._priceService),new n.DataBuilders.VouchersECommerceDataBuilder(r,this._priceService)];return s.forEach(function(n){return n.AddToData()}),r.Data},t.prototype.GetTotalBasketPrice=function(n){return n?n.TotalPaidPrice:this._funnelPriceService.TotalPrice()},t.ServiceName="Funnel_ECommerceAnalyticsService",t.$inject=["IAnalyticsTracker","Sitecore_SitecoreLanguageSettings","Funnel_PriceService","Common_PriceService","FunnelECommerceCookie_Service","ExchangeRates_GBP","Funnel_BasketService","Sitecore_RoutesData"],t}();n.ECommerceAnalyticsService=t})(t=n.ECommerce||(n.ECommerce={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n){this._data=n.Data;this._paymentType=n.PaymentType;this._basket=n.Basket;this._gbpExchangeRates=n.GbpExchangeRates}return t.prototype.AddItem=function(n,t,i,r,u){var f=this.GetAmountFromPriceObjectWithoutFees(r);this._data.Items.some(function(n){return n.sku===i})?console.log("Duplicate SKUs detected. Only the first item with this SKU will be sent to GA."):this._data.Items.push({category:n,name:t,sku:i,price:this.FormatPriceInGbp(f),quantity:u})},t.prototype.BuildNewPrice=function(t,i){var r={};return r[n.Data.Common.PaymentType.CreditCard]=t,r[n.Data.Common.PaymentType.DebitCard]=i,r},t.prototype.BuildFlightSku=function(n){var t=[];return t.push(n.FlightNumber.toString()),t.push(n.DepartureIata),t.push(n.ArrivalIata),t.push(n.LocalDepartureTime.Date().Format("YYYYMMDD")),t.join(" ")},t.prototype.GetPassengerComposition=function(){var n=Main3.Common.BookingPassengers.CreateFromBasket(this._basket);return n.PassengerComposition()},t.prototype.GetAllFlights=function(){for(var n,t=[],i=0,r=this._basket.JourneyPairs;i<r.length;i++)n=r[i],!n.OutboundSlot||!n.OutboundSlot.Flight||t.push(n.OutboundSlot.Flight),!n.ReturnSlot||!n.ReturnSlot.Flight||t.push(n.ReturnSlot.Flight);return t},t.prototype.GetAmountFromPriceObject=function(n){return n[this._paymentType]},t.prototype.GetAmountFromPriceObjectWithoutFees=function(t){return t[n.Data.Common.PaymentType.DebitCard]},t.prototype.FormatPriceInGbp=function(n){var t=1,i;return this._gbpExchangeRates.hasOwnProperty(this._basket.Currency)&&(t=this._gbpExchangeRates[this._basket.Currency]),i=n*t,i.toFixed(2)},t}();t.BaseECommerceDataBuilder=i})(i=t.DataBuilders||(t.DataBuilders={}))})(i=t.ECommerce||(t.ECommerce={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){var i=function(t){function i(n,i,r,u){var f=t.call(this,n)||this;return f._basketService=i,f._priceService=r,f._routesService=u,f._carHireCategory="Car Hire",f._carHireMediumInsuaranceTrackingCode="Medium",f._carHirePremiumInsuaranceTrackingCode="Premium",f._skuIncrement=1,f}return __extends(i,t),i.prototype.AddToData=function(){!this._basket.Car||(this.AddCarHireItem(),this.AddCarHireInsurance(),this.AddCarHireSelectedExtras())},i.prototype.AddCarHireItem=function(){var n="Car|"+this._basket.Car.CarCategory,t=this._priceService.Divide(this._basket.Car.CarPrice,this._basket.Car.BookingDurationDays);this.AddItem(this._carHireCategory,n,this.GetCarSku(),t,this._basket.Car.BookingDurationDays)},i.prototype.AddCarHireInsurance=function(){var t,i;!this._basket.Car.SelectedInsuranceOption||(t=this.GetSelectedInsuranceLevel(),t!==n.Data.Funnel.Cars.CarInsuranceTypeIndex.Basic&&(i=t===n.Data.Funnel.Cars.CarInsuranceTypeIndex.Medium?this._carHireMediumInsuaranceTrackingCode:this._carHirePremiumInsuaranceTrackingCode,this.AddItem(this._carHireCategory,"CH-INS-"+i,this.GetCarSku(),this._basket.Car.SelectedInsuranceOption.TotalPrice,1)))},i.prototype.AddCarHireSelectedExtras=function(){var r=this._basket.Car.SelectedExtras,n,i,t;if(!!r)for(n=0,i=r;n<i.length;n++)t=i[n],this.AddItem(this._carHireCategory,"CH-"+t.Code,this.GetCarSku(),t.TotalPrice,t.Quantity)},i.prototype.GetCarSku=function(){var n=this.GetArrivalAirportIata()+"|"+this._basket.Car.PickUpStationId+" -"+this._skuIncrement;return this._skuIncrement++,n},i.prototype.GetArrivalAirportIata=function(){return this._basketService.GetPrimaryJourneyPair().OutboundSlot.Flight.ArrivalIata},i.prototype.GetSelectedInsuranceLevel=function(){var t=this._routesService.FindCountryByIata(this.GetArrivalAirportIata()),i=this._basket.Car.SelectedInsuranceOption.GroupId;return i===t.CarsMediumInsuranceGroupId?n.Data.Funnel.Cars.CarInsuranceTypeIndex.Medium:i===t.CarsPremiumInsuranceGroupId?n.Data.Funnel.Cars.CarInsuranceTypeIndex.Premium:n.Data.Funnel.Cars.CarInsuranceTypeIndex.Basic},i}(t.BaseECommerceDataBuilder);t.CarsECommerceDataBuilder=i})(i=t.DataBuilders||(t.DataBuilders={}))})(i=t.ECommerce||(t.ECommerce={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.AddToData=function(){this._data.Dimensions=this.BuildDimensions()},t.prototype.BuildDimensions=function(){return{BasketCurrency:this._basket.Currency,PodIdentifier:MambaCookies.getCookie("CMSPOD"),DateOfFirstFlight:this.GetEarliestFlightDate(),PassengerComposition:this.GetPassengerComposition()}},t.prototype.GetEarliestFlightDate=function(){for(var u,t,n,i=0,r=this.GetAllFlights();i<r.length;i++)u=r[i],t=u.LocalDepartureTime.Date(),n?t.ToSortable()<n.ToSortable()&&(n=t):n=t;return n},t}(n.BaseECommerceDataBuilder);n.DimensionsECommerceDataBuilder=t})(t=n.DataBuilders||(n.DataBuilders={}))})(t=n.ECommerce||(n.ECommerce={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){var i=function(t){function i(n,i){var r=t.call(this,n)||this;return r._routesService=i,r}return __extends(i,t),i.prototype.AddToData=function(){for(var i,n=0,t=this._basket.JourneyPairs;n<t.length;n++)i=t[n],this.AddFlightItemForSlot(i.OutboundSlot,!1),this.AddFlightItemForSlot(i.ReturnSlot,!0)},i.prototype.AddFlightItemForSlot=function(n,t){var i=this.GetPassengerComposition(),s=this._basket.FareType,u;if(n&&n.Flight&&(u=n.Flight.FlightFares.filter(function(n){return n.FareType===s}),u&&u.length>0)){var o=n.Flight,r=u[0].Prices,f=this.BuildFlightName(o,t),e="FLIGHT: "+this.BuildFlightSku(o);!r.Child||r.Adult[0]!==r.Child[0]?(i.Adults>0&&this.AddItem("Flight",f,e+" a",r.Adult,i.Adults),i.Children>0&&this.AddItem("Flight",f,e+" c",r.Child,i.Children)):(i.Adults>0||i.Children>0)&&this.AddItem("Flight",f,e+" a + c",r.Adult,i.Adults+i.Children);i.Infants>0&&this.AddItem("Flight",f,e+" i",r.Infant,i.Infants)}},i.prototype.BuildFlightName=function(t,i){var r=[],u=t.ArrivalIata,f=this._routesService.FindAirportByIata(u);return r.push(u),f&&r.push(f.Name),r.push(t.LocalDepartureTime.Date().Format("DD/MM/YYYY")),this._basket.FareType===n.Data.Common.FlightFareType.Flexi&&r.push("(flexi)"),i?r.push("(Ret)"):r.push("(Out)"),r.join(" ")},i}(t.BaseECommerceDataBuilder);t.FlightECommerceDataBuilder=i})(i=t.DataBuilders||(t.DataBuilders={}))})(i=t.ECommerce||(t.ECommerce={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.AddToData=function(){var n,u,o,t,f;if(this._basket.Luggage.HoldBags){var r=[],h=function(n){var t={weight:n.TotalWeight,isFlexi:n.IsFlexiFareBag,price:n.IsFlexiFareBag?c.BuildNewPrice(0,0):n.TotalPrice,count:n.Quantity},i=r.filter(function(n){return n.weight===t.weight&&n.isFlexi===t.isFlexi});i&&i.length>0?i[0].count+=n.Quantity:r.push(t)},c=this;for(n=0,u=this._basket.Luggage.HoldBags;n<u.length;n++)o=u[n],h(o);for(t=0,f=r;t<f.length;t++){var i=f[t],s="Extra Bag(s) "+i.weight+"kg",e=s;i.isFlexi&&(e=e+" (flexi)");this.AddItem("Luggage",s,e,i.price,i.count)}}},t}(n.BaseECommerceDataBuilder);n.HoldBagsECommerceDataBuilder=t})(t=n.DataBuilders||(n.DataBuilders={}))})(t=n.ECommerce||(n.ECommerce={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){var i=function(t){function i(n,i){var r=t.call(this,n)||this;return r._priceService=i,r}return __extends(i,t),i.prototype.AddToData=function(){if(!!this._basket.Hotel){var n=this._basket.Hotel.Name.substr(0,15),t=this.GetHotelNameString(),i=this.GetHotelPriceInLocalCurrency();this.AddItem("Hotel",t,n,i,1)}},i.prototype.GetHotelPriceInLocalCurrency=function(){var r=this,t=[],n,i;return this._basket.Hotel.Rooms.forEach(function(n){return t.push(n.LocalPrice)}),n=[],t.forEach(function(t){return n.push(r._priceService.NewPrice(t))}),(i=this._priceService).Add.apply(i,n)},i.prototype.FormatPriceInGbp=function(n){var t=1,i;return this._gbpExchangeRates.hasOwnProperty(this._basket.Hotel.LocalCurrencyCode)&&(t=this._gbpExchangeRates[this._basket.Hotel.LocalCurrencyCode]),i=n*t,i.toFixed(2)},i.prototype.GetHotelNameString=function(){var t=this._basket.Hotel.BookingType===n.Data.Common.HotelBookingType.BookNowPayNow?"Pay Now":"Pay Later",i=this._basket.Hotel.CheckInDateTime.Date(),r=this._basket.Hotel.CheckOutDateTime.Date(),u=r.DifferenceInDays(i).toString();return t+" {"+u+"}"},i}(t.BaseECommerceDataBuilder);t.HotelsECommerceDataBuilder=i})(i=t.DataBuilders||(t.DataBuilders={}))})(i=t.ECommerce||(t.ECommerce={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){var i=function(t){function i(n,i,r){var u=t.call(this,n)||this;return u._basketService=i,u._priceService=r,u}return __extends(i,t),i.prototype.AddToData=function(){var n=this,t,i;!this._basket.TravelInsurance||(t=this.GetSku(),this.AddItem("Travel Insurance",this.GetMainProductName(),t+" -1",this._basket.TravelInsurance.Policy.TotalPrice,this._basket.TravelInsurance.InsuredPassengers.length),!this._basket.TravelInsurance.Policy.SelectedExtras||(i=2,this._basket.TravelInsurance.Policy.SelectedExtras.forEach(function(r){n.AddItem("Travel Insurance",n.GetAddOnName(r),t+" -"+i,r.Price,n._basket.TravelInsurance.InsuredPassengers.length);i++})))},i.prototype.GetSku=function(){var n=this._basketService.GetPrimaryJourneyPair();return"INS: "+n.OutboundSlot.Flight.FlightNumber+" "+n.OutboundSlot.Route.OriginIata+" "+n.OutboundSlot.Route.DestinationIata+" "+n.OutboundSlot.Route.Date.ToCompressedString()},i.prototype.GetMainProductName=function(){return"Main Product "+this._basket.TravelInsurance.Policy.ProductName+" "+(this.AnyPassengersOverSixtyFour()?"(65 +)":"")},i.prototype.GetAddOnName=function(n){return"Add On "+n.Name+" "+(this.AnyPassengersOverSixtyFour()?"(65 +)":"")},i.prototype.AnyPassengersOverSixtyFour=function(){return this._basket.TravelInsurance.InsuredPassengers.some(function(t){return t.Type===n.Data.Funnel.TravelInsurance.TravelInsurancePassengerType.Over64})},i}(t.BaseECommerceDataBuilder);t.InsuranceECommerceDataBuilder=i})(i=t.DataBuilders||(t.DataBuilders={}))})(i=t.ECommerce||(t.ECommerce={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){var i=function(t){function i(n,i){var r=t.call(this,n)||this;return r._eCommerceCookie=i,r}return __extends(i,t),i.prototype.AddToData=function(){!this._eCommerceCookie||!this._eCommerceCookie.PaymentAnalytics||this.AddItem("Payment Charge",this.GetName(),this.GetSku(),this.GetPrice(),1)},i.prototype.GetName=function(){switch(this._eCommerceCookie.PaymentAnalytics.Method){case n.Data.Cookies.FunnelPaymentAnalyticsPaymentMethod.DebitCard:return"Debit Card";case n.Data.Cookies.FunnelPaymentAnalyticsPaymentMethod.CreditCard:return"Credit Card";case n.Data.Cookies.FunnelPaymentAnalyticsPaymentMethod.Sepa:return"SEPA";default:return""}},i.prototype.GetSku=function(){return this._eCommerceCookie.PaymentAnalytics.Method===n.Data.Cookies.FunnelPaymentAnalyticsPaymentMethod.Sepa?"SEPA":this._eCommerceCookie.PaymentAnalytics.CardName},i.prototype.GetPrice=function(){var t=0;return this._eCommerceCookie.PaymentAnalytics.Method===n.Data.Cookies.FunnelPaymentAnalyticsPaymentMethod.CreditCard&&(t=this._eCommerceCookie.PaymentAnalytics.CreditCardFee),this.BuildNewPrice(t,t)},i}(t.BaseECommerceDataBuilder);t.PaymentChargeECommerceDataBuilder=i})(i=t.DataBuilders||(t.DataBuilders={}))})(i=t.ECommerce||(t.ECommerce={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(n){function t(t,i){var r=n.call(this,t)||this;return r._eCommerceCookie=i,r}return __extends(t,n),t.prototype.AddToData=function(){var n,t,i;if(!!this._eCommerceCookie&&!!this._eCommerceCookie.SeatingAnalytics&&this._eCommerceCookie.SeatingAnalytics.Flights.length>0)for(n=0,t=this.GetAllFlights();n<t.length;n++)i=t[n],this.AddSeatAvailabilityForFlight(i)},t.prototype.AddSeatAvailabilityForFlight=function(n){var i=new Flights.SegmentId(n.SegmentId).ToString(),t=this.GetFreeSeatsBreakdown(i);!t||this.AddItem("Available-Seats",t,"AVLSEAT: "+this.BuildFlightSku(n),this.BuildNewPrice(0,0),1)},t.prototype.GetFreeSeatsBreakdown=function(n){var i=this,t=this._eCommerceCookie.SeatingAnalytics.Flights.filter(function(t){return t.SegmentId===n});return t.length>0?t[0].Bands.map(function(n){return i.FormatFreeSeatsBand(n)}).join("|"):null},t.prototype.FormatFreeSeatsBand=function(n){var t=n.FreeSeats/n.TotalSeats*100;return"Band"+n.BandId+":"+t.toFixed(0)},t}(n.BaseECommerceDataBuilder);n.SeatAvailabilityECommerceDataBuilder=t})(t=n.DataBuilders||(n.DataBuilders={}))})(t=n.ECommerce||(n.ECommerce={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){var i=function(t){function i(n){return t.call(this,n)||this}return __extends(i,t),i.prototype.AddToData=function(){for(var o,i,f,r=[],s=function(n){if(n&&n.Seat){var u=n.Seat,e=t.CalculatePriceBandId(n),o=t.IsEjPlusAssociation(n)?t.BuildNewPrice(0,0):t.BuildNewPrice(u.PriceWithCreditCardFee,u.Price),i={band:e,rawBand:n.Seat.PriceBandId.toString(),isEjPlus:t.IsEjPlusAssociation(n),comparisonPrice:u.Price,flightInternalId:n.FlightInternalId,price:o,count:1},f=r.filter(function(n){return n.band===i.band&&n.comparisonPrice===i.comparisonPrice&&n.flightInternalId===i.flightInternalId});f&&f.length>0?f[0].count++:r.push(i)}},t=this,u=0,e=this._basket.Associations;u<e.length;u++)o=e[u],s(o);for(i=0,f=r;i<f.length;i++){var n=f[i],h="Seat in Band "+n.band,c=n.band==="F"?"F"+(n.isEjPlus?"0":n.rawBand):n.band;this.AddItem("Seat",h,"SEAT_"+c+": "+this.GetSeatSkuForFlight(n.flightInternalId),n.price,n.count)}},i.prototype.CalculatePriceBandId=function(n){return this.IsFlexiFareBooking()?"F":this.IsEjPlusAssociation(n)?"0":n.Seat.PriceBandId.toString()},i.prototype.IsEjPlusAssociation=function(n){var t=this._basket.Passengers.filter(function(t){return t.InternalId===n.PassengerInternalId});return t&&t.length>0?!!t[0].EjPlusNumber:!1},i.prototype.IsFlexiFareBooking=function(){return this._basket.FareType===n.Data.Common.FlightFareType.Flexi},i.prototype.GetSeatSkuForFlight=function(n){for(var t,i=0,r=this._basket.JourneyPairs;i<r.length;i++){if(t=r[i],!!t.OutboundSlot&&!!t.OutboundSlot.Flight&&t.OutboundSlot.Flight.InternalId===n)return this.BuildFlightSku(t.OutboundSlot.Flight);if(!!t.ReturnSlot&&!!t.ReturnSlot.Flight&&t.ReturnSlot.Flight.InternalId===n)return this.BuildFlightSku(t.ReturnSlot.Flight)}return""},i}(t.BaseECommerceDataBuilder);t.SeatECommerceDataBuilder=i})(i=t.DataBuilders||(t.DataBuilders={}))})(i=t.ECommerce||(t.ECommerce={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){var i=function(t){function i(n){return t.call(this,n)||this}return __extends(i,t),i.prototype.AddToData=function(){var t,e,i,u,o,r,f,n,s;if(this._basket.Luggage.SportsEquipment){for(t=[],e=function(n){var i={type:n.Type,name:n.DisplayName,price:n.Price,count:n.Quantity},r=t.filter(function(n){return n.type===i.type});r&&r.length>0?r[0].count+=i.count:t.push(i)},i=0,u=this._basket.Luggage.SportsEquipment;i<u.length;i++)o=u[i],e(o);for(r=0,f=t;r<f.length;r++)n=f[r],s=n.name,this.AddItem("Sports Equipment",s,this.GetSportEquipmentSkuForType(n.type),n.price,n.count)}},i.prototype.GetSportEquipmentSkuForType=function(t){return t===n.Data.Common.SportsEquipmentType.ToString(n.Data.Common.SportsEquipmentType.GolfBag)?"SEGOLF":t===n.Data.Common.SportsEquipmentType.ToString(n.Data.Common.SportsEquipmentType.Skis)?"SESKBT":t===n.Data.Common.SportsEquipmentType.ToString(n.Data.Common.SportsEquipmentType.Snowboard)?"SESNBD":t===n.Data.Common.SportsEquipmentType.ToString(n.Data.Common.SportsEquipmentType.Bicycle)?"SEBICL":t===n.Data.Common.SportsEquipmentType.ToString(n.Data.Common.SportsEquipmentType.WindsurfingBoard)?"SEWDSF":t===n.Data.Common.SportsEquipmentType.ToString(n.Data.Common.SportsEquipmentType.Firearm)?"SEFIRE":t===n.Data.Common.SportsEquipmentType.ToString(n.Data.Common.SportsEquipmentType.Canoe)?"SECANO":t===n.Data.Common.SportsEquipmentType.ToString(n.Data.Common.SportsEquipmentType.HangGlider)?"SEHANG":t===n.Data.Common.SportsEquipmentType.ToString(n.Data.Common.SportsEquipmentType.OtherSmallSportsEquipment)||t==="Unknown_Small"?"SEOSSE":t==="Unknown_Large"?"SEOLSE":""},i}(t.BaseECommerceDataBuilder);t.SportsEquipmentECommerceDataBuilder=i})(i=t.DataBuilders||(t.DataBuilders={}))})(i=t.ECommerce||(t.ECommerce={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(n){function t(t,i,r){var u=n.call(this,t)||this;return u._languageCode=i,u._totalPrice=r,u}return __extends(t,n),t.prototype.AddToData=function(){this._data.TransactionId=this._basket.BookingReference+"-"+this._languageCode;this._data.Transaction=this.BuildTransaction()},t.prototype.BuildTransaction=function(){return{affiliation:"easyJetWeb-"+this._languageCode,revenue:this.FormatPriceInGbp(this.GetAmountFromPriceObject(this._totalPrice)),shipping:this.FormatPriceInGbp(0),tax:this.FormatPriceInGbp(0)}},t}(n.BaseECommerceDataBuilder);n.TransactionECommerceDataBuilder=t})(t=n.DataBuilders||(n.DataBuilders={}))})(t=n.ECommerce||(n.ECommerce={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(n){function t(t,i){var r=n.call(this,t)||this;return r._priceService=i,r}return __extends(t,n),t.prototype.AddToData=function(){for(var i,n=0,t=this._basket.JourneyPairs;n<t.length;n++)i=t[n],this.AddVouchersToItemForSlot(i.OutboundSlot,!1),this.AddVouchersToItemForSlot(i.ReturnSlot,!0)},t.prototype.AddVouchersToItemForSlot=function(n,t){var i,r;!n||!n.Flight||!this._basket.Associations||(i=this._basket.Associations.filter(function(t){return t.FlightInternalId===n.Flight.InternalId&&!!t.Vouchers}),i.length>0&&(r=i.reduce(function(n,t){return n+t.Vouchers.Quantity},0),this.AddItem("Vouchers",this.VouchersName(t),this.VouchersSku(n.Flight),this._priceService.NewPrice(i[0].Vouchers.CostWithCreditCardFee,i[0].Vouchers.Cost),r)))},t.prototype.VouchersName=function(n){var t="Vouchers: ";return n?t+"Return Flight":t+"Outbound Flight"},t.prototype.VouchersSku=function(n){return"VOUCHERS: "+this.BuildFlightSku(n)},t}(n.BaseECommerceDataBuilder);n.VouchersECommerceDataBuilder=t})(t=n.DataBuilders||(n.DataBuilders={}))})(t=n.ECommerce||(n.ECommerce={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this._qService=n;this._priceService=t;this._funnelBasketService=i;this._basketFlightItemChargeService=r}return n.prototype.GetPrice=function(){var t=this,n=this._qService.defer();return this._basketFlightItemChargeService.GetFlightItemCharges(!1).then(function(i){var r,u,f,e;if(i){if(r=_(i).filter(function(n){return!!n.SmallHoldLuggage&&!!n.SmallHoldLuggage.Amount||!!n.HoldLuggage.Amount}),!r||r.length===0){n.reject();return}u=(e=t._priceService).Add.apply(e,r.map(function(n){return!!n.SmallHoldLuggage&&!!n.SmallHoldLuggage.Amount?n.SmallHoldLuggage.Amount:n.HoldLuggage.Amount}));f=t._priceService.Multiply(u,1/r.length);n.resolve(f)}else n.reject()}),n.promise},n.prototype.IsSelected=function(){var n=this._funnelBasketService.GetBasket();return!!n&&n.Luggage.HoldBags.length>0},n.prototype.IsVisible=function(){return!0},n.prototype.IsCtaVisible=function(){return!0},n.prototype.GetImageSettings=function(n){var t=this._qService.defer();return t.resolve({ExtraImage:n.ExtraImage,ExtraHoverImage:n.ExtraHoverImage,ExtraImageAlternativeText:n.ExtraImageAlternativeText}),t.promise},n.ServiceName="Funnel_ExtraPanelLuggageStrategy",n.$inject=["$q","Common_PriceService","Funnel_BasketService","Funnel_BasketFlightItemChargeService"],n}();n.ExtraPanelLuggageService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u){this._qService=n;this._priceService=t;this._funnelBasketService=i;this._basketFlightItemChargeService=r;this._bypassService=u}return n.prototype.GetPrice=function(){var t=this,n=this._qService.defer();return this._basketFlightItemChargeService.GetFlightItemCharges(!0,!0).then(function(i){if(i&&t.HaveSeatData(i)){var r=i.map(function(n){return n.StandardSeat.Amount}).sort(function(n,i){return t._priceService.Compare(n,i)})[0];n.resolve(r)}else n.reject()},function(){n.reject()}),n.promise},n.prototype.HaveSeatData=function(n){return n.filter(function(n){return n.StandardSeat!=null}).length>0},n.prototype.IsSelected=function(){var n=this._funnelBasketService.GetBasket();return!!n&&_(n.Associations).some(function(n){return!!n.Seat&&!!n.Seat.SeatNumber})},n.prototype.IsVisible=function(){return!this._bypassService.SkipSeatingPage()},n.prototype.IsCtaVisible=function(){return!0},n.prototype.GetImageSettings=function(n){var t=this._qService.defer();return t.resolve({ExtraImage:n.ExtraImage,ExtraHoverImage:n.ExtraHoverImage,ExtraImageAlternativeText:n.ExtraImageAlternativeText}),t.promise},n.ServiceName="Funnel_ExtraPanelSeatsStrategy",n.$inject=["$q","Common_PriceService","Funnel_BasketService","Funnel_BasketFlightItemChargeService","Funnel_BypassService"],n}();n.ExtraPanelSeatsService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this._qService=n;this._priceService=t;this._funnelBasketService=i;this._basketFlightItemChargeService=r}return n.prototype.GetPrice=function(){var t=this,n=this._qService.defer();return this._basketFlightItemChargeService.GetFlightItemCharges(!1).then(function(i){var r,u,f,e;if(i){if(r=_(i).filter(function(n){return!!n.SmallSportsEquipment.Amount}),!!r&&r.length===0){n.reject();return}u=(e=t._priceService).Add.apply(e,r.map(function(n){return n.SmallSportsEquipment.Amount}));f=t._priceService.Multiply(u,1/r.length);n.resolve(f)}else n.reject()}),n.promise},n.prototype.IsSelected=function(){var n=this._funnelBasketService.GetBasket();return!!n&&n.Luggage.SportsEquipment.length>0},n.prototype.IsVisible=function(){return!0},n.prototype.IsCtaVisible=function(){return!0},n.prototype.GetImageSettings=function(n){var t=this._qService.defer();return t.resolve({ExtraImage:n.ExtraImage,ExtraHoverImage:n.ExtraHoverImage,ExtraImageAlternativeText:n.ExtraImageAlternativeText}),t.promise},n.ServiceName="Funnel_ExtraPanelSportsStrategy",n.$inject=["$q","Common_PriceService","Funnel_BasketService","Funnel_BasketFlightItemChargeService"],n}();n.ExtraPanelSportsService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._injector=n}return n.prototype.GetStrategy=function(n){switch(n){case 2:return this._injector.get("Funnel_ExtraPanelSeatsStrategy");case 3:return this._injector.get("Funnel_ExtraPanelLuggageStrategy");case 4:return this._injector.get("Funnel_ExtraPanelSportsStrategy")}return null},n.ServiceName="Funnel_ExtraPanelStrategyService",n.$inject=["$injector"],n}();n.ExtraPanelStrategyService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this.$window=i;this._sce=n;this._analytics=t}return t.prototype.GetTopRowSmartMessage=function(n){var t=this.GetFirstPanelSmartMessage(n);return t?t:this.GetSecondPanelSmartMessage(n)},t.prototype.GetSecondPanelSmartMessage=function(t){var r=this.GetSecondUnselectedPanel(t),i=r?r.SmartMessageSettings:null;return i?(i.tip=n.Data.SmartMessages.SmartMessageTips.BottomRightLongTip,i.LinkAction=this.GetActionForExtra(r),i.OnClose=this.SendGaForClosedSmartMessage.bind(this),i):null},t.prototype.GetFirstPanelSmartMessage=function(t){var r=this.GetFirstUnselectedPanel(t),i=r?r.SmartMessageSettings:null;return i?(i.tip=n.Data.SmartMessages.SmartMessageTips.BottomLeftLongTip,i.LinkAction=this.GetActionForExtra(r),i.OnClose=this.SendGaForClosedSmartMessage.bind(this),i):null},t.prototype.GetActionForExtra=function(n){var t=this;return n?function(){t.SendGaForClickedSmartMessage(n.AnalyticsType);t.$window.location.href=n.AddButtonLink}:function(){t.SendGaForClickedSmartMessage(n.AnalyticsType)}},t.prototype.SendGaForClickedSmartMessage=function(n){this._analytics.TrackEvent(Tracking.EventConstants.Categories.Extras,"Smart Message",n)},t.prototype.SendGaForClosedSmartMessage=function(){this._analytics.TrackEvent(Tracking.EventConstants.Categories.Extras,"Smart Message","{Dismiss}")},t.prototype.GetFirstUnselectedPanel=function(n){return this.GetUnSelectedPanelAtPosition(0,n)},t.prototype.GetSecondUnselectedPanel=function(n){return this.GetUnSelectedPanelAtPosition(1,n)},t.prototype.GetUnSelectedPanelAtPosition=function(n,t){var i=this.GetUnSelectedPanels(t);return i.length>n?i[n]:null},t.prototype.GetUnSelectedPanels=function(n){return _.filter(n,function(n){return!n.IsSelected})},t.ServiceName="Funnel_ExtrasSmartMessagesService",t.$inject=["$sce","IAnalyticsTracker","$window"],t}();t.ExtrasSmartMessagesService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this._funnelExtrasSettings=n;this._funnelBasketService=t}return t.prototype.GetExtraPanelsToDisplay=function(){var i=this._funnelBasketService.GetFareType(),t=this._funnelExtrasSettings.Panels;return i===n.Data.Common.FlightFareType.Flexi&&(t=t.filter(function(n){return n.ShowForFlexi})),t},t.ServiceName="Funnel_ExtrasService",t.$inject=["Sitecore_FunnelExtraSettings","Funnel_BasketService"],t}();t.FunnelExtrasService=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._routesService=new Main3.Routes.RoutesService(n)}return n.prototype.GetAlternativeOriginAirports=function(n,t){var i=this,r=this._routesService.FindAirportByIata(n),u=this._routesService.FindAirportByIata(t),f=this.GetOrderedNearbyAirports(u,r);return f.map(function(n){return{RouteNearbyOrigin:n,Country:i._routesService.GetCountryNameForIata(n.Airport.Iata)}})},n.prototype.GetOrderedNearbyAirports=function(n,t){var i=this._routesService.GetValidNearbyOriginsForDestination(n,t);return i.sort(function(n,t){return n.Nearby.DistanceKm-t.Nearby.DistanceKm}),i.push({Airport:t,Nearby:null}),i},n.ServiceName="Funnel_AlternativeAirportsService",n.$inject=["Sitecore_RoutesData"],n}();n.AlternativeAirportsService=t})(t=n.Flight||(n.Flight={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._funnelBasketService=n;this._priceService=t;this._activePairService=i;this._basketFlightSelectionService=r;this._priceChanges=[];this._unavailableFlights=[]}return t.prototype.HandleJourneyPairFlightChanges=function(n,t,i){this.HandleFlightNotAvailable(t.OutboundSlot,n,!1,t.Id);this.HandleFlightNotAvailable(t.ReturnSlot,n,!0,t.Id);this.HandleJourneyPairPriceChanges(n,t);i&&(this._unavailableFlights.length>0?(this.RemoveUnavailableFlights(),this.OpenFlightUnavailableDrawer(),this.SetFirstUnavailableJourneyPairAsActive()):this._priceChanges.length>0&&(this.OpenPriceChangeDrawer(),this.SetFirstAffectedPriceChangeJourneyPairAsActive()),this.ResetJourneyPairLists(t.Id))},t.prototype.HandleJourneyPairPriceChanges=function(n,t){var i=[],r,u;!t||(r=this.CheckForFlightPriceChange(t.OutboundSlot,n,!1),u=this.CheckForFlightPriceChange(t.ReturnSlot,n,!0),r&&i.push(r),u&&i.push(u));i.length>0&&this.RegisterPriceChanges(i,t.Id)},t.prototype.GetMatchingFlight=function(n,t){var i=!!t&&!!t.Flight;return i?_(n).select(function(n){return n.DepartureIata===t.Flight.DepartureIata})[0]:null},t.prototype.HandleFlightNotAvailable=function(n,t,i,r){!n||!n.Flight||!this.FlightNoLongerAvailable(n,t)||this._unavailableFlights.push({slot:n,isReturnSegment:i,journeyPairId:r})},t.prototype.RemoveUnavailableFlights=function(){var n=_(this._unavailableFlights).map(function(n){return n.slot.Flight});this._basketFlightSelectionService.RemoveFlights(n)},t.prototype.OpenFlightUnavailableDrawer=function(){n.Events.QueueDrawerWithOptions({ShowAfterActionComplete:!0,SectionKey:"flightgrid-notavailable"})},t.prototype.SetFirstAffectedPriceChangeJourneyPairAsActive=function(){this.SetFirstAffectedPairAsActive(this._priceChanges.map(function(n){return n.journeyPairId}))},t.prototype.SetFirstUnavailableJourneyPairAsActive=function(){this.SetFirstAffectedPairAsActive(this._unavailableFlights.map(function(n){return n.journeyPairId}))},t.prototype.SetFirstAffectedPairAsActive=function(n){if(n.length>0){var t=_.min(n);this._activePairService.GetActiveJourneyPair().Id!==t&&this._activePairService.UpdateActiveJourneyPair(t)}},t.prototype.ResetJourneyPairLists=function(){this._unavailableFlights=[];this._priceChanges=[]},t.prototype.FlightNoLongerAvailable=function(n,t){var i=this.GetMatchingFlight(t,n);if(i&&i.HasFares()){var u=this._funnelBasketService.GetFareType(),r=_(i.FlightFares).select(function(n){return _.isEqual(n.FareType,u)});return!r||r.length!==1||!r[0].HasEnoughSeatsForRequiredPassengers}return!0},t.prototype.CheckForFlightPriceChange=function(t,i,r){if(!!t&&!!t.Flight&&!this.FlightNoLongerAvailable(t,i)){var u=this.GetMatchingFlight(i,t);if(u&&u.HasFares()&&this.FlightPricesChanged(t.Flight,u))return{IsOutboundSlot:!r,Slot:t,OldPrices:{Adult:this.GetChargeForBasketFlight(t.Flight,n.Data.Common.PassengerDataType.Adult),Child:this.GetChargeForBasketFlight(t.Flight,n.Data.Common.PassengerDataType.Child)}}}return null},t.prototype.RegisterPriceChanges=function(n,t){var i=this;n=_(n).select(function(n){return!!n});n.length>0&&n.forEach(function(n){i._priceChanges.push({slot:n,journeyPairId:t})})},t.prototype.OpenPriceChangeDrawer=function(){var t=this,i={AcceptButtonEvent:function(){return n.Events.Fire(n.Events.Names.Drawer.Close)}.bind(this),FarePriceChangedSlot:this._priceChanges.sort(function(n,i){return t.CompareIds(n,i)}).map(function(n){return n.slot})};n.Events.OpenDrawerWithOptions({SectionKey:"funnel-basketfarepricechanged",PreventDismissOverride:!0,ShowAfterActionComplete:!0,Parameters:i})},t.prototype.CompareIds=function(n,t){return n.journeyPairId-t.journeyPairId},t.prototype.FlightPricesChanged=function(t,i){if(this.GetCurrentFarePricesFromBasket(t)===null)return!1;var r=this._funnelBasketService.GetPassengerComposition(),u=this.GetChargeForBasketFlight(t,n.Data.Common.PassengerDataType.Adult),f=this.GetChargeForBasketFlight(t,n.Data.Common.PassengerDataType.Child),e=this.GetChargeForApiFlight(i,n.Data.Common.PassengerDataType.Adult),o=this.GetChargeForApiFlight(i,n.Data.Common.PassengerDataType.Child),s=!this.PricesAreEqual(u,e)&&r.Adults>0,h=!this.PricesAreEqual(f,o)&&r.Children>0;return s||h},t.prototype.PricesAreEqual=function(n,t){if(n||t){if(n&&t)return this._priceService.Compare(n,t)===0}else return!0;return!1},t.prototype.GetChargeForApiFlight=function(t,i){var r,u=this._funnelBasketService.GetFareType();return t.FlightFares.forEach(function(t){t.FareType===u&&(i===n.Data.Common.PassengerDataType.Adult?r=t.Prices.Adult:i===n.Data.Common.PassengerDataType.Child&&(r=t.Prices.Child))}),r},t.prototype.GetChargeForBasketFlight=function(t,i){var r=null,u=this.GetCurrentFarePricesFromBasket(t);return u===null?null:(i===n.Data.Common.PassengerDataType.Adult?r=u.Adult:i===n.Data.Common.PassengerDataType.Child&&(r=u.Child),r)},t.prototype.GetCurrentFarePricesFromBasket=function(n){var i=this._funnelBasketService.GetFareType(),t=_(n.FlightFares).select(function(n){return _.isEqual(n.FareType,i)});return t.length>0?t[0].Prices:null},t.ServiceName="Funnel_BasketFlightChangeValidator",t.$inject=["Funnel_BasketService","Common_PriceService","Funnel_ActivePairService","Funnel_BasketFlightSelectionService"],t}();t.BasketFlightChangeValidator=i})(i=t.Flight||(t.Flight={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function i(n,i,r,u,f,e){this._qService=n;this._funnelApi=i;this._priceService=r;this._funnelBasketService=u;this._errorService=f;this._funnelBasketUpdateService=e;this._cacheDurationMilliseconds=6e4;this._basketFlightItemChargesDataMapper=new t.FlightItemChargesDataMapper;this._flightChargesCache=new CacheStore(this._cacheDurationMilliseconds)}return i.prototype.GetFlightItemCharges=function(t,i){var o=this,r,f,u,e;return(i===void 0&&(i=!1),r=this._funnelBasketService.GetBasket(),f=this._funnelBasketService.GetFareType()===n.Data.Common.FlightFareType.Flexi,this.ClientBasketHasChargeData(r))?(u=r.FlightItemCharges,f&&(u=this.RemoveCreditCardFee(u)),e=this._qService.defer(),e.resolve(u),e.promise):this._flightChargesCache.Get(JSON.stringify(r.Associations),function(){return o.GetBasketFlightChargesPromise(f,t,i)})},i.prototype.GetFlightItemChargesFromServer=function(){var t=this._funnelBasketService.GetFareType()===n.Data.Common.FlightFareType.Flexi;return this.GetFlightChargesPromise(t)},i.prototype.GetFlightChargesPromise=function(n){var t=this,e=this._funnelBasketService.GetBasket(),u=this._funnelBasketService.GetCurrencyCode(),f=this._funnelBasketService.GetEResLanguageCode(),r=[],i;return this._funnelBasketService.GetFlights().forEach(function(n){r.push(n.SegmentId)}),i=this._qService.defer(),this._funnelApi.GetFlightCharges(u,f,r,function(r){var u=t._basketFlightItemChargesDataMapper.MapFromBasketFlightChargeListApi(r);t._funnelBasketUpdateService.SetBasketFlightItemCharges(u);n&&(u=t.RemoveCreditCardFee(u));i.resolve(u)},function(n,r,u,f){t._errorService.HandleApiError(n,r,u,f);i.reject()}),i.promise},i.prototype.ClientBasketHasChargeData=function(n){return(n.FlightItemCharges&&_(n.FlightItemCharges).any())?_(this._funnelBasketService.GetFlights()).all(function(t){return _(n.FlightItemCharges).any(function(n){return n.SegmentId===t.SegmentId})}):!1},i.prototype.GetBasketFlightChargesPromise=function(n,t,i){var r=this,u=this._qService.defer();return this._funnelApi.GetBasketFlightsCharges(t,function(t){var i=r._basketFlightItemChargesDataMapper.MapFromBasketFlightChargeListApi(t);r._funnelBasketUpdateService.SetBasketFlightItemCharges(i);n&&(i=r.RemoveCreditCardFee(i));u.resolve(i)},function(n,t,f,e){i||r._errorService.HandleApiError(n,t,f,e);u.reject()}),u.promise},i.prototype.RemoveCreditCardFee=function(n){var t=this;return angular.extend(n).forEach(function(n){n.HoldLuggage.Amount=t._priceService.RemoveCreditCardFee(n.HoldLuggage.Amount);n.SmallHoldLuggage&&(n.SmallHoldLuggage.Amount=t._priceService.RemoveCreditCardFee(n.SmallHoldLuggage.Amount));n.HoldLuggageExcessWeight.Amount=t._priceService.RemoveCreditCardFee(n.HoldLuggageExcessWeight.Amount);n.LargeSportsEquipment.Amount=t._priceService.RemoveCreditCardFee(n.LargeSportsEquipment.Amount);n.SmallSportsEquipment.Amount=t._priceService.RemoveCreditCardFee(n.SmallSportsEquipment.Amount);n.StandardSeat&&(n.StandardSeat.Amount=t._priceService.RemoveCreditCardFee(n.StandardSeat.Amount));n.VouchersCost&&(n.VouchersCost.Amount=t._priceService.RemoveCreditCardFee(n.VouchersCost.Amount));n.VouchersRedeemableAmount&&(n.VouchersRedeemableAmount.Amount=t._priceService.RemoveCreditCardFee(n.VouchersRedeemableAmount.Amount))}),n},i.ServiceName="Funnel_BasketFlightItemChargeService",i.$inject=["$q","Funnel_Api","Common_PriceService","Funnel_BasketService","Funnel_ErrorService","Funnel_BasketUpdateService"],i}();t.BasketFlightItemChargeService=i})(i=t.Flight||(t.Flight={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function i(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){this._qService=n;this._api=t;this._errorService=i;this._availabilityService=r;this._funnelRootSettings=u;this._funnelJourneyCookieService=f;this._funnelBasketService=e;this._funnelBasketLuggageService=o;this._funnelDataMapper=s;this._funnelActivePairService=h;this._funnelCurrencyService=c;this._funnelFlightTemporalProximityService=l;this._funnelAccessibilityService=a;this._funnelBasketTravelInsuranceService=v;this._funnelBasketUpdateService=y;this._funnelCurrencyService.AddPreServerCurrencyUpdateHandler(this.UpdateClientBasketFlightsCurrencies.bind(this))}return i.prototype.UpdateClientBasketFlightsCurrencies=function(n){var i=this,r=this._funnelJourneyCookieService.ReadCookie(),t=[];return this._funnelBasketService.GetJourneyPairs().forEach(function(u){var f=i.UpdateJourneyPairCurrencyOnClient(u,r,n);t.push(f)}),this._qService.all(t)},i.prototype.UpdateJourneyPairCurrencyOnClient=function(n,t,i){var f=this,r=this._qService.defer();if(this._funnelBasketService.JourneyPairHasAnyFlightsSelected(n)){var e=n.OutboundSlot.Flight?n.OutboundSlot.Flight.LocalDepartureTime.Date().ToIso8601():null,u=n.ReturnSlot?n.ReturnSlot.Flight?n.ReturnSlot.Flight.LocalDepartureTime.Date().ToIso8601():null:null,o={AdditionalSeats:0,AdultSeats:t.NumberOfAdults,ArrivalIata:n.OutboundSlot.Route.DestinationIata,ChildSeats:t.NumberOfChildren,Infants:t.NumberOfInfants,CurrencyCode:i,DepartureIata:n.OutboundSlot.Route.OriginIata,IncludeFlexiFares:t.ShowFlexiFares,IncludePrices:!0,IsPartOfReturnJourney:!!n.ReturnSlot&&!!n.ReturnSlot.Flight,IsTransfer:!1,LanguageCode:this._funnelRootSettings.EResLanguageCode,MinDepartureDate:e||u,MaxDepartureDate:e||u,MinReturnDate:u,MaxReturnDate:u,FlightNumbers:this._funnelBasketService.GetFlightsForJourneyPair(n).map(function(n){return n.FlightNumber}),IncludeLowestFareSeats:!1,IncludeAdminFees:n.IsPrimaryPair},s=!n.IsPrimaryPair;s&&(o.BaseCurrencyCode=this._funnelBasketService.GetPrimaryJourneyPair().BaseCurrency);this._availabilityService.FindGridFlights(o,function(t){var i=f._funnelBasketService.GetFareType(),u=t.Flights.filter(function(n){return n.FareTypeIsSelectable(i)});f.RemoveUnavailableFlightsOnClient(n,u);f._funnelBasketUpdateService.UpdateJourneyPairFlights(n,t.Flights);r.resolve()},r.reject)}else r.resolve();return r.promise},i.prototype.RemoveUnavailableFlightsOnClient=function(n,t){for(var f,e=function(n){!n||!n.Flight||t.some(function(t){return t.SegmentId===n.Flight.SegmentId})||(r._funnelBasketUpdateService.RemoveFlightFromSlot(n),r.OpenFlightUnavailableDrawer())},r=this,i=0,u=[n.OutboundSlot,n.ReturnSlot];i<u.length;i++)f=u[i],e(f)},i.prototype.OpenFlightUnavailableDrawer=function(){n.Events.QueueDrawerWithOptions({ShowAfterActionComplete:!0,SectionKey:"flightgrid-notavailable"})},i.prototype.SetFlightForActivePair=function(n,t,i,r){var u=this,f=jQuery.extend(!0,{},this._funnelActivePairService.GetActiveJourneyPair()),e=this._funnelBasketService.GetFareType();return this.SynchroniseServerAfterClientAction(function(){return u._funnelCurrencyService.SetCurrency(u._funnelBasketService.GetCurrencyCode(),3,!1,2),u.PerformActivePairUpdateOnClient(i,n,t,r),u.PostActivePairUpdate(f,n,i,e,r)})},i.prototype.PerformActivePairUpdateOnClient=function(n,t,i,r){var u=this._funnelActivePairService.GetActiveJourneyPair(),e=r===!!u.ReturnSlot,f=this._funnelJourneyCookieService.ReadCookie();e&&this.ResetPairToSearch(u);this._funnelBasketUpdateService.SetPairFlight(u,n,t,f.OriginIata,f.DestinationIata);this._funnelBasketUpdateService.SetFareType(i)},i.prototype.ResetPairToSearch=function(n){var t=this._funnelJourneyCookieService.ReadCookie();this._funnelBasketUpdateService.RemoveFlightFromSlot(n.OutboundSlot);this._funnelBasketUpdateService.RemoveFlightFromSlot(n.ReturnSlot);n.OutboundSlot={Flight:null,Route:{Date:t.OutboundDate,OriginIata:t.OriginIata,DestinationIata:t.DestinationIata}};n.ReturnSlot=t.ReturnDate?{Flight:null,Route:{Date:t.ReturnDate,OriginIata:t.OriginIata,DestinationIata:t.DestinationIata}}:null},i.prototype.PostActivePairUpdate=function(t,i,r,u,f){var s=this,o=[],e;return this._funnelActivePairService.UpdateJourneyCookieFromActiveJourneyPair(),this.QueueClientFlightChangeNotifications(t,u,i,r),this.NotifyAnyTemporalProximityClashes(i),this.ShouldResetBaseCurrencyCodeForActiveJourneyPair(i,t)&&(e=this.ResetBaseCurrencyCodeForActivePair(),o.push(e)),this.ShouldResetInsuranceAndLuggage(u,t,r,i,f)?(e=this.ResetInsuranceAndLuggageOnClient(),o.push(e)):(e=this._funnelBasketLuggageService.RepriceLuggageOnClient(),o.push(e)),n.Events.Fire(n.Events.Names.Basket.HeightModified),this._qService.all(o).then(function(){return s._qService.now()})},i.prototype.QueueClientFlightChangeNotifications=function(t,i,r,u){var o=this._funnelActivePairService.GetActiveJourneyPair(),s=this.GetNumberOfFlights(t)>this.GetNumberOfFlights(o),f=u===n.Data.Common.RouteDirection.Outbound?t.OutboundSlot.Flight:!t.ReturnSlot?null:t.ReturnSlot.Flight,h=(!f?null:f.SegmentId)!==r.SegmentId,e=this._funnelBasketService.GetFareType()!==i;s&&this._funnelAccessibilityService.AlertActivePairFlightsRemoved();e&&this.QueueAlertFareTypeChanged();(h||e)&&(this.QueueFlightAddedOrReplacedAlert(!!f,u),n.Events.Fire(n.Events.Names.Funnel.FlightAddedToBasket))},i.prototype.ShouldResetBaseCurrencyCodeForActiveJourneyPair=function(n,t){return this.IsChangingPrimaryPairRoute(n,t)},i.prototype.ResetBaseCurrencyCodeForActivePair=function(){var t=this._funnelActivePairService.GetActiveJourneyPair();return this._funnelCurrencyService.ResetBaseCurrencyCodeForJourneyPair(t).then(function(){n.Events.Fire(n.Events.Names.AvailabilityFlightsProvider.ForceBasketRefresh,!0)})},i.prototype.ShouldResetInsuranceAndLuggage=function(n,t,i,r,u){var f=this._funnelBasketService.GetFareType()!==n,e=this.IsChangingRoute(t,r,i,u),o=this.PairHasFlightCurrentlyChosen(t,i);return f||e||!o},i.prototype.NotifyAnyTemporalProximityClashes=function(t){this._funnelFlightTemporalProximityService.IsInTemporalProximityToExistingFlightInBasket(t)&&n.Events.QueueDrawer("funnel-short-time-between-flights")},i.prototype.GetNumberOfFlights=function(n){return[n.OutboundSlot,n.ReturnSlot].filter(function(n){return!!n&&!!n.Flight}).length},i.prototype.QueueFlightAddedOrReplacedAlert=function(n,t){n?this._funnelAccessibilityService.QueueFlightReplacedAlert(t,this._funnelBasketService.GetFareType()):this._funnelAccessibilityService.QueueFlightAddedAlert(t,this._funnelBasketService.GetFareType())},i.prototype.QueueAlertFareTypeChanged=function(){this._funnelBasketService.GetFlights().length>1&&this._funnelAccessibilityService.QueueBasketFareUpdatedAlert(this._funnelBasketService.GetFareType())},i.prototype.ResetInsuranceAndLuggageOnClient=function(){var n=this._funnelBasketTravelInsuranceService.HasTravelInsuranceInClientBasket(),t=this._funnelBasketService.BasketContainsLuggage();return(t||n)&&this._funnelAccessibilityService.QueueExtrasRemovedFromBasketAlert(),n&&this._funnelBasketTravelInsuranceService.RemoveSelectedPolicy(),this._funnelBasketLuggageService.ResetLuggageToDefaults()},i.prototype.IsChangingRoute=function(t,i,r,u){var f=r===n.Data.Common.RouteDirection.Return?t.ReturnSlot:t.OutboundSlot,e=!!t.ReturnSlot,o=!u;return!f||e!==o||f.Route.OriginIata!==i.DepartureIata||f.Route.DestinationIata!==i.ArrivalIata},i.prototype.PairHasFlightCurrentlyChosen=function(t,i){var r=i===n.Data.Common.RouteDirection.Return?t.ReturnSlot:t.OutboundSlot;return!!r&&!!r.Flight},i.prototype.IsChangingPrimaryPairRoute=function(n,t){return!this._funnelBasketService.FlightIsOnLegRoute(n,t.OutboundSlot.Route.OriginIata,t.OutboundSlot.Route.DestinationIata)&&t.IsPrimaryPair&&this._funnelBasketService.HasMultipleJourneyPairs()},i.prototype.RemoveAllFlights=function(){var t=this;return this.SynchroniseServerAfterClientAction(function(){for(var u,i=0,r=t._funnelBasketService.GetJourneyPairs();i<r.length;i++)u=r[i],t._funnelBasketUpdateService.RemoveFlightFromSlot(u.OutboundSlot),t._funnelBasketUpdateService.RemoveFlightFromSlot(u.ReturnSlot);return t._funnelAccessibilityService.AlertAllFlightsRemoved(),n.Events.Fire(n.Events.Names.Basket.HeightModified),t.ResetInsuranceAndLuggageOnClient()})},i.prototype.RemoveFlights=function(t){var i=this;return t.length>0?this.SynchroniseServerAfterClientAction(function(){for(var f,r=0,u=t;r<u.length;r++)f=u[r],i._funnelBasketUpdateService.RemoveFlight(f);return n.Events.Fire(n.Events.Names.Basket.HeightModified),i.ResetInsuranceAndLuggageOnClient()}):this._qService.now()},i.prototype.RemoveFlightFromSlot=function(t,i,r){var u=this;return r===void 0&&(r=!1),this.SynchroniseServerAfterClientAction(function(){var f=[],e,o;return u._funnelBasketUpdateService.RemoveFlightFromSlot(t),u._funnelAccessibilityService.QueueFlightRemovedAlert(i),f.push(u.ResetInsuranceAndLuggageOnClient()),u._funnelBasketService.PrimaryJourneyPairHasAnyFlightsSelected()||u._funnelCurrencyService.SetCurrencyPriority(2,3),r&&u.ShouldRemoveActiveJourneyPairDueToFlightRemoval()&&(u._funnelActivePairService.GetActiveJourneyPair().IsPrimaryPair?(e=u._funnelBasketService.GetFirstAdditionalPair(),o=u._funnelCurrencyService.ResetBaseCurrencyCodeForJourneyPair(e).then(function(){u.RemoveActiveJourneyPair()}),f.push(o)):u.RemoveActiveJourneyPair()),u._funnelAccessibilityService.AlertBasketChangedQueue(),n.Events.Fire(n.Events.Names.Basket.HeightModified),u._qService.all(f).then(function(){return u._qService.now()})})},i.prototype.ShouldRemoveActiveJourneyPairDueToFlightRemoval=function(){return this._funnelBasketService.HasMultipleJourneyPairs()&&this._funnelActivePairService.ActivePairHasNoFlights()},i.prototype.RemoveActiveJourneyPair=function(){var t=this._funnelActivePairService.GetActiveJourneyPair();this._funnelBasketUpdateService.RemoveJourneyPair(t.Id);t.IsPrimaryPair&&(this._funnelBasketUpdateService.SetFirstPairAsPrimaryPair(),this._funnelCurrencyService.NotifyUserOfAdminFeeChangeDueToPrimaryPairChange());this._funnelActivePairService.SetLastJourneyPairAsActivePair();this._funnelAccessibilityService.AlertLoadedExistingPair();n.Events.Fire(n.Events.Names.Funnel.ScrollToOutboundLeg)},i.prototype.UpdateFlightPriceBySlot=function(n,t){var i=this;return this.SynchroniseServerAfterClientAction(function(){i._funnelBasketUpdateService.UpdateFlightPriceBySlot(n,t)})},i.prototype.UpdateFlightPricesBySegmentId=function(n){var t=this;return this.SynchroniseServerAfterClientAction(function(){for(var r,i=0,u=n;i<u.length;i++)r=u[i],t._funnelBasketUpdateService.UpdateFlightPriceBySegmentId(r.SegmentId,r.NewPrices.Adult,r.NewPrices.Child)})},i.prototype.RemoveIncompletePairs=function(){var n=this;return this.SynchroniseServerAfterClientAction(function(){n._funnelBasketUpdateService.RemoveIncompletePairs()})},i.prototype.SynchroniseServerAfterClientAction=function(n){var t=this,i=JSON.stringify(this._funnelBasketService.GetBasket()),r=n();return this._qService.when(r).then(function(){var n=JSON.stringify(t._funnelBasketService.GetBasket());return i!==n?t.SynchroniseClientBasketWithServer():t._qService.now()})},i.prototype.HasUpdateInProgress=function(){return this._api.HasAnyRequestsPending()},i.prototype.SynchroniseClientBasketWithServer=function(){var i=this;this.UpdateJourneyCookieRoutePairs();var r=this._qService.defer(),f=this._funnelBasketService.GetJourneyPairs(),u=this._funnelBasketService.GetFareType(),e=f.map(function(n){return i._funnelDataMapper.ConvertToApiJourneyPair(n,u)}),o=this.GetBasketInitializationModel(),s=this._funnelBasketService.HasAnySeatsAssigned();return this._funnelBasketLuggageService.GetLuggageUpdateRequest().then(function(f){var h={BasketInitialization:o,JourneyPairs:e,FareType:n.Data.Common.FlightFareType.ToString(u),UpdateLuggageRequest:f,ClearSeats:!s};i._api.SetBasketJourneyPairs(h,function(n){var u,f;i._funnelBasketService.ServerBasketExists()||(u=i._funnelDataMapper.CreateClientBasket(n),i._funnelBasketService.UpdateClientBasketFromServer(u));f=(new t.FlightItemChargesDataMapper).MapFromBasketFlightChargeListApi(n.FlightItemChargesList);i._funnelBasketUpdateService.SetBasketFlightItemCharges(f);i._funnelAccessibilityService.AlertBasketChangedQueue();r.resolve()},i._errorService.HandleDeferredError(r))},r.reject),r.promise},i.prototype.UpdateJourneyCookieRoutePairs=function(){var n=this._funnelBasketService.GetJourneyPairs();this._funnelJourneyCookieService.UpdateCookie(function(t){t.JourneyPairs=n.map(function(n){return{Id:n.Id,IsPrimaryPair:n.IsPrimaryPair,OutboundRoute:n.OutboundSlot.Route,ReturnRoute:!n.ReturnSlot?null:n.ReturnSlot.Route,BaseCurrency:n.BaseCurrency}})})},i.prototype.GetBasketInitializationModel=function(){var t=this._funnelBasketService.GetBasket();return{LanguageCode:this._funnelRootSettings.EResLanguageCode,CurrencyCode:t.Currency,WebsiteRegionCode:this._funnelRootSettings.WebsiteRegionCode,AdultIds:t.Passengers.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Adult}).map(function(n){return n.InternalId}),ChildIds:t.Passengers.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Child}).map(function(n){return n.InternalId}),InfantIds:t.CarriedInfants.map(function(n){return n.InternalId})}},i.ServiceName="Funnel_BasketFlightSelectionService",i.$inject=["$q","Funnel_Api","Error_Service","Availability_AvailabilityService","Sitecore_FunnelRootSettings","FunnelJourneyCookie_Service","Funnel_BasketService","Funnel_BasketLuggageService","Funnel_FunnelDataMapper","Funnel_ActivePairService","Funnel_CurrencyService","Funnel_FlightTemporalProximityService","Funnel_AccessibilityService","Funnel_TravelInsuranceBasketService","Funnel_BasketUpdateService"],i}();t.BasketFlightSelectionService=i})(i=t.Flight||(t.Flight={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r;(function(i){var r=function(){function i(){this._priceMapper=new t.Common.PriceDataMapper}return i.prototype.MapFromClientToApi=function(t){var i=this;return _(t).map(function(t){return{FareType:n.Data.Common.FlightFareType.ToString(t.FareType),Prices:i._priceMapper.MapFlightPricesToApi(t.Prices),FlightIdentification:t.FlightIdentification}})},i.prototype.MapFromClientToBasePrice=function(t,i){var u=t.filter(function(n){return n.FareType===i}),r=u[0];if(!r.Prices)return 0;if(!!r.Prices.Adult)return r.Prices.Adult[n.Data.Common.PaymentType.Base];if(!!r.Prices.Child)return r.Prices.Child[n.Data.Common.PaymentType.Base];throw new Error("Unable to map a base price - expected to have an Adult or Child price available");},i.prototype.MapFromApiToClient=function(t){var i=this;return _(t).map(function(t){return{FareType:n.Data.Common.FlightFareType.Parse(t.FareType),Prices:i._priceMapper.MapFlightPricesFromApi(t.Prices),FlightIdentification:t.FlightIdentification}})},i.prototype.MapFromResponseToApi=function(n){return _(n).map(function(n){return{FareType:n.FareType,Prices:n.Prices,FlightIdentification:n.FlightIdentification}})},i}();i.FlightFaresDataMapper=r})(r=i.Flight||(i.Flight={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){this._priceMapper=new n.Common.PriceDataMapper}return t.prototype.MapFromBasketFlightChargeListApi=function(n){var t=this,i=[];return n&&_(n).forEach(function(n){var r={SegmentId:n.SegmentId,SmallHoldLuggage:t.MapFromBasketFlightItemChargeApi(n.SmallHoldLuggage),HoldLuggage:t.MapFromBasketFlightItemChargeApi(n.HoldLuggage),HoldLuggageExcessWeight:t.MapFromBasketFlightItemChargeApi(n.HoldLuggageExcessWeight),SmallSportsEquipment:t.MapFromBasketFlightItemChargeApi(n.SmallSportsEquipment),LargeSportsEquipment:t.MapFromBasketFlightItemChargeApi(n.LargeSportsEquipment),StandardSeat:t.MapFromBasketFlightItemChargeApi(n.StandardSeat),VouchersCost:t.MapFromBasketFlightItemChargeApi(n.VouchersCost),VouchersRedeemableAmount:t.MapFromBasketFlightItemChargeApi(n.VouchersRedeemableAmount)};i.push(r)}),i},t.prototype.MapFromBasketFlightItemChargeApi=function(n){return n?{ChargeCode:n.ChargeCode,Amount:this._priceMapper.MapFromNumbers(n.AmountWithCreditCard,n.Amount)}:null},t}();t.FlightItemChargesDataMapper=i})(i=t.Flight||(t.Flight={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this._newFlight=n;this._otherFlights=t;this._temporalProximitySameAirportHours=i;this._temporalProximityDifferentAirportsHours=r;this._closestPastFlight=this.GetClosestPastFlight(n,t);this._closestFutureFlight=this.GetClosestFutureFlight(n,t)}return n.prototype.IsInTemporalProximityToFlightInSameAirport=function(){return this.IsInTemporalProximity(!0,this._temporalProximitySameAirportHours)},n.prototype.IsInTemporalProximityToFlightInDifferentAirport=function(){return this.IsInTemporalProximity(!1,this._temporalProximityDifferentAirportsHours)},n.prototype.IsOverlappingWithAnotherFlight=function(){for(var i,n=0,t=this._otherFlights;n<t.length;n++)if(i=t[n],i.LocalDepartureTime.ToSortable()<this._newFlight.LocalArrivalTime.ToSortable()&&i.LocalArrivalTime.ToSortable()>this._newFlight.LocalDepartureTime.ToSortable())return!0;return!1},n.prototype.IsInTemporalProximity=function(n,t){return!!this._closestPastFlight&&this._closestPastFlight.ArrivalIata===this._newFlight.DepartureIata==n&&this.GetTimeDifferenceInHours(this._closestPastFlight,this._newFlight)<t?!0:!!this._closestFutureFlight&&this._newFlight.ArrivalIata===this._closestFutureFlight.DepartureIata==n&&this.GetTimeDifferenceInHours(this._newFlight,this._closestFutureFlight)<t?!0:!1},n.prototype.GetClosestPastFlight=function(n){var t=this._otherFlights.filter(function(t){return t.LocalArrivalTime.ToSortable()<=n.LocalDepartureTime.ToSortable()});return _.last(_(t).sortBy(function(n){return n.LocalArrivalTime.ToSortable()}))},n.prototype.GetClosestFutureFlight=function(n){var t=this._otherFlights.filter(function(t){return t.LocalDepartureTime.ToSortable()>=n.LocalArrivalTime.ToSortable()});return _.first(_(t).sortBy(function(n){return n.LocalDepartureTime.ToSortable()}))},n.prototype.GetTimeDifferenceInHours=function(n,t){return t.LocalDepartureTime.Difference(n.LocalArrivalTime,Utilities.ZonelessDateTimePart.Hours,!0)},n}();n.FunnelFlightTemporalProximityChecker=t})(t=n.Flight||(n.Flight={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function t(n){this.TemporalProximitySameAirportHours=2;this.TemporalProximityDifferentAirportsHours=24;this._funnelBasketService=n}return t.prototype.IsInTemporalProximityToExistingFlightInBasket=function(n){var t=this.GetChecker(n);return t.IsInTemporalProximityToFlightInSameAirport()||t.IsInTemporalProximityToFlightInDifferentAirport()||t.IsOverlappingWithAnotherFlight()},t.prototype.GetChecker=function(t){var i=this.RemoveFirstInstanceOf(t,this._funnelBasketService.GetFlights());return new n.FunnelFlightTemporalProximityChecker(t,i,this.TemporalProximitySameAirportHours,this.TemporalProximityDifferentAirportsHours)},t.prototype.RemoveFirstInstanceOf=function(n,t){var i=t.filter(function(t){return t.FlightNumber===n.FlightNumber&&t.LocalDepartureTime.ToSortable()===n.LocalDepartureTime.ToSortable()})[0];return _.without(t,i)},t.ServiceName="Funnel_FlightTemporalProximityService",t.$inject=["Funnel_BasketService"],t}();n.FunnelFlightTemporalProximityService=t})(t=n.Flight||(n.Flight={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._qService=n;this._funnelJourneyCookieService=t;this._recentSearchesCookieService=i;this._searchCookieService=r}return t.prototype.UpdateGrid=function(t){this.EnsureDates(t);this.SetJourneyCookieForRoutes(t);this.UpdateSearchCookies(t);n.Events.Fire(n.Events.Names.Funnel.JourneyCookieRouteUpdated)},t.prototype.SetJourneyCookieForRoutes=function(n){var t=this._funnelJourneyCookieService.ReadCookie();t.OriginIata=n.OriginIata;t.DestinationIata=n.DestinationIata;t.OutboundDate=n.OutboundDate;t.ReturnDate=n.IsOneWayFlight?null:n.ReturnDate;this._funnelJourneyCookieService.WriteCookie(t)},t.prototype.UpdateSearchCookies=function(n){var t={OriginIata:n.OriginIata,DestinationIata:n.DestinationIata,OutboundDate:n.OutboundDate.ToZonelessDateTime(),ReturnDate:n.IsOneWayFlight?null:n.ReturnDate.ToZonelessDateTime(),Adults:n.Adults,Children:n.Children,Infants:n.Infants,FlexibleOnDates:!1,SearchDate:moment()};this._recentSearchesCookieService.UpdateCookie(t);this._searchCookieService.UpdateCookie(t)},t.prototype.EnsureDates=function(n){var r=this._funnelJourneyCookieService.ReadCookie(),i=r.OutboundDate,t=n.IsOneWayFlight?null:r.ReturnDate;n.OutboundDate&&(i=n.OutboundDate,t&&n.OutboundDate.ToSortable()>t.ToSortable()&&(t=i));n.ReturnDate&&(t=n.IsOneWayFlight?null:n.ReturnDate,t&&t.ToSortable()<i.ToSortable()&&(i=t));n.OutboundDate=i;n.ReturnDate=t},t.ServiceName="Funnel_PickFlightsJourneyChangeService",t.$inject=["$q","FunnelJourneyCookie_Service","RecentSearchesCookie_Service","SearchCookie_Service",],t}();t.PickFlightsJourneyChangeService=i})(i=t.Flight||(t.Flight={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f,e){this._funnelBasketExtrasRemovalService=i;this._qService=n;this._funnelBasketService=t;this._priceService=f;this._hotelsDataMapper=r;this._funnelApi=u;this._errorService=e}return t.prototype.SaveHotel=function(){var t=this,n=this._qService.defer();return this._funnelApi.UpdateHotel(this._hotelsDataMapper.ToUpdateHotelRequestData(this.GetHotelFromBasket()),function(){n.resolve()},function(i,r,u,f){t._errorService.HandleApiError(i,r,u,f);n.reject()}),n.promise},t.prototype.RemoveHotelFromClientBasket=function(){this._funnelBasketExtrasRemovalService.RemoveHotelFromClientBasket()},t.prototype.RemoveHotelFromServer=function(){this._funnelApi.UpdateHotel({Hotel:null},function(){},this._errorService.HandleApiError.bind(this._errorService))},t.prototype.UpdateHotelLeadGuestInternalId=function(n){var t=this._funnelBasketService.GetBasket();t.Hotel.HotelLeadGuestInternalId=n},t.prototype.GetNights=function(){var n=this.GetHotelFromBasket(),t,i;return!n||!n.CheckInDateTime||!n.CheckOutDateTime?0:(t=n.CheckInDateTime.Date(),i=n.CheckOutDateTime.Date(),i.DifferenceInDays(t))},t.prototype.IsSameCurrency=function(){var n=this.GetHotelFromBasket(),t=this._priceService.GetCurrentCurrency();return n&&t&&n.LocalCurrencyCode===t.CurrencyCode},t.prototype.IsPayNow=function(){var t=this.GetHotelFromBasket();return t&&t.BookingType===n.Data.Common.HotelBookingType.BookNowPayNow},t.prototype.IsHotelLeadGuest=function(n){var t=this.GetHotelFromBasket();return!!t&&n.InternalId===t.HotelLeadGuestInternalId},t.prototype.TotalBasketPrice=function(){return this.GetRoomTotalPrice(function(n){return new Big(n.BasketPrice)})},t.prototype.TotalLocalPrice=function(){return this.GetRoomTotalPrice(function(n){return new Big(n.LocalPrice)})},t.prototype.HotelCurrency=function(){var n=this.GetHotelFromBasket();return n?this.GetHotelFromBasket().LocalCurrencyCode:null},t.prototype.HasHotel=function(){return!!this.GetHotelFromBasket()},t.prototype.GetHotelFromBasket=function(){var n=this._funnelBasketService.GetBasket();return n?this._funnelBasketService.GetBasket().Hotel:null},t.prototype.GetRoomTotalPrice=function(n){var t=this.GetHotelFromBasket(),i;return!t||!t.Rooms?0:(i=_(t.Rooms).chain().map(n).reduce(function(n,t){return t.plus(n)},new Big(0)).value(),Number(i))},t.ServiceName="Funnel_BasketHotelsService",t.$inject=["$q","Funnel_BasketService","Funnel_BasketExtrasRemovalService","Funnel_HotelsDataMapper","Funnel_Api","Common_PriceService","Error_Service"],t}();t.FunnelBasketHotelsService=i})(i=t.Hotels||(t.Hotels={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r;(function(i){var r=function(t){function i(n,i,r,u,f){var e=t.call(this,n,i,r,u,"","")||this;return e._qService=f,e}return __extends(i,t),i.prototype.GetAcceptedPaymentMethods=function(n){var i=this,t=this._qService.defer();return this.AjaxRequest("GET","hotels/acceptedpaymentmethods",n,function(n){t.resolve(i.MapAcceptedPaymentMethodNamesToEnum(n))},this.ExtractKnownError(function(n,i,r,u){var f=!u?null:u.KnownErrorAdditionalData,e={HttpCode:n,StatusText:i,KnownError:r,KnownErrorJson:f};t.reject(e)}),"Hotels.GetAcceptedPaymentMethods"),t.promise},i.prototype.MapAcceptedPaymentMethodNamesToEnum=function(t){return!t||!t.AcceptedPaymentMethods?[]:t.AcceptedPaymentMethods.map(function(t){return n.Data.Common.PaymentMethodType.Parse(t)})},i.ServiceName="Funnel_HotelsApiService",i.$inject=["ClientApi_Service","$http","$httpParamSerializer","IAnalyticsTracker","$q"],i}(t.BaseClientApiService);i.HotelsApiService=r})(r=i.Hotels||(i.Hotels={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._qService=n;this._luggageChargesDataMapper=t;this._luggageRulesService=i}return n.prototype.GetWeightList=function(){var n=this,t=[this.GetBasketCharges(),this.GetLuggageRules()];return this._qService.all(t).then(function(){return n._luggageChargesDataMapper.MapToWeightList(n._basketCharges,n._basketRules)},this._qService.reject)},n.prototype.GetLuggageRules=function(){var n=this;return this._luggageRulesService.GetLuggageRules().then(function(t){return n._basketRules=t})},n.prototype.GetSportsEquipmentList=function(){var n=this,t=[this.GetBasketCharges(),this.GetLuggageRules()];return this._qService.all(t).then(function(){return n._luggageChargesDataMapper.MapToSportsEquipmentList(n._basketCharges,n._basketRules)},function(){n._qService.reject()})},n}();n.BaseLuggageChargesService=t})(t=n.Luggage||(n.Luggage={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n){this._luggageRulesService=n}return t.prototype.Initialize=function(){var n=this;return this._luggageRulesService.GetLuggageRules().then(function(t){n._luggageRules=t})},t.prototype.GetBagsAllowedForPassenger=function(t){if(t===n.Data.Common.PassengerDataType.Adult)return this._luggageRules.LuggageRules.Bags.MaxBagsPerAdult;if(t===n.Data.Common.PassengerDataType.Child)return this._luggageRules.LuggageRules.Bags.MaxBagsPerChild;throw new Error("Invalid Passenger Type");},t.prototype.GetBagsAllowedForInfant=function(){return this._luggageRules.LuggageRules.Bags.MaxBagsPerInfant},t.prototype.GetSportsEquipmentAllowedForPassenger=function(t){if(t===n.Data.Common.PassengerDataType.Adult)return this._luggageRules.LuggageRules.SportsEquipment.MaxSportsEquipmentPerAdult;if(t===n.Data.Common.PassengerDataType.Child)return this._luggageRules.LuggageRules.SportsEquipment.MaxSportsEquipmentPerChild;throw new Error("Invalid Passenger Type");},t.prototype.GetSportsEquipmentAllowedForInfant=function(){return this._luggageRules.LuggageRules.SportsEquipment.MaxSportsEquipmentPerInfant},t.prototype.HasReachedMaximumLargeSportsEquipmentAllowance=function(n){var t=(n||[]).filter(function(n){return n.IsLarge}).length;return t>=this._luggageRules.LuggageRules.SportsEquipment.MaxLargeSportsEquipmentPerBooking},t.prototype.HasReachedMaximumSportsEquipmentAllowance=function(n){var t=this.GetPassengerComposition(),i=t.Adults*this._luggageRules.LuggageRules.SportsEquipment.MaxSportsEquipmentPerAdult,r=t.Children*this._luggageRules.LuggageRules.SportsEquipment.MaxSportsEquipmentPerChild,u=t.Infants*this._luggageRules.LuggageRules.SportsEquipment.MaxSportsEquipmentPerInfant;return(n||[]).length>=i+r+u},t}();t.BaseLuggageLimitsService=i})(i=t.Luggage||(t.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._priceService=n}return t.prototype.ToClientBasketLuggage=function(n,t){var i=this;return{HoldBags:_(n).map(function(n){return i.ToClientBasketBag(n)}),SportsEquipment:_(t).map(function(n){return i.ToClientBasketSportsEquipment(n)})}},t.prototype.ToClientBasketBag=function(n){return{ExcessWeightSteps:n.ExcessWeightSteps,Quantity:1,TotalPrice:n.Price,TotalWeight:n.Weight,PassengerInternalId:null,IsFlexiFareBag:n.IsFlexiFareBag,Type:n.Type}},t.prototype.ToClientBasketSportsEquipment=function(n){return{PassengerInternalId:null,DisplayName:n.Name,Quantity:1,Type:n.Code,Price:n.Price,IsLarge:n.IsLarge,TotalWeight:n.Weight}},t.prototype.MapBasketHoldBagsToFunnelBags=function(n,t){var i=this;return t===0&&(t=1),_(n).map(function(n){return{Weight:n.TotalWeight,ExcessWeightSteps:n.ExcessWeightSteps,AverageFlightPrice:i._priceService.Multiply(n.TotalPrice,1/t),Price:n.TotalPrice,IsFlexiFareBag:n.IsFlexiFareBag,Type:n.Type,PassengerInternalId:n.PassengerInternalId}})},t.prototype.MapSportEquipmentToFunnelSportsEquipment=function(n,t){var i=this;return t===0&&(t=1),_(n).map(function(n){return{Name:n.DisplayName,Code:n.Type,IsLarge:n.IsLarge,AverageFlightPrice:i._priceService.Multiply(n.Price,1/t),Price:n.Price,Weight:n.TotalWeight,PassengerInternalId:n.PassengerInternalId}})},t.prototype.ToApiHoldBagModel=function(t,i){return{ExcessWeightSteps:t.ExcessWeightSteps,IsFlexiFareBag:t.IsFlexiFareBag,PassengerInternalId:i,Quantity:1,TotalPrice:t.Price[n.Data.Common.PaymentType.DebitCard],TotalPriceWithCreditCard:t.Price[n.Data.Common.PaymentType.CreditCard],TotalWeight:t.Weight,Type:n.Data.Funnel.BagType.ToString(t.Type)}},t.prototype.ToApiSportsEquipmentModel=function(t,i){return{DisplayName:t.Name,IsLarge:t.IsLarge,PassengerInternalId:i,Price:t.Price[n.Data.Common.PaymentType.DebitCard],PriceWithCreditCard:t.Price[n.Data.Common.PaymentType.CreditCard],Quantity:1,TotalWeight:t.Weight,Type:t.Code}},t.ServiceName="Funnel_LuggageDataMapper",t.$inject=["Common_PriceService"],t}();t.FunnelLuggageDataMapper=i})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){var i=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i,r,u,"","")||this;return e._qService=f,e}return __extends(t,n),t.prototype.GetLuggageRules=function(){var n=this._qService.defer();return this.AjaxRequest("GET","luggage/rulesandclassifications",null,function(t){return n.resolve(t)},function(){return n.reject()},"RulesAndClassifications"),n.promise},t.ServiceName="Funnel_LuggageApiService",t.$inject=["ClientApi_Service","$http","$httpParamSerializer","IAnalyticsTracker","$q"],t}(n.BaseClientApiService);t.LuggageApiService=i})(i=t.Luggage||(t.Luggage={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t){this._priceService=n;this._luggageSettings=t}return t.prototype.MapToWeightList=function(t,i){var f=[],u,o;if(t&&i&&t.length>0&&i.LuggageRules){var r=this.SumCharges(function(n){return n.HoldLuggage.Amount},t),s=this.SumCharges(function(n){return n.HoldLuggageExcessWeight.Amount},t),h=t.length,e=0;for(t.every(function(n){return!!n.SmallHoldLuggage})&&!!i.LuggageRules.Bags.DefaultWeightPerSmallBag&&f.push(this.GenerateSmallHoldBag(t,i)),u=i.LuggageRules.Bags.DefaultWeightPerBag;u<=i.LuggageRules.Bags.MaxAllowedWeightPerBag;u+=i.LuggageRules.Bags.ExcessWeightStep)o={Weight:u,AverageFlightPrice:this._priceService.Multiply(r,1/h),Price:r,ExcessWeightSteps:e,IsFlexiFareBag:!1,Type:n.Data.Funnel.BagType.StandardHoldBag},f.push(o),r=this._priceService.Add(r,s),e++}return f},t.prototype.GenerateSmallHoldBag=function(t,i){var r=this.SumCharges(function(n){return n.SmallHoldLuggage.Amount},t),u=t.length;return{Weight:parseInt(i.LuggageRules.Bags.DefaultWeightPerSmallBag),AverageFlightPrice:this._priceService.Multiply(r,1/u),Price:r,ExcessWeightSteps:0,IsFlexiFareBag:!1,Type:n.Data.Funnel.BagType.SmallHoldBag}},t.prototype.MapToSportsEquipmentList=function(n,t){var f=[],r,u;if(n&&t&&n.length>0){var o=this.SumCharges(function(n){return n.SmallSportsEquipment.Amount},n),s=this.SumCharges(function(n){return n.LargeSportsEquipment.Amount},n),h=n.length;for(r=0,u=t.SportsEquipmentClassifications;r<u.length;r++){var c=u[r],i=c,e=i.IsLarge?s:o,l={Name:this.GetNameForCodeName(i.SportsEquipmentCodeName),Code:i.SportsEquipmentCodeName,AverageFlightPrice:this._priceService.Multiply(e,1/h),Price:e,IsLarge:i.IsLarge,Weight:this.GetSportsEquipmentWeight(i.IsLarge)};f.push(l)}}return f},t.prototype.GetNameForCodeName=function(n){var t=this._luggageSettings.SportsEquipmentNameSettings,i;if(t&&t.Names&&t.Names.length>0)for(i=0;i<t.Names.length;i++)if(t.Names[i].CodeName===n)return t.Names[i].SingularText;return"Sports equipment"},t.prototype.SumCharges=function(n,t){var i=this,r=this._priceService.NewPrice(0,0);return _(t).reduce(function(t,r){return i._priceService.Add(n(r),t)},r)},t.prototype.GetSportsEquipmentWeight=function(n){var t=this._luggageSettings.SportsEquipmentWeightSettings;return n?t.LargeSportsEquipmentWeight:t.SmallSportsEquipmentWeight},t.ServiceName="Funnel_LuggageChargesDataMapperService",t.$inject=["Common_PriceService","Sitecore_LuggageSettings"],t}();t.LuggageChargesDataMapper=i})(i=t.Luggage||(t.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){var i=function(n){function t(t,i,r,u,f){var e=n.call(this,t,f,i)||this;return e._priceService=r,e._basketFlightItemChargeService=u,e}return __extends(t,n),t.prototype.GetBasketCharges=function(){var n=this;return this._basketFlightItemChargeService.GetFlightItemCharges(!1).then(function(t){n._basketCharges=t})},t.prototype.GetFlightItemChargesFromServer=function(){return this._basketFlightItemChargeService.GetFlightItemChargesFromServer()},t.prototype.CalculateTotalLuggagePrice=function(n,t){var u=this,r=this._priceService.NewPrice(0,0),i=[];return i=!n?i:i.concat(n),i=!t?i:i.concat(t),_(i).each(function(n){r=u._priceService.Add(r,n.Price)}),r},t.ServiceName="Funnel_LuggageChargesService",t.$inject=["$q","Funnel_LuggageRulesService","Common_PriceService","Funnel_BasketFlightItemChargeService","Funnel_LuggageChargesDataMapperService"],t}(n.Funnel.Luggage.BaseLuggageChargesService);t.LuggageChargesService=i})(i=t.Luggage||(t.Luggage={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n){this._qService=n}return t.prototype.OpenLuggageLimitReachedDrawer=function(i,r){var u={ShowHoldLuggageMessage:i,ShowSportsEquipmentMessage:r};n.Events.OpenDrawerWithOptions({SectionKey:"luggage-limit-reached",AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Luggage,Action:t._limitReachedDrawerId,IncludePagePathInLabel:!0},Parameters:u})},t.prototype.OpenChangeWeightDrawer=function(i,r){var u={OnSelect:r,ComparisonBag:i},f={SectionKey:"luggage-changeweight",AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Luggage,Action:t._changeWeightDrawerId,IncludePagePathInLabel:!0},Parameters:u};n.Events.OpenDrawerWithOptions(f)},t.prototype.OpenSkipWithNoLuggageDrawer=function(i,r){var u={SectionKey:"luggage-skip-with-no-luggage",AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Luggage,Action:t._skipWithNoLuggageDrawerId,IncludePagePathInLabel:!0},Parameters:{OptionItems:i,OnSelect:r}};n.Events.OpenDrawerWithOptions(u)},t.prototype.OpenCabinBagOnlyDrawer=function(i,r){var u={SectionKey:"luggage-cabin-bag-only",AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Luggage,Action:t._skipWithNoLuggageDrawerId,IncludePagePathInLabel:!0},Parameters:{OptionItems:i,OnSelect:r}};n.Events.OpenDrawerWithOptions(u)},t.prototype.OpenCombinedBagsSportsEquipmentDrawer=function(i){var r={SectionKey:"combined-bag-sports-equipment-drawer",AnalyticsOptions:{Category:Tracking.EventConstants.Categories.Luggage,Action:t._combinedBagsSportsEquipmentDrawerId,IncludePagePathInLabel:!0},DrawerContentIsLoaded:this._qService.defer(),Parameters:i};n.Events.OpenDrawerWithOptions(r)},t.ServiceName="Funnel_LuggageDrawersService",t._limitReachedDrawerId="{E73FBE18-9FC1-4F18-ADEB-D32DCEFB1629}",t._changeWeightDrawerId="{8133776F-C9FB-429B-9186-F2C34A423445}",t._skipWithNoLuggageDrawerId="{BB41D3EA-5033-479C-86ED-B541732E7248}",t._combinedBagsSportsEquipmentDrawerId="{2D07F628-AC1C-4033-B2C7-6806D9971611}",t.$inject=["$q"],t}();t.LuggageDrawersService=i})(i=t.Luggage||(t.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r;(function(i){var r=function(t){function i(n,i){var r=t.call(this,n)||this;return r._basketService=i,r}return __extends(i,t),i.prototype.HasReachedMaximumBaggageAllowance=function(n){return(n||[]).length>=this.GetTotalBagsAllowed()},i.prototype.GetTotalBagsAllowed=function(){var t=_(this._basketService.GetBasket().Passengers).filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Adult}).length*this._luggageRules.LuggageRules.Bags.MaxBagsPerAdult;return t+=_(this._basketService.GetBasket().Passengers).filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Child}).length*this._luggageRules.LuggageRules.Bags.MaxBagsPerChild,t+this._basketService.GetBasket().CarriedInfants.length*this._luggageRules.LuggageRules.Bags.MaxBagsPerInfant},i.prototype.GetPassengerComposition=function(){return this._basketService.GetPassengerComposition()},i.FlexiFareBagsLimitPerAdult=1,i.FlexiFareBagsLimitPerChild=1,i.FlexiFareBagsLimitPerInfant=0,i.ServiceName="Funnel_LuggageLimitsService",i.$inject=["Funnel_LuggageRulesService","Funnel_BasketService"],i}(t.Funnel.Luggage.BaseLuggageLimitsService);i.LuggageLimitsService=r})(r=i.Luggage||(i.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._luggageApiService=n}return n.prototype.GetLuggageRules=function(){return this._apiResponsePromise||(this._apiResponsePromise=this._luggageApiService.GetLuggageRules()),this._apiResponsePromise},n.ServiceName="Funnel_LuggageRulesService",n.$inject=["Funnel_LuggageApiService"],n}();n.LuggageRulesService=t})(t=n.Luggage||(n.Luggage={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._qService=n;this._funnelAccessibilityService=t;this._funnelBasketHotelsService=i;this._funnelHotelsApiService=r}return t.prototype.CheckForHotelPaymentTypes=function(){if(this._acceptedPaymentsPromise)return this._acceptedPaymentsPromise;var n=this._funnelBasketHotelsService.GetHotelFromBasket();return n?(this._acceptedPaymentsPromise=this._funnelHotelsApiService.GetAcceptedPaymentMethods({HotelNumber:n.Id}),this._acceptedPaymentsPromise):this._qService.when(null)},t.prototype.OpenHotelPaymentsDrawer=function(t){var i=this,r={OnAccept:function(){n.Events.Fire(n.Events.Names.Drawer.Close);t()},OnReject:function(){i._funnelBasketHotelsService.RemoveHotelFromClientBasket();i._funnelBasketHotelsService.RemoveHotelFromServer();i._funnelAccessibilityService.AlertHotelRemovedFromBasket();n.Events.Fire(n.Events.Names.Drawer.Close)},StyleSecondButtonAsDismissOption:!0},u={SectionKey:"hotel-payment-method-not-accepted",Parameters:r};n.Events.OpenDrawerWithOptions(u)},t.prototype.ShouldShowHotelPaymentsDrawer=function(n){var t=this;return!this._acceptedPaymentsPromise||!this.HasHotel()||n===null?this._qService.when(!1):this._acceptedPaymentsPromise.then(function(i){return!t.IsPaymentMethodAccepted(n,i)})},t.prototype.HasHotel=function(){return!!this._funnelBasketHotelsService.GetHotelFromBasket()},t.prototype.IsPaymentMethodAccepted=function(n,t){return!t||t.length===0?!0:_(t).any(function(t){return t===n})},t.ServiceName="Funnel_PaymentHotelsService",t.$inject=["$q","Funnel_AccessibilityService","Funnel_BasketHotelsService","Funnel_HotelsApiService"],t}();t.PaymentHotelsService=i})(i=t.Payment||(t.Payment={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._analyticsTracker=n;this.$window=t}return n.prototype.TrackProductSelected=function(n){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.TravelInsurance,Tracking.EventConstants.Actions.GetAQuoteOptions,"Select Cover - "+n)},n.prototype.TrackProductRemovedFromBasket=function(n){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.TravelInsurance,Tracking.EventConstants.Actions.GetAQuoteOptions,"Remove Selection - "+n)},n.prototype.TrackProductExtraSelected=function(n,t){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.TravelInsurance,Tracking.EventConstants.Actions.GetAQuoteOptions,"Add "+n+"|"+t)},n.prototype.TrackProductExtraDeselected=function(n,t){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.TravelInsurance,Tracking.EventConstants.Actions.GetAQuoteOptions,"Remove "+n+"|"+t)},n.prototype.TrackChangePassengersToOver64=function(){this.TrackChangePassengersToInsure("Over 64 option")},n.prototype.TrackChangeAllPassengersToInsure=function(){this.TrackChangePassengersToInsure("All Passengers Insured option")},n.prototype.TrackChangePassengersToInsure=function(n){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.TravelInsurance,"Add Options",n)},n.ServiceName="Funnel_TravelInsuranceAnalyticsService",n.$inject=["IAnalyticsTracker","$window"],n}();n.AnalyticsService=t})(t=n.TravelInsurance||(n.TravelInsurance={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){var i=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i,r,u,"","")||this;return e._qService=f,e}return __extends(t,n),t.prototype.GetInsuranceQuote=function(n){var t=this._qService.defer();return this.AjaxRequest("POST","travel-insurance/quote",n,function(n){return t.resolve(n)},this.ExtractKnownError(function(n,i,r,u){var f=!u?null:u.KnownErrorAdditionalData,e={HttpCode:n,StatusText:i,KnownError:r,KnownErrorJson:f};t.reject(e)}),"TravelInsurance.GetQuote"),t.promise},t.ServiceName="Funnel_TravelInsuranceApi",t.$inject=["ClientApi_Service","$http","$httpParamSerializer","IAnalyticsTracker","$q"],t}(n.BaseClientApiService);t.ApiService=i})(i=t.TravelInsurance||(t.TravelInsurance={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t){this._funnelAssociationsService=n;this._funnelBasketService=t}return t.prototype.GetSeatType=function(){var n=this._funnelAssociationsService.GetSeatBandSummaryForAllFlights();return n&&n.length>0?this.AnyUpFrontSeats(n)?"4":this.AnyExtraLegRoomSeats(n)?"3":this.AnyStandardSeats(n)?"2":"0":"1"},t.prototype.GetAncillaryRequestData=function(){var t=[];return this.AddAncillary(t,n.Data.Funnel.TravelInsurance.Api.TravelInsuranceAncillaryName.checkinluggage,this._funnelBasketService.BasketContainsHoldBags()?n.Data.Funnel.TravelInsurance.Api.TravelInsuranceAncillarySelectedOption.Yes:n.Data.Funnel.TravelInsurance.Api.TravelInsuranceAncillarySelectedOption.No),this.AddSportsEquipmentRequestData(t,this._funnelBasketService.GetBasket().Luggage.SportsEquipment),t},t.prototype.AddSportsEquipmentRequestData=function(t,i){this.AddAncillary(t,n.Data.Funnel.TravelInsurance.Api.TravelInsuranceAncillaryName.bicycle,this.ContainsSportsEquipmentItem(i,n.Data.Common.SportsEquipmentType.Bicycle));this.AddAncillary(t,n.Data.Funnel.TravelInsurance.Api.TravelInsuranceAncillaryName.canoe,this.ContainsSportsEquipmentItem(i,n.Data.Common.SportsEquipmentType.Canoe));this.AddAncillary(t,n.Data.Funnel.TravelInsurance.Api.TravelInsuranceAncillaryName.sportingfirearm,this.ContainsSportsEquipmentItem(i,n.Data.Common.SportsEquipmentType.Firearm));this.AddAncillary(t,n.Data.Funnel.TravelInsurance.Api.TravelInsuranceAncillaryName.golfbag,this.ContainsSportsEquipmentItem(i,n.Data.Common.SportsEquipmentType.GolfBag));this.AddAncillary(t,n.Data.Funnel.TravelInsurance.Api.TravelInsuranceAncillaryName.hangglider,this.ContainsSportsEquipmentItem(i,n.Data.Common.SportsEquipmentType.HangGlider));this.AddAncillary(t,n.Data.Funnel.TravelInsurance.Api.TravelInsuranceAncillaryName.skisandorboots,this.ContainsSportsEquipmentItem(i,n.Data.Common.SportsEquipmentType.Skis));this.AddAncillary(t,n.Data.Funnel.TravelInsurance.Api.TravelInsuranceAncillaryName.snowboard,this.ContainsSportsEquipmentItem(i,n.Data.Common.SportsEquipmentType.Snowboard));this.AddAncillary(t,n.Data.Funnel.TravelInsurance.Api.TravelInsuranceAncillaryName.windsurfingboard,this.ContainsSportsEquipmentItem(i,n.Data.Common.SportsEquipmentType.WindsurfingBoard));this.AddAncillary(t,n.Data.Funnel.TravelInsurance.Api.TravelInsuranceAncillaryName.othersmallsportsequipment,this.ContainsSportsEquipmentItem(i,n.Data.Common.SportsEquipmentType.OtherSmallSportsEquipment))},t.prototype.AnyExtraLegRoomSeats=function(n){return n.filter(function(n){return n.PriceBand&&n.PriceBand.toLowerCase()===Constants.DisplayNames.SeatBand.UpFront}).length>0},t.prototype.AnyStandardSeats=function(n){return n.filter(function(n){return n.PriceBandDisplayName&&n.PriceBandDisplayName.toLowerCase()===Constants.DisplayNames.SeatBand.Standard}).length>0},t.prototype.AnyUpFrontSeats=function(n){return n.filter(function(n){return n.PriceBand&&n.PriceBand.toLowerCase()===Constants.DisplayNames.SeatBand.ExtraLegroom}).length>0},t.prototype.ContainsSportsEquipmentItem=function(t,i){return t.filter(function(t){return t.Type===n.Data.Common.SportsEquipmentType.ToString(i)}).length>0?n.Data.Funnel.TravelInsurance.Api.TravelInsuranceAncillarySelectedOption.Yes:n.Data.Funnel.TravelInsurance.Api.TravelInsuranceAncillarySelectedOption.No},t.prototype.AddAncillary=function(t,i,r){var u={Name:n.Data.Funnel.TravelInsurance.Api.TravelInsuranceAncillaryName.ToString(i),SelectedOption:r};t.push(u)},t.ServiceName="Funnel_TravelInsuranceBasketAssociationService",t.$inject=["Funnel_AssociationsService","Funnel_BasketService"],t}();t.BasketAssociationService=i})(i=t.TravelInsurance||(t.TravelInsurance={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function i(n,t,i){this._basketAssociationsService=n;this._priceMapper=t;this._routesService=new Main3.Routes.RoutesService(i)}return i.prototype.ToUpdateTravelInsuranceRequestData=function(i,r,u){return i?{AuthToken:t.QuoteService.AuthToken,TravelInsuranceLanguageCode:r,CostOfTrip:u,SeatTypeSelected:this._basketAssociationsService.GetSeatType(),FlightAncillaries:this._basketAssociationsService.GetAncillaryRequestData(),Policy:{StartDate:i.Policy.StartDate.ToIso8601(),EndDate:i.Policy.EndDate.ToIso8601(),ProductName:i.Policy.ProductName,ProductCode:i.Policy.ProductCode,FirstProductTermsLink:i.Policy.FirstProductTermsLink,SecondProductTermsLink:i.Policy.SecondProductTermsLink,TotalPrice:this._priceMapper.MapToApi(i.Policy.TotalPrice),AddOns:this.MapSelectedExtrasToApiRequest(i.Policy.SelectedExtras)},InsuredPassengers:i.InsuredPassengers.map(function(t){return{InternalPassengerId:t.InternalPassengerId,Type:n.Data.Funnel.TravelInsurance.TravelInsurancePassengerType.ToString(t.Type)}}),QuoteOutboundRoute:this.MapApiRouteFromRouteDate(i.QuoteOutboundRoute),QuoteReturnRoute:!i.QuoteReturnRoute?null:this.MapApiRouteFromRouteDate(i.QuoteReturnRoute)}:null},i.prototype.MapApiRouteFromRouteDate=function(n){return{OriginIata:n.OriginIata,OriginCountryCode:this._routesService.FindCountryByIata(n.OriginIata).Code,DestinationIata:n.DestinationIata,Date:n.Date.ToIso8601()}},i.prototype.MapSelectedExtrasToApiRequest=function(n){var t=this;return n.map(function(n){return{Name:n.Name,Code:n.Code,Price:t._priceMapper.MapToApi(n.Price)}})},i.prototype.ToClientBasketFromModel=function(t){return!t||!t.Policy||!t.InsuredPassengers?null:{AuthToken:t.AuthToken,Policy:{StartDate:Utilities.ZonelessDateTime.FromIso8601(t.Policy.StartDate),EndDate:Utilities.ZonelessDateTime.FromIso8601(t.Policy.EndDate),ProductName:t.Policy.ProductName,ProductCode:t.Policy.ProductCode,FirstProductTermsLink:t.Policy.FirstProductTermsLink,SecondProductTermsLink:t.Policy.SecondProductTermsLink,TotalPrice:this._priceMapper.MapFromApi(t.Policy.TotalPrice),SelectedExtras:this.MapApiResponseToSelectedExtras(t.Policy.AddOns)},InsuredPassengers:t.InsuredPassengers.map(function(t){return{InternalPassengerId:t.InternalPassengerId,Type:n.Data.Funnel.TravelInsurance.TravelInsurancePassengerType.Parse(t.Type)}}),QuoteOutboundRoute:!t.QuoteOutboundRoute?null:this.MapRouteDateFromApi(t.QuoteOutboundRoute),QuoteReturnRoute:!t.QuoteReturnRoute?null:this.MapRouteDateFromApi(t.QuoteReturnRoute),OriginalCostOfTrip:t.CostOfTrip}},i.prototype.MapRouteDateFromApi=function(n){return{OriginIata:n.OriginIata,DestinationIata:n.DestinationIata,Date:Utilities.TimeAgnosticDate.FromIso8601(n.Date)}},i.prototype.MapApiResponseToSelectedExtras=function(n){var t=this;return n.map(function(n){return{Name:n.Name,Code:n.Code,Price:t._priceMapper.MapFromApi(n.Price)}})},i.prototype.MapProductToPolicy=function(n,t,i){return n?{StartDate:n.PolicyStartDate,EndDate:n.PolicyEndDate,ProductCode:n.Code,ProductName:n.Name,FirstProductTermsLink:t,SecondProductTermsLink:i,TotalPrice:n.Premium,SelectedExtras:[]}:null},i.prototype.MapPassengersToInsuredPassengers=function(n){if(!n)return[];var i=n.filter(function(n){return n.Insured});return i?i.map(function(n){return{InternalPassengerId:n.InternalId,Type:t.PassengerDataService.GetTravelInsurancePassengerType(n)}}):[]},i.ServiceName="Funnel_TravelInsuranceDataMapper",i.$inject=["Funnel_TravelInsuranceBasketAssociationService","Funnel_PriceDataMapper","Sitecore_RoutesData"],i}();t.BasketDataMapper=i})(i=t.TravelInsurance||(t.TravelInsurance={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function i(n,t,i,r,u,f,e,o,s,h){this._qService=n;this._errorService=t;this._funnelApi=i;this._funnelBasketService=r;this._travelInsuranceDataMapper=u;this._insuranceAnalyticsService=e;this._funnelAccessibilityService=o;this._funnelPriceService=s;this._funnelBasketExtrasRemovalService=h;this._routesService=new Main3.Routes.RoutesService(f)}return i.prototype.SaveToClientBasket=function(i,r,u,f,e){var s=this._travelInsuranceDataMapper.MapProductToPolicy(i,u,f),o=this._travelInsuranceDataMapper.MapPassengersToInsuredPassengers(r),h;!!s&&!!o&&o.length>0&&(h=this._funnelBasketService.GetBasket(),h.TravelInsurance={AuthToken:t.QuoteService.AuthToken,Policy:s,InsuredPassengers:o,QuoteOutboundRoute:!this._funnelBasketService.GetPrimaryJourneyPair().OutboundSlot?null:this._funnelBasketService.GetPrimaryJourneyPair().OutboundSlot.Route,QuoteReturnRoute:!this._funnelBasketService.GetPrimaryJourneyPair().ReturnSlot?null:this._funnelBasketService.GetPrimaryJourneyPair().ReturnSlot.Route,OriginalCostOfTrip:e},n.Events.Fire(n.Events.Names.Funnel.TravelInsuranceUpdated))},i.prototype.SaveExtraToClientBasket=function(n){var t=this._funnelBasketService.GetBasket().TravelInsurance.Policy,i;t.SelectedExtras.filter(function(t){return t.Code===n.Code}).length===0&&(i={Code:n.Code,Name:n.Name,Price:n.Price},t.SelectedExtras.push(i))},i.prototype.RemoveExtraFromClientBasket=function(n){var t=this._funnelBasketService.GetBasket().TravelInsurance.Policy,i=t.SelectedExtras.filter(function(t){return t.Code!==n.Code});!i||(t.SelectedExtras=i)},i.prototype.SaveInsuranceToServerBasket=function(n){var i=this,t=this._qService.defer(),r=this._funnelPriceService.GetTravelInsuranceCostOfTrip();return this._funnelApi.UpdateTravelInsurance(this._travelInsuranceDataMapper.ToUpdateTravelInsuranceRequestData(this.GetTravelInsuranceFromClientBasket(),n,r),function(){t.resolve()},function(){i._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.TravelInsurance,Tracking.EventConstants.GenericErrorDrawerLabels.UpdateTravelInsurance);t.reject(0)}),t.promise},i.prototype.RemoveSelectedPolicy=function(){var n=this;return this.RemoveSelectedPolicyFromClientBasket().then(function(){return n.RemoveSelectedPolicyFromServerBasket()})},i.prototype.RemoveSelectedPolicyFromClientBasket=function(){var r=this._qService.defer(),t=this.GetTravelInsuranceFromClientBasket(),i;return!t||!t.Policy||(i=t.Policy,this._funnelAccessibilityService.TravelInsuranceProductRemovedAlert(i.ProductName),this._insuranceAnalyticsService.TrackProductRemovedFromBasket(i.ProductCode)),this._funnelBasketExtrasRemovalService.RemoveTravelInsuranceFromClientBasket(),n.Events.Fire(n.Events.Names.Funnel.TravelInsuranceUpdated),n.Events.Fire(n.Events.Names.Basket.HeightModified),r.resolve(),r.promise},i.prototype.RemoveSelectedPolicyFromServerBasket=function(){var t=this,n=this._qService.defer();return this._funnelApi.UpdateTravelInsurance({AuthToken:null,QuoteOutboundRoute:null,Policy:null,InsuredPassengers:null,TravelInsuranceLanguageCode:null,CostOfTrip:null,SeatTypeSelected:null,FlightAncillaries:null},function(){n.resolve()},function(i,r,u,f){t._errorService.HandleApiError(i,r,u,f);n.reject()}),n.promise},i.prototype.PassengerHasTravelInsurance=function(n){var t=this.GetTravelInsuranceFromClientBasket(),i=!!t&&!!t.InsuredPassengers?t.InsuredPassengers:[];return i.some(function(t){return t.InternalPassengerId===n.InternalId})},i.prototype.HasTravelInsuranceInClientBasket=function(){return!!this.GetTravelInsuranceFromClientBasket()&&!!this.GetTravelInsuranceFromClientBasket().Policy},i.prototype.GetTravelInsuranceFromClientBasket=function(){var n=this._funnelBasketService.GetBasket();return!n||!n.TravelInsurance?null:n.TravelInsurance},i.ServiceName="Funnel_TravelInsuranceBasketService",i.$inject=["$q","Error_Service","Funnel_Api","Funnel_BasketService","Funnel_TravelInsuranceDataMapper","Sitecore_RoutesData","Funnel_TravelInsuranceAnalyticsService","Funnel_AccessibilityService","Funnel_PriceService","Funnel_BasketExtrasRemovalService"],i}();t.BasketService=i})(i=t.TravelInsurance||(t.TravelInsurance={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f,e,o,s){this._basketService=n;this._funnelPriceService=t;this._travelInsuranceSettings=i;this._funnelTravelInsuranceQuoteService=r;this._travelInsurancePassengerDataService=u;this._funnelRootSettings=f;this._travelInsuranceThresholdBreachedDrawerSettings=e;this._analyticsTracker=o;this._priceService=s}return t.prototype.HandlePriceChange=function(){this._basketService.GetBasket().TravelInsurance?this.CheckIfPriceChangeHasBreachedTravelInsuranceThreshold():n.Events.Fire(n.Events.Names.Funnel.ReFinalise)},t.prototype.CheckIfPriceChangeHasBreachedTravelInsuranceThreshold=function(){var t=this._basketService.GetBasket().TravelInsurance.OriginalCostOfTrip,i=this._funnelPriceService.GetBasePriceOfFlightsAndFlightAncillariesWithoutVouchers(),r=this._travelInsuranceSettings.PriceChangeThresholdPercentage/100;t===0?this.OpenDrawerInErrorState():this.PriceChangeHasBreachedTravelInsuranceThreshold(t,i,r)?(this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.TravelInsurance,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.TravelInsuranceThresholdBreached),this.Requote()):n.Events.Fire(n.Events.Names.Funnel.ReFinalise)},t.prototype.PriceChangeHasBreachedTravelInsuranceThreshold=function(n,t,i){var r=Math.abs(t-n),u=r/n;return u>i},t.prototype.Requote=function(t){var i=this;t===void 0&&(t=!1);var r=this._basketService.GetBasket().TravelInsurance.Policy,u=this._travelInsurancePassengerDataService.GetPassengers(),f=this.GetTravelInsuranceLanguageCode();return this._funnelTravelInsuranceQuoteService.GetInsuranceQuoteForCurrentBasket(u,f).then(function(t){var e=t.Products.filter(function(n){return n.Name===r.ProductName});!!e&&e.length>0?i.RequotedProductMatchesOriginalPolicyExactly(e,r)?n.Events.Fire(n.Events.Names.Funnel.ReFinalise):i.OpenDrawerInUpdatedPriceState(e,u,r,f):i.OpenDrawerInRequiresRequoteState()},function(){i.OpenDrawerInErrorState()})},t.prototype.RequotedProductMatchesOriginalPolicyExactly=function(n,t){var i=this;return n.some(function(n){return i.RequotedProductMatchesOriginalPolicy(n,t)})},t.prototype.RequotedProductMatchesOriginalPolicy=function(n,t){var i=this;return t.SelectedExtras.every(function(t){return i.SelectedExtraHasAMatchInRequotedProduct(t,n)})&&this._priceService.AreEqual(t.TotalPrice,n.Premium)},t.prototype.SelectedExtraHasAMatchInRequotedProduct=function(n,t){var i=this;return t.OptionalExtras.some(function(t){return t.Code===n.Code&&i._priceService.AreEqual(t.Price,n.Price)})},t.prototype.GetTravelInsuranceLanguageCode=function(){return this._travelInsuranceSettings.TravelInsuranceLanguageCode||this._funnelRootSettings.SitecoreLanguageCode},t.prototype.OpenDrawerInUpdatedPriceState=function(t,i,r,u){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Checkout,Tracking.EventConstants.Actions.Drawer,Tracking.EventConstants.Labels.TravelInsurancePriceUpdated);var f={DrawerState:n.Data.Common.Drawers.TravelInsuranceThresholdBreachedDrawerStates.UpdatedPrice,UpdatedPolicy:t[0],Passengers:i,FirstProductTermsLink:r.FirstProductTermsLink,SecondProductTermsLink:r.SecondProductTermsLink,TravelInsuranceLanguageCode:u};this.OpenInsuranceThresholdBreachedDrawer(f)},t.prototype.OpenDrawerInRequiresRequoteState=function(){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Checkout,Tracking.EventConstants.Actions.Drawer,Tracking.EventConstants.Labels.TravelInsuranceRequiresRequote);var t={DrawerState:n.Data.Common.Drawers.TravelInsuranceThresholdBreachedDrawerStates.RequiresRequote};this.OpenInsuranceThresholdBreachedDrawer(t)},t.prototype.OpenDrawerInErrorState=function(){this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Checkout,Tracking.EventConstants.Actions.Drawer,Tracking.EventConstants.Labels.TravelInsuranceQuoteError);var t={DrawerState:n.Data.Common.Drawers.TravelInsuranceThresholdBreachedDrawerStates.Error};this.OpenInsuranceThresholdBreachedDrawer(t)},t.prototype.OpenInsuranceThresholdBreachedDrawer=function(t){var i={SectionKey:"funnel-finaliseinsurancethresholdbreached",Parameters:t,TitleOverride:this.GetTitleForState(t.DrawerState),ShowAfterActionComplete:!0};n.Events.OpenDrawerWithOptions(i)},t.prototype.GetTitleForState=function(t){switch(t){case n.Data.Common.Drawers.TravelInsuranceThresholdBreachedDrawerStates.UpdatedPrice:return this._travelInsuranceThresholdBreachedDrawerSettings.UpdatedPriceTitle;case n.Data.Common.Drawers.TravelInsuranceThresholdBreachedDrawerStates.RequiresRequote:return this._travelInsuranceThresholdBreachedDrawerSettings.RequiresRequoteTitle;case n.Data.Common.Drawers.TravelInsuranceThresholdBreachedDrawerStates.Error:return this._travelInsuranceThresholdBreachedDrawerSettings.ErrorTitle}},t.ServiceName="Funnel_FunnelFinaliseTravelInsuranceService",t.$inject=["Funnel_BasketService","Funnel_PriceService","Sitecore_FunnelTravelInsuranceSettings","Funnel_TravelInsuranceQuoteService","Funnel_TravelInsurancePassengerDataService","Sitecore_FunnelRootSettings","Sitecore_TravelInsuranceThresholdBreachedDrawerSettings","IAnalyticsTracker","Common_PriceService"],t}();t.FunnelFinaliseTravelInsuranceService=i})(i=t.TravelInsurance||(t.TravelInsurance={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t){this._funnelBasketService=n;this._funnelPassengerService=t}return t.prototype.GetPassengers=function(){var u=this,i=[],t=this._funnelBasketService.GetBasket(),r;return t?(r=t.Passengers.concat(t.CarriedInfants),r.forEach(function(r){var f=!0,e=!1,o=null;!t.TravelInsurance||!t.TravelInsurance.InsuredPassengers||(o=_(t.TravelInsurance.InsuredPassengers).find(function(n){return n.InternalPassengerId===r.InternalId}),o?(f=!0,e=o.Type===n.Data.Funnel.TravelInsurance.TravelInsurancePassengerType.Over64):(f=!1,e=!1));i.push({DisplayName:u._funnelPassengerService.GetDisplayName(r.InternalId),InternalId:r.InternalId,Type:r.Type,Insured:f,Over64:e})}),i):i},t.GetTravelInsurancePassengerType=function(t){return t.Type===n.Data.Common.PassengerDataType.Adult?t.Over64?n.Data.Funnel.TravelInsurance.TravelInsurancePassengerType.Over64:n.Data.Funnel.TravelInsurance.TravelInsurancePassengerType.Adult:t.Type===n.Data.Common.PassengerDataType.Child?n.Data.Funnel.TravelInsurance.TravelInsurancePassengerType.Child:t.Type===n.Data.Common.PassengerDataType.Infant?n.Data.Funnel.TravelInsurance.TravelInsurancePassengerType.Infant:null},t.ServiceName="Funnel_TravelInsurancePassengerDataService",t.$inject=["Funnel_BasketService","Funnel_PassengerService"],t}();t.PassengerDataService=i})(i=t.TravelInsurance||(t.TravelInsurance={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._priceService=n}return n.prototype.GetTotalPrice=function(n){var i=this,t;return n?(t=n.TotalPrice,n.SelectedExtras.forEach(function(n){t=i._priceService.Add(t,n.Price)}),t):this._priceService.NewPrice()},n.ServiceName="Funnel_TravelInsurancePriceService",n.$inject=["Common_PriceService"],n}();n.PriceService=t})(t=n.TravelInsurance||(n.TravelInsurance={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function t(n,t,i,r,u){this.$q=n;this._funnelBasketService=t;this._travelInsuranceApi=i;this._requestMapper=r;this._errorService=u}return t.prototype.GetInsuranceQuoteForCurrentBasket=function(n,t){var i=this._funnelBasketService.GetPrimaryJourneyPair();return this.GetInsuranceQuote(n,i,t)},t.prototype.GetInsuranceQuote=function(i,r,u){var f=this.$q.defer(),e=this._requestMapper.GetInsuranceQuoteRequestData(i,r,u);return this._travelInsuranceApi.GetInsuranceQuote(e).then(function(i){t.AuthToken=i.AuthToken;var r=n.ResponseMapper.ToQuoteFromQuoteResponseModel(i);f.resolve(r)},function(n){f.reject(n)}),f.promise},t.AuthToken=null,t.ServiceName="Funnel_TravelInsuranceQuoteService",t.$inject=["$q","Funnel_BasketService","Funnel_TravelInsuranceApi","Funnel_TravelInsuranceRequestMapper","Error_Service"],t}();n.QuoteService=t})(t=n.TravelInsurance||(n.TravelInsurance={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function i(n,t,i,r,u){this._basketAssociationsService=n;this._funnelBasketService=t;this._funnelPriceService=i;this._priceService=r;this._routesService=new Main3.Routes.RoutesService(u)}return i.prototype.GetInsuranceQuoteRequestData=function(i,r,u){var f=r.OutboundSlot.Flight.DepartureIata,o=r.OutboundSlot.Flight.LocalDepartureTime,h=r.OutboundSlot.Flight.ArrivalIata,e=null,s;return!r.ReturnSlot||!r.ReturnSlot.Flight||(s=r.ReturnSlot.Flight,e=s.LocalDepartureTime),{AuthToken:t.QuoteService.AuthToken,CurrencyCode:this._priceService.GetCurrentCurrency().CurrencyCode,OrganizationCode:this._routesService.GetTravelInsuranceOrganisationCodeForIata(f),TravelInsuranceLanguageCode:u,CostOfTrip:this._funnelPriceService.GetTravelInsuranceCostOfTrip(),PolicyStartDate:o.ToIso8601(),PolicyEndDate:!e?o.ToIso8601():e.ToIso8601(),OriginIata:f,OriginCountry:this._routesService.FindCountryByIata(f).Code,DestinationIata:h,IsSingleTrip:!r.ReturnSlot||!r.ReturnSlot.Flight,IsFlexiFare:this._funnelBasketService.GetFareType()===n.Data.Common.FlightFareType.Flexi,SeatTypeSelected:this._basketAssociationsService.GetSeatType(),Ancillaries:this._basketAssociationsService.GetAncillaryRequestData(),Passengers:this.GetPassengerRequestData(i)}},i.prototype.GetPassengerRequestData=function(i){for(var r,o,f=[],u=0,e=i;u<e.length;u++)r=e[u],r.Insured&&(o={FirstName:r.DisplayName,PassengerType:n.Data.Funnel.TravelInsurance.TravelInsurancePassengerType.ToString(t.PassengerDataService.GetTravelInsurancePassengerType(r))},f.push(o));return f},i.ServiceName="Funnel_TravelInsuranceRequestMapper",i.$inject=["Funnel_TravelInsuranceBasketAssociationService","Funnel_BasketService","Funnel_PriceService","Common_PriceService","Sitecore_RoutesData"],i}();t.RequestMapper=i})(i=t.TravelInsurance||(t.TravelInsurance={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(){}return t.ToQuoteFromQuoteResponseModel=function(n){return{Products:this.MapProductsFromApiToDomain(n.Products,n),Terms:{AssumptionCountryOfRiskText:n.AssumptionCountryofRisk,GeneralTermsText:n.GeneralTerms,FirstTermsConditionsLink:n.FirstGeneralTermsDocumentUrl,FirstTermsConditionsText:n.FirstGeneralTermsDocument,SecondTermsConditionsLink:n.SecondGeneralTermsDocumentUrl,SecondTermsConditionsText:n.SecondGeneralTermsDocument}}},t.MapProductsFromApiToDomain=function(n,i){var r=this;return n.map(function(n){return{PolicyStartDate:Utilities.ZonelessDateTime.FromIso8601(i.PolicyStartDate),PolicyEndDate:Utilities.ZonelessDateTime.FromIso8601(i.PolicyEndDate),OptionalExtras:r.MapOptionalExtrasFromApiToDomain(n.AddOns),IsFeaturedProduct:n.IsFeaturedProduct,Benefits:(n.Benefits||[]).map(function(n){return t.MapApiBenefitSectionToDomain(n)}),Code:n.Code,Name:n.Name,Description:n.Description,Premium:r.MapApiPricesToDomainPrices(n.Premium)}})},t.MapOptionalExtrasFromApiToDomain=function(n){var i=this;return _(n).map(function(n){return{Name:n.Name,Code:n.Code,Description:n.Description,Price:i.MapApiPricesToDomainPrices(n.Premium),IsSelected:!1,Benefits:(n.Benefits||[]).map(function(n){return t.MapApiBenefitSectionToDomain(n)})}})},t.MapApiPricesToDomainPrices=function(t){if(t){var i={};return i[n.Data.Common.PaymentType.CreditCard]=t.PriceWithCreditCard,i[n.Data.Common.PaymentType.DebitCard]=t.PriceWithDebitCard,i[n.Data.Common.PaymentType.Base]=t.Price,i}return null},t.MapApiBenefitSectionToDomain=function(n){var i;return n&&(i={Description:n.Description,Cost:n.Cost,Benefits:(n.Benefits||[]).map(function(n){return t.MapApiBenefitToDomain(n)})}),i},t.MapApiBenefitToDomain=function(n){var t;return n&&(t={Description:n.Description,Cost:n.Cost}),t},t}();t.ResponseMapper=i})(i=t.TravelInsurance||(t.TravelInsurance={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(n){function t(t,i,r){var u=n.call(this,t,i,null,null,null)||this;return u._settings=r,u}return __extends(t,n),t.prototype.GetApiUrl=function(){return this._settings.EndpointUrl},t.prototype.Login=function(n,t,i){this.AjaxRequest("POST",this._settings.EndpointUrl+"signin",n,t,i,null)},t.prototype.Logout=function(n,t){this.AjaxRequest("POST",this._settings.EndpointUrl+"signout",null,n,t,null)},t.prototype.KeepAlive=function(n){this.AjaxRequest("GET",this._settings.EndpointUrl+"signin",null,null,n,null)},t.ServiceName="Hotac_AuthApi",t.$inject=["$http","$httpParamSerializer","Sitecore_HotacAuthApiSettings"],t}(n.BaseApiService);t.AuthApi=i})(t=n.Hotacc||(n.Hotacc={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i,r;(function(n){n.ControllerUrl="IsMyFlightDisrupted"})(i||(i={}));r=function(n){function t(t,i,r){var u=n.call(this,t,i,null,null,null)||this;return u._authApi=r,u}return __extends(t,n),t.prototype.BuildRequest=function(n,t,i){return{DepartureIata:n,FlightNumber:t,FlightDate:i}},t.prototype.IsFlightDisrupted=function(n,t,r){this._hotacUrl=Urls.UrlBuilder.UrlWithTrailingSlash(this._authApi.GetApiUrl());this.AjaxRequest("GET",this._hotacUrl+i.ControllerUrl,n,t,r,null)},t.ServiceName="Hotac_Api",t.$inject=["$http","$httpParamSerializer","Hotac_AuthApi"],t}(n.BaseApiService);t.HotacApi=r})(t=n.Hotacc||(n.Hotacc={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r){var u=this;this._rootScope=t;this._api=i;this._clientSettings=r;this._timer=new Utilities.ExpiryTimer(this._clientSettings.InactivitySeconds*1e3+this._clientSettings.MessageSeconds*1e3,this.TimeLeftTillExpiry.bind(this),this.CalculateKeepAliveThrottle(this._clientSettings),!0);this._timer.AddExpiredCallback(this.OnExpired.bind(this));this._timer.AddKeepAliveCallback(this.OnKeepAlive.bind(this));this._rootScope.$on(n.Events.Names.HotAcc.ResetExpiryTimer,function(n,t){u._timer.Reset(t||!1)});this._rootScope.$on(n.Events.Names.Drawer.Scroll,function(){u._timer.Reset(!1)});this._rootScope.$on(n.Events.Names.HotAcc.StopTimer,function(){u._timer.Stop()});this._rootScope.$on(n.Events.Names.HotAcc.LoggedOut,function(){u._timer.Stop()})}return t.prototype.CalculateKeepAliveThrottle=function(n){var t=(n.InactivitySeconds+n.MessageSeconds)/2+1;return t*1e3},t.prototype.OnExpired=function(){n.Events.OpenDrawer("hotacc-login-expiry")},t.prototype.OnKeepAlive=function(){this._api.KeepAlive(function(t){t==401&&n.Events.Fire(n.Events.Names.HotAcc.LoggedOut)})},t.prototype.TimeLeftTillExpiry=function(t){var i=this._clientSettings.InactivitySeconds*1e3;if(n.Services.Account.AccountService.HasExpiresCookie()){var r=n.Services.Account.AccountService.GetExpiresCookieValue(),u=moment.utc().toDate().getTime(),f=parseInt(r);i=f-u;i-=this._clientSettings.MessageSeconds*1e3;i-=t}return i},t.ServiceName="Hotacc_LoginExpiryTimer",t.$inject=["$rootScope","Hotac_AuthApi","Sitecore_HotaccExpirySettings"],t}();t.LoginExpiryTimer=i})(i=t.Hotacc||(t.Hotacc={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(n){function t(t,i,r,u,f){var e=n.call(this,i,r,u,f,"DA-CKN",Main3.Cookies.CookieConstants.Names.RebookingPodIdentifier)||this;return e._qService=t,e}return __extends(t,n),t.prototype.GetBooking=function(n,t,i){var r={BookingReference:n};this.AjaxRequest("GET","check-in/getbooking",r,t,this.ExtractKnownError(i),"CheckIn.GetBooking",!0)},t.prototype.GetPassengerOnBooking=function(n,t,i,r){var u={BookingReference:n,PassengerCode:t};this.AjaxRequest("GET","check-in/getpassengeronbooking",u,i,this.ExtractKnownError(r),"CheckIn.GetPassengerOnBooking",!0)},t.prototype.UpdatePassengerOnBooking=function(n,t,i){this.AjaxRequest("POST","check-in/updatepassengeronbooking",n,t,this.ExtractKnownError(i),"CheckIn.UpdatePassengerOnBooking",!0)},t.prototype.GetDocumentTypes=function(n,t,i){var r={Language:n};this.AjaxRequest("GET","check-in/getdocumenttypes",r,t,this.ExtractKnownError(i),"CheckIn.GetDocumentTypes",!0)},t.prototype.DeleteDocumentType=function(n,t,i){var r={DocumentNumber:n};this.AjaxRequest("POST","check-in/deletesaveddocument",r,t,this.ExtractKnownError(i),"CheckIn.DeleteSavedDocument",!0)},t.prototype.GetSavedDocuments=function(n){var t=this._qService.defer(),i={Language:n};return this.AjaxRequest("GET","check-in/getsaveddocuments",i,function(n){t.resolve(n)},this.ExtractKnownError(function(n,i,r){t.reject(r)}),"CheckIn.GetSavedDocuments",!0),t.promise},t.prototype.GetNationalities=function(n,t,i){var r={Language:n};this.AjaxRequest("GET","check-in/getnationalities",r,t,this.ExtractKnownError(i),"CheckIn.GetNationalities",!0)},t.prototype.CheckIn=function(n,t,i){this.AjaxRequest("POST","check-in/checkin",n,t,this.ExtractKnownError(i),"CheckIn.CheckIn",!0)},t.ServiceName="CheckIn_Api",t.$inject=["$q","ClientApi_Service","$http","$httpParamSerializer","IAnalyticsTracker"],t}(n.QueuedBaseApiService);t.CheckInApi=i})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._helpingHandModel=n;this._checkInService=t;this._tracker=i}return t.prototype.GetHelpingHandSettings=function(n){var t=n.IsApisRequired;return t?this.SettingsBasedOnApis(n):this.SettingsBasedOnContactInformation(n)},t.prototype.UpdateHelpingHand=function(t){var i=this,r;t.Button.Enabled?(r={Title:t.Message,ButtonText:t.Button.Text,ButtonEvent:function(){t.Button.Url===""?(t.Button.Action(),i._tracker.TrackEvent(Tracking.EventConstants.Categories.CheckIn,t.Event.Action,t.Event.Label)):i._tracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.CheckIn,t.Event.Action,t.Event.Label,t.Button.Url)},ButtonEnabledWatch:function(){return!0},IsALink:!1},n.Events.Fire(n.Events.Names.HelpingHand.ShowTextWithButton,r)):n.Events.Fire(n.Events.Names.HelpingHand.ShowText,t.Message)},t.prototype.FirstAvailableFlightForCheckIn=function(t){var o,e,i,r,u,f;for(this._flights=t,o=Utilities.ZonelessDateTime.NowLocal(),e=Number.MAX_VALUE,t=t.filter(function(t){return t.Status!==n.Data.ManageBookings.FlightStatus.Cancelled}),r=0;r<t.length;r++)u=t[r],f=u.FlightCardFlight.LocalDepartureTime.Difference(o,Utilities.ZonelessDateTimePart.Minutes),u.CheckInState.WithinCheckInWindow&&f>0&&f<e&&(e=f,i=u);return i||(i=t[0]),i},t.prototype.SettingsBasedOnApis=function(n){return this.Settings(n,function(n){return n.HasCompletedApis})},t.prototype.SettingsBasedOnContactInformation=function(n){return this.Settings(n,function(n){return n.HasCompletedContactInformation})},t.prototype.Settings=function(n,t){for(var r={Button:{Action:"",Enabled:!1,Text:"",Url:""},Event:{Action:"",Label:""},Message:this._helpingHandModel.OriginalText},i=n.Passengers,u=0,e=0,f=0;f<i.length;f++)u+=t(i[f])?1:0,e+=i[f].IsCheckedIn?1:0;return u===0?r=this.NoPassengersCompletedQuery(i[0]):i.length===u?i.length===e?r=this.AllPassengersCompletedQueryAndCheckedIn():n.CheckInState.WithinCheckInWindow&&i.length!==e?r=this.AllPassengersCompletedQueryAndWithinCheckInWindow():n.CheckInState.WithinCheckInWindow||(r=this.AllPassengersCompletedQueryAndOutsideCheckInWindow(n)):i.length>u&&(r=this.SomePassengersCompletedQuery(u,i.length)),r},t.prototype.NoPassengersCompletedQuery=function(n){return{Button:{Action:function(){},Enabled:!0,Text:this._helpingHandModel.AddPassengerInfoBeforeCheckInButtonText,Url:this._checkInService.GetAddPassengerInformationLinkUrl(n.PassengerCode)},Event:{Action:Tracking.EventConstants.Actions.AddApis,Label:Tracking.EventConstants.Labels.PassengerInformation},Message:this._helpingHandModel.AddPassengerInfoBeforeCheckInText}},t.prototype.AllPassengersCompletedQueryAndCheckedIn=function(){return{Button:{Action:this.GetBoardingPasses,Enabled:!0,Text:this._helpingHandModel.BoardingPassesAvailableButtonText,Url:""},Event:{Action:Tracking.EventConstants.Actions.GetBoardingPasses,Label:Tracking.EventConstants.Labels.BoardingPasses},Message:this._helpingHandModel.BoardingPassesAvailableText}},t.prototype.AllPassengersCompletedQueryAndWithinCheckInWindow=function(){var n=this;return{Button:{Action:function(){n._checkInService.GoToCheckInSelectFlights(n._flights)},Enabled:!0,Text:this._helpingHandModel.PassengersReadyToCheckInButtonText,Url:""},Event:{Action:Tracking.EventConstants.Actions.PassengersReadyToCheckIn,Label:Tracking.EventConstants.Labels.CompleteCheckIn},Message:this._helpingHandModel.PassengersReadyToCheckInText}},t.prototype.AllPassengersCompletedQueryAndOutsideCheckInWindow=function(n){var i=this._helpingHandModel.MaximumDaysUntilCheckIn,t="";return t=n.CheckInState.DaysUntilCheckIn>i?this._helpingHandModel.CheckInIsNotAvailableText:this._helpingHandModel.CheckInOpensInSeveralDaysText.replace("{days}",n.CheckInState.DaysUntilCheckIn.toString().htmlEncode()),{Button:{Action:"",Enabled:!1,Text:"",Url:""},Event:{Action:"",Label:""},Message:t}},t.prototype.SomePassengersCompletedQuery=function(n,t){var i=this._helpingHandModel.PassengerAmountProvidedInfoText.replace("{passengers-completed-apis-count}",n.toString().htmlEncode()).replace("{total-passengers}",t.toString().htmlEncode());return{Button:{Action:"",Enabled:!1,Text:"",Url:""},Event:{Action:"",Label:""},Message:i}},t.prototype.GetBoardingPasses=function(){},t.ServiceName="CheckInHelpingHand_Service",t.$inject=["Sitecore_CheckInBooking_HelpingHandSettings","CheckIn_Service","IAnalyticsTracker",],t}();t.CheckInHelpingHandService=i})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._checkedIn="CheckedIn";this._contactInformationComplete="ContactInformationComplete";this._passengerInformationComplete="PassengerInformationComplete";this._passengerDisplayService=n}return t.prototype.GetBookingResponseToBookingFlights=function(t){var i=this,r=t.Flights.map(function(t){var r=t.Passengers.map(function(n){return i.GetBookingResponsePassengerToBookingPassenger(n)});return{FlightCardFlight:i.GetBookingResponseFlightToFlightCardFlight(t),Status:n.Data.ManageBookings.FlightStatus.Parse(t.Status),Passengers:r,CheckInState:t.CheckinState,LeadPassenger:r.filter(function(n){return n.PassengerCode===t.LeadPassengerCode})[0],IsApisRequired:t.IsApisRequired}});return r.sort(function(n,t){return n.FlightCardFlight.LocalDepartureTime.ToSortable()-t.FlightCardFlight.LocalDepartureTime.ToSortable()})},t.prototype.GetSavedDocumentsResponseToTravelDocuments=function(n){var t=this;return n.SavedDocuments?n.SavedDocuments.map(function(n){return t.LocalisedTravelDocumentModelToLocalisedTravelDocument(n)}):[]},t.prototype.LocalisedTravelDocumentModelToLocalisedTravelDocument=function(t){return{CountryOfIssue:t.CountryOfIssue,DateOfBirth:Utilities.ZonelessDateTime.FromIso8601(t.DateOfBirth),DocumentExpiryDate:Utilities.ZonelessDateTime.FromIso8601(t.DocumentExpiryDate),DocumentNumber:t.DocumentNumber,DocumentType:t.DocumentType,Gender:n.Data.Common.Gender.Parse(t.Gender),Nationality:t.Nationality,MarkedForDeletion:!1}},t.prototype.GetBookingResponseFlightToFlightCardFlight=function(t){var i=n.Data.ManageBookings.FlightStatus.Parse(t.Status);return{CarrierCode:t.CarrierCode,FlightNumber:t.FlightNumber,SegmentId:t.SegmentId,FlightKey:t.SegmentId,DepartureIata:t.DepartureIata,ArrivalIata:t.ArrivalIata,LocalDepartureTime:Utilities.ZonelessDateTime.FromIso8601(t.LocalDepartureTime),LocalArrivalTime:Utilities.ZonelessDateTime.FromIso8601(t.LocalArrivalTime),IsCancelled:i==n.Data.ManageBookings.FlightStatus.Cancelled,IsDisrupted:i==n.Data.ManageBookings.FlightStatus.Delayed,IsStandBy:i==n.Data.ManageBookings.FlightStatus.StandBy,IsFlexi:n.Data.Common.FlightFareType.Parse(t.FareType)===n.Data.Common.FlightFareType.Flexi,DepTerminalName:t.DepTerminalName,ArrTerminalName:t.ArrTerminalName,FlightTaxes:null}},t.prototype.GetBookingResponsePassengerToBookingPassenger=function(t){return{Type:n.Data.Common.PassengerDataType.Parse(t.Type),FullName:this._passengerDisplayService.GetDisplayName(t),PassengerCode:t.PassengerCode,HasCompletedApis:this.CheckCompletedApis(t.Status),IsCheckedIn:this.CheckCheckedIn(t.Status),OnlineBoardingPassAvailable:t.OnlineBoardingPassAvailable,Age:t.Age,AssociatedAdultPassengerCode:t.AssociatedAdultPassengerCode,HasCompletedContactInformation:this.CheckCompletedContactInformation(t.Status)}},t.prototype.CheckCompletedContactInformation=function(n){return n===this._contactInformationComplete||n===this._checkedIn},t.prototype.CheckCheckedIn=function(n){return n===this._checkedIn},t.prototype.CheckCompletedApis=function(n){return n===this._passengerInformationComplete||n===this._checkedIn},t.ServiceName="CheckIn_Mapper",t.$inject=["Common_PassengerDisplayService"],t}();t.CheckInMapper=i})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f){this._bookingModel=n;this._checkInPassengerCookieService=t;this._manageBookingsService=i;this._navigationService=r;this._passengerDisplayService=u;this._routesService=new Main3.Routes.RoutesService(f)}return t.prototype.GoToCheckInSelectFlights=function(t){if(t.length!==0)if(t.length===1&&this.FlightIsAvailableForCheckIn(t[0]))this.GoToCheckInSelectPassengers(t);else{var i={Flights:t};n.Events.OpenDrawerWithOptions({SectionKey:"check-in-flights",Parameters:i})}},t.prototype.GoToCheckInSelectPassengers=function(t){var i=this.PassengerCodesReadyToCheckIn(t,!1),r;i.length!==0&&(i.length===1?this.GoToCheckInConfirmation(t,this.PassengerCodesReadyToCheckIn(t,!0)):(r={Flights:t},n.Events.OpenDrawerWithOptions({SectionKey:"check-in-passengers",Parameters:r})))},t.prototype.GoToCheckInConfirmation=function(n,t){var r=this.MapToSelectedFlightWithPassengers(n,t),i;this._checkInPassengerCookieService.WriteCookie(r);i=this._manageBookingsService.ApplyBookingReferenceToUrl(this._bookingModel.CheckInRedirectUrl);this._navigationService.NavigateTo(i)},t.prototype.MapToSelectedFlightWithPassengers=function(n,t){for(var r=[],i=0,u=n;i<u.length;i++){var f=u[i],o=this.PassengerCodesReadyToCheckIn([f],!0),e=o.filter(function(n){return t.indexOf(n)>=0});e.length>0&&r.push({SegmentId:f.FlightCardFlight.SegmentId,Passengers:e})}return r},t.prototype.FlightIsAvailableForCheckIn=function(n){return this.MapFlightToCheckInDrawerFlight(n).IsEnabled},t.prototype.PassengerCodesReadyToCheckIn=function(n,t){return this.MapSelectedPassengersToPassengerCodes(this.MapFlightPassengersToCheckInDrawerPassengers(n),t)},t.prototype.MapSelectedPassengersToPassengerCodes=function(n,t){return n.filter(function(n){return n.IsSelected}).reduce(function(n,i){return n.push(i.PassengerCode),t&&!!i.AssociatedInfant&&n.push(i.AssociatedInfant.PassengerCode),n},[])},t.prototype.MapFlightToCheckInDrawerFlight=function(t){var r=t.Passengers.filter(function(n){return!n.IsCheckedIn}).length==0,u=t.Passengers.filter(function(n){return n.HasCompletedApis}).length==0,i=t.Status===n.Data.ManageBookings.FlightStatus.Cancelled,f=!t.CheckInState.WithinCheckInWindow&&!t.CheckInState.AfterCheckInWindow,e=t.CheckInState.AfterCheckInWindow,o=r||u||i||f||e;return{SegmentId:t.FlightCardFlight.SegmentId,OriginAirportName:this._routesService.FindAirportByIata(t.FlightCardFlight.DepartureIata).Name,DestinationAirportName:this._routesService.FindAirportByIata(t.FlightCardFlight.ArrivalIata).Name,LocalDepartureTime:t.FlightCardFlight.LocalDepartureTime,IsSelected:!o,IsEnabled:!o,IsCancelled:i,IsCheckInClosed:e&&!i,IsCheckInUnavailable:f&&!i,IsNobodyReadyToCheckIn:u&&!i,IsAlreadyCheckedIn:r&&!i,DaysUntilCheckInOpen:t.CheckInState.DaysUntilCheckIn}},t.prototype.MapFlightPassengersToCheckInDrawerPassengers=function(n){for(var r,u,f=[],t=n.reduce(function(n,t){for(var i,r=0,u=t.Passengers;r<u.length;r++)i=u[r],n.ContainsKey(i.PassengerCode)?n.Get(i.PassengerCode).push(i):n.Set(i.PassengerCode,[i]);return n},new Dictionary),i=0,e=t.AllKeys();i<e.length;i++){var o=e[i],s=t.Get(o),h=s.filter(function(n){return!!n.AssociatedAdultPassengerCode}).length>0;h||(r=this.GetDepedantInfantPassengerCode(n,o),u=null,!r||(u=this.BuildCheckInPassenger(t.Get(r))),f.push(this.BuildCheckInPassenger(s,u)))}return f},t.prototype.GetDepedantInfantPassengerCode=function(n,t){for(var o,r,f,e,i=0,u=n;i<u.length;i++)for(o=u[i],r=0,f=o.Passengers;r<f.length;r++)if(e=f[r],e.AssociatedAdultPassengerCode===t)return e.PassengerCode;return null},t.prototype.BuildCheckInPassenger=function(n,t){t===void 0&&(t=null);var r=n.filter(function(n){return!n.IsCheckedIn}).length>0,u=n.filter(function(n){return!n.HasCompletedApis}).length>0,i=r&&!u;return!t||t.IsEnabled||(i=!1),{Age:this._passengerDisplayService.GetAgeDisplayText(n[0].Type,n[0].Age),FullName:n[0].FullName,PassengerCode:n[0].PassengerCode,IsAlreadyCheckedIn:!r,IsMissingApis:u,IsEnabled:i,IsSelected:i,AssociatedInfant:t}},t.prototype.GetAddPassengerInformationLinkUrl=function(n){var t=this._bookingModel.AddPassengerInformationLinkUrl;return t=this._manageBookingsService.ApplyBookingReferenceToUrl(t),this._manageBookingsService.ApplyPassengerCodeToUrl(t,n)},t.prototype.GetManageDisruptionLinkUrl=function(n){return this._manageBookingsService.ManageDisruptionLinkReplacements(this._bookingModel.ManageDisruptionLinkUrl,n.FlightCardFlight)},t.ServiceName="CheckIn_Service",t.$inject=["Sitecore_CheckInBooking","CheckInPassengersCookie_Service","ManageBookings_Service","Common_NavigationService","Common_PassengerDisplayService","Sitecore_RoutesData"],t}();t.CheckInService=i})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(){function t(t,i,r,u){this._qService=t;this._funnelApi=i;this._priceService=r;this._errorService=u;this._cacheDurationMilliseconds=6e4;this._flightItemChargesDataMapper=new n.Funnel.Flight.FlightItemChargesDataMapper;this._flightChargesCache=new CacheStore(this._cacheDurationMilliseconds)}return t.prototype.GetFlightItemCharges=function(n,t,i){var r=this,u=i.map(function(n){return n.Flight.SegmentId});return this._flightChargesCache.Get(JSON.stringify({currencyCode:n,languageCode:t,flightSegmentIds:u}),function(){return r.GetFlightItemChargesFromServer(n,t,i)}).then(function(n){var t=i.filter(function(n){return n.Flight.IsFlexi});return t.length<0&&(n=r.RemoveCreditCardFee(n,t)),n})},t.prototype.GetFlightItemChargesFromServer=function(n,t,i){var u=this,r=this._qService.defer(),f=i.map(function(n){return n.Flight.SegmentId});return this._funnelApi.GetFlightCharges(n,t,f,function(n){var t=u._flightItemChargesDataMapper.MapFromBasketFlightChargeListApi(n);r.resolve(t)},function(n,t,i,f){u._errorService.HandleApiError(n,t,i,f);r.reject()}),r.promise},t.prototype.RemoveCreditCardFee=function(n,t){var i=this;return angular.extend(n).forEach(function(n){t.forEach(function(t){t.Flight.SegmentId===n.SegmentId&&(n.HoldLuggage.Amount=i._priceService.RemoveCreditCardFee(n.HoldLuggage.Amount),n.SmallHoldLuggage&&(n.SmallHoldLuggage.Amount=i._priceService.RemoveCreditCardFee(n.SmallHoldLuggage.Amount)),n.HoldLuggageExcessWeight.Amount=i._priceService.RemoveCreditCardFee(n.HoldLuggageExcessWeight.Amount),n.LargeSportsEquipment.Amount=i._priceService.RemoveCreditCardFee(n.LargeSportsEquipment.Amount),n.SmallSportsEquipment.Amount=i._priceService.RemoveCreditCardFee(n.SmallSportsEquipment.Amount),n.StandardSeat.Amount=i._priceService.RemoveCreditCardFee(n.StandardSeat.Amount),n.VouchersCost&&(n.VouchersCost.Amount=i._priceService.RemoveCreditCardFee(n.VouchersCost.Amount)),n.VouchersRedeemableAmount&&(n.VouchersRedeemableAmount.Amount=i._priceService.RemoveCreditCardFee(n.VouchersRedeemableAmount.Amount)))})}),n},t.ServiceName="Funnel_FlightItemChargeService",t.$inject=["$q","Funnel_Api","Common_PriceService","ManageBookings_Funnel_ErrorService"],t}();t.FlightItemChargeService=i})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(n){function t(t,i,r,u){return n.call(this,t,i,r,u,"DA-MNB",Main3.Cookies.CookieConstants.Names.RebookingPodIdentifier)||this}return __extends(t,n),t.prototype.QueryBookings=function(n,t,i){this.AjaxRequest("GET","manage-bookings/querybookings",n,t,this.ExtractKnownError(i),"ManageBookings.QueryBookings",!0)},t.prototype.ViewBooking=function(n,t,i){this.AjaxRequest("GET","manage-bookings/viewbooking",{BookingReference:n},t,this.ExtractKnownError(i),"ManageBookings.ViewBooking",!0)},t.prototype.RequestPaymentConfirmation=function(n,t,i){this.AjaxRequest("GET","manage-bookings/requestpaymentconfirmation",{BookingReference:n},t,this.ExtractKnownError(i),"ManageBookings.RequestPaymentConfirmation",!0)},t.prototype.RequestVatInvoice=function(n,t,i){this.AjaxRequest("GET","manage-bookings/requestvatinvoice",{BookingReference:n},t,this.ExtractKnownError(i),"ManageBookings.RequestVatInvoice",!0)},t.ServiceName="ManageBookings_Api",t.$inject=["ClientApi_Service","$http","$httpParamSerializer","IAnalyticsTracker"],t}(n.QueuedBaseApiService);t.ManageBookingsApi=i})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this._viewBookingModel=n;this._luggageService=t}return t.prototype.ViewBookingResponseToViewBookingFlights=function(n){var t=this,i=this.BuildLuggageText(n),r=n.Flights.map(function(n){return t.ViewBookingResponseFlightToViewBookingFlight(n,i)});return r.sort(function(n,t){return n.FlightCardFlight.LocalDepartureTime.ToSortable()-t.FlightCardFlight.LocalDepartureTime.ToSortable()})},t.prototype.ViewBookingResponseToViewBookingPayments=function(t){var i=t.Payments.map(function(t){return{PaymentMethod:n.Data.Common.Api.PaymentMethod.Parse(t.PaymentMethod),TransactionType:n.Data.Common.Api.TransactionType.Parse(t.TransactionType),Price:t.Price,CurrencyCode:t.CurrencyCode,PaymentDate:Utilities.ZonelessDateTime.FromIso8601(t.PaymentDate),PaymentInformation:{CardInformation:{CardType:n.Data.Common.PaymentMethodType.Parse(t.PaymentInformation.CardInformation.CardType),LastFourDigits:t.PaymentInformation.CardInformation.LastFourDigits,CardholderName:t.PaymentInformation.CardInformation.CardholderName,ExpiryMonth:t.PaymentInformation.CardInformation.ExpiryMonth,ExpiryYear:t.PaymentInformation.CardInformation.ExpiryYear,ValidFromMonth:t.PaymentInformation.CardInformation.ValidFromMonth,ValidFromYear:t.PaymentInformation.CardInformation.ValidFromYear}}}});return i.sort(function(n,t){return t.PaymentDate.ToSortable()-n.PaymentDate.ToSortable()})},t.prototype.BuildLuggageText=function(t){for(var f,i,e,o,r=[],u=0,s=t.HoldBags;u<s.length;u++)f=s[u],r.push(this._luggageService.FormatBag({Description:f.Weight.toString(),Quantity:f.Quantity,Type:n.Data.Controls.DisplayItemType.StandardBag}));for(i=0,e=t.SportsEquipment;i<e.length;i++)o=e[i],r.push(this._luggageService.FormatSportsEquipment({Description:o.Code,Quantity:o.Quantity,Type:n.Data.Controls.DisplayItemType.SportsItem}));return r},t.prototype.ViewBookingResponseFlightToViewBookingFlight=function(n,t){var i=this.ViewBookingResponseFlightToFlightCardFlight(n),r=_(n.Passengers).chain().map(function(n){return n.SeatNumber}).filter(function(n){return!!n}).unique().value(),u=!i.IsCancelled&&!i.IsFlown&&!n.CheckinState.AfterCheckInWindow;return{FlightCardFlight:i,AfterCheckInWindow:n.CheckinState.AfterCheckInWindow,DaysUntilCheckIn:n.CheckinState.DaysUntilCheckIn,WithinCheckInWindow:n.CheckinState.WithinCheckInWindow,ShowDisruptionLink:n.AllowManageDisruption,ShowSeats:n.ShowSeatsInformation,AllowEditSeats:n.AllowManageSeats,HasSeatsSelected:r.length>0,NumberOfSeatsSelected:r.length,ListOfSeatNumbers:r.join(", "),AddSeatsLinkUrl:this._viewBookingModel.SeatsLinkTargetUrl,ShowLuggage:n.ShowLuggageInformation,AllowEditLuggage:n.AllowManageLuggage,HasLuggageSelected:t.length>0,ListOfLuggageSelected:t.join(", "),AddLuggageLinkUrl:this._viewBookingModel.LuggageLinkTargetUrl,ShowPassengers:n.ShowPassengerInformation,ListOfPassengers:this.BuildPassengerBreakdown(n).join(", "),Passengers:this.BuildPassengerComposition(n),ShowChangeFlightLink:n.AllowChangeFlight,ChangeFlightLinkUrl:this._viewBookingModel.ChangeFlightLinkTargetUrl,CheckInApplicable:n.CheckInApplicable}},t.prototype.BuildPassengerComposition=function(t){var i=t.Passengers.map(function(t){return n.Data.Common.PassengerDataType.Parse(t.Type)});return{Adults:i.filter(function(t){return t===n.Data.Common.PassengerDataType.Adult}).length,Children:i.filter(function(t){return t===n.Data.Common.PassengerDataType.Child}).length,Infants:i.filter(function(t){return t===n.Data.Common.PassengerDataType.Infant}).length}},t.prototype.BuildPassengerBreakdown=function(t){var i=t.Passengers.map(function(t){return n.Data.Common.PassengerDataType.Parse(t.Type)}),r=[this.BuildPassengerText(this._viewBookingModel.SingularAdultText,this._viewBookingModel.MultipleAdultText,i,n.Data.Common.PassengerDataType.Adult),this.BuildPassengerText(this._viewBookingModel.SingularChildText,this._viewBookingModel.MultipleChildText,i,n.Data.Common.PassengerDataType.Child),this.BuildPassengerText(this._viewBookingModel.SingularInfantText,this._viewBookingModel.MultipleInfantText,i,n.Data.Common.PassengerDataType.Infant)];return r.filter(function(n){return!!n})},t.prototype.BuildPassengerText=function(n,t,i,r){var u=i.filter(function(n){return n===r}).length;return u<1?null:u===1?n.replace("{amount}",u.toString()):t.replace("{amount}",u.toString())},t.prototype.ViewBookingResponseFlightToFlightCardFlight=function(t){var i=n.Data.ManageBookings.FlightStatus.Parse(t.Status);return{CarrierCode:t.CarrierCode,FlightNumber:t.FlightNumber,SegmentId:t.SegmentId,FlightKey:t.SegmentId,DepartureIata:t.DepartureIata,ArrivalIata:t.ArrivalIata,LocalDepartureTime:Utilities.ZonelessDateTime.FromIso8601(t.LocalDepartureTime),LocalArrivalTime:Utilities.ZonelessDateTime.FromIso8601(t.LocalArrivalTime),IsCancelled:i==n.Data.ManageBookings.FlightStatus.Cancelled,IsDisrupted:i==n.Data.ManageBookings.FlightStatus.Delayed,IsStandBy:i==n.Data.ManageBookings.FlightStatus.StandBy,IsFlown:t.HasFlown,IsCheckInClosed:t.CheckinState.AfterCheckInWindow,IsFlexi:n.Data.Common.FlightFareType.Parse(t.FareType)===n.Data.Common.FlightFareType.Flexi,DepTerminalName:t.DepTerminalName,ArrTerminalName:t.ArrTerminalName,FlightTaxes:null}},t.ServiceName="ManageBookings_Mapper",t.$inject=["Sitecore_ViewBooking","Controls_LuggageService"],t}();t.ManageBookingsMapper=i})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._queryString=new Urls.QueryString(n.location.href)}return n.prototype.ApplyBookingReferenceToUrl=function(t,i){i===void 0&&(i=null);i=i||this.GetCurrentBookingReference();var r=new Urls.UrlBuilder(t);return r.AddQueryParameter(n.BookingReferenceQueryParameterName,i),r.GetUrl()},n.prototype.ApplyPassengerCodeToUrl=function(t,i){var r=new Urls.UrlBuilder(t);return r.AddQueryParameter(n.PassengerCodeQueryParameterName,i),r.GetUrl()},n.prototype.GetCurrentBookingReference=function(){return this._queryString.GetParameter(n.BookingReferenceQueryParameterName,!0)},n.prototype.GetCurrentPassengerCode=function(){return this._queryString.GetParameter(n.PassengerCodeQueryParameterName,!0)},n.prototype.ManageDisruptionLinkReplacements=function(n,t){return n=n.replace("%7Bbooking-reference%7D",this.GetCurrentBookingReference()),n=n.replace("{booking-reference}",this.GetCurrentBookingReference()),n=n.replace("%7Bflight-id%7D",t.SegmentId),n.replace("{flight-id}",t.SegmentId)},n.BookingReferenceQueryParameterName="b",n.PassengerCodeQueryParameterName="p",n.ServiceName="ManageBookings_Service",n.$inject=["$window"],n}();n.ManageBookingsService=t})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function t(n){this._funnelJourneySettings=n}return t.prototype.DisableAddSeating=function(n){return this.ShouldDisableSeatingDueToMaxPassengersOnAllFlights(n)||this.ShouldDisableSeatingDueToNoFlightsAvailable(n)},t.prototype.ShouldDisableSeatingDueToMaxPassengersOnAllFlights=function(t){var i=this;return t.every(function(t){var r=n.Funnel.ManageBookingFunnelBasketMapper.BuildPassengerComposition(t.Passengers);return i.ShouldDisableSeatingDueToMaxPassengers(r)})},t.prototype.ShouldDisableSeatingDueToMaxPassengers=function(n){return this.ThereAreMorePassengersInBookingThan(n,this.GetMaxPassengersForSeating())},t.prototype.ThereAreMorePassengersInBookingThan=function(n,t){var i=n.Adults+n.Children+n.Infants;return i>t},t.prototype.ShouldDisableSeatingDueToSeatsBooked=function(n){return n.some(function(n){return!!n.Seating&&!!n.Seating.Booked&&n.Seating.Booked.length>0})},t.prototype.IsFlightAvailable=function(n){var t=n.Flight;return!t.IsCancelled&&!t.IsFlown&&!t.IsCheckInClosed},t.prototype.ShouldDisableSeatingDueToNoFlightsAvailable=function(n){var t=this;return n.every(function(n){return!t.IsFlightAvailable(n)})},t.prototype.GetMaxPassengersForSeating=function(){return Main3.Common.BreakPointService.IsMobile()?this._funnelJourneySettings.SeatingMobileMaxPassengers:this._funnelJourneySettings.SeatingDesktopAndTabletMaxPassengers},t.ServiceName="ManageBookings_SkipPageService",t.$inject=["Sitecore_FunnelJourneySettings"],t}();n.ManageBookingsSkipPageService=t})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){var i=function(n){function t(t,i,r,u){return n.call(this,t,i,r,u,"DA-MBF",Main3.Cookies.CookieConstants.Names.RebookingPodIdentifier)||this}return __extends(t,n),t.prototype.CreateBasket=function(n,t,i){this.AjaxRequest("POST","manage-booking-funnel/createbasket",n,t,this.ExtractKnownError(i),"ManageBookingFunnel.CreateBasket",!0)},t.prototype.GetBasket=function(n,t){this.AjaxRequest("GET","manage-booking-funnel/getbasket",null,n,this.ExtractKnownError(t),"ManageBookingFunnel.GetBasket",!0)},t.prototype.UpdateSeatsForFlight=function(n,t,i){this.AjaxRequest("POST","manage-booking-funnel/updateseatsforflight",n,t,this.ExtractKnownError(i),"ManageBookingFunnel.UpdateSeatsForFlight",!0)},t.ServiceName="ManageBookings_Funnel_Api",t.$inject=["ClientApi_Service","$http","$httpParamSerializer","IAnalyticsTracker"],t}(n.QueuedBaseApiService);t.ManageBookingFunnelApi=i})(i=t.Funnel||(t.Funnel={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n){this._priceMapper=n}return t.BuildPassengerComposition=function(t){var i=t.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Adult}).length,r=t.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Child}).length,u=t.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Infant}).length;return{Adults:i,Children:r,Infants:u}},t.prototype.MapApiBasketToClientBasket=function(t){var i=this;return{BookingReference:t.BookingReference,CurrencyCode:t.CurrencyCode,LanguageCode:t.LanguageCode,Flights:t.Flights.map(function(t){return{FareType:n.Data.Common.FlightFareType.Parse(t.FareType),CheckInState:t.CheckInState,Flight:i.MapApiFlightToFlightCardFlight(t.Flight,t.CheckInState),Passengers:t.Passengers.map(i.MapApiPassenger),Seating:i.MapApiSeating(t.Seating)}}),LuggageBooked:{HoldBags:this.CreateClientBags(t.Bags),SportsEquipment:this.CreateClientSportsEquipments(t.SportsEquipment)},LuggageChanges:null}},t.prototype.MapApiFlightToFlightCardFlight=function(n,t){return!n?null:{ArrivalIata:n.ArrivalIata,ArrTerminalName:n.ArrTerminalName,CarrierCode:n.CarrierCode,DepartureIata:n.DepartureIata,DepTerminalName:n.DepTerminalName,FlightKey:n.FlightKey,FlightNumber:n.FlightNumber,InternalId:n.InternalId,LocalArrivalTime:Utilities.ZonelessDateTime.FromIso8601(n.LocalArrivalTime),LocalDepartureTime:Utilities.ZonelessDateTime.FromIso8601(n.LocalDepartureTime),SegmentId:n.SegmentId,IsDisrupted:!1,IsCancelled:!1,IsFlown:!1,IsCheckInClosed:!t?!1:t.AfterCheckInWindow,FlightTaxes:n.FlightTaxes}},t.prototype.MapApiPassenger=function(t){return!t?null:{AssociatedInfantPassengerCode:t.AssociatedInfantPassengerCode,FirstName:t.FirstName,HasSpecialServiceRequests:t.HasSpecialServiceRequests,HasEjPlusCard:t.HasEjPlusCard,LastName:t.LastName,PassengerCode:t.PassengerCode,Title:t.Title,Type:n.Data.Common.PassengerDataType.Parse(t.Type)}},t.prototype.MapApiSeating=function(n){return!n?null:{CanEditSeating:n.CanEditSeating,Booked:this.MapApiSeatAssociations(n.Booked),Changes:this.MapApiSeatAssociations(n.Changes)}},t.prototype.MapApiSeatAssociations=function(n){var t=this;return!n?null:n.map(function(n){return{DisplayName:n.DisplayName,PassengerCode:n.PassengerCode,PricePerSeat:t._priceMapper.MapFromApi(n.PricePerSeat),Quantity:n.Quantity,SeatNumber:n.SeatNumber}})},t.prototype.CreateClientBags=function(n){var t=this;return _(n).map(function(n){return t.CreateClientBag(n)})},t.prototype.CreateClientBag=function(t){return{PassengerInternalId:t.PassengerInternalId,TotalWeight:t.TotalWeight,TotalPrice:this._priceMapper.MapFromNumbers(t.TotalPriceWithCreditCard,t.TotalPrice),ExcessWeightSteps:t.ExcessWeightSteps,Quantity:t.Quantity,IsFlexiFareBag:t.IsFlexiFareBag,Type:n.Data.Funnel.BagType.Parse(t.Type)}},t.prototype.CreateClientSportsEquipments=function(n){var t=this;return _(n).map(function(n){return t.CreateClientSportsEquipment(n)})},t.prototype.CreateClientSportsEquipment=function(n){return{PassengerInternalId:n.PassengerInternalId,DisplayName:n.DisplayName,Quantity:n.Quantity,Type:n.Type,Price:this._priceMapper.MapFromNumbers(n.PriceWithCreditCard,n.Price),IsLarge:n.IsLarge,TotalWeight:n.TotalWeight}},t.ServiceName="ManageBookings_Funnel_BasketMapper",t.$inject=["Funnel_PriceDataMapper"],t}();t.ManageBookingFunnelBasketMapper=i})(i=t.Funnel||(t.Funnel={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._priceService=n;this._priceMapper=t;this._basketMapper=i}return n.prototype.GetBasket=function(){return this._clientBasket},n.prototype.GetFlightByInternalId=function(n){var t=this.GetBasket().Flights.filter(function(t){return t.Flight.InternalId===n});if(t&&t.length===1)return t[0];throw new Error("Could not find flight with ID = "+n);},n.prototype.GetPassengerByInternalId=function(n,t,i){var u=this.GetFlightByInternalId(n),r=u.Passengers.filter(function(n){return n.PassengerCode===t});if(r&&r.length===1)return r[0];if(i)throw new Error("Could not find passenger with ID = "+t+" in flight with ID = "+n);else return null},n.prototype.GetBookedSeatForPassengerByInternalId=function(n,t){var i=this.GetFlightByInternalId(n),r;return!!i.Seating&&!!i.Seating.Booked&&(r=i.Seating.Booked.filter(function(n){return n.PassengerCode===t}),r.length>0)?r[0]:null},n.prototype.SetClientBasketFromServer=function(n){this._priceService.SetCurrencyCode(n.CurrencyCode);this._clientBasket=this._basketMapper.MapApiBasketToClientBasket(n)},n.ServiceName="ManageBookings_Funnel_ClientBasketService",n.$inject=["Common_PriceService","Funnel_PriceDataMapper","ManageBookings_Funnel_BasketMapper"],n}();n.ManageBookingFunnelClientBasketService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r;(function(i){var r=function(i){function r(n,t,r,u){var f=i.call(this,n,t)||this;return f._journeySettings=r,f._window=u,f}return __extends(r,i),r.prototype.Exit=function(i){var r=this._journeySettings.SignedInExitPageUrl;t.Account.AccountService.IsSignedIn!==n.Data.Account.SignedInStatus.SignedIn&&(r=this._journeySettings.SignedOutExitPageUrl);this.LogError(i);t.Common.ErrorService.IsExiting=!0;this._tracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.Alert,Tracking.EventConstants.Actions.ManageBookingFunnelExitReason,i,r)},r.ServiceName="ManageBookings_Funnel_ErrorService",r.$inject=["IAnalyticsTracker","Cookies_BaseCookieService","Sitecore_ManageBookingsFunnelJourneySettings","$window"],r}(t.Common.ErrorService);i.ManageBookingFunnelErrorService=r})(r=i.Funnel||(i.Funnel={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f,e,o){this._dataMapper=u;this._funnelApi=f;this._errorService=e;this._luggageLimitsService=o;this._qService=t;this._funnelBasketService=i;this._funnelLuggageDataMapper=r}return t.prototype.GetClientBasketBags=function(){if(!(this._funnelBasketService.GetBasket().LuggageBooked&&this._funnelBasketService.GetBasket().LuggageBooked.HoldBags))return[];var n=this._funnelBasketService.GetBasket().Flights.length;return this._funnelLuggageDataMapper.MapBasketHoldBagsToFunnelBags(this._funnelBasketService.GetBasket().LuggageBooked.HoldBags,n)},t.prototype.GetClientBasketSportsEquipment=function(){if(!(this._funnelBasketService.GetBasket().LuggageBooked&&this._funnelBasketService.GetBasket().LuggageBooked.SportsEquipment))return[];var n=this._funnelBasketService.GetBasket().Flights.length;return this._funnelLuggageDataMapper.MapSportEquipmentToFunnelSportsEquipment(this._funnelBasketService.GetBasket().LuggageBooked.SportsEquipment,n)},t.prototype.PassengerIds=function(){return this._funnelBasketService.GetBasket().Flights[0].Passengers.map(function(n){return n.PassengerCode})},t.prototype.AdultPassengerIds=function(){return _(this._funnelBasketService.GetBasket().Flights[0].Passengers).select(function(t){return t.Type===n.Data.Common.PassengerDataType.Adult}).map(function(n){return n.PassengerCode})},t.prototype.ChildPassengerIds=function(){return _(this._funnelBasketService.GetBasket().Flights[0].Passengers).select(function(t){return t.Type===n.Data.Common.PassengerDataType.Child}).map(function(n){return n.PassengerCode})},t.prototype.InfantPassengerIds=function(){return[]},t.prototype.AddBagToServerBasket=function(n){var i=this,t=this._qService.defer(),r=this.GetLuggageAddRequest(n,null);return this._funnelApi.AddLuggage(r,function(n){var r=i._dataMapper.CreateClientBasket(n);t.resolve(r)},this.DeferredBasketResponseError(t)),t.promise},t.prototype.RemoveBagFromServerBasket=function(n){var i=this,t=this._qService.defer(),r=this.GetClientBasketBags(),u=r[n],f=this.GetRemoveLuggageRequest(u);return this._funnelApi.RemoveLuggage(f,function(n){var r=i._dataMapper.CreateClientBasket(n);t.resolve(r)},this.DeferredBasketResponseError(t)),t.promise},t.prototype.AddSportsEquipmentToServerBasket=function(n){var i=this,t=this._qService.defer(),r=this.GetLuggageAddRequest(null,n);return this._funnelApi.AddLuggage(r,function(n){var r=i._dataMapper.CreateClientBasket(n);t.resolve(r)},this.DeferredBasketResponseError(t)),t.promise},t.prototype.RemoveSportsEquipmentFromServerBasket=function(n){var i=this,t=this._qService.defer(),r=this.GetClientBasketSportsEquipment(),u=r[n],f=this.GetRemoveLuggageRequest(null,u);return this._funnelApi.RemoveLuggage(f,function(n){var r=i._dataMapper.CreateClientBasket(n);t.resolve(r)},this.DeferredBasketResponseError(t)),t.promise},t.prototype.DeferredBasketResponseError=function(n){var t=this;return function(i,r,u){t._errorService.HandleApiError(i,r,u);n.reject()}},t.prototype.GetRemoveLuggageRequest=function(n,t){var i={Bag:null,SportsEquipment:null},r,u;return!n||(r=this._funnelLuggageDataMapper.ToApiHoldBagModel(n,n.PassengerInternalId),i.Bag=r),!t||(u=this._funnelLuggageDataMapper.ToApiSportsEquipmentModel(t,t.PassengerInternalId),i.SportsEquipment=u),i},t.prototype.GetLuggageAddRequest=function(n,t){var e=this,r={Bag:null,SportsEquipment:null},f;if(!!n){var o=this.GetClientBasketBags(),s=this.MapFunnelBagToHoldBagModel(o),u=this.FindValidPassengerIdForBag(this.PassengerIds(),s,n);u&&(f=this._funnelLuggageDataMapper.ToApiHoldBagModel(n,u),r.Bag=f)}if(!!t){var h=this.GetClientBasketSportsEquipment(),c=this.MapFunnelSportsEquipmentToSportsEquipmentModel(h),i=null;_(this.PassengerIds()).forEach(function(n){i||(i=e.TryAssignSportsEquipmentToPassenger(n,t,c),!i||(r.SportsEquipment=i))})}return r},t.prototype.UpdateLuggageOnServer=function(n,t){var r=this,i=this._qService.defer();return this.GetLuggageUpdateRequestFromModels(n,t).then(function(n){r._funnelApi.UpdateLuggage(n,function(){return i.resolve()},r.DeferredError(i))}),i.promise},t.prototype.GetLuggageUpdateRequest=function(){var n=this.GetClientBasketBags(),t=this.GetClientBasketSportsEquipment();return this.GetLuggageUpdateRequestFromModels(n,t)},t.prototype.GetLuggageUpdateRequestFromModels=function(n,t){var i=this,r;return n.length==0&&t.length==0?(r={Bags:[],SportsEquipment:[]},this._qService.now(r)):this._luggageLimitsService.Initialize().then(function(){return{Bags:i.MapFunnelBagToHoldBagModel(n),SportsEquipment:i.MapFunnelSportsEquipmentToSportsEquipmentModel(t)}})},t.prototype.UpdateClientBasketFromServer=function(t){var i=this._funnelBasketService.GetBasket();i.LuggageBooked=t;n.Events.Fire(n.Events.Names.Funnel.LuggageUpdated);n.Events.Fire(n.Events.Names.Basket.HeightModified)},t.prototype.UpdateClientBasket=function(t,i){var r=this._funnelBasketService.GetBasket();r.LuggageBooked=this._funnelLuggageDataMapper.ToClientBasketLuggage(t,i);n.Events.Fire(n.Events.Names.Funnel.LuggageUpdated);n.Events.Fire(n.Events.Names.Basket.HeightModified)},t.prototype.RemoveAllLuggageFromClientBasket=function(){this.UpdateClientBasket([],[])},t.prototype.ClientHasAnyLuggage=function(){return this.GetClientBasketBags().length>0||this.GetClientBasketSportsEquipment().length>0},t.prototype.ClientHasPaidLuggage=function(){return this.GetClientBasketBags().some(function(n){return!n.IsFlexiFareBag})||this.GetClientBasketSportsEquipment().length>0},t.prototype.DeferredError=function(n){var t=this;return function(i,r,u){t._errorService.HandleApiError(i,r,u);n.reject()}},t.prototype.MapFunnelBagToHoldBagModel=function(n){var t=this,i=[],r=_(n).sortBy(function(n){return n.IsFlexiFareBag?0:1});return r.forEach(function(n){var r=t.FindValidPassengerIdForBag(t.PassengerIds(),i,n);r&&i.push(t._funnelLuggageDataMapper.ToApiHoldBagModel(n,r))}),i},t.prototype.FindValidPassengerIdForBag=function(n,t,i){for(var u,e=function(r){var u=n[r],e=t.filter(function(n){return n.PassengerInternalId===u}),o=f.GetBagLimitForPassenger(u),s=f.GetFlexiFareBagLimitForPassenger(u);if(e.length<o&&(!i.IsFlexiFareBag||e.filter(function(n){return n.IsFlexiFareBag}).length<s))return{value:u}},f=this,r=0;r<n.length;r++)if(u=e(r),typeof u=="object")return u.value;return null},t.prototype.MapFunnelSportsEquipmentToSportsEquipmentModel=function(n){var t=[];return this.AssignSportsEquipmentToPassengers(n,t),t},t.prototype.AssignSportsEquipmentToPassengers=function(n,t){var i=this;_(this.PassengerIds()).forEach(function(r){for(var u=0,e=i.GetSportsEquipmentLimitForPassenger(r),f;i.PassengerCanHaveMoreItems(t.length,n.length,u,e);)f=n[t.length],t.push(i._funnelLuggageDataMapper.ToApiSportsEquipmentModel(f,r)),u++})},t.prototype.TryAssignSportsEquipmentToPassenger=function(n,t,i){var r=i.filter(function(t){return t.PassengerInternalId===n}).length||0,u=this.GetSportsEquipmentLimitForPassenger(n);return this.PassengerCanHaveMoreItems(i.length,i.length+1,r,u)?this._funnelLuggageDataMapper.ToApiSportsEquipmentModel(t,n):null},t.prototype.PassengerCanHaveMoreItems=function(n,t,i,r){return n<t&&i<r},t.prototype.GetSportsEquipmentLimitForPassenger=function(){return 0},t.prototype.GetBagLimitForPassenger=function(){return 0},t.prototype.GetFlexiFareBagLimitForPassenger=function(){return 0},t.prototype.PassengerIsCarryingInfant=function(){return!1},t.prototype.GetBasketPassengerById=function(){return null},t.ServiceName="ManageBookings_Funnel_BasketLuggageService",t.$inject=["$rootScope","$q","ManageBookings_Funnel_ClientBasketService","Funnel_LuggageDataMapper","Funnel_FunnelDataMapper","Funnel_Api","ManageBookings_Funnel_ErrorService","ManageBookings_Funnel_LuggageLimitsService"],t}();t.ManageBookingFunnelBasketLuggageService=i})(i=t.Funnel||(t.Funnel={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._qService=n;this._api=t;this._clientBasketService=i;this._errorService=r}return t.prototype.CreateBasket=function(n){var i=this,t=this._qService.defer();return this._api.CreateBasket({BookingReference:n},function(n){i._clientBasketService.SetClientBasketFromServer(n);t.resolve(n)},function(n,r,u,f){t.reject();i._errorService.HandleApiError(n,r,u,f)}),t.promise},t.prototype.GetBasket=function(){var t=this,n=this._qService.defer();return this._api.GetBasket(function(i){t._clientBasketService.SetClientBasketFromServer(i);n.resolve(i)},function(i,r,u,f){n.reject();t._errorService.HandleApiError(i,r,u,f)}),n.promise},t.prototype.UpdateSeatsForFlight=function(n){var r=this,t=this._qService.defer(),i=this._clientBasketService.GetFlightByInternalId(n),u={FlightId:i.Flight.SegmentId,Associations:this.MapSeatChangesToUpdateAssociations(i.Seating.Changes)};return this._api.UpdateSeatsForFlight(u,function(){t.resolve()},function(n,i,u,f){t.reject();r._errorService.HandleApiError(n,i,u,f)}),t.promise},t.prototype.MapSeatChangesToUpdateAssociations=function(t){return t?t.map(function(t){return{PassengerCode:t.PassengerCode,SeatNumber:t.SeatNumber,Price:t.PricePerSeat[n.Data.Common.PaymentType.DebitCard]}}):[]},t.ServiceName="ManageBookings_Funnel_ServerBasketService",t.$inject=["$q","ManageBookings_Funnel_Api","ManageBookings_Funnel_ClientBasketService","ManageBookings_Funnel_ErrorService"],t}();t.ManageBookingFunnelServerBasketService=i})(i=t.Funnel||(t.Funnel={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u,f){this._qService=n;this._rootScope=t;this._errorService=i;this._queryCookieService=r;this._journeyCookieService=u;this._serverBasketService=f;this._startedUp=!1}return t.prototype.StartUp=function(){var n=this;if(this._startedUp){console.warn("Funnel start up has already been called, ignoring duplicate");return}this._startedUp=!0;this.EnsureSignedIn().then(function(){var t=n.DetermineCookieStateAndWhetherIsStartingUpFromDeepLink();t?n.InitialiseFunnelWithNewBasket():n.InitialiseFunnelWithExistingBasket()})},t.prototype.DetermineCookieStateAndWhetherIsStartingUpFromDeepLink=function(){var t=this._queryCookieService.HasValidCookie(),i=this._journeyCookieService.HasValidCookie(),n;return t?(n=this._queryCookieService.ReadCookie(),this._journeyCookieService.RemoveCookie(),this._journeyCookieService.WriteCookie({BackToViewBooking:!0,BookingReference:n.BookingReference,SeatMapFirstFlightSegmentId:n.FlightId}),this._queryCookieService.RemoveCookie(),!0):(i||(this._journeyCookieService.RemoveCookie(),this._queryCookieService.RemoveCookie(),this._errorService.Exit("ManageBookingFunnelStartupService - Journey cookie missing")),!1)},t.prototype.EnsureSignedIn=function(){var i=this,t=this._qService.defer();return this._rootScope.$on(n.Events.Names.Account.SignInStatusChanged,this.OnSignInStatusChanged.bind(this,t)),this._rootScope.$on(n.Events.Names.Account.GetSignInStatusFailed,function(){i._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Account,Tracking.EventConstants.GenericErrorDrawerLabels.SignInStatusFailed)}),t.promise},t.prototype.OnSignInStatusChanged=function(t,i,r){r===n.Data.Account.SignedInStatus.NotSignedIn||r===n.Data.Account.SignedInStatus.Unknown||r===n.Data.Account.SignedInStatus.SoftSignedIn?this._errorService.Exit("ManageBookingFunnelStartupService - Not signed in"):t.resolve()},t.prototype.InitialiseFunnelWithNewBasket=function(){var n=this._journeyCookieService.ReadCookie();this._serverBasketService.CreateBasket(n.BookingReference).then(this.OnServerBasketSuccess.bind(this))},t.prototype.InitialiseFunnelWithExistingBasket=function(){this._serverBasketService.GetBasket().then(this.OnServerBasketSuccess.bind(this))},t.prototype.OnServerBasketSuccess=function(t){var i=this._journeyCookieService.ReadCookie();if(t.BookingReference!==i.BookingReference){this._errorService.Exit("ManageBookingFunnelStartupService - Basket booking refrence did not match journey cookie");return}n.Events.Fire(n.Events.Names.Funnel.FunnelReady)},t.ServiceName="ManageBookings_Funnel_StartupService",t.$inject=["$q","$rootScope","ManageBookings_Funnel_ErrorService","ManageBookingQuery_Service","ManageBookingJourney_Service","ManageBookings_Funnel_ServerBasketService"],t}();t.ManageBookingFunnelStartupService=i})(i=t.Funnel||(t.Funnel={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u){this._qService=n;this._priceService=t;this._basketService=i;this._flightItemChargeService=r;this._skipPageService=u;this._isSelected=null;this._isVisible=null;this._isCtaVisible=null}return n.prototype.GetPrice=function(){var i=this,n=this._basketService.GetBasket(),t=this._qService.defer();return this._flightItemChargeService.GetFlightItemCharges(n.CurrencyCode,n.LanguageCode,n.Flights).then(function(n){if(n){var r=n.map(function(n){return n.StandardSeat.Amount}).sort(function(n,t){return i._priceService.Compare(n,t)})[0];t.resolve(r)}},function(){t.reject()}),t.promise},n.prototype.IsSelected=function(){if(this._isSelected==null){var n=this._basketService.GetBasket();this._isSelected=n.Flights.some(function(n){return!!n.Seating&&!!n.Seating.Booked&&n.Seating.Booked.some(function(n){return!!n.SeatNumber})})}return this._isSelected},n.prototype.IsVisible=function(){if(this._isVisible==null)if(this.IsSelected())this._isVisible=!0;else{var n=this._basketService.GetBasket().Flights;this._isVisible=!this._skipPageService.ShouldDisableSeatingDueToNoFlightsAvailable(n)&&!this._skipPageService.ShouldDisableSeatingDueToMaxPassengersOnAllFlights(n)}return this._isVisible},n.prototype.IsCtaVisible=function(){if(this._isCtaVisible==null)if(this.IsVisible()){var n=this._basketService.GetBasket().Flights;this._isCtaVisible=n.some(function(n){return!n.Flight.IsCheckInClosed})&&!this._skipPageService.ShouldDisableSeatingDueToMaxPassengersOnAllFlights(n)}else this._isCtaVisible=!1;return this._isCtaVisible},n.prototype.GetImageSettings=function(n){var t=this._qService.defer();return t.resolve({ExtraImage:n.ExtraImage,ExtraHoverImage:n.ExtraHoverImage,ExtraImageAlternativeText:n.ExtraImageAlternativeText}),t.promise},n.ServiceName="ManageBookings_Funnel_ExtraPanelSeatsStrategy",n.$inject=["$q","Common_PriceService","ManageBookings_Funnel_ClientBasketService","Funnel_FlightItemChargeService","ManageBookings_SkipPageService"],n}();n.ExtraPanelSeatsService=t})(t=n.Funnel||(n.Funnel={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._injector=n}return n.prototype.GetStrategy=function(n){switch(n){case 2:return this._injector.get("ManageBookings_Funnel_ExtraPanelSeatsStrategy");case 3:return null;case 4:return null}return null},n.ServiceName="ManageBookings_Funnel_ExtraPanelStrategyService",n.$inject=["$injector"],n}();n.ExtraPanelStrategyService=t})(t=n.Extras||(n.Extras={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._extrasSettings=n}return n.prototype.GetExtraPanelsToDisplay=function(){return this._extrasSettings.Panels},n.ServiceName="ManageBookings_Funnel_ExtrasService",n.$inject=["Sitecore_ManageBookingFunnelExtraSettings",],n}();n.ManageBookingFunnelExtrasService=t})(t=n.Extras||(n.Extras={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(n){function t(t,i,r,u,f,e){var o=n.call(this,t,f,i)||this;return o._priceService=r,o._flightItemChargeService=u,o._basketService=e,o}return __extends(t,n),t.prototype.GetBasketCharges=function(){var t=this,n=this._basketService.GetBasket();return this._flightItemChargeService.GetFlightItemCharges(n.CurrencyCode,n.LanguageCode,n.Flights).then(function(n){t._basketCharges=n})},t.prototype.GetFlightItemChargesFromServer=function(){var n=this._basketService.GetBasket();return this._flightItemChargeService.GetFlightItemCharges(n.CurrencyCode,n.LanguageCode,n.Flights)},t.prototype.CalculateTotalLuggagePrice=function(n,t){var u=this,r=this._priceService.NewPrice(0,0),i=[];return i=!n?i:i.concat(n),i=!t?i:i.concat(t),_(i).each(function(n){r=u._priceService.Add(r,n.Price)}),r},t.ServiceName="ManageBookings_Funnel_LuggageChargesService",t.$inject=["$q","Funnel_LuggageRulesService","Common_PriceService","Funnel_FlightItemChargeService","Funnel_LuggageChargesDataMapperService","ManageBookings_Funnel_ClientBasketService"],t}(n.Funnel.Luggage.BaseLuggageChargesService);t.LuggageChargesService=i})(i=t.Luggage||(t.Luggage={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r;(function(i){var r;(function(i){var r=function(t){function i(n,i){var r=t.call(this,n)||this;return r._funnelBasketService=i,r}return __extends(i,t),i.prototype.HasReachedMaximumBaggageAllowance=function(n){return(n||[]).length>=this.GetTotalBagsAllowed()},i.prototype.GetTotalBagsAllowed=function(){var t=this.GetFlightWithMostPassengers(),i=t.Passengers.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Adult||t.Type===n.Data.Common.PassengerDataType.Child}),u=t.Passengers.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Infant}),r=_(i).filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Adult}).length*this._luggageRules.LuggageRules.Bags.MaxBagsPerAdult;return r+=_(i).filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Child}).length*this._luggageRules.LuggageRules.Bags.MaxBagsPerChild,r+u.length*this._luggageRules.LuggageRules.Bags.MaxBagsPerInfant},i.prototype.GetPassengerComposition=function(){var t=this.GetFlightWithMostPassengers(),i=t.Passengers.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Adult}),r=t.Passengers.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Child}),u=t.Passengers.filter(function(t){return t.Type===n.Data.Common.PassengerDataType.Infant});return{Adults:i.length,Children:r.length,Infants:u.length}},i.prototype.GetFlightWithMostPassengers=function(){var t=this._funnelBasketService.GetBasket(),n=t.Flights[0];return t.Flights.forEach(function(t){t.Passengers.length>n.Passengers.length&&(n=t)}),n},i.FlexiFareBagsLimitPerAdult=1,i.FlexiFareBagsLimitPerChild=1,i.FlexiFareBagsLimitPerInfant=0,i.ServiceName="ManageBookings_Funnel_LuggageLimitsService",i.$inject=["Funnel_LuggageRulesService","ManageBookings_Funnel_ClientBasketService"],i}(t.Funnel.Luggage.BaseLuggageLimitsService);i.LuggageLimitsService=r})(r=i.Luggage||(i.Luggage={}))})(r=i.Funnel||(i.Funnel={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t){this._basketService=n;this._priceService=t}return t.prototype.SetSeatAssignment=function(n,t){var i=this._basketService.GetFlightByInternalId(n),r=!1,u;i.Seating.Booked&&i.Seating.Booked.length>0&&(u=i.Seating.Booked.filter(function(n){return n.SeatNumber===t.Seat.SeatNumber&&n.PassengerCode===t.Passenger.Id}),r=u.length>0);r||(i.Seating.Changes=i.Seating.Changes?i.Seating.Changes.filter(function(n){return n.PassengerCode!=t.Passenger.Id}):[],i.Seating.Changes.push({DisplayName:t.Seat.PriceBandDisplayName,PassengerCode:t.Passenger.Id,PricePerSeat:this._priceService.NewPrice(t.Seat.PriceWithCreditCardFee,t.Seat.Price),SeatNumber:t.Seat.SeatNumber}))},t.prototype.AlertSeatsInBasketUpdated=function(){},t.prototype.GetFlightAssociationsForFlight=function(t){var i=this,r=this._basketService.GetFlightByInternalId(t),u=[];return r.Passengers.forEach(function(f){if(f.Type!==n.Data.Common.PassengerDataType.Infant){var e=i.GetAssignedSeatForPassenger(r.Seating,f.PassengerCode),o=i._basketService.GetPassengerByInternalId(t,f.AssociatedInfantPassengerCode,!1);u.push({FlightInternalId:t,PassengerInternalId:f.PassengerCode,CarriedInfantId:!o?null:o.PassengerCode,Seat:!e?null:{IsRestricted:!1,Price:e.PricePerSeat[n.Data.Common.PaymentType.DebitCard],PriceWithCreditCardFee:e.PricePerSeat[n.Data.Common.PaymentType.CreditCard],PriceBand:e.DisplayName,PriceBandDisplayName:e.DisplayName,PriceBandId:null,SeatNumber:e.SeatNumber}})}}),u},t.prototype.GetAssignedSeatForPassenger=function(n,t){var i=null,r,u;return n&&n.Booked&&(r=n.Booked.filter(function(n){return n.PassengerCode===t}),r.length>0&&(i=r[0])),n&&n.Changes&&(u=n.Changes.filter(function(n){return n.PassengerCode===t}),u.length>0&&(i=u[0])),i},t.prototype.ClearSeatsForFlight=function(n){var t=this._basketService.GetFlightByInternalId(n);t.Seating.Changes=[]},t.ServiceName="ManageBookings_Funnel_SeatMapAssociationsService",t.$inject=["ManageBookings_Funnel_ClientBasketService","Common_PriceService"],t}();t.ManageBookingSeatMapAssociationsService=i})(i=t.SeatMap||(t.SeatMap={}))})(i=t.Funnel||(t.Funnel={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._qService=n;this._basketService=t;this._journeyCookieService=i;this._skipPageService=r;this._allFlightData=null;this._currentFlightIndex=0}return t.prototype.GetAllFlightData=function(){var t=this,n;return this._allFlightData||(n=this._basketService.GetBasket(),this._allFlightData=n.Flights.filter(function(n){return t.IsAvailableForSeatMap(n)}).map(function(t){return{CurrencyCode:n.CurrencyCode,FareType:t.FareType,FlightInternalId:t.Flight.InternalId,FlightNumber:t.Flight.FlightNumber,JourneyPairId:null,LanguageCode:n.LanguageCode,SegmentId:new Flights.SegmentId(t.Flight.SegmentId),IsUnavailable:!1,AircraftType:""}}),this.UpdateCurrentIndexFromJourneyCookie()),this._allFlightData},t.prototype.IsAvailableForSeatMap=function(t){var i=n.ManageBookings.Funnel.ManageBookingFunnelBasketMapper.BuildPassengerComposition(t.Passengers);return!t.Flight.IsCancelled&&!t.Flight.IsCheckInClosed&&!this._skipPageService.ShouldDisableSeatingDueToMaxPassengers(i)},t.prototype.UpdateCurrentIndexFromJourneyCookie=function(){for(var t,i=this._journeyCookieService.ReadCookie().SeatMapFirstFlightSegmentId,n=0;n<this._allFlightData.length;n++)if(t=this._allFlightData[n],t.SegmentId.ToString()===i){this._currentFlightIndex=n;this._journeyCookieService.UpdateCookie(function(n){return n.SeatMapFirstFlightSegmentId=""});return}},t.prototype.GetCurrentFlightData=function(){return this.GetAllFlightData()[this._currentFlightIndex]},t.prototype.GetFlightDataForFlightInternalId=function(n){var t=this.GetAllFlightData().filter(function(t){return t.FlightInternalId===n});return t&&t.length>0?t[0]:null},t.prototype.IsLoaded=function(){return this._qService.now()},t.prototype.LoadNext=function(){this._currentFlightIndex++},t.prototype.HasNext=function(){return this._currentFlightIndex+1<this.GetAllFlightData().length},t.prototype.ShouldLoadNext=function(){return this.HasNext()},t.prototype.GetCurrentFlightIndex=function(){return this._currentFlightIndex},t.prototype.SetAircraftType=function(){},t.prototype.MarkFlightAsUnavailable=function(n){var t=Utilities.Arrays.FirstOrDefault(this.GetAllFlightData(),function(t){return t.FlightInternalId==n.FlightInternalId});!t||(t.IsUnavailable=!0)},t.prototype.GetRemainingFlightDataCount=function(){return this.GetAllFlightData().length-(this._currentFlightIndex+1)},t.prototype.SetSkipAllFlights=function(){},t.ServiceName="ManageBookings_Funnel_SeatMapFlightDataService",t.$inject=["$q","ManageBookings_Funnel_ClientBasketService","ManageBookingJourney_Service","ManageBookings_SkipPageService"],t}();t.ManageBookingSeatMapFlightDataService=i})(i=t.SeatMap||(t.SeatMap={}))})(i=t.Funnel||(t.Funnel={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t){this._basketService=n;this._passengerDisplayService=t}return t.prototype.GetPassengers=function(t){var r=this,u=this._basketService.GetFlightByInternalId(t),i=0;return u.Passengers.filter(function(t){return t.Type!==n.Data.Common.PassengerDataType.Infant}).map(function(n){return i++,r.BuildSeatMapPassenger(n,i,t)})},t.prototype.BuildSeatMapPassenger=function(t,i,r){var e=this._passengerDisplayService.GetDisplayName(t),u={FallBackSeatNumber:null,FallBackSeatData:null,CarriedInfantDisplayName:null,DisplayName:e,FullDisplayName:e,Id:t.PassengerCode,Initials:this._passengerDisplayService.GetPassengerInitials(t,i),RequiresSpecialAssistance:t.HasSpecialServiceRequests,Type:t.Type===n.Data.Common.PassengerDataType.Adult?0:2},o=this._basketService.GetPassengerByInternalId(r,t.AssociatedInfantPassengerCode,!1),f;return!o||(u.Type=1,u.CarriedInfantDisplayName=this._passengerDisplayService.GetDisplayName(o),u.FullDisplayName=u.DisplayName+" "+u.CarriedInfantDisplayName),f=this._basketService.GetBookedSeatForPassengerByInternalId(r,t.PassengerCode),!f||(u.FallBackSeatNumber=f.SeatNumber),u},t.ServiceName="ManageBookings_Funnel_SeatMapPassengerService",t.$inject=["ManageBookings_Funnel_ClientBasketService","Common_PassengerDisplayService"],t}();t.ManageBookingSeatMapPassengerService=i})(i=t.SeatMap||(t.SeatMap={}))})(i=t.Funnel||(t.Funnel={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i;(function(t){var i;(function(t){var i=function(){function t(n,t,i){this._basketService=n;this._flightDataService=t;this._seatAssignmentService=i}return t.prototype.IsCurrentFlightReadOnly=function(){var t=this._flightDataService.GetCurrentFlightData(),n=this._basketService.GetFlightByInternalId(t.FlightInternalId);return!!n&&!!n.Seating&&!n.Seating.CanEditSeating?!0:!1},t.prototype.IsPassengerReadOnly=function(){var t=this._flightDataService.GetCurrentFlightData(),n=this._basketService.GetFlightByInternalId(t.FlightInternalId);return!!n&&!n.Seating.CanEditSeating?!0:!1},t.prototype.IsSeatReadOnly=function(n){var i=this._flightDataService.GetCurrentFlightData(),t=this._basketService.GetFlightByInternalId(i.FlightInternalId);return!!t&&(!t.Seating.CanEditSeating||this.IsSeatNumberBookedOnFlight(t,n))?!0:!1},t.prototype.IsSeatNumberBookedOnFlight=function(n,t){var i;if(!!n.Seating&&!!n.Seating.Booked&&(i=n.Seating.Booked.filter(function(n){return n.SeatNumber===t}),i.length>0)){var r=!1,f=i[0].PassengerCode,u=this._seatAssignmentService.GetAssignedSeatForPassengerId(f);if(u&&u.Seat.SeatNumber===t||(r=!0),!r)return!0}return!1},t.ServiceName="ManageBookings_Funnel_SeatMapReadOnlyService",t.$inject=["ManageBookings_Funnel_ClientBasketService",n.DynamicDependencyKeys.SeatMapFlightDataService,"SeatMapSeatAssignmentService"],t}();t.ManageBookingSeatMapReadOnlyService=i})(i=t.SeatMap||(t.SeatMap={}))})(i=t.Funnel||(t.Funnel={}))})(i=t.ManageBookings||(t.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.prototype.CanSelectSameSeats=function(){return!1},n.prototype.HasOutboundSeatsAssigned=function(){return!1},n.prototype.SelectSameSeats=function(){throw new Error("Method not implemented.");},n.prototype.HasSelectedSameSeats=function(){return!1},n.prototype.IsReturnFlight=function(){return!1},n.ServiceName="ManageBookings_Funnel_SeatMapSameSeatService",n.$inject=[],n}();n.ManageBookingSeatMapSameSeatService=t})(t=n.SeatMap||(n.SeatMap={}))})(t=n.Funnel||(n.Funnel={}))})(t=n.ManageBookings||(n.ManageBookings={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(n){function t(t,i,r,u,f,e){var o=n.call(this,r,u,f,e,"DA-PER",Main3.Cookies.CookieConstants.Names.RebookingPodIdentifier)||this;return o._qService=t,o._accountService=i,o}return __extends(t,n),t.prototype.GetPersonalisationContext=function(){var t=this,n=this._qService.defer();return this._accountService.IsSignedIn()?this.AjaxRequest("GET","personalisation/getpersonalisationcontext",null,function(t){return n.resolve(t)},function(){return t.HandleApiError(n)},"Personalisation.GetPersonalisationContext",!0):n.resolve(this.DefaultPersonalisationContext()),n.promise},t.prototype.HandleApiError=function(n){n.resolve(this.DefaultPersonalisationContext())},t.prototype.DefaultPersonalisationContext=function(){return{}},t.ServiceName="Personalisation_ApiService",t.$inject=["$q","Account_Service","ClientApi_Service","$http","$httpParamSerializer","IAnalyticsTracker"],t}(n.AuthenticatedBaseApiService);t.PersonalisationApiService=i})(t=n.Personalisation||(n.Personalisation={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i){this._qService=n;this._sessionStorageService=t;this._apiService=i}return n.prototype.ResetPersonalisation=function(){this._personalisationDataPromise=null;this._sessionStorageService.ClearPersonalisationContext()},n.prototype.GetPersonalisationContext=function(){return this._personalisationDataPromise||(this._personalisationDataPromise=this.GetPersonalisationContextInternal()),this._personalisationDataPromise},n.prototype.GetPersonalisationContextInternal=function(){var n=this._qService.defer(),t=this._sessionStorageService.GetPersonalisationContext();return t?n.resolve(t):n.resolve({NextFlight:null}),n.promise},n.ServiceName="Personalisation_DataService",n.$inject=["$q","Personalisation_SessionStorageService","Personalisation_ApiService"],n}();n.PersonalisationDataService=t})(t=n.Personalisation||(n.Personalisation={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._personalisationContextSessionStorageKey="PersonalisationContext";this._sessionStorageService=n}return n.prototype.GetPersonalisationContext=function(){return this._sessionStorageService.GetItem(this._personalisationContextSessionStorageKey)},n.prototype.SetPersonalisationContext=function(n){this._sessionStorageService.SetItem(this._personalisationContextSessionStorageKey,n)},n.prototype.ClearPersonalisationContext=function(){return this._sessionStorageService.RemoveItem(this._personalisationContextSessionStorageKey)},n.ServiceName="Personalisation_SessionStorageService",n.$inject=["SessionStorage_Service"],n}();n.PersonalisationSessionStorageService=t})(t=n.Personalisation||(n.Personalisation={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(n){function t(t,i,r,u){var f=n.call(this,t,i,r,"DA-PRC","CMSPOD")||this;return f._baseUrl=Urls.UrlBuilder.UrlWithTrailingSlash(u.PricingApiUrl),f}return __extends(t,n),t.prototype.Search=function(n,t,i){var r={MaxResults:n.MaxResults,MaxPrice:n.MaxPrice,OriginIatas:this.FormatIatasForApi(n.OriginIatas),PreferredOriginIatas:this.FormatIatasForApi(n.PreferredOriginIatas),AllOrigins:n.AllOrigins,DestinationIatas:this.FormatIatasForApi(n.DestinationIatas),AllDestinations:n.AllDestinations,StartDate:n.StartDate?n.StartDate.ToIso8601():null,EndDate:n.EndDate?n.EndDate.ToIso8601():null,CurrencyId:n.CurrencyId,AdminFeePerBooking:n.AdminFeePerBooking,CreditCardFeePercent:n.CreditCardFeePercent,AssumedPassengersPerBooking:n.AssumedPassengersPerBooking,AssumedSectorsPerBooking:n.AssumedSectorsPerBooking};this.AjaxRequest("GET",this._baseUrl+"flights/search",r,t,i,"Flights.Search",!0)},t.prototype.FormatIatasForApi=function(n){return n&&n.length>0?n.join(","):null},t.ServiceName="Pricing_Api",t.$inject=["$http","$httpParamSerializer","IAnalyticsTracker","pricingClientSettings"],t.UseMocks=!1,t}(n.BaseApiService);t.PricingApi=i})(t=n.Pricing||(n.Pricing={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var r=function(){function i(n){this._api=n}return i.prototype.GetBasket=function(n,t){this._api.GetBasket(this.OnGetBasketSuccess.bind(this,n),t)},i.prototype.GetBookings=function(n,t,i){this._api.GetBookings(n,t,i)},i.prototype.OnGetBasketSuccess=function(n,i){for(var f,o,e,r=null,u=0;u<i.Flights.length;u++)if(f=i.Flights[u],f.IsFocalFlight){r=f;break}o=new t.RebookingDataMapper(r.OriginalFlight.SegmentId);e=o.CreateClientBasket(i);this.HandleHotacIntegration(e,r);n&&n(e)},i.prototype.HandleHotacIntegration=function(t,i){var r=Main3.Common.BookingPassengers.CreateFromBasket(t),u={DepartureIata:i.OriginalFlight.DepartureIata,FlightNumber:this.GetFlightNumberWithCarrierCode(i),FlightDate:this.GetFlightDate(i)},f={BookingReference:t.BookingReference,FlightId:null,Surname:r.GetPrimaryLastName(i.OriginalFlight.InternalId)};n.Events.Fire(n.Events.Names.HotAcc.CheckIsFlightDisrupted,u,f)},i.prototype.GetFlightNumberWithCarrierCode=function(n){var t=n.OriginalFlight.FlightNumber.toString(),i=(n.OriginalFlight.CarrierCode||"").toUpperCase();return i+t},i.prototype.GetFlightDate=function(n){return Utilities.ZonelessDateTime.FromIso8601(n.OriginalFlight.LocalDepartureTime).Date().ToIso8601()},i.ServiceName="Rebooking_ConfirmationService",i.$inject=["Rebooking_Api"],i}(),i;t.ConfirmationService=r;i=function(){function n(){}return n.BasketNotFinalised="Basket Not Finalised",n.NotAuthorised="Not Authorised",n}();t.ConfirmationServiceError=i})(i=t.Rebooking||(t.Rebooking={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this._rootScope=n;this._settings=t;this._titleBarInstance=Title.TitleBar.Instance}return t.prototype.HandleUpdate=function(t,i){var r=i.Disruption=="Level1"?this._settings.Level1PageTitle:this._settings.Level3PageTitle,u;r&&(u=this.GetFocalFlight(t,i),this.BuildAndShowTitle(u,r));n.Events.Fire(n.Events.Names.TitleBar.ShowIcon,!0)},t.prototype.BuildAndShowTitle=function(n,t){var i=this.BuildUpdatedFlightTitle(n,t);this._titleBarInstance.HideAndThenShowText(i)},t.prototype.GetFocalFlight=function(n,t){var i=t.Flights.filter(function(n){return n.IsFocalFlight});return i.length>0?i[0]:null},t.prototype.BuildUpdatedFlightTitle=function(n,t){var i=this.BuildFlightNumberWithCarrierCode(n);return this.FormatTitleText(t,i)},t.prototype.BuildFlightNumberWithCarrierCode=function(n){var t=n.CarrierCode?n.CarrierCode.toUpperCase():"",i=n.FlightNumber.toString();return t+i},t.prototype.FormatTitleText=function(n,t){return n.replace("{flight number}",t)},t.ServiceName="Rebooking_DynamicTitleService",t.$inject=["$rootScope","Sitecore_RebookingPageTextSettings"],t}();t.DynamicTitleService=i})(i=t.Rebooking||(t.Rebooking={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u){this._rootScope=n;this._clientSettings=t;this._rbkApi=i;this._accountService=r;this._errorService=u}return t.prototype.GetBookings=function(n,t){var i=this;t===void 0&&(t=null);this._rbkApi.GetBookings(n,function(r){i.OnGetBookingsSuccess(r,n,function(){return i.OnNoBookingsForFlight(n,t)},t)},function(r,u){i.OnGeneralError(n,r,u,Tracking.EventConstants.GenericErrorDrawerLabels.GetBookings);t&&t()},this.GetCurrentBookingReferenceFromQueryString())},t.prototype.HandleResponse=function(n,t){var i=this;this.OnGetBookingsSuccess(n,t,function(){return i.OnNoBookingsForFlight(t)})},t.prototype.RedirectToRebooking=function(n,t){var i=new Urls.UrlBuilder(this._clientSettings.RebookingPageUrl);i.AddQueryParameter("FlightId",n);!t||i.AddQueryParameter("BookingRef",t);window.location.href=i.GetUrl()},t.prototype.CreateBasket=function(n,t,i,r){var u=this;i===void 0&&(i=null);this._rbkApi.CreateBasket(n,t,function(){u.OnCreateBasketSuccess(t);i&&i()},function(n,r){u.OnGeneralError(t,n,r,Tracking.EventConstants.GenericErrorDrawerLabels.CreateBasket);i&&i()},!!r)},t.prototype.OnGeneralError=function(n,t,i,r){r===void 0&&(r=Tracking.EventConstants.Labels.Error);t!=401&&this._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Rebooking,r)},t.prototype.OnGetBookingsSuccess=function(t,i,r,u){if(u===void 0&&(u=null),t.Bookings.length>1){var f={FlightSegmentId:i,BookingsData:t};n.Events.OpenDrawerWithOptions({AllowBackOverride:n.Data.DrawerBackOverride.FromSitecore,SectionKey:"rebooking-pickbooking",Parameters:f});u&&u()}else t.Bookings.length==1?this.CheckForUnmanageableBooking(t.Bookings[0])?this.CreateBasket(t.Bookings[0].BookingReference,i,u,!0):u&&u():r&&r()},t.prototype.OnNoBookingsForFlight=function(n,t){var i=this;t===void 0&&(t=null);this._accountService.GetUsername(function(r){i.OnGetUsernameSuccess(r,n);t&&t()},function(){i.OnGetUsernameError(n);t&&t()})},t.prototype.OnGetUsernameSuccess=function(n,t){var i=this;this._accountService.SignOut(function(){i.OpenLoginDrawer(t,!0,n.Username)})},t.prototype.OnGetUsernameError=function(n){this.OpenLoginDrawer(n,!0)},t.prototype.OpenLoginDrawer=function(t,i,r){var e=this,u,f;i===void 0&&(i=!1);r===void 0&&(r="");u={PreFillUsername:r,PreFillDynamicMessage:i?this._clientSettings.RebookingRootSettings.NoBookingsMessage:"",AfterSignIn:function(n){return e.AfterSignIn(n,t)},UserInitiatedSignIn:!1};f={SectionKey:"sign-in",PreventDismissOverride:!1,Parameters:u,ShowAfterActionComplete:!0};n.Events.OpenDrawerWithOptions(f)},t.prototype.AfterSignIn=function(n,t){var i=this;this._rbkApi.GetBookings(t,function(r){return i.OnGetBookingsSuccess(r,t,function(){return n.DynamicErrorMessage=i._clientSettings.RebookingRootSettings.NoBookingsMessage})},function(n,r){return i.OnGeneralError(t,n,r,Tracking.EventConstants.GenericErrorDrawerLabels.GetBookings)},this.GetCurrentBookingReferenceFromQueryString())},t.prototype.CheckForUnmanageableBooking=function(t){var r=t.IsManageable,i;return r?t.IsWorldwide?(i={SectionKey:"rebooking-worldwide-disruption",AllowBackOverride:n.Data.DrawerBackOverride.AlwaysHide,OnConfirmCallback:function(){n.Events.CloseDrawer()}},n.Events.OpenDrawerWithOptions(i),!1):!0:(n.Events.OpenDrawer("rebooking-unmanageable-error"),!1)},t.prototype.OnCreateBasketSuccess=function(n){this.RedirectToRebooking(n,this.GetCurrentBookingReferenceFromQueryString())},t.prototype.GetCurrentBookingReferenceFromQueryString=function(){var n=new Urls.QueryString(window.location.href);return n.GetParameter("BookingRef",!0)},t.ServiceName="Rebooking_PickBookingService",t.$inject=["$rootScope","Sitecore_RebookingClientSettings","Rebooking_Api","Account_Service","Error_Service"],t}();t.PickBookingService=i})(i=t.Rebooking||(t.Rebooking={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(n){function t(t,i,r,u){return n.call(this,t,i,r,u,"DA-RBK",Main3.Cookies.CookieConstants.Names.RebookingPodIdentifier)||this}return __extends(t,n),t.prototype.GetHeaders=function(){var n=null;return t.UseMocks&&(n={"EJ-Rebooking-UseMocks":"true"}),n},t.prototype.GetBookings=function(n,t,i,r){var u={FlightSegmentId:n,BookingReference:r};this.AuthenticatedAjaxRequest("GET","rebooking/getbookings",u,t,this.ExtractKnownError(i),"Rebooking.GetBookings",!0)},t.prototype.CreateBasket=function(n,t,i,r,u){var f={IsSoleBookingForUser:u,BookingReference:n,FocalFlightSegmentId:t};this.AuthenticatedAjaxRequest("POST","rebooking/createbasket",f,i,this.ExtractKnownError(r),"Rebooking.CreateBasket",u)},t.prototype.GetBasket=function(n,t){this.AuthenticatedAjaxRequest("GET","rebooking/getbasket",null,n,this.ExtractKnownError(t),"Rebooking.GetBasket",!0)},t.prototype.UpdateBasketFlight=function(n,t,i,r,u){var f={SegmentId:n,Modification:t,ReplacementFlight:this.ConvertReplacementFlight(i)};this.AuthenticatedAjaxRequest("POST","rebooking/updatebasketflight",f,r,this.ExtractKnownError(u),"Rebooking.UpdateBasketFlight")},t.prototype.Finalize=function(n,t){this.AuthenticatedAjaxRequest("POST","rebooking/finalize",null,n,this.ExtractKnownError(t),"Rebooking.Finalize")},t.prototype.ConvertReplacementFlight=function(n){return n==null?null:{InternalId:n.InternalId,CarrierCode:n.CarrierCode,FlightNumber:n.FlightNumber,SegmentId:n.SegmentId,ArrivalIata:n.ArrivalIata,DepartureIata:n.DepartureIata,ArrTerminalName:n.ArrTerminalName,DepTerminalName:n.DepTerminalName,LocalDepartureTime:n.LocalDepartureTime.ToIso8601(),LocalArrivalTime:n.LocalArrivalTime.ToIso8601()}},t.ServiceName="Rebooking_Api",t.$inject=["ClientApi_Service","$http","$httpParamSerializer","IAnalyticsTracker"],t.UseMocks=!1,t}(n.AuthenticatedBaseApiService);t.RebookingApi=i})(t=n.Rebooking||(n.Rebooking={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._focalFlightSegmentId=n.toUpperCase()}return t.prototype.CreateClientBasket=function(n){return{IsSoleBookingForUser:n.IsSoleBookingForUser,CanBeFinalised:n.CanBeFinalised,HasBeenFinalised:n.HasBeenFinalised,BookingReference:n.BookingReference,Flights:this.CreateClientFlights(n.Flights),Associations:n.Associations,Passengers:this.CreateClientPassengers(n.Passengers),CarriedInfants:this.CreateClientInfants(n.CarriedInfants),Luggage:{HoldBags:this.CreateClientBags(n.Bags),SportsEquipment:this.CreateClientSportsEquipments(n.SportsEquipment)},Disruption:n.DisruptionLevel,Ancillaries:this.GetAncillariesFromBasketResponse(n.Ancillaries)}},t.prototype.GetAncillariesFromBasketResponse=function(n){var t;return n?{HasCar:n.CarHire,HasHotelBooking:n.HotelBooking,HasTravelInsurance:n.TravelInsurance}:t},t.prototype.CreateClientBags=function(n){for(var i=[],t=0;t<n.length;t++)i.push(this.CreateClientBag(n[t]));return i},t.prototype.CreateClientBag=function(n){return{Quantity:n.Quantity,TotalWeight:n.WeightKg}},t.prototype.CreateClientSportsEquipments=function(n){for(var i=[],t=0;t<n.length;t++)i.push(this.CreateClientSportsEquipment(n[t]));return i},t.prototype.CreateClientSportsEquipment=function(n){return{Quantity:n.Quantity,Type:n.Type}},t.prototype.CreateClientFlights=function(n){var i=this,t=[];return n.forEach(function(n){var r=i.CreateClientFlight(n);t.push(r)}),t},t.prototype.CreateClientFlight=function(t){return{InternalId:t.OriginalFlight.InternalId,ArrivalIata:t.OriginalFlight.ArrivalIata,ArrTerminalName:t.OriginalFlight.ArrivalTerminalName,CarrierCode:t.OriginalFlight.CarrierCode,DepartureIata:t.OriginalFlight.DepartureIata,DepTerminalName:t.OriginalFlight.DepartureTerminalName,FlightNumber:t.OriginalFlight.FlightNumber,Modification:n.Data.Rebooking.FlightModificationType.Parse(t.Modification),ReplacementFlight:this.CreateClientReplacementFlight(t.ReplacementFlight),RouteSearchFlight:null,IsCancelled:t.OriginalFlightDisruptionLevel==n.Data.Rebooking.DisruptionLevel.Level3,IsDisrupted:t.OriginalFlightDisruptionLevel==n.Data.Rebooking.DisruptionLevel.Level1,LocalDepartureTime:n.Data.Common.Flight.ZonelessDepartureTime(t.OriginalFlight),LocalArrivalTime:n.Data.Common.Flight.ZonelessArrivalTime(t.OriginalFlight),SegmentId:t.OriginalFlight.SegmentId,FlightKey:t.OriginalFlight.FlightKey,IsFocalFlight:t.OriginalFlight.SegmentId.toUpperCase()==this._focalFlightSegmentId,CanCheckIn:t.CanCheckIn,FlightTaxes:t.OriginalFlight.FlightTaxes,Position:null}},t.prototype.CreateClientReplacementFlight=function(t){return t?{InternalId:t.InternalId,ArrivalIata:t.ArrivalIata,DepartureIata:t.DepartureIata,DepTerminalName:t.DepartureTerminalName,ArrTerminalName:t.ArrivalTerminalName,CarrierCode:t.CarrierCode,FlightNumber:t.FlightNumber,SegmentId:t.SegmentId,FlightKey:t.FlightKey,LocalArrivalTime:n.Data.Common.Flight.ZonelessArrivalTime(t),LocalDepartureTime:n.Data.Common.Flight.ZonelessDepartureTime(t),IsCancelled:!1,IsDisrupted:!1,FlightTaxes:t.FlightTaxes}:null},t.prototype.CreateClientPassengers=function(n){var t=this;return n.map(function(n){return t.CreateClientPassenger(n)})},t.prototype.CreateClientPassenger=function(t){return{InternalId:t.InternalId,Age:t.Age,Title:t.Title,FirstName:t.FirstName,LastName:t.LastName,Type:n.Data.Common.PassengerDataType.Parse(t.Type),HasSpecialServiceFlags:t.HasSpecialServiceFlags,EjPlusNumber:t.EjPlusNumber,SpecialServiceRequestCodes:t.SpecialServiceRequestCodes}},t.prototype.CreateClientInfants=function(t){return t.map(function(t){return{Age:t.Age,FirstName:t.FirstName,LastName:t.LastName,InternalId:t.InternalId,Title:t.Title,Type:n.Data.Common.PassengerDataType.Infant}})},t}();t.RebookingDataMapper=i})(i=t.Rebooking||(t.Rebooking={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u){this._rootScope=n;this._api=t;this._availabilityService=i;this._pageTextSettings=r;this._rebookingService=u;this._b2bSeatsAreAlwaysAvailableValue=9;this.ListenForEvents()}return t.prototype.ListenForEvents=function(){this._rootScope.$on(n.Events.Names.Rebooking.FlightModified,this.OnFlightModified.bind(this));this._rootScope.$on(n.Events.Names.Rebooking.BasketLoaded,this.OnBasketLoaded.bind(this))},t.prototype.OnBasketLoaded=function(){this.UpdateRefundStatusText();this.UpdateChangeCount();this.UpdateHelpingHandState()},t.prototype.Refresh=function(){var t=this,n=this._rebookingService.CurrentClientBasket;!n||!n.Flights||n.Flights.forEach(function(n){!n||!n.ReplacementFlight||t.CheckFlightAvailablity(n)})},t.prototype.CheckFlightAvailablity=function(n){var i=this,t=this.GetPassengerComposition(this._rebookingService.CurrentClientBasket.Passengers);this._availabilityService.FindFlight(n.ReplacementFlight.DepartureIata,n.ReplacementFlight.ArrivalIata,n.ReplacementFlight.LocalDepartureTime.Date(),n.ReplacementFlight.FlightNumber,t.Adults,t.Children,t.Infants,!1,function(t){return i.HandleAvailabilityResponse(t,n)})},t.prototype.GetPassengerComposition=function(t){var i=0,r=0;return t.forEach(function(t){t.Type===n.Data.Common.PassengerDataType.Adult?++i:t.Type===n.Data.Common.PassengerDataType.Child&&++r}),{Adults:i,Children:r,Infants:0}},t.prototype.HandleAvailabilityResponse=function(t,i){if(!t||!t.HasFares()||this.IsSoldOut(t.FlightFares[0].SeatsAvailable)){var r={SegmentId:i.SegmentId,Modification:n.Data.Rebooking.FlightModificationType.None,ReplacementFlight:null,RouteSearchFlight:null};this._rootScope.$emit(n.Events.Names.Rebooking.FlightModified,r);n.Events.OpenDrawer("flightgrid-notavailable",this._rootScope)}},t.prototype.IsSoldOut=function(n){var t=this.GetPassengerComposition(this._rebookingService.CurrentClientBasket.Passengers),i=t.Adults||0,r=t.Children||0;return n<this._b2bSeatsAreAlwaysAvailableValue?i+r>n:!1},t.prototype.OnFlightModified=function(t,i){var r=Utilities.Arrays.FirstOrDefault(this._rebookingService.CurrentClientBasket.Flights,function(n){return n.SegmentId==i.SegmentId});n.Events.Fire(n.Events.Names.FinaliseButton.Status,!1);this.UpdateClientBasketFlightFromModifiedData(r,i);this.UpdateServerBasketFlightFromModifiedData(r,i);this.UpdateChangeCount()},t.prototype.UpdateChangeCount=function(){if(this._rebookingService.CurrentClientBasket){var t=this._rebookingService.CurrentClientBasket.Flights.filter(function(t){return t.Modification!=n.Data.Rebooking.FlightModificationType.None}).length;n.Events.Fire(n.Events.Names.Basket.SetChanges,t)}},t.prototype.UpdateServerBasketFlightFromModifiedData=function(t,i){var r=n.Data.Rebooking.FlightModificationType.ToString(i.Modification);this._api.UpdateBasketFlight(i.SegmentId,r,i.ReplacementFlight,this.OnUpdateBasketFlight.bind(this),this._rebookingService.OnGeneralError.bind(this._rebookingService))},t.prototype.OnUpdateBasketFlight=function(n){this._api.HasAnyRequestsPending()||(this._rebookingService.CurrentClientBasket.CanBeFinalised=n.CanBeFinalised,this.UpdateHelpingHandState())},t.prototype.UpdateHelpingHandState=function(){this.BasketContainsNoModifications()?(n.Events.Fire(n.Events.Names.FinaliseButton.Status,!1),n.Events.Fire(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/rebooking/finalisation/no-changes")):this._rebookingService.CurrentClientBasket.CanBeFinalised?(n.Events.Fire(n.Events.Names.FinaliseButton.Status,!0),n.Events.Fire(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/rebooking/finalisation/allowed")):(n.Events.Fire(n.Events.Names.FinaliseButton.Status,!1),n.Events.Fire(n.Events.Names.HelpingHand.ShowTemplate,"ng-templates/rebooking/finalisation/unfinished"))},t.prototype.BasketContainsNoModifications=function(){for(var r,t=0,i=this._rebookingService.CurrentClientBasket.Flights;t<i.length;t++)if(r=i[t],r.Modification!==n.Data.Rebooking.FlightModificationType.None)return!1;return!0},t.prototype.UpdateClientBasketFlightFromModifiedData=function(n,t){n.Modification=t.Modification;n.ReplacementFlight=t.ReplacementFlight;this.UpdateRefundStatusText()},t.prototype.UpdateRefundStatusText=function(){var t,i,r;if(!!this._rebookingService.CurrentClientBasket)for(t=0,i=this._rebookingService.CurrentClientBasket.Flights;t<i.length;t++)r=i[t],r.AdditionalStatusText=r.Modification==n.Data.Rebooking.FlightModificationType.Refund?this._pageTextSettings.RefundingStatusText:""},t.ServiceName="RebookingPage_Service",t.$inject=["$rootScope","Rebooking_Api","Availability_AvailabilityService","Sitecore_RebookingPageTextSettings","Rebooking_Service"],t}();t.RebookingPageService=i})(i=t.Rebooking||(t.Rebooking={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function i(n,t,i,r,u){this._rootScope=n;this._api=t;this._pickBookingService=i;this._accountService=r;this._errorService=u;this.ListenForEvents()}return i.prototype.ListenForEvents=function(){var t=this;this._rootScope.$on(n.Events.Names.Account.DeprecatedSignInStatusChanged,function(n,i){i||(t._apiBasketData=null)});this._rootScope.$on(n.Events.Names.Account.GetSignInStatusFailed,function(){t._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Account,Tracking.EventConstants.GenericErrorDrawerLabels.SignInStatusFailed)})},i.prototype.StartRebookingProcessIfNoValidBasket=function(n){this.ExistingBasketValid(n)||this.StartRebookingProcess(n)},i.prototype.StartRebookingProcess=function(n){var t=this;this._accountService.IsSignedIn()?this._api.GetBasket(function(i){return t.OnGetBasketSuccess(i,n,!1)},this.OnGeneralError.bind(this)):this._pickBookingService.OpenLoginDrawer(n)},i.prototype.StartRebookingProcessThenGoToRebookingPage=function(n,t){var i=this;t===void 0&&(t=null);this._accountService.IsSignedIn()?this._api.GetBasket(function(r){i.OnGetBasketSuccess(r,n,!0,t)},function(n,r){i.OnGeneralError(n,r,Tracking.EventConstants.GenericErrorDrawerLabels.GetBasket);t&&t()}):(this._pickBookingService.OpenLoginDrawer(n),t&&t())},i.prototype.OnGetBasketSuccess=function(i,r,u,f){if(f===void 0&&(f=null),this._apiBasketData=i,this.ExistingBasketValid(r))if(u)this._pickBookingService.RedirectToRebooking(r,this._apiBasketData.BookingReference);else{var e=new t.RebookingDataMapper(r);this.CurrentClientBasket=e.CreateClientBasket(this._apiBasketData);n.Events.Fire(n.Events.Names.Rebooking.BasketLoaded,this.CurrentClientBasket);f&&f()}else this._pickBookingService.GetBookings(r,f)},i.prototype.ExistingBasketValid=function(n){var t=this._apiBasketData,i;return!t||t.HasNoBasket?!1:t.HasBeenFinalised?!1:n?this.RequestedDifferentBookingToThatAlreadyInBasket(t.BookingReference)?!1:t.Flights&&(i=t.Flights.filter(function(t){return t.OriginalFlight.SegmentId.toUpperCase()==n.toUpperCase()}),i&&i.length==1&&i[0].IsFocalFlight)?!0:!1:!1},i.prototype.RequestedDifferentBookingToThatAlreadyInBasket=function(n){var t=this._pickBookingService.GetCurrentBookingReferenceFromQueryString();return!!t&&!!n&&t.toUpperCase()!=n.toUpperCase()?!0:!1},i.prototype.OnGeneralError=function(n,t,i){i===void 0&&(i=Tracking.EventConstants.Labels.Error);n!=401&&this._errorService.ShowGenericErrorDrawer(Tracking.EventConstants.Categories.Rebooking,i)},i.prototype.GetDisruptionLevel=function(){return this.CurrentClientBasket.Disruption},i.ServiceName="Rebooking_Service",i.$inject=["$rootScope","Rebooking_Api","Rebooking_PickBookingService","Account_Service","Error_Service"],i}();t.RebookingService=i})(i=t.Rebooking||(t.Rebooking={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(n){function t(t,i){var r=n.call(this,i.RebookingRootSettings.DataRefreshSeconds)||this;return r.ResetRefreshAll(),r}return __extends(t,n),t.ServiceName="Rebooking_SyncedRefreshService",t.$inject=["$rootScope","Sitecore_RebookingClientSettings"],t}(n.Common.BaseSyncedRefreshService);t.SyncedRefreshService=i})(t=n.Rebooking||(n.Rebooking={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._ignoreNextRouteChangeEvent=!1;this.$rootScope=n}return t.prototype.IgnoreNextRouteChangeEvent=function(n){this._ignoreNextRouteChangeEvent=n},t.prototype.SetDefaultAriaAttributesOnQtip=function(n){if(!!n.tooltip){var i=n.tooltip.attr("aria-describedby"),t=n.tooltip.find("#"+i);!t||t.removeAttr("aria-atomic");n.tooltip.removeAttr("aria-describedby");n.tooltip.removeAttr("aria-live");n.tooltip.attr("role","tooltip")}},t.prototype.ShouldIgnoreNextRouteChangeEvent=function(){return this._ignoreNextRouteChangeEvent},t.prototype.ShowSmartMessage=function(t){this.$rootScope.$applyAsync(function(i){var r={Id:t};i.$broadcast(n.Events.Names.SmartMessaging.Show,r)})},t.ServiceName="SmartMessage_Service",t.$inject=["$rootScope"],t}();t.SmartMessageService=i})(i=t.SmartMessages||(t.SmartMessages={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n){this._allAirportsCache=new Dictionary;this._routesServiceWithEasyJetData=n.BuildEasyjetService();this._worldwideDataIsAvailable=n.WorldwideDataIsAvailable();this.WorldwideMode=this._worldwideDataIsAvailable;this.WorldwideMode&&(this.WorldwideMode=!0,this._routesServiceWithWorldwideData=n.BuildWorldwideService(),this._routesServiceWithCombinedData=n.BuildCombinedService())}return t.prototype.GetService=function(n){return n&&this._worldwideDataIsAvailable?this._routesServiceWithCombinedData:this._routesServiceWithEasyJetData},t.prototype.GetAlternateRoutes=function(n,t){return this.GetService(!1).GetAlternateRoutes(n,t)},t.prototype.GetWorldwideRoute=function(n,t){return this.IsWorldwideRoute(n.Iata,t.Iata)?{Origin:n,Destination:t,RouteKey:""+n.Iata+t.Iata}:null},t.prototype.HasNearbyRoutes=function(n,t,i){var r=[];return!t||(r=i?this.GetAlternateRoutes(n,t):this.GetAlternateRoutes(t,n)),r.length>0},t.prototype.FindCountryByAirport=function(n,t){return this.GetService(t).FindCountryByAirport(n)},t.prototype.AllAirports=function(n){var t="includeWorldwideRoutes_"+(n||!1).toString(),i;return this._allAirportsCache.ContainsKey(t)||(i=this.GetService(n).AllAirports(),this._allAirportsCache.Set(t,i)),this._allAirportsCache.Get(t)},t.prototype.AllCountries=function(n){return this.GetService(n).AllCountries()},t.prototype.GetAirportsInCountry=function(n,t){return this.GetService(t).GetAirportsInCountry(n)},t.prototype.FindAirportByIata=function(n,t){return this.GetService(t).FindAirportByIata(n)},t.prototype.IsValidRouteForPlatform=function(n,t,i){return this.GetService(i).IsValidRouteForPlatform(n,t)},t.prototype.FindCountryByCode=function(n,t){return t===void 0&&(t=!0),this.GetService(t).FindCountryByCode(n)},t.prototype.IsMarketGroup=function(n,t){return!t&&this._routesServiceWithEasyJetData.IsMarketGroup(n)},t.prototype.GetIatasForMarketGroup=function(n,t){return t?[]:this._routesServiceWithEasyJetData.GetIatasForMarketGroup(n)},t.prototype.IsValidRoute=function(n,t,i){return this.GetService(i).IsValidRoute(n,t)},t.prototype.IsWorldwideRoute=function(n,t){var i=this.GetService(!0).FindAirportByIata(n),r=this.GetService(!0).FindAirportByIata(t);return!!i&&!!r?this.IsAirportValidWorldwideRouteForFilter(r,i,!0):!1},t.prototype.IsAirportValidWorldwideRouteForFilter=function(t,i,r){if(!!i){var u=this.GetFilterToAirportConnectionType(t.Iata,i,r);return n.Data.RouteSearch.ConnectionType.IsWorldwide(u)}return!0},t.prototype.GetConnectionTypeByFilterDirection=function(n,t,i){var r,u;return n?(u=i,r=t):(u=this.FindAirportByIata(t,!0),r=i.Iata),this.GetFilterToAirportConnectionType(r,u,!0)},t.prototype.GetFilterToAirportConnectionType=function(t,i,r){if(!!i){if(this.AirportConnectionsIncludeIata(t,i))return n.Data.RouteSearch.ConnectionType.DirectEasyJetConnection;if(r){if(this.AirportPartnerConnectionsIncludeIata(t,i))return n.Data.RouteSearch.ConnectionType.DirectPartnerConnection;if(this.AirportIndirectConnectionsIncludeIata(t,i))return n.Data.RouteSearch.ConnectionType.IndirectConnection;if(this.AirportIndirectPartnerConnectionsIncludeIata(t,i))return n.Data.RouteSearch.ConnectionType.IndirectPartnerConnection}}return n.Data.RouteSearch.ConnectionType.NoConnection},t.prototype.IsValidRouteForFilter=function(n,t,i){var r=this.GetService(i).IsValidRouteForFilter(n,t);return r?!0:this.IsAirportValidWorldwideRouteForFilter(n,t,i)},t.prototype.ShowAsWorldwideAirport=function(n,t,i){if(n){if(this.IsWorldwideOnlyAirportIata(n,i))return!0;if(!!t){if(this._routesServiceWithEasyJetData.IsValidRouteForFilterByIata(i,t))return!1;var r=this.GetService(n).FindAirportByIata(i);if(!!r&&this.IsAirportValidWorldwideRouteForFilter(r,t,n))return!0}}return!1},t.prototype.IsWorldwideOnlyAirportIata=function(n,t){var i=this.GetService(n).FindAirportByIata(t);return!!i&&i.IsWorldwide},t.prototype.AirportConnectionsIncludeIata=function(n,t){return this.IataIsInList(n,t.Connections)},t.prototype.AirportPartnerConnectionsIncludeIata=function(n,t){return this.IataIsInList(n,t.PartnerConnections)},t.prototype.AirportIndirectConnectionsIncludeIata=function(n,t){return this.IataIsInList(n,t.IndirectConnections)},t.prototype.AirportIndirectPartnerConnectionsIncludeIata=function(n,t){return this.IataIsInList(n,t.IndirectPartnerConnections)},t.prototype.IataIsInList=function(n,t){return!!t&&$jq.inArray(n,t)>-1},t.prototype.HasAnyDirectConnections=function(n){return!!n.Connections&&n.Connections.length>0},t.prototype.HasAnyPartnerConnections=function(n){return!!n.PartnerConnections&&n.PartnerConnections.length>0},t.prototype.HasAnyIndirectConnections=function(n){return!!n.IndirectConnections&&n.IndirectConnections.length>0},t.prototype.HasAnyIndirectPartnerConnections=function(n){return!!n.IndirectPartnerConnections&&n.IndirectPartnerConnections.length>0},t.ServiceName="Worldwide_CombinedRoutesService",t.$inject=["Worldwide_CombinedRoutesServiceFactory"],t}();t.CombinedRoutesService=i})(i=t.Worldwide||(t.Worldwide={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t){this._easyjetRoutesData=n;this._worldwideRouteDataService=t;this.EnsureEasyjetRouteDataHasCorectWorldwideFlag();this._routesServiceWithEasyJetData=this.BuildEasyjetService();this.WorldwideDataIsAvailable()&&(this._routesServiceWithWorldwideData=this.BuildWorldwideService(),this._routesServiceWithCombinedData=this.BuildCombinedService())}return t.prototype.EnsureEasyjetRouteDataHasCorectWorldwideFlag=function(){this._easyjetRoutesData.Airports.forEach(function(n){return n.IsWorldwide=!1})},t.prototype.BuildEasyjetService=function(){return new Main3.Routes.RoutesService(this._easyjetRoutesData)},t.prototype.BuildWorldwideService=function(){var n=this.MapAndBuildWorldwideData();return new Main3.Routes.RoutesService(n)},t.prototype.BuildCombinedService=function(){var n=this.CloneAndCombinedRoutesData();return new Main3.Routes.RoutesService(n)},t.prototype.WorldwideDataIsAvailable=function(){return this._worldwideRouteDataService.WorldwideDataIsAvaialble()},t.prototype.CloneAndCombinedRoutesData=function(){var n=angular.copy(this._easyjetRoutesData);return n.Airports=this.CloneAndCombineAirports(),n.Countries=this.CloneAndCombineCountries(),n},t.prototype.CloneAndCombineAirports=function(){var i=this,r=this._routesServiceWithEasyJetData.AllAirports(),u=this._routesServiceWithWorldwideData.AllAirports(),t=angular.copy(r);return u.forEach(function(n,r,u){return i.MergeAirportIntoList(n,r,u,t)}),t.sort(function(t,i){return n.SortComparers.CompareStrings(t.Name.toUpperCase(),i.Name.toUpperCase())})},t.prototype.MergeAirportIntoList=function(n,t,i,r){var u=r.filter(function(t){return t.Iata===n.Iata});u.length===0?r.push(angular.copy(n)):u.length===1&&this.MergeAirports(n,u[0])},t.prototype.MergeAirports=function(n,t){t.PartnerConnections=n.PartnerConnections;t.IndirectConnections=n.IndirectConnections;t.IndirectPartnerConnections=n.IndirectPartnerConnections},t.prototype.CloneAndCombineCountries=function(){var i=this,r=this._routesServiceWithEasyJetData.AllCountries(),u=this._routesServiceWithWorldwideData.AllCountries(),t=angular.copy(r);return u.forEach(function(n,r,u){return i.MergeCountryIntoList(n,r,u,t)}),t.sort(function(t,i){return n.SortComparers.CompareStrings(t.Name.toUpperCase(),i.Name.toUpperCase())})},t.prototype.MergeCountryIntoList=function(n,t,i,r){var u=r.filter(function(t){return t.Code===n.Code});u.length===0?r.push(n):u.length===1&&this.MergeCountries(n,u[0])},t.prototype.MergeCountries=function(n,t){for(var u,i=0,r=n.Airports;i<r.length;i++)u=r[i],t.Airports.indexOf(u)===-1&&t.Airports.push(u)},t.prototype.MapAndBuildWorldwideData=function(){return{NearbyAirportSettings:null,Airports:this._worldwideRouteDataService.Data().Airports.map(function(n){return{Iata:n.Iata,Name:n.Name,Connections:[],IndirectConnections:n.IndirectConnections,IndirectPartnerConnections:n.IndirectPartnerConnections,PartnerConnections:n.PartnerConnections,B2bAreaCode:"",NearbyAirports:[],IsMarketGroup:!1,MarketGroupIatas:[],Flags:[],ShowDirectRoutesByDefault:!1,IsWorldwide:!0}}),Countries:this._worldwideRouteDataService.Data().Countries,Cities:[]}},t.ServiceName="Worldwide_CombinedRoutesServiceFactory",t.$inject=["Sitecore_RoutesData","Worldwide_RoutesDataService"],t}();t.CombinedRoutesServiceFactory=i})(i=t.Worldwide||(t.Worldwide={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._worldwideSettings=n;this._deepLinkSettings=t;this._ageUsedToRepresentAChild=8;this._ageUsedToRepresentAnInfant=1}return n.prototype.ToUrl=function(n){var t=this._worldwideSettings.WorldwidePartnerWebsiteAddress,i=this.BuildAirportsUrlSection(n),r=this.BuildFlightDatesUrlSection(n),u=this.BuildPassengersUrlSection(n),f=this.BuildUrlLanguageQueryString(n);return t+"/flights"+i+r+u+f},n.prototype.BuildAirportsUrlSection=function(n){return"/"+n.OriginIata+"/"+n.DestinationIata},n.prototype.BuildFlightDatesUrlSection=function(n){var t="/"+n.DepartureDate.ToIso8601();return n.IsOneWayFlight||(t+="/"+n.ReturnDate.ToIso8601()),t},n.prototype.BuildPassengersUrlSection=function(n){var t="/"+n.Adults+"-adults",i,r;return(n.Children>0||n.Infants>0)&&(i=this.BuildAgeListUrlSection(n.Children,this._ageUsedToRepresentAChild),r=this.BuildAgeListUrlSection(n.Infants,this._ageUsedToRepresentAnInfant),t+="/children"+i+r),t},n.prototype.BuildAgeListUrlSection=function(n,t){for(var i="",r=0;r<n;r++)i+="-"+t;return i},n.prototype.BuildUrlLanguageQueryString=function(){var n="",t=this._deepLinkSettings.LanguageCode;return t&&(n+="?lang="+t.toLowerCase()),n},n.ServiceName="Worldwide_DeepLinkService",n.$inject=["Sitecore_WorldwideSettings","Sitecore_DeepLinkSettings"],n}();n.WorldwideDeepLinkService=t})(t=n.Worldwide||(n.Worldwide={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){}return n.prototype.WorldwideDataIsAvaialble=function(){return typeof easyjetWorldwideRoutesData!="undefined"&&!!easyjetWorldwideRoutesData},n.prototype.Data=function(){return easyjetWorldwideRoutesData},n.ServiceName="Worldwide_RoutesDataService",n.$inject=[],n}();n.WorldwideRoutesDataService=t})(t=n.Worldwide||(n.Worldwide={}))})(t=n.Services||(n.Services={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t=function(){function n(){}return n.SeatAssigned="ej.seatmap.seatassigned",n.SeatUnassigned="ej.seatmap.seatunassigned",n.Skip="ej.seatmap.helpinghand.skip",n.SeatsAutomaticallyAssigned="ej.seatmap.seatsautomaticallyassigned",n.UpdateHelpingHand="ej.seatmap.helpinghand.update",n.UpdateSmartMessage="ej.seatmap.smartmessage.update",n.SelectSameSeats="ej.seatmap.selectsameseats",n.InfantRestricted="ej.seatmap.infantrestricted",n}();n.Events=t})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._selectedSeatsToken="{selected-seats}";this._scope=n;this._drawerParameters=this._scope.CurrentSection.Options.Parameters;this._scope.FirstOptionOnClick=this.FirstOptionOnClick.bind(this);this._scope.SecondOptionOnClick=this.SecondOptionOnClick.bind(this)}return n.prototype.InterpolateDrawerTitle=function(n,t){if(this._drawerParameters.SelectedSeats.length>0){var i=this._drawerParameters.SelectedSeats.join(", "),r=this._drawerParameters.SelectedSeats.length===1?n.replace(this._selectedSeatsToken,i):t.replace(this._selectedSeatsToken,i);r&&(this._scope.TitleText=r)}},n.prototype.FirstOptionOnClick=function(){this._drawerParameters.FirstOptionAction();this._drawerParameters.ShouldAutoClose&&this._scope.DoClose()},n.prototype.SecondOptionOnClick=function(){this._drawerParameters.SecondOptionAction();this._drawerParameters.ShouldAutoClose&&this._scope.DoClose()},n.ControllerName="Controls_OptionDrawerController",n.$inject=["$scope"],n}();n.OptionDrawerController=t})(t=n.Controllers||(n.Controllers={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function i(i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){var g=this;this._qService=i;this._scope=r;this._seatMapApiService=u;this._seatMapSettings=f;this._moneySettings=e;this._priceService=o;this._seatAssignmentService=s;this._passengerService=h;this._drawerService=c;this._timeout=l;this._seatMapAircraftService=a;this._accessibilityService=v;this._funnelJourneyCookieService=y;this._errorService=p;this._funnelReasonCookieService=w;this._analyticsTracker=b;this._funnelJourneyService=k;this._flightDataService=d;this._seatMapLoadedCallbacks=$jq.Callbacks();this._scope.AddSeatAssignedCallbackHandler=this.AddSeatAssignedCallbackHandler.bind(this);this._scope.AddSelectedPassengersChangedCallbackHandler=this.AddSelectedPassengersChangedCallbackHandler.bind(this);this._scope.AddSeatMapLoadedCallbackHandler=this.AddSeatMapLoadedCallbackHandler.bind(this);this._scope.AssignSeats=this.AssignSeats.bind(this);this._scope.GetSectionPrice=this.GetSectionPrice.bind(this);this._scope.LoadSeatMap=this.LoadSeatMap.bind(this);this._scope.ScrollToSelectedSeats=this.ScrollToSelectedSeats.bind(this);this._scope.SetFocussedElement=this.SetFocussedElement.bind(this);this._scope.UnassignSeats=this.UnassignSeats.bind(this);this._scope.IsValid=this.IsValid.bind(this);this._scope.ContinueToNextStep=this.ContinueToNextStep.bind(this);this._scope.LoadingErrorMessageText=this._seatMapSettings.LoadingErrorMessageText;this._scope.LoadingPlaceholderText=this._seatMapSettings.LoadingPlaceholderText;this._scope.ScrollToSelectedSeatsEventName=t.Events.SelectSameSeats;this._scope.ShowLoadingErrorMessage=!1;this._scope.ShowLoadingPlaceholder=!0;this._scope.ShowSeatMapUnavailable=!1;this._scope.$on(n.Events.Names.Drawer.Closing,this.GiveFocusBackToElement.bind(this));this._scope.$on(t.Events.SeatsAutomaticallyAssigned,this.ToggleSkipAfterAutoAssignLinkFocusable.bind(this,!0));this._scope.$on(t.Events.SeatUnassigned,this.ToggleSkipAfterAutoAssignLinkFocusable.bind(this,!1));this.AddSeatAssignedCallbackHandler(function(n){n.forEach(function(n){n.Seat.PriceBandDisplayName=g.GetPriceBandName(n.Seat.PriceBand)});g._scope.$emit(t.Events.SeatAssigned,n);g._scope.$evalAsync()})}return i.prototype.GetScope=function(){return this._scope},i.prototype.GetPriceBandName=function(n){return this._scope.Aircraft.PriceBands.filter(function(t){return t.PriceBandName===n})[0].PriceBandDisplayName},i.prototype.ContinueToNextStep=function(){this.IsValid()&&this._scope.$emit(n.Events.Names.Funnel.Continue)},i.prototype.AddSeatAssignedCallbackHandler=function(n){this._seatAssignmentService.AddSeatAssignedCallback(n)},i.prototype.AddSelectedPassengersChangedCallbackHandler=function(n){this._passengerService.AddPassengerSelectedCallbackHandler(n);n(this._passengerService.GetSelectedPassengers())},i.prototype.AddSeatMapLoadedCallbackHandler=function(n){this._seatMapLoadedCallbacks.add(n)},i.prototype.AssignSeats=function(n){var t=this._passengerService.GetSelectedPassengers();this.AssignSeatsToPassengersIfValid(n,t)},i.prototype.AssignSeatsToPassengers=function(n,i){this._seatAssignmentService.AssignSeats(n,i);this._accessibilityService.AlertSeatSelected(n[0],i[0]);this._scope.$emit(t.Events.UpdateSmartMessage,n);this._passengerService.SelectNextUnassignedPassenger(this._seatAssignmentService.GetUnassignedPassengers(this._scope.Passengers),this._scope.Passengers);this.CreateAndPositionSkipToContinueLink(n)},i.prototype.AssignSeatsToPassengersIfValid=function(n,i,r){var f=this,u;(r===void 0&&(r=!0),(n||[]).length!==0&&(i||[]).length!==0)&&(u=this._seatAssignmentService.ValidateSeatAssignment(n[0],i[0]),u===5?this._scope.$broadcast(t.Events.InfantRestricted,n):r?this._drawerService.OpenSeatDrawer(u,n,!1,function(){f.AssignSeatsToPassengers(n,i)}):this.IsSeatSelectable(u)&&this.AssignSeatsToPassengers(n,i))},i.prototype.GetSectionPrice=function(n){var t=n.Blocks[0].Seats[0];return!t?null:this._priceService.NewPrice(t.PriceWithCreditCardFee,t.Price)},i.prototype.GiveFocusBackToElement=function(){this._focussedElement&&this._focussedElement.focus()},i.prototype.IsValid=function(){return(this._scope.Passengers||[]).length===this._seatAssignmentService.GetAssignedSeatCount()},i.prototype.LoadSeatMap=function(n,t,i){this._loadSeatMapDeferred=this._qService.defer();this._scope.SeatMapRows=[];this._seatAssignmentService.Clear();this._initialSeatAssignments=i;this._scope.Passengers=t;this._scope.ShowLoadingErrorMessage=!1;this._scope.ShowLoadingPlaceholder=!0;this._scope.ShowSeatMapUnavailable=!1;var r={DepartureIata:n.SegmentId.OriginIata(),ArrivalIata:n.SegmentId.DestinationIata(),DepartureDate:n.SegmentId.Date().Format("YYYY-MM-DD"),FlightNumber:n.FlightNumber,LanguageCode:n.LanguageCode,CurrencyCode:n.CurrencyCode,FareType:n.FareType,FlightInternalId:n.FlightInternalId};return this._seatMapApiService.GetSeatMap(r,this.OnSeatMapApiRequestSuccess.bind(this,n),this.OnSeatMapApiRequestError.bind(this,n)),this._funnelJourneyCookieService.UpdateCookie(function(n){n.HasSeenSeatingPage=!0}),this._loadSeatMapDeferred.promise},i.prototype.OnSeatMapApiRequestError=function(t,i,r,u){this._seatMapSettings.UseSeatMapUnavailableMessaging?this.SwitchToSeatMapUnavailable(t):u===n.Data.Rebooking.KnownError.SeatingAvailability?this.RedirectToNextStepDueToApiUnavailable(Constants.Redirect.Reasons.Funnel.Step.OnLoadRedirect):this.OnSeatMapApiRequestUnknownError()},i.prototype.SwitchToSeatMapUnavailable=function(i){this._scope.ShowLoadingErrorMessage=!1;this._scope.ShowLoadingPlaceholder=!1;this._scope.ShowSeatMapUnavailable=!0;this._flightDataService.MarkFlightAsUnavailable(i);this._seatMapLoadedCallbacks.fire();this._loadSeatMapDeferred.resolve();n.Events.Fire(t.Events.UpdateHelpingHand)},i.prototype.RedirectToNextStepDueToApiUnavailable=function(t){this._funnelReasonCookieService.UpdateCookie(function(n){return n.SeatingRedirectReason=t});n.Services.Common.ErrorService.IsExiting=!0;this._analyticsTracker.TrackEventAndNavigateToUrl(Tracking.EventConstants.Categories.Seating,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.Error+" | "+Utilities.ZonelessDateTime.NowUtc(),this._funnelJourneyService.GetBypassNextStepUrl())},i.prototype.OnSeatMapApiRequestUnknownError=function(){this._scope.ShowLoadingPlaceholder=!1;this._scope.ShowLoadingErrorMessage=!0;this._loadSeatMapDeferred.resolve()},i.prototype.OnSeatMapApiRequestSuccess=function(n,t){var i=this;this._scope.ShowLoadingPlaceholder=!1;this._scope.Aircraft=this._seatMapAircraftService.GetAircraftByType(t.AircraftType);this._flightDataService.SetAircraftType(t.AircraftType);this._timeout(function(){return i.AssignInitialSeatAssignments()});this._scope.SeatMapSections=this.BuildSeatMapSections(t.Rows,this._scope.Aircraft.BulkheadSeats);this._scope.SeatMapRows=this.GetSeatMapRows();this._seatMapLoadedCallbacks.fire();this._scope.OnSeatMapApiRequestSuccess&&this._scope.OnSeatMapApiRequestSuccess(n,t);this._loadSeatMapDeferred.resolve()},i.prototype.BuildSeatMapSections=function(n,t){return this._seatMapAircraftService.BuildSeatMapSections(n,this._scope.Aircraft,t)},i.prototype.GetSeatMapRows=function(){var n=[];return this._scope.SeatMapSections.forEach(function(t){t.SeatMapRows.forEach(function(t){n.push(t)})}),n},i.prototype.CreateAndPositionSkipToContinueLink=function(n){var i,t;if((this.RemoveSkipToContinueLink(),this._scope&&this._scope.Passengers&&n)&&(i=this._seatAssignmentService.GetAssignedSeatCount(),i===this._scope.Passengers.length)){var f=n[n.length-1],r=this._scope.Element.find('.plane-map .seat[data-seat-number="'+f.SeatNumber+'"]'),u=this._scope.Element.find(".skip-to-next-step-link");!r||!u||(t=u.clone(!0),t.css("display","block"),r.after(t))}},i.prototype.RemoveSkipToContinueLink=function(){this._scope.Element.find(".plane-map .skip-to-next-step-link").remove()},i.prototype.ToggleSkipAfterAutoAssignLinkFocusable=function(n){var t=this._scope.Element.find(".skip-after-auto-assign-seats-link");n?t.css("display","block"):t.css("display","none")},i.prototype.ScrollToSelectedSeats=function(){this._scope.$broadcast(this._scope.ScrollToSelectedSeatsEventName)},i.prototype.SetFocussedElement=function(n){this._focussedElement=$jq(n.currentTarget)},i.prototype.UnassignSeats=function(n){var t=this._seatAssignmentService.GetPassengersAssignedToSeats(n);this._seatAssignmentService.UnassignSeats({seats:n,fireCallback:!0,allowFallBackSeat:!0});this._accessibilityService.AlertSeatRemoved(n[0],t[0]);this._passengerService.SelectPassengers(t);this.RemoveSkipToContinueLink()},i.prototype.AssignInitialSeatAssignments=function(){var n=this;this._initialSeatAssignments.forEach(function(i){var r,u,f;i.SeatNumber&&(r=n._scope.Passengers.filter(function(n){return n.Id===i.PassengerInternalId})[0],!r||(u=t.Services.SeatMapSeatAircraftService.FindSeatBySeatNumber(i.SeatNumber,n._scope.SeatMapRows),f=n._seatAssignmentService.AnyPassengerIsInfantRestricted(u,[r]),u.IsAvailable&&!f?n.AssignSeatsToPassengersIfValid([u],[r],!1):n._drawerService.OpenSeatNoLongerAvailableDrawer(n._scope.RemoveSeatsFromClientAndServerBasketForFlight),!r.FallBackSeatNumber||(r.FallBackSeatData=t.Services.SeatMapSeatAircraftService.FindSeatBySeatNumber(r.FallBackSeatNumber,n._scope.SeatMapRows))))})},i.prototype.IsSeatSelectable=function(n){return n!==4&&n!==3&&n!==5},i.ControllerName="Controls_SeatMap",i.$inject=["$q","$scope","SeatMapApiService","seatMapSettings","Sitecore_MoneySettings","Common_PriceService","SeatMapSeatAssignmentService","SeatMapPassengerService","SeatMapDrawerService","$timeout","Sitecore_SeatMapAircraftService","Funnel_AccessibilityService","FunnelJourneyCookie_Service","Funnel_ErrorService","FunnelReasonCookie_Service","IAnalyticsTracker","Funnel_JourneyService",n.DynamicDependencyKeys.SeatMapFlightDataService],i}();i.SeatMapController=r})(i=t.Controllers||(t.Controllers={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._drawerService=t;this._scope=n;this._scope.OpenBulkheadSeatWarningDrawer=this.OpenBulkheadSeatWarningDrawer.bind(this);this._scope.OpenEasyJetPlusDrawer=this.OpenEasyJetPlusDrawer.bind(this);this._scope.OpenSeatRestrictionsDrawer=this.OpenSeatRestrictionsDrawer.bind(this);this._scope.OpenSpecialAssistanceDrawer=this.OpenSpecialAssistanceDrawer.bind(this);this._scope.OpenTravellingWithChildrenDrawer=this.OpenTravellingWithChildrenDrawer.bind(this);this._scope.OpenWhySelectASeatDrawer=this.OpenWhySelectASeatDrawer.bind(this)}return n.prototype.OpenBulkheadSeatWarningDrawer=function(n){this._drawerService.OpenBulkheadSeatWarningDrawer(n,!1)},n.prototype.OpenEasyJetPlusDrawer=function(){this._drawerService.OpenEasyJetPlusDrawer(!1)},n.prototype.OpenSeatRestrictionsDrawer=function(n){this._drawerService.OpenSeatRestrictionsDrawer(n,!1)},n.prototype.OpenSpecialAssistanceDrawer=function(){this._drawerService.OpenSpecialAssistanceDrawer(!1)},n.prototype.OpenTravellingWithChildrenDrawer=function(){this._drawerService.OpenTravellingWithChildrenDrawer(!1)},n.prototype.OpenWhySelectASeatDrawer=function(){this._drawerService.OpenWhySelectASeatDrawer(!1)},n.ControllerName="Controls_SeatMapDrawer",n.$inject=["$scope","SeatMapDrawerService"],n}();n.SeatMapDrawerController=t})(t=n.Controllers||(n.Controllers={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(t){function i(n,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){var k=t.call(this,n,i,r,u,f,o,c,l,a,s)||this;return k._funnelflightDataService=r,k._funnelService=e,k._funnelBasketService=h,k._seatMapECommerceService=v,k._funnelJourneyService=y,k._funnelActivePairService=p,k._funnelReasonCookieService=b,k._scope.OnSeatMapApiRequestSuccess=k.OnSeatMapApiRequestSuccess.bind(k),!w||w.AllowDeleteSeats(),k}return __extends(i,t),i.prototype.UpdateSeatAssociationsInServerBasket=function(n){var t=this._associationService.GetFlightAssociationsForFlight(n.FlightInternalId);return this._seatMapECommerceService.SaveSeatingDataForFlightToCookie(n.SegmentId),this._seatMapECommerceService.RemoveUnusedDataFromCookie(),this._funnelService.UpdateSeatAssignments(t)},i.prototype.ShouldShowAreYouSureDrawerForSkip=function(){var i=this._flightDataService.GetCurrentFlightData().FlightInternalId,n=this._funnelflightDataService.GetJourneyPairForCurrentFlightData(),t;return this._funnelBasketService.JourneyPairHasReturnFlightSelected(n)&&n.ReturnSlot.Flight.InternalId===i?(t=this._associationService.GetFlightAssociationsForFlight(n.OutboundSlot.Flight.InternalId),_(t).every(function(n){return!!n.Seat})):!1},i.prototype.ShouldShowYouHaventSelectedAllSeatsDrawerForSkip=function(){var t=this._flightDataService.GetCurrentFlightData().FlightInternalId,n=this._associationService.GetFlightAssociationsForFlight(t),i=_(n).filter(function(n){return!!n.Seat&&!!n.Seat.SeatNumber}).length,r=_(n).every(function(n){return!!n.Seat});return i>0&&!r},i.prototype.ShouldExitFunnel=function(){return!this._funnelBasketService.HasAnyFlights()},i.prototype.ShouldRedirectOnLoad=function(){return!this._funnelBasketService.AllPairsHaveFlightsSelected()},i.prototype.BeforeLeavingStep=function(){this._funnelActivePairService.SetPrimaryJourneyPairAsActivePair()},i.prototype.GetStepOnLoadRedirect=function(){return this._funnelJourneyService.GetStepOnLoadInvalidFlightRedirect(Tracking.EventConstants.Categories.Seating)||this.GetStepOnLoadUnavailableStepRedirect()},i.prototype.GetStepOnLoadUnavailableStepRedirect=function(){var t=this,n=this._funnelJourneyService.GetNextStepUrlIfOnLoadRedirectRequired();return!n?null:{TargetUrl:n,EventCategory:Tracking.EventConstants.Categories.Seating,EventAction:Tracking.EventConstants.Actions.Skip,EventLabel:Tracking.EventConstants.Labels.Unavailable,AdditionalAction:function(){t._funnelReasonCookieService.UpdateCookie(function(n){return n.SeatingRedirectReason=Constants.Redirect.Reasons.Funnel.Step.OnLoadRedirect})}}},i.prototype.OnSeatMapApiRequestSuccess=function(n,t){this._seatMapECommerceService.StoreSeatingDataForFlight(n.SegmentId,t.Rows)},i.ControllerName="Controls_SeatMapFunnel",i.$inject=["$q","$scope","SeatMapFunnelFlightDataService",n.DynamicDependencyKeys.SeatMapAssociationsService,n.DynamicDependencyKeys.SeatMapPassengerService,"Funnel_Service","IAnalyticsTracker",n.DynamicDependencyKeys.SeatMapSameSeatService,"Funnel_BasketService","SeatMapDrawerService","seatMapSettings","SeatMapSeatAssignmentService","SeatMapECommerceService","Funnel_JourneyService","Funnel_ActivePairService","Funnel_BasketIconService","FunnelReasonCookie_Service"],i}(n.Controllers.SharedFunnel.BaseSeatMap);t.SeatMapFunnelController=i})(i=t.Controllers||(t.Controllers={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i){this.$scope=t;this._associationsService=i;this.$scope.OnBackWithoutSaveLinkClick=this.OnBackWithoutSaveLinkClick.bind(this);this.$scope.$on(n.Events.Names.Funnel.FunnelReady,this.LoadInitialAssociations.bind(this))}return t.prototype.LoadInitialAssociations=function(){this._associations=this._associationsService.GetFlightAssociations()},t.prototype.OnBackWithoutSaveLinkClick=function(n){n.preventDefault();n.stopPropagation();this._associations&&this._associationsService.SetFlightAssociations(this._associations);this.$scope.BackWithoutSaveLinkDestination&&(window.location.href=this.$scope.BackWithoutSaveLinkDestination)},t.ControllerName="Controls_SeatMapHeader",t.$inject=["$scope","Funnel_AssociationsService"],t}();t.SeatMapHeaderController=i})(i=t.Controllers||(t.Controllers={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function i(i,r,u,f,e,o){var s=this;this._scope=i;this._journeyService=r;this._helpingHandMessages=u;this._flightDataService=f;this._readOnlySerivce=e;this._seatMapSettings=o;this._isValid=!1;this._displayedState=0;this._currentFlightInternalId="";this._debouncedUpdate=_.debounce(this.Update.bind(this),250);this._scope.$on(t.Events.UpdateHelpingHand,function(){s._debouncedUpdate()});this._scope.$on(n.Events.Names.Funnel.StepValidityChanged,function(n,t){s._isValid=t;s._debouncedUpdate()})}return i.prototype.Update=function(){var t=2,i=this._flightDataService.GetCurrentFlightData(),r;this._isValid||(t=1);this._readOnlySerivce.IsCurrentFlightReadOnly()&&(t=3);i.IsUnavailable&&(t=4);(t!==this._displayedState||i.FlightInternalId!==this._currentFlightInternalId)&&(this._displayedState=t,this._currentFlightInternalId=i.FlightInternalId,r=this.GetHelpingHandParametersForState(t),n.Events.Fire(n.Events.Names.HelpingHand.ShowTextWithButton,r))},i.prototype.GetHelpingHandParametersForState=function(t){var i,r=this._journeyService.GetCurrentStepInJourney();return t===2?i={Title:r.HelpingHandContinueText,Subtitle:this.GetCurrentRouteText(),ButtonText:r.HelpingHandContinueButtonText,ButtonEvent:function(){n.Events.Fire(n.Events.Names.Funnel.Continue)},ButtonEnabledWatch:function(){return!0}}:t===1?i={Title:r.HelpingHandSkipText,Subtitle:this.GetCurrentRouteText(),ButtonText:r.HelpingHandSkipButtonText,ButtonEvent:function(){n.Events.Fire(n.Events.Names.Funnel.Skip)},ButtonEnabledWatch:function(){return!0},IsALink:!0}:t===3?i={Title:this._helpingHandMessages.UnableToChangeSeatsHelpingHandText,Subtitle:this.GetCurrentRouteText(),ButtonText:this._helpingHandMessages.UnableToChangeSeatsHelpingHandLinkText,ButtonEvent:function(){n.Events.Fire(n.Events.Names.Funnel.Skip)},ButtonEnabledWatch:function(){return!0},IsALink:!0}:t===4&&(i={Title:this._seatMapSettings.UnavailableHelpingHandMessage,Subtitle:this.GetCurrentRouteText(),ButtonText:this._seatMapSettings.UnavailableHelpingHandButtonText,ButtonEvent:function(){n.Events.Fire(n.Events.Names.Funnel.Skip)},ButtonEnabledWatch:function(){return!0}}),i},i.prototype.GetCurrentRouteText=function(){return this.GetRouteText(this._flightDataService.GetCurrentFlightData())},i.prototype.GetRouteText=function(n){var i=n.SegmentId.Date().Format(this._helpingHandMessages.DateFormatString),r=n.SegmentId.DestinationIata(),u=n.SegmentId.OriginIata(),t="";return this._helpingHandMessages.DepartureArrivalDateFormatString&&(t=this._helpingHandMessages.DepartureArrivalDateFormatString.replaceAll("{OriginIata}",u).replaceAll("{DestinationIata}",r).replaceAll("{DepartureDate}",i)),t},i.ControllerName="Controls_SeatMapHelpingHand",i.$inject=["$scope","Funnel_JourneyService",n.DynamicDependencyKeys.SeatMapHelpingHandSettings,n.DynamicDependencyKeys.SeatMapFlightDataService,n.DynamicDependencyKeys.SeatMapReadOnlyService,"seatMapSettings"],i}();i.SeatMapHelpingHandController=r})(i=t.Controllers||(t.Controllers={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u,f){var e=this;this._passengerSelectedCallbacks=$jq.Callbacks();this._seatAssignmentService=i;this._seatMapPassengerService=r;this._accessibilityService=u;this._seatMapSettings=f;this._scope=n;this._scope.AddPassengerSelectedCallbackHandler=this.AddPassengerSelectedCallbackHandler.bind(this);this._scope.SelectAllPassengers=this.SelectAllPassengers.bind(this);this._scope.SelectPassengers=this.SelectPassengers.bind(this);this._scope.UnassignPassengers=this.UnassignPassengers.bind(this);this._scope.GetAriaLabel=this.GetAriaLabel.bind(this);this._timeout=t;n.$parent.$watch("Passengers",function(n){e._scope.Passengers=n;n&&n.length>0&&e._timeout(function(){e.SelectPassengers([e._scope.Passengers[0]])})});this._seatMapPassengerService.AddPassengerSelectedCallbackHandler(this.HandlePassengerSelectionAccessibility.bind(this))}return n.prototype.GetAriaLabel=function(n){var t=null,i="",r=this._seatMapPassengerService.GetSelectedPassengers().indexOf(n)>-1,u=this._seatAssignmentService.GetAssignedSeatsForPassengers([n]);return u&&u.length>0&&(t=u[0].Seat.SeatNumber),t&&r?i=this._seatMapSettings.SelectedPassengerWithSeatAccessibilityText:!t&&r?i=this._seatMapSettings.SelectedPassengerNoSeatAccessibilityText:t&&!r?i=this._seatMapSettings.NotCurrentlySelectedPassengerWithSeatAccessibilityText:t||r||(i=this._seatMapSettings.NotCurrentlySelectedPassengerNoSeatAccessibilityText),i.replaceAll("{Name}",n.FullDisplayName).replaceAll("{Seat}",t)},n.prototype.AddPassengerSelectedCallbackHandler=function(n){this._seatMapPassengerService.AddPassengerSelectedCallbackHandler(n)},n.prototype.AddSeatAssignedCallbackHandler=function(n){this._seatAssignmentService.AddSeatAssignedCallback(n)},n.prototype.SelectAllPassengers=function(){this.SelectPassengers(this._scope.Passengers)},n.prototype.HandlePassengerSelectionAccessibility=function(n){var t=this;this._scope.$applyAsync(function(){t._scope.Passengers.forEach(function(i){var r=n.filter(function(n){return n.Id===i.Id});r.length>0&&t._accessibilityService.AlertPassengerSelected(r)})})},n.prototype.SelectPassengers=function(n){this._seatMapPassengerService.SelectPassengers(n)},n.prototype.UnassignPassengers=function(n){if(n&&n.length===1){var t=this._seatAssignmentService.GetAssignedSeatsForPassengers(n);this._accessibilityService.AlertSeatRemoved(t[0].Seat,n[0])}this._seatAssignmentService.UnassignPassengers({passengers:n,fireCallback:!0,allowFallBackSeat:!0})},n.ControllerName="Controls_SeatMapPassenger",n.$inject=["$scope","$timeout","SeatMapSeatAssignmentService","SeatMapPassengerService","Funnel_AccessibilityService","seatMapSettings"],n}();n.SeatMapPassengerController=t})(t=n.Controllers||(n.Controllers={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function i(n,t,i,r,u,f){this._rootScope=n;this._scope=t;this._sce=i;this._seatMapSettings=r;this._seatMapDrawerService=u;this._seatMapSameSeatService=f;this._scope.RaiseSmartMessageEvent=this.RaiseSmartMessageEvent.bind(this);this.ListenForEvents()}return i.prototype.ShowStartUpMessage=function(){this._scope.ActiveSmartMessage=null;this.ShowMessage(2)},i.prototype.ListenForEvents=function(){var t=this;this._rootScope.$on(n.SeatMap.Events.UpdateSmartMessage,function(n,i){i.length>0&&(i[i.length-1].PriceBand===""?t.ShowMessage(1):t.ShowMessage(2))});this._scope.AddSeatMapLoadedCallbackHandler(function(){t._seatMapSameSeatService.CanSelectSameSeats(t._scope.SeatMapRows,t._scope.Passengers)&&!t._seatMapSameSeatService.HasSelectedSameSeats()?t.ShowMessage(3):t.ShowStartUpMessage()})},i.prototype.RaiseSmartMessageEvent=function(){switch(this._scope.ActiveSmartMessage.CallToActionEvent){case i.OpenDrawerCallToActionName:this._seatMapDrawerService.OpenWhySelectASeatDrawer(!1);break;case i.SameSeatsCallToActionName:this._seatMapSameSeatService.SelectSameSeats(this._scope.SeatMapRows,this._scope.Passengers);this._scope.HideMessage();this._scope.ScrollToSelectedSeats();n.Events.Fire(t.Events.SeatsAutomaticallyAssigned)}},i.prototype.ShowMessage=function(n){var r=this.GetSmartMessage(n),t;r&&this.MessageHasChanged(r.MessageType)&&this.IsMessageEnabledForDevice(r)&&(t=i.CopySmartMessage(r),t.Text=this._sce.trustAsHtml(t.Text),t.Title=this._sce.trustAsHtml(t.Title),this.StartMessageDelayTimer(t))},i.prototype.GetSmartMessage=function(n){var t=this._seatMapSettings.SmartMessages.filter(function(t){return t.MessageType===n});return t.length>0?t[0]:null},i.prototype.MessageHasChanged=function(n){return!this._scope.ActiveSmartMessage||this._scope.ActiveSmartMessage.MessageType!==n},i.prototype.IsMessageEnabledForDevice=function(n){var t=!1;return Main3.Common.BreakPointService.IsDesktop()?t=n.EnabledOnDesktop:Main3.Common.BreakPointService.IsTablet()?t=n.EnabledOnTablet:Main3.Common.BreakPointService.IsMobile()&&(t=n.EnabledOnMobile),t},i.prototype.GetDisplayDelayForDevice=function(n){if(this._scope.MessageVisible)return 0;var t=Main3.Common.BreakPointService.IsMobile()?n.MobileDelayMilliseconds:n.DesktopAndTabletDelayMilliseconds;return t<0&&(t=0),t},i.prototype.StartMessageDelayTimer=function(n){var t=this,i;this.StopMessageDelayTimer();i=this.GetDisplayDelayForDevice(n);this._currentTimeoutNumber=setTimeout(function(){t._scope.ChangeMessage(function(){t._scope.ActiveSmartMessage=n;t._scope.$apply()});t._scope.ShowMessage()},i)},i.prototype.StopMessageDelayTimer=function(){this._currentTimeoutNumber!=null&&clearTimeout(this._currentTimeoutNumber)},i.CopySmartMessage=function(n){var i={};for(var t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i},i.OpenDrawerCallToActionName="OpenWhySelectASeatDrawer",i.SameSeatsCallToActionName="SelectSameSeatsAgain",i.$inject=["$rootScope","$scope","$sce","seatMapSettings","SeatMapDrawerService",n.DynamicDependencyKeys.SeatMapSameSeatService],i}();i.SeatMapSmartMessageController=r})(i=t.Controllers||(t.Controllers={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._scope=n;this._drawerService=t;this._scope.OpenDrawer=this.OpenDrawer.bind(this)}return n.prototype.OpenDrawer=function(n){n==="travelling-with-children"?this._drawerService.OpenTravellingWithChildrenDrawer(!1):this._drawerService.OpenDrawer(n,null)},n.ControllerName="Controls_WhySelectASeatDrawer",n.$inject=["$scope","SeatMapDrawerService"],n}();n.WhySelectASeatDrawerController=t})(t=n.Controllers||(n.Controllers={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.OptionDrawerController,link:function(n,t,i,r){var u=i.drawerTitleSingleSeat,f=i.drawerTitleMultipleSeats;r.InterpolateDrawerTitle(u,f)}}},t.DirectiveName="ejOptionDrawer",t}();t.OptionDrawerDirective=i})(t=n.Directives||(n.Directives={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function i(){}return i.Factory=function(r,u){return{restrict:"A",controller:t.Controllers.SeatMapController,link:function(t,f){var s;t.Element=f;var e=t.Element.find(".seat-map-passengers"),o=t.Element.find(".plane-map"),h=u.GetBrowserName()==="Android";t.AddSeatMapLoadedCallbackHandler(function(){f.find(".plane-map").fadeIn(500)});t.ResizePassengerList=function(n){i.ResizePassengerList(t,r,n);i.DisplaySliderArrows(t,n)};s=t.$watch("Passengers",function(){Main3.Common.BreakPointService.IsMobile()?t.ResizePassengerList(!0):i.ReSetPassengersHeight(t);s()});t.$on(n.Events.Names.Header.Fixed,function(){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];e.addClass("fixed");o.addClass("fixed-passenger-list")});t.$on(n.Events.Names.Header.Unfixed,function(){e.removeClass("fixed");o.removeClass("fixed-passenger-list");h&&e.hide().show(0)});(Main3.Common.BreakPointService.IsTablet()||Main3.Common.BreakPointService.IsDesktop())&&$jq(window).resize(function(){i.ReSetPassengersHeight(t)});bowser.ios&&e.addClass("safari-scrolling-fix")}}},i.ResizePassengerList=function(n,t,i){t(function(){var t=n.Element.find(".passenger-list"),u,f,r,e,o;if(i){for(u=t.find(".passenger"),f=0,r=0;r<u.length;r++)e=$jq(u[r]),e.innerWidth()>0&&(f+=Math.ceil($jq(u[r]).outerWidth(!0)));f===0?setTimeout(function(){n.ResizePassengerList(i)},100):(o=Math.ceil(t.length/2)+1,t.width(f+o))}else t.removeAttr("style");t.addClass("scroll-right-arrow")})},i.ReSetPassengersHeight=function(n){var t=n.Element.find(".seat-map-passengers"),i=$jq(".main-header").height()+$jq(".helping-hand").height(),r=$jq(window).height()-(i+60);t.height(r)},i.DisplaySliderArrows=function(n,t){t?(n.Element.find(".slider-left-arrow").show(),n.Element.find(".slider-right-arrow").show()):(n.Element.find(".slider-left-arrow").hide(),n.Element.find(".slider-right-arrow").hide())},i.DirectiveName="ejSeatMap",i}();i.SeatMapDirective=r;r.Factory.$inject=["$timeout","Common_BrowserDetectionService"]})(i=t.Directives||(t.Directives={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(){return{restrict:"A",controller:n.Controllers.SeatMapDrawerController,templateUrl:"ng-templates/seat-map-drawers",link:function(){}}},t.DirectiveName="ejSeatMapDrawers",t}();t.SeatMapDrawerDirective=i})(t=n.Directives||(n.Directives={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function n(){}return n.Factory=function(n){return{restrict:"A",require:"^ejSeatMap",scope:{Passenger:"&passenger"},link:function(i,r){var u=i.$parent,f=i.Passenger(),e=u.$parent;new t.DomUpdaters.SeatMapPassengerUpdater(r,f,u,e,n)}}},n.DirectiveName="ejSeatMapPassenger",n}();i.SeatMapPassengerDirective=r;r.Factory.$inject=[n.DynamicDependencyKeys.SeatMapReadOnlyService]})(i=t.Directives||(t.Directives={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function n(){}return n.Factory=function(n,i,r,u){return{restrict:"A",require:"^ejSeatMap",link:function(f,e,o,s){var h=s.GetScope(),c=f.seat;new t.DomUpdaters.SeatMapSeatUpdater(e,c,n,i.SitecoreLanguageCode,h,r,u)}}},n.DirectiveName="ejSeatMapSeat",n}();i.SeatMapSeatDirective=r;r.Factory.$inject=["IAnalyticsTracker","Sitecore_SitecoreLanguageSettings","SeatMapSeatAssignmentService",n.DynamicDependencyKeys.SeatMapReadOnlyService]})(i=t.Directives||(t.Directives={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(t){var i=function(){function t(){}return t.Factory=function(i){return{restrict:"A",templateUrl:"ng-templates/seat-map-message",controller:n.Controllers.SeatMapSmartMessageController,link:function(n,r){var f=t.CreateContainer(r),u=t.CreateQTip(r,f,i);n.ShowMessage=function(){n.MessageVisible=!0;u.show()};n.HideMessage=function(){n.MessageVisible=!1;u.hide()};n.ChangeMessage=function(t){n.MessageVisible?r.fadeOut(200,function(){t();r.fadeIn(300)}):t()}}}},t.CreateContainer=function(n){var t=angular.element("<div>");return t.addClass("seat-map-message"),t.addClass("smart-message-container"),n.before(t),n.addClass("smart-message"),t},t.CreateQTip=function(n,i,r){return i.qtip({show:{event:"",effect:function(){t.UpdateCloseIcon(i,!0);angular.element(this).stop().slideDown(500,"linear")}},hide:{event:"",effect:function(){t.UpdateCloseIcon(i,!1);angular.element(this).stop().slideUp(500)}},position:{at:"top center",my:"bottom center",target:[0,0],container:i},content:{text:n},style:{classes:"ej-qtip-smart-message ej-qtip-smart-message-inline",def:!1,tip:!1},events:{render:function(n,t){r.SetDefaultAriaAttributesOnQtip(t)}}}),i.qtip("api")},t.UpdateCloseIcon=function(n,t){var i=n.find(".close-icon");t?i.appendTo(n).stop().show():i.fadeOut(400)},t.DirectiveName="ejSeatMapMessage",t}();t.SeatMapSmartMessageDirective=i;i.Factory.$inject=["SmartMessage_Service"]})(t=n.Directives||(n.Directives={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function i(n,t,i,r,u){this._element=n;this._passenger=t;this._seatMapPassengerScope=i;this._sliderScope=r;this._readOnlyService=u;this._passenger&&(this._readOnlyService.IsPassengerReadOnly(this._passenger.Id)?this._element.addClass("passenger-readonly"):(this.BindPassengerSelectionEvents(),this.BindUnassignClickHandler()),this.AddPassengerSelectedCallbackHandler(),this.AddSeatAssignedCallbackHandler(),this.AddPassengerTypeClass())}return i.prototype.BindPassengerSelectionEvents=function(){var n=this,t=function(){n._passenger?n._seatMapPassengerScope.SelectPassengers([n._passenger]):n._seatMapPassengerScope.SelectAllPassengers()};if(bowser.msie&&bowser.version<=9)this._element.on("selectstart",function(){return n._element[0].dragDrop(),!1});this._element.on("dragstart",function(n){var i=n.originalEvent;i.dataTransfer.setData("Text","passenger");t()});this._element.on("click",function(){t()});this._element.on("keydown",function(i){var r=new Main3.Common.KeyboardEventWrapper(i);(r.IsReturnKeyPress()||r.IsSpaceKeyPress())&&(r.PreventDefault(),t(),n._element.find(".icon").blur())})},i.prototype.BindUnassignClickHandler=function(){var i=this,r=this._element.find(".unassign-passenger-button"),u=this._element.find(".passenger-detail");if(r){r.on("click",function(){i._seatMapPassengerScope.UnassignPassengers([i._passenger]);u.focus();n.Events.Fire(t.Events.SeatUnassigned)});r.on("keydown",function(n){var t=new Main3.Common.KeyboardEventWrapper(n);(t.IsSpaceKeyPress()||t.IsReturnKeyPress())&&(t.PreventDefault(),i._seatMapPassengerScope.UnassignPassengers([i._passenger]),u.focus())})}},i.prototype.AddPassengerSelectedCallbackHandler=function(){var n=this;this._seatMapPassengerScope.AddPassengerSelectedCallbackHandler(function(t){n._element.removeClass("selected");var i=t.map(function(n){return n.Id.toLowerCase()});t&&i.indexOf(n._passenger.Id.toLowerCase())>=0&&(n._element.addClass("selected"),n._sliderScope.SlideToSelectedItem(n._element))})},i.prototype.AddSeatAssignedCallbackHandler=function(){var n=this,t=this._element.find(".passenger-selected-seat");t&&t.length&&this._seatMapPassengerScope.AddSeatAssignedCallbackHandler(function(i){var r,u;if(t.text(""),n._element.removeClass("with-assigned-seat"),n._passenger)for(r=0;r<i.length;r++)i[r].Passenger.Id.toLowerCase()===n._passenger.Id.toLowerCase()&&(u=i[r],t.text(u.Seat.SeatNumber),n._readOnlyService.IsSeatReadOnly(u.Seat.SeatNumber)?n._element.addClass("with-assigned-seat-readonly"):n._element.addClass("with-assigned-seat"))})},i.prototype.AddPassengerTypeClass=function(){switch(this._passenger.Type){case 0:this._element.addClass("adult");break;case 1:this._element.addClass("adult-with-infant");break;case 2:this._element.addClass("infant");break;default:this._element.addClass("adult")}},i}();i.SeatMapPassengerUpdater=r})(i=t.DomUpdaters||(t.DomUpdaters={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(i){var r=function(){function i(n,t,i,r,u,f,e){this._element=n;this._seat=t;this._tracker=i;this._trackingLanguageCode=r;this._seatMapScope=u;this._assignmentService=f;this._readOnlyService=e;this.SetSeatIcons();this.AddSeatAssignedCallbackHandler();this.AddSelectedPassengersChangedCallbackHandler();this.AddDragEnterEventHandler();this.AddDragLeaveEventHandler();this.AddDragOverEventHandler();this.AddDropEventHandler();this.AddClickEventHandler();this.AddKeyDownEventHandler();this.UpdateDisabledState()}return i.prototype.SetSeatIcons=function(){this._element.removeClass("restricted");this._element.removeClass("infant-restricted");this.IsRestrictedSeat()?this._element.addClass("restricted"):this._assignmentService.AnyPassengerIsInfantRestricted(this._seat,this._selectedPassengers)&&this._element.addClass("infant-restricted")},i.prototype.AddSeatAssignedCallbackHandler=function(){var n=this;this._seatMapScope.AddSeatAssignedCallbackHandler(function(t){n.RemovePassengerFromSeat();n.SetSeatIcons();for(var i=0;i<t.length;i++)if(t[i].Seat.SeatNumber===n._seat.SeatNumber){n._element.addClass("passenger-assigned");switch(t[i].Passenger.Type){case 0:n._element.addClass("adult");break;case 2:n._element.addClass("infant");break;case 1:n._element.addClass("adult-infant")}t[i].Passenger.Initials?n.SetAssignedPassengerText(t[i].Passenger.Initials):n.SetAssignedPassengerText(t[i].Passenger.Id)}})},i.prototype.AddSelectedPassengersChangedCallbackHandler=function(){var n=this;this._seatMapScope.AddSelectedPassengersChangedCallbackHandler(function(t){n._selectedPassengers=t;n.SetSeatIcons()})},i.prototype.AddDragEnterEventHandler=function(){var n=this;this._element.on("dragenter",function(t){t.preventDefault();n._seat.IsAvailable&&(n._element.focus(),n._element.addClass("select"))})},i.prototype.AddDragLeaveEventHandler=function(){var n=this;this._element.on("dragleave",function(t){t.preventDefault();n._seat.IsAvailable&&(n._element.blur(),n._element.removeClass("select"))})},i.prototype.AddDragOverEventHandler=function(){this._element.on("dragover",function(n){n.preventDefault()})},i.prototype.AddDropEventHandler=function(){var n=this;this._element.on("drop",function(t){t.preventDefault();var i=t.originalEvent;i.dataTransfer.getData("Text")==="passenger"&&n.OnAssignSeats(!0)})},i.prototype.AddClickEventHandler=function(){var n=this;this._element.on("click",function(){n.OnAssignSeats(!1)})},i.prototype.AddKeyDownEventHandler=function(){var n=this;this._element.on("keydown",function(t){var i=new Main3.Common.KeyboardEventWrapper(t);i.IsReturnKeyPress()&&(i.PreventDefault(),n.OnAssignSeats(!1))})},i.prototype.OnAssignSeats=function(i){this._seatMapScope.SetFocussedElement(this._element);this._element.hasClass("passenger-assigned")?(this._seatMapScope.UnassignSeats([this._seat]),n.Events.Fire(t.Events.SeatUnassigned)):this._seat.IsAvailable&&(this._element.removeClass("select"),this._seatMapScope.AssignSeats([this._seat]));this.UpdateDisabledState();this._tracker.TrackEvent(Tracking.EventConstants.Categories.Seating,i?"Drag":"Select",this._trackingLanguageCode)},i.prototype.IsRestrictedSeat=function(){return this._seat.SeatAccess==="Restricted"},i.prototype.RemovePassengerFromSeat=function(){this._element.removeClass("passenger-assigned");this._element.removeClass("adult");this._element.removeClass("infant");this._element.removeClass("adult-infant");this.SetAssignedPassengerText("");this.UpdateDisabledState()},i.prototype.UpdateDisabledState=function(){!this._seat.IsAvailable||this._readOnlyService.IsSeatReadOnly(this._seat.SeatNumber)?(this._element.addClass("unavailable"),this._element.attr("disabled","disabled")):(this._element.removeClass("unavailable"),this._element.removeAttr("disabled"))},i.prototype.SetAssignedPassengerText=function(n){this._element.find(".assigned-passenger").text(n)},i}();i.SeatMapSeatUpdater=r})(i=t.DomUpdaters||(t.DomUpdaters={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this.ExtraLegroomPriceBandName="Extra legroom";this._aircrafts=n.Aircraft}return n.prototype.GetAircraftByType=function(n){var t=this._aircrafts.filter(function(t){return t.AircraftType.indexOf(n)!==-1})[0];return jQuery.extend(!0,{},t)},n.FindSeatBySeatNumber=function(n,t){var i;return t.forEach(function(t){t.Blocks.forEach(function(t){t.Seats.forEach(function(t){t.SeatNumber===n&&(i=t)})})}),i},n.prototype.BuildSeatMapSections=function(n,t,i){var f=this,u=[],e=n[0],r=this.InitialiseEmptySection();return n.forEach(function(n){n.PriceBandName!==e.PriceBandName?(u.push(r),r=f.InitialiseEmptySection(),r=f.PushRowsIntoSection(r,n)):r=f.PushRowsIntoSection(r,n);e=n}),u.push(r),this.SetPriceBandProperties(t,u),this.AddAdditionalInformationToSeats(i,u),u},n.prototype.InitialiseEmptySection=function(){return{SeatMapRows:[],SectionDisplayName:null,SectionDescription:null,SectionName:null,SectionNameForScreenReaders:null,SectionPrice:0}},n.prototype.PushRowsIntoSection=function(n,t){return n.SeatMapRows.push(t),n.SectionName=t.PriceBandName,n.SectionPrice=t.Blocks[0].Seats[0].Price,n},n.prototype.SetPriceBandProperties=function(n,t){return!n||t.forEach(function(t){var i=Utilities.Arrays.FirstOrDefault(n.PriceBands,function(n){return n.PriceBandName===t.SectionName});t.SectionDisplayName=i.PriceBandDisplayName;t.SectionDescription=i.PriceBandDescription;t.SectionNameForScreenReaders=i.AccessibilityHeaders.shift()}),t},n.prototype.AddAdditionalInformationToSeats=function(n,t){var r=this,u=(n||"").split(","),i;t.forEach(function(n){n.SeatMapRows.forEach(function(n){n.HasExtraLegroom=n.PriceBandName===r.ExtraLegroomPriceBandName;n.Blocks.forEach(function(n){n.Seats.forEach(function(t){u.some(function(n){return n.toUpperCase()===t.SeatNumber.toUpperCase()})&&(t.IsBulkhead=!0);t.OtherSeatsInBlock=n.Seats.filter(function(n){return t.SeatNumber.toUpperCase()!==n.SeatNumber.toUpperCase()})})})})});i=Utilities.Arrays.SelectMany(t,function(n){return n.SeatMapRows.filter(function(n){return n.IsOverWing})});i.length>0&&(_(i).first().IsFirstOverWing=!0,_(i).last().IsLastOverWing=!0)},n.ServiceName="Sitecore_SeatMapAircraftService",n.$inject=["seatMapSettings"],n}();n.SeatMapSeatAircraftService=t})(t=n.Services||(n.Services={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(n){function t(t,i,r,u){return n.call(this,t,i,r,u,"","")||this}return __extends(t,n),t.prototype.GetSeatMap=function(n,t,i){this.AjaxRequest("GET","seating/getseatplan",n,t,this.ExtractKnownError(i),"");var r=Flights.SegmentId.FromParts(new Utilities.TimeAgnosticDate(n.DepartureDate),n.DepartureIata,n.ArrivalIata,n.FlightNumber);this._tracking.TrackNonInteractionEvent("DA-SEAT","GetSeatMap",r.ToString())},t.ServiceName="SeatMapApiService",t.$inject=["ClientApi_Service","$http","$httpParamSerializer","IAnalyticsTracker"],t}(n.Services.BaseClientApiService);t.SeatMapApiService=i})(i=t.Services||(t.Services={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r,u){this._seatAssignmentService=n;this._seatMapPassengerService=t;this._flightDataService=i;this._analyticsTracker=r;this._languageSettings=u;this._viewedDrawers={}}return t.prototype.OpenDrawer=function(t,i){var r={SectionKey:t,Parameters:i};n.Events.OpenDrawerWithOptions(r);this._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Seating,"GetInfo",t+" | "+this._languageSettings.SitecoreLanguageCode)},t.prototype.OpenSeatDrawer=function(n,t,i,r){switch(n){case 2:this.OpenBulkheadSeatWarningDrawer(t,i,r);break;case 1:this.OpenSeatRestrictionsDrawer(t,i,r);break;case 4:this.OpenSpecialAssistanceDrawer(i);break;case 3:this.OpenTravellingWithChildrenDrawer(i);break;case 0:r!=null&&r()}},t.prototype.OpenAreYouSureDrawer=function(t,i){var r=this;this.IfDrawerNotViewed("are-you-sure",t,function(){var t={SelectedSeats:[],FirstOptionAction:function(){n.Events.Fire(n.Events.Names.Drawer.Close)},SecondOptionAction:function(){return i()},ShouldAutoClose:!1};r.OpenDrawer("are-you-sure",t)})},t.prototype.OpenYouHaventSelectedAllSeatsDrawer=function(t,i){var r=this;this.IfDrawerNotViewed("you-have-not-selected-all-seats",t,function(){var t={SelectedSeats:[],FirstOptionAction:function(){n.Events.Fire(n.Events.Names.Drawer.Close)},SecondOptionAction:function(){return i()},ShouldAutoClose:!1};r.OpenDrawer("you-have-not-selected-all-seats",t)})},t.prototype.OpenBulkheadSeatWarningDrawer=function(n,t,i){var r=this,u=this._seatAssignmentService.GetBulkheadSeatAssignments();this.IfDrawerNotViewed("bulkhead-seat-warning",t,function(){var n={SelectedSeats:u.map(function(n){return n.Seat.SeatNumber}),FirstOptionAction:function(){i!=null&&i()},SecondOptionAction:function(){},ShouldAutoClose:!0};r.OpenDrawer("bulkhead-seat-warning",n)})},t.prototype.OpenEasyJetPlusDrawer=function(n){var t=this;this.IfDrawerNotViewed("easyjet-plus",n,function(){t.OpenDrawer("easyjet-plus",null)})},t.prototype.OpenSeatNoLongerAvailableDrawer=function(t){var i=this,r={SectionKey:"seat-no-longer-available",OnConfirmCallback:function(){var r=i._flightDataService.GetCurrentFlightData().FlightInternalId;t(r);n.Events.Fire(n.Events.Names.Drawer.Close);i._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Seating,Tracking.EventConstants.Actions.Fail,Tracking.EventConstants.Labels.SeatClash)}};n.Events.OpenDrawerWithOptions(r)},t.prototype.OpenSeatRestrictionsDrawer=function(n,t,i){var r=this,u=this._seatAssignmentService.GetRestrictedSeatAssignments();this.IfDrawerNotViewed("seat-restrictions",t,function(){var n={SelectedSeats:u.map(function(n){return n.Seat.SeatNumber}),FirstOptionAction:function(){i!=null&&i()},SecondOptionAction:function(){},ShouldAutoClose:!0};r.OpenDrawer("seat-restrictions",n)})},t.prototype.OpenSpecialAssistanceDrawer=function(n){var t=this;this.IfDrawerNotViewed("special-assistance",n,function(){t.OpenDrawer("special-assistance",null)})},t.prototype.OpenTravellingWithChildrenDrawer=function(t){var i=this;this.IfDrawerNotViewed("travelling-with-children",t,function(){n.Events.OpenDrawer("travelling-with-children");var t=i._flightDataService.GetCurrentFlightData().AircraftType;i._analyticsTracker.TrackEvent(Tracking.EventConstants.Categories.Seating,"GetInfo","travelling-with-children | "+i._languageSettings.SitecoreLanguageCode+" | "+t)})},t.prototype.OpenWhySelectASeatDrawer=function(n){var t=this;this.IfDrawerNotViewed("why-select-a-seat",n,function(){t.OpenDrawer("why-select-a-seat",null)})},t.prototype.SetDrawerSeen=function(n){this._viewedDrawers[n]=!0},t.prototype.HasViewedDrawer=function(n){return(this._viewedDrawers[n]||!1)===!0},t.prototype.IfDrawerNotViewed=function(n,t,i){t&&this.HasViewedDrawer(n)||(this.SetDrawerSeen(n),i())},t.ServiceName="SeatMapDrawerService",t.$inject=["SeatMapSeatAssignmentService","SeatMapPassengerService",n.DynamicDependencyKeys.SeatMapFlightDataService,"IAnalyticsTracker","Sitecore_SitecoreLanguageSettings"],t}();t.SeatMapDrawerService=i})(i=t.Services||(t.Services={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n,t){this._funnelECommerceCookieService=n;this._funnelBasketService=t;this._storedData=[]}return n.prototype.StoreSeatingDataForFlight=function(n,t){var i=this.BuildAnalyticsBandDataFromRows(t);this._storedData.push({SegmentId:n.ToString(),Bands:i})},n.prototype.BuildAnalyticsBandDataFromRows=function(n){for(var c,t,u,l,i,f,e,o,s=[],r=0,h=n;r<h.length;r++)for(c=h[r],t=0,u=c.Blocks;t<u.length;t++)for(l=u[t],i=0,f=l.Seats;i<f.length;i++)e=f[i],o=this.GetBandForSeat(s,e),o.TotalSeats++,e.IsAvailable&&o.FreeSeats++;return s},n.prototype.GetBandForSeat=function(n,t){var i,r=n.filter(function(n){return n.BandId===t.PriceBandId});return r.length===1?i=r[0]:(i={BandId:t.PriceBandId,FreeSeats:0,TotalSeats:0},n.push(i)),i},n.prototype.SaveSeatingDataForFlightToCookie=function(n){var i=this._storedData.filter(function(t){return t.SegmentId===n.ToString()}),t;i.length===1&&(t=this._funnelECommerceCookieService.ReadCookie(),t?t.SeatingAnalytics?(t.SeatingAnalytics.Flights=t.SeatingAnalytics.Flights.filter(function(t){return t.SegmentId!==n.ToString()}),t.SeatingAnalytics.Flights.push(i[0])):t.SeatingAnalytics={Flights:i}:t={AlreadySentForBookingRef:null,PaymentAnalytics:null,SeatingAnalytics:{Flights:i}},this._funnelECommerceCookieService.WriteCookie(t))},n.prototype.RemoveUnusedDataFromCookie=function(){var r=this._funnelBasketService.GetFlights().map(function(n){return new Flights.SegmentId(n.SegmentId).ToString()}),n=this._funnelECommerceCookieService.ReadCookie(),t=!1,i;!n||!n.SeatingAnalytics||(i=n.SeatingAnalytics.Flights.length,n.SeatingAnalytics.Flights=n.SeatingAnalytics.Flights.filter(function(n){return r.indexOf(n.SegmentId)>-1}),t=n.SeatingAnalytics.Flights.length!==i);t&&this._funnelECommerceCookieService.WriteCookie(n)},n.ServiceName="SeatMapECommerceService",n.$inject=["FunnelECommerceCookie_Service","Funnel_BasketService"],n}();n.SeatMapECommerceService=t})(t=n.Services||(n.Services={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(t,i,r,u,f,e){var o=this;this._currentFlightIndex=0;this._qService=t;this.$rootScope=i;this._funnelBasketService=r;this._priceService=f;this._funnelRootSettings=u;this._activePairService=e;this._skipAllFlights=!1;this._flightDataQueueLoadedDeferred=this._qService.defer();this.$rootScope.$on(n.Events.Names.Funnel.FunnelReady,function(){o._flightDataQueue||(o._currentFlightIndex=0,o._flightDataQueue=o.LoadFlightDataQueue(),o.LoadNext(),o._flightDataQueueLoadedDeferred.resolve())})}return t.prototype.GetCurrentFlightData=function(){return this._currentFlightData},t.prototype.GetFlightDataForFlightInternalId=function(n){var t=this.LoadFlightDataQueue().filter(function(t){return t.FlightInternalId===n});return t&&t.length>0?t[0]:null},t.prototype.IsLoaded=function(){return this._flightDataQueueLoadedDeferred.promise},t.prototype.LoadNext=function(){this.ShouldLoadNext()&&(this._currentFlightData=this._flightDataQueue.shift(),this._currentFlightIndex++,this._activePairService.UpdateActiveJourneyPair(this._currentFlightData.JourneyPairId))},t.prototype.ShouldLoadNext=function(){return this.HasNext()&&!this._skipAllFlights},t.prototype.HasNext=function(){return!!this._flightDataQueue&&this._flightDataQueue.length>0},t.prototype.GetCurrentFlightIndex=function(){return this._currentFlightIndex},t.prototype.LoadFlightDataQueue=function(){var i=[],r=this._funnelBasketService.GetJourneyPairs(),t,n,u,f;if(r)for(t=0;t<r.length;t++)n=r[t],n.OutboundSlot&&n.OutboundSlot.Route&&n.OutboundSlot.Flight&&(u=this.GetFlightDataFromJourneySlot(n.OutboundSlot,n.Id),i.push(u)),n.ReturnSlot&&n.ReturnSlot.Route&&n.ReturnSlot.Flight&&(f=this.GetFlightDataFromJourneySlot(n.ReturnSlot,n.Id),i.push(f));return i},t.prototype.GetJourneyPairForCurrentFlightData=function(){var n=this;return this._funnelBasketService.GetJourneyPairs().filter(function(t){return t.Id===n._currentFlightData.JourneyPairId})[0]},t.prototype.GetFlightDataFromJourneySlot=function(n,t){return{FlightInternalId:n.Flight.InternalId,FlightNumber:n.Flight.FlightNumber,LanguageCode:this._funnelRootSettings.EResLanguageCode,CurrencyCode:this._priceService.GetCurrentCurrency().CurrencyCode,FareType:this._funnelBasketService.GetFareType(),JourneyPairId:t,SegmentId:new Flights.SegmentId(n.Flight.SegmentId),IsUnavailable:!1,AircraftType:""}},t.prototype.SetAircraftType=function(n){this._currentFlightData.AircraftType=n},t.prototype.MarkFlightAsUnavailable=function(n){if(!!this._flightDataQueue){var t=Utilities.Arrays.FirstOrDefault(this._flightDataQueue,function(t){return t.FlightInternalId==n.FlightInternalId});t||this._currentFlightData.FlightInternalId!==n.FlightInternalId||(t=this._currentFlightData);!t||(t.IsUnavailable=!0)}},t.prototype.GetRemainingFlightDataCount=function(){return!this._flightDataQueue?0:this._flightDataQueue.length},t.prototype.SetSkipAllFlights=function(n){this._skipAllFlights=n},t.ServiceName="SeatMapFunnelFlightDataService",t.$inject=["$q","$rootScope","Funnel_BasketService","Sitecore_FunnelRootSettings","Common_PriceService","Funnel_ActivePairService"],t}();t.SeatMapFunnelFlightDataService=i})(i=t.Services||(t.Services={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function t(n,t,i,r){this._seatMapSettings=n;this._funnelBasketService=t;this._funnelPassengerService=i;this._passengerDisplayService=r}return t.prototype.GetPassengers=function(t){var u,i,f;if(this._passengers)return this._passengers;var e=this._funnelBasketService.GetBasket(),r=e.Passengers,o=e.CarriedInfants;if(!r||r.length===0)return null;for(u=[],i=0;i<r.length;i++)f=null,r[i].Type===n.Data.Common.PassengerDataType.Adult&&(f=this._funnelPassengerService.GetInfantForPassenger(r[i].InternalId,t)),u.push(this.GetSeatMapPassenger(r[i],i,f));return u},t.prototype.GetSeatMapPassenger=function(n,t,i){var u=this.GetPassengerCarriedInfantDisplayName(i),r=this.GetPassengerDisplayName(n,t),f=r;return u&&(f=r+" "+u),{FallBackSeatNumber:null,FallBackSeatData:null,Id:n.InternalId,CarriedInfantDisplayName:this.GetPassengerCarriedInfantDisplayName(i),DisplayName:r,FullDisplayName:f,Initials:this._passengerDisplayService.GetPassengerInitials(n,t),RequiresSpecialAssistance:n.HasSpecialServiceFlags,Type:this.GetPassengerType(n,i)}},t.prototype.GetPassengerDisplayName=function(n){return this._funnelPassengerService.GetDisplayName(n.InternalId)},t.prototype.GetPassengerCarriedInfantDisplayName=function(n){if(n){var t=this._funnelPassengerService.GetDisplayName(n.InternalId);return"& "+t+" "+(this._seatMapSettings.CarriedInfantSuffix||"")}return""},t.prototype.GetPassengerType=function(t,i){switch(t.Type){case n.Data.Common.PassengerDataType.Adult:return i?1:0;case n.Data.Common.PassengerDataType.Child:return 2;default:return 0}},t.ServiceName="SeatMapFunnelPassengerService",t.$inject=["seatMapSettings","Funnel_BasketService","Funnel_PassengerService","Common_PassengerDisplayService"],t}();t.SeatMapFunnelPassengerService=i})(i=t.Services||(t.Services={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(n){this._journeyService=n}return n.prototype.IsCurrentFlightReadOnly=function(){return!this._journeyService.GetCurrentStepInJourney()},n.prototype.IsPassengerReadOnly=function(){return!this._journeyService.GetCurrentStepInJourney()},n.prototype.IsSeatReadOnly=function(){return!this._journeyService.GetCurrentStepInJourney()},n.ServiceName="SeatMapFunnelReadOnlyService",n.$inject=["Funnel_JourneyService"],n}();n.SeatMapFunnelReadOnlyService=t})(t=n.Services||(n.Services={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){this._passengerSelectedCallbacks=$jq.Callbacks();this._selectedPassengers=[]}return n.prototype.AddPassengerSelectedCallbackHandler=function(n){this._passengerSelectedCallbacks.add(n)},n.prototype.GetSelectedPassengers=function(){return this._selectedPassengers},n.prototype.SelectPassengers=function(n){this._selectedPassengers=n;this._passengerSelectedCallbacks.fire(this._selectedPassengers)},n.prototype.SelectNextUnassignedPassenger=function(n,t){var o=this._selectedPassengers[this._selectedPassengers.length-1],f,i,r,u,e;if(n.length>0){for(f=t.indexOf(o),i=0,r=n;i<r.length;i++)if(u=r[i],e=t.indexOf(u),e>f){this.SelectPassengers([u]);return}this.SelectPassengers([n[0]])}},n.ServiceName="SeatMapPassengerService",n.$inject=[],n}();n.SeatMapPassengerService=t})(t=n.Services||(n.Services={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(t){var i;(function(t){var i=function(){function i(n,t,i){this._funnelBasketService=n;this._seatMapSeatAssignmentService=t;this._flightDataService=i}return i.prototype.CanSelectSameSeats=function(n,t){var r=this,i;return this.IsReturnFlight()?(i=this.GetOutboundAssociations(),i.length===0)?!1:_(i).every(function(i){return!!i.Seat&&r.ReturnSeatIsAvailable(n,i,t)}):!1},i.prototype.HasOutboundSeatsAssigned=function(){var n=this.GetOutboundAssociations();return _(n).any(function(n){return!!n.Seat})},i.prototype.SelectSameSeats=function(n,i){var u=this,r=this.GetOutboundAssociations(),f=r.map(function(i){return t.SeatMapSeatAircraftService.FindSeatBySeatNumber(i.Seat.SeatNumber,n)}),e=r.map(function(n){return u.GetPassengerFromId(n.PassengerInternalId,i)});this._seatMapSeatAssignmentService.AssignSeats(f,e)},i.prototype.HasSelectedSameSeats=function(){var n=this,t=this.GetOutboundAssociations(),i=this.GetReturnAssociations();return _(t).every(function(t){return!!t.Seat&&_(i).some(function(i){return n.SeatAssociationsAreEqual(t,i)&&n.IsSamePassenger(t,i)})})},i.prototype.GetOutboundAssociations=function(){var n=this.GetCurrentJourney();return n.OutboundSlot?this._funnelBasketService.GetBasket().Associations.filter(function(t){return t.FlightInternalId===n.OutboundSlot.Flight.InternalId&&t.PassengerInternalId!==""}):[]},i.prototype.GetReturnAssociations=function(){var n=this.GetCurrentJourney();return n.ReturnSlot?this._funnelBasketService.GetBasket().Associations.filter(function(t){return t.FlightInternalId===n.ReturnSlot.Flight.InternalId&&t.PassengerInternalId!==""}):[]},i.prototype.ReturnSeatIsAvailable=function(n,i,r){var u=t.SeatMapSeatAircraftService.FindSeatBySeatNumber(i.Seat.SeatNumber,n),f=this.GetPassengerFromId(i.PassengerInternalId,r),e=!f?!1:!this._seatMapSeatAssignmentService.AnyPassengerIsInfantRestricted(u,[f]);return u&&u.IsAvailable&&e&&i.Seat.PriceBand===u.PriceBand},i.prototype.GetPassengerFromId=function(n,t){var i=t.filter(function(t){return t.Id===n});return i.length>0?i[0]:null},i.prototype.SeatAssociationsAreEqual=function(n,t){return!!n.Seat&&!!t.Seat&&n.Seat.SeatNumber===t.Seat.SeatNumber&&n.Seat.PriceBand===t.Seat.PriceBand},i.prototype.IsSamePassenger=function(n,t){return n.PassengerInternalId===t.PassengerInternalId},i.prototype.GetCurrentJourney=function(){var n=this._flightDataService.GetCurrentFlightData(),i=this._funnelBasketService.GetJourneyPairs(),t=i.filter(function(t){return t.OutboundSlot.Flight.InternalId===n.FlightInternalId||t.ReturnSlot&&t.ReturnSlot.Flight.InternalId===n.FlightInternalId});return t.length>0?t[0]:null},i.prototype.IsReturnFlight=function(){var n=this._flightDataService.GetCurrentFlightData(),t=this._funnelBasketService.GetJourneyPairs(),i=t.filter(function(t){return t.ReturnSlot&&t.ReturnSlot.Flight.InternalId===n.FlightInternalId});return i.length>0},i.ServiceName="SeatMapSameSeatService",i.$inject=["Funnel_BasketService","SeatMapSeatAssignmentService",n.DynamicDependencyKeys.SeatMapFlightDataService],i}();t.SeatMapSameSeatService=i})(i=t.Services||(t.Services={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t;(function(n){var t;(function(n){var t=function(){function n(){this._seatAssignedCallbacks=$jq.Callbacks();this._seatAssignments=[]}return n.prototype.AddSeatAssignedCallback=function(n){this._seatAssignedCallbacks.add(n)},n.prototype.AssignSeats=function(n,t){var i,r,u;if((n||[]).length===(t||[]).length){for(this.UnassignPassengers({passengers:t,fireCallback:!1,allowFallBackSeat:!1}),this.UnassignSeats({seats:n,fireCallback:!1,allowFallBackSeat:!1}),i=0;i<(t||[]).length;i++)r=t[i],u=n[i],this._seatAssignments.push({Passenger:r,Seat:u}),r.Type===1&&(u.PassengerIdWithInfantSeatedHere=r.Id.toLowerCase());this._seatAssignedCallbacks.fire(this._seatAssignments)}},n.prototype.Clear=function(){this.UnassignPassengers({passengers:this.GetAssignedPassengers(),fireCallback:!0,allowFallBackSeat:!0})},n.prototype.GetAssignedPassengers=function(){for(var r,t=[],n=0,i=this._seatAssignments;n<i.length;n++)r=i[n],t.push(r.Passenger);return t},n.prototype.GetAssignedSeatCount=function(){return this._seatAssignments.length},n.prototype.GetAssignedSeatNumbers=function(){return this._seatAssignments.map(function(n){return n.Seat.SeatNumber})},n.prototype.GetAssignedSeatsForPassengers=function(n){var t=(n||[]).map(function(n){return n.Id.toLocaleLowerCase()});return this._seatAssignments.filter(function(n){return _(t).any(function(t){return t===n.Passenger.Id.toLowerCase()})})},n.prototype.GetAssignedSeatForPassengerId=function(n){var t=this._seatAssignments.filter(function(t){return t.Passenger.Id===n});return t&&t.length>0?t[0]:null},n.prototype.GetBulkheadSeatAssignments=function(){return this._seatAssignments.filter(function(n){return n.Seat.IsBulkhead})},n.prototype.GetRestrictedSeatAssignments=function(){var n=this;return this._seatAssignments.filter(function(t){return n.IsRestrictedSeat(t.Seat)})},n.prototype.GetUnassignedPassengers=function(n){var t=this.GetAssignedPassengers().map(function(n){return n.Id.toLowerCase()});return n.filter(function(n){return t.indexOf(n.Id.toLowerCase())===-1})},n.prototype.ValidateSeatAssignment=function(n,t){return this.IsRestrictedSeat(n)?this.IsTravellingWithChild(t)?3:t.RequiresSpecialAssistance?4:1:this.AnyPassengerIsInfantRestricted(n,[t])?5:n.IsBulkhead?2:0},n.prototype.AnyPassengerIsInfantRestricted=function(n,t){if(t&&n){var i=t.map(function(n){return n.Id.toLowerCase()}),r=t.filter(function(n){return n.Type===1}).length>0,u=!n.IsAvailableForInfant,f=n.OtherSeatsInBlock.filter(function(n){return n.PassengerIdWithInfantSeatedHere&&i.indexOf(n.PassengerIdWithInfantSeatedHere)===-1}).length>0;if((u||f)&&r)return!0}return!1},n.prototype.IsRestrictedSeat=function(n){return n.SeatAccess==="Restricted"},n.prototype.IsTravellingWithChild=function(n){return n.Type===1||n.Type===2},n.prototype.GetPassengersAssignedToSeats=function(n){for(var f,r=[],e=function(n){t=o._seatAssignments.filter(function(t){return t.Seat.SeatNumber.toLowerCase()===n.SeatNumber.toLowerCase()});(t||[]).length>0&&r.push(t[0].Passenger)},o=this,t,i=0,u=n;i<u.length;i++)f=u[i],e(f);return r},n.prototype.UnassignPassengers=function(n){for(var u,f=function(t){var r=i._seatAssignments.filter(function(n){return n.Passenger.Id.toLowerCase()===t.Id.toLowerCase()});i.Unassign(r,n.allowFallBackSeat)},i=this,t=0,r=n.passengers||[];t<r.length;t++)u=r[t],f(u);n.fireCallback&&this._seatAssignedCallbacks.fire(this._seatAssignments)},n.prototype.UnassignSeats=function(n){for(var u,f=function(t){var r=i._seatAssignments.filter(function(n){return n.Seat.SeatNumber.toLowerCase()===t.SeatNumber.toLowerCase()});i.Unassign(r,n.allowFallBackSeat)},i=this,t=0,r=n.seats||[];t<r.length;t++)u=r[t],f(u);n.fireCallback&&this._seatAssignedCallbacks.fire(this._seatAssignments)},n.prototype.Unassign=function(n,t){var i=this;n&&n.forEach(function(n){n&&n.Passenger&&n.Passenger.Type===1&&(n.Seat.PassengerIdWithInfantSeatedHere=null);i._seatAssignments=i._seatAssignments.filter(function(t){return t!==n});t&&!!n.Passenger.FallBackSeatData&&i.AssignSeats([n.Passenger.FallBackSeatData],[n.Passenger])})},n.ServiceName="SeatMapSeatAssignmentService",n.$inject=[],n}();n.SeatMapSeatAssignmentService=t})(t=n.Services||(n.Services={}))})(t=n.SeatMap||(n.SeatMap={}))}(AngularEj||(AngularEj={})),function(n){var t=function(){function t(){}return t.Fire=function(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];window.angularEjRootScope&&angularEjRootScope.$applyAsync(function(t){t.$broadcast.apply(angularEjRootScope,[n].concat(i))})},t.OpenDrawer=function(n,i){i===void 0&&(i=null);t.OpenDrawerWithOptions({SectionKey:n},i)},t.DoSignInBeforeRedirect=function(t){this.Fire(n.Events.Names.Header.ShowSignInBeforeRedirect,t)},t.DoCheckInBeforeRedirect=function(t){this.Fire(n.Events.Names.Header.ShowCheckInBeforeRedirect,t)},t.OpenDrawerWithOptions=function(t,i){i===void 0&&(i=null);i||(i=angularEjRootScope);i.$applyAsync(function(i){i.$emit(n.Events.Names.Drawer.Open,t)})},t.QueueDrawer=function(n,i){i===void 0&&(i=null);t.QueueDrawerWithOptions({SectionKey:n},i)},t.QueueDrawerWithOptions=function(t,i){i===void 0&&(i=null);i||(i=angularEjRootScope);i.$applyAsync(function(i){i.$emit(n.Events.Names.Drawer.Queue,t)})},t.CloseDrawer=function(){this.Fire(t.Names.Drawer.Close)},t.Names={NavigationService:{ChangeStart:"NavigationService.ChangeStart"},Account:{DeprecatedSignInStatusChanged:"ej.account.signinstatuschanged.deprecated",GetUsernameFailed:"ej.account.getusernamefailed",GetSignInStatusFailed:"ej.account.getsigninstatusfailed",ResetExpiryTimer:"ej.account.resetexpirytimer",SignInStatusChanged:"ej.account.signinstatuschanged",SignInDrawer:{InitializePassengerSignIn:"ej.account.signindrawer.initializepassengersignin",InitializeRegisteredUserSignIn:"ej.account.signindrawer.initializeregisteredusersignin",SignInTypeChanged:"ej.account.signindrawer.signintypechanged"}},AriaHideModal:{Hide:"ej.ariahidemodal.hide",Unhide:"ej.ariahidemodal.unhide"},AvailabilityFlightsProvider:{ApiError:"ej.availabilityflightsprovider.apierror",ForceRefresh:"ej.availabilityflightsprovider.forcerefresh",RegisterSubscriber:"ej.availabilityflightsprovider.registersubscriber",ForceGridRefresh:"ej.availabilityflightsprovider.forcegridrefresh",ForceBasketRefresh:"ej.availabilityflightsprovider.forcebasketrefresh"},Basket:{BasketInitialised:"ej.basket.funnelbasketinitialised",FunnelBasketReady:"ej.basket.funnelbasketready",FunnelBasketUpdating:"ej.basket.funnelbasketupdating",HeightModified:"ej.basket.heightmodified",Hide:"ej.basket.hide",InitializeContinueButton:"ej.basket.continuebuttoninitialized",ManageContinueButton:"ej.basket.managecontinuebutton",Opened:"ej.basket.opened",PassengersOrdered:"ej.basket.passengersordered",SelectedFareUpdated:"ej.basket.selectedfareupdated",SetChanges:"ej.basket.setchanges",SetFocusOnTitle:"ej.basket.setfocusontitle",SetFocusOnChangeCurrency:"ej.basket.setfocusonchangecurrency",SetPrice:"ej.basket.setprice",SetupBasket:"ej.basket.setupbasket",Show:"ej.basket.show",ResetFocus:"ej.basket.resetfocus"},CheckinButton:{Clicked:"ej.checkinbutton.clicked",Status:"ej.checkinbutton.status"},Drawer:{Open:"ej.drawer.open",Opened:"ej.drawer.opened",Back:"ej.drawer.back",Close:"ej.drawer.close",Closed:"ej.drawer.closed",Closing:"ej.drawer.closing",Dismiss:"ej.drawer.dismiss",Dismissed:"ej.drawer.dismissed",Scroll:"ej.drawer.scroll",Queue:"ej.drawer.queue",DoPostponedLoad:"ej.drawer.dopostponedload",TabChanged:"ej.drawer.tabChanged",ActivateTab:"ej.drawer.activateTab",SectionCreated:"ej.drawer.sectioncreated",ResetTitle:"ej.drawer.resettitle"},DrawerSection:{Shown:"ej.drawersection.shown",Hidden:"ej.drawersection.hidden"},DrawerSectionView:{Start:"ej.drawersectionview.start",Animating:"ej.drawersectionview.animating",End:"ej.drawersectionview.end"},EditableControls:{RegisterControl:"ej.editablecontrols.registercontrol",RegisterEditableControl:"ej.editablecontrols.registereditablecontrol",SetEditingFirstInvalid:"ej.editablecontrols.handlereviewsection",StartEditingReviewSection:"ej.editablecontrols.starteditingreviewsection"},ErrorMessage:{Close:"ej.errormessage.close"},FinaliseButton:{Clicked:"ej.finalisebutton.clicked",Status:"ej.finalisebutton.status"},FlightSearch:{SearchStarted:"ej.flightsearch.searchstarted",SearchCancelled:"ej.flightsearch.searchcancelled",SearchCompleted:"ej.flightsearch.searchcompleted"},FlightTracker:{FlightUpdated:"ej.flightstatus.flightupdated",FlightNumberFinder:{Validate:"ej.flightstatus.flightnumberfinder.validate"}},FlightGrid:{FlightFareSelected:"ej.flightgrid.flightfareselected",SelectFlightFareRequest:"ej.flightgrid.selectflightfarerequest",InitialLoadComplete:"ej.flightgrid.initialloadcomplete",Refreshed:"ej.flightgrid.refreshed",ShowLoadingSpinners:"ej.flightgrid.showloadingspinners"},Header:{Fixed:"ej.helpinghand.fixed",Unfixed:"ej.helpinghand.unfixed",ShowSignInBeforeRedirect:"ej.header.showsigninbeforeredirect",ShowCheckInBeforeRedirect:"ej.header.showcheckinbeforeredirect"},HelpingHand:{Focus:"ej.helpinghand.focus",PreventInitialReset:"ej.helpinghand.preventinitialreset",Reset:"ej.helpinghand.reset",ShowText:"ej.helpinghand.showtext",ShowObject:"ej.helpinghand.showobject",ShowTemplate:"ej.helpinghand.showtemplate",ShowTextWithButton:"ej.helpinghand.showtextwithbutton",SetOriginalText:"ej.helpinghand.setoriginaltext",SetSubtitle:"ej.helpinghand.setsubtitle"},PaymentCard:{ScrollToDetails:"ej.paymentcard.scrolltodetails"},Rebooking:{BasketLoaded:"ej.rebooking.basketloaded",FlightModified:"ej.rebooking.flightmodified",AirportChangeNotification:"ej.rebooking.airportchangenotification",ScrollToFirstDisruption:"ej.rebooking.scrolltofirstdisruption",UpdateHelpingHand:"ej.rebooking.updatehelpinghand"},RouteDatePicker:{DateChosen:"ej.routedatepicker.datechosen",ApiError:"ej.routedatepicker.apierror",BeforeOpen:"ej.routedatepicker.BeforeOpen",ProcessedDates:"ej.routedatepicker.ProcessedDates",Validate:"ej.routedatepicker.Validate",SearchValid:"ej.routedatepicker.searchvalid"},RouteSearch:{Validate:"ej.routesearch.validate",SearchValid:"ej.routesearch.valid",SearchInvalid:"ej.routesearch.invalid",ChangeMade:"ej.routesearch.changemade",UpdateFlightCard:"ej.update.flightcard",ResetRoute:"ej.routesearch.resetroute"},SmartMessaging:{Show:"ej.smartmessage.show",Hide:"ej.smartmessage.hide",HideAll:"ej.smartmessage.hideall"},HotAcc:{HideAll:"ej.hotacc.hideall",LoggedOut:"ej.hotacc.loggedout",ResetExpiryTimer:"ej.hotacc.resetexpirytimer",StopTimer:"ej.hotacc.stoptimer",CheckIsFlightDisrupted:"ej.hotacc.checkisflightdisrupted"},TitleBar:{ShowIcon:"ej.titlebar.showicon"},TouchScroll:{DisableObserverForScrollHeightChanges:"ej.touchscroll.disableobserverforscrollheightchanges",Reset:"ej.touchscroll.reset",ScrollToBottom:"ej.touchscroll.scrolltobottom"},ScrollTo:{PageScrolled:"ej.scrollto.pagescrolled",Top:"ej.scrollto.top"},Funnel:{ActiveJourneyPairChanged:"ej.funnel.activejourneypairchanged",ServerBasketCreated:"ej.funnel.serverbasketcreated",Continue:"ej.funnel.continue",CurrencyIsUpdating:"ej.funnel.currencyisupdating",CurrencyUpdated:"ej.funnel.currencyupdated",FlightAddedToBasket:"ej.funnel.flightaddedtobasket",ForceContinue:"ej.funnel.forcecontinue",FunnelReady:"ej.funnel.funnelready",HotelDeleted:"ej.funnel.hoteldeleted",HotelLoading:"ej.funnel.hotelloading",HotelUpdated:"ej.funnel.hotelupdated",JourneyCookieShowFlexiFaresUpdated:"ej.funnel.journeycookieshowflexifaresupdated",JourneyCookieRouteUpdated:"ej.funnel.journeycookierouteupdated",JourneyChanged:"ej.funnel.journeychanged",LuggageReady:"ej.funnel.luggageready",LuggageUpdated:"ej.funnel.luggageupdated",ManageDrawerContinueButton:"ej.funnel.managedrawercontinuebutton",ReFinalise:"ej.funnel.refinalise",ReFinaliseAllowDuplicateBooking:"ej.funnel.refinaliseallowduplicatebooking",RegisterFunnelControl:"ej.funnel.registerfunnelcontrol",RegisterOffersControl:"ej.funnel.registerofferscontrol",RemoveLinkFromEjLogo:"ej.funnel.removeejlogolink",OffersControlLoadFailure:"ej.funnel.offerscontrolloadfailure",OffersControlLoadComplete:"ej.funnel.offerscontrolloadcomplete",OffersBasketStateChanged:"ej.funnel.offersbasketstatechanged",ScrollToOutboundLeg:"ej.funnel.scrolltooutboundleg",ScrollToReturnLeg:"ej.funnel.scrolltoreturnleg",ScrollToVouchers:"ej.funnel.scrolltovouchers",ScrollToTravelInsurance:"ej.funnel.scrolltotravelinsurance",SecurePaymentStart:"ej.funnel.securepaymentstart",SecurePaymentSuccess:"ej.funnel.securepaymentsuccess",SignUpContinue:"ej.funnel.signupcontinue",SignUpMemberExists:"ej.funnel.signupmemberexists",Skip:"ej.funnel.skip",TravelInsuranceDeleted:"ej.funnel.travelinsurancedeleted",TravelInsuranceUpdated:"ej.funnel.travelinsuranceupdated",UpdateClientBasketPaymentMethod:"ej.funnel.updateclientbasketpaymentmethod",UpdateHelpingHand:"ej.funnel.updatehelpinghand",SetLoading:"ej.funnel.setloading",StepValidityChanged:"ej.funnel.setvaliditychanged",RemoveVouchersFromBasketForFlight:"ej.funnel.removevouchersfrombasket"},ShelfRack:{ShowShelfRack:"ej.shelfrack.show",HideShelfRack:"ej.shelfrack.hide"},TabbedContainer:{TabSelected:"ej.tabbedcontainer.tabselected"},Validation:{Validate:"ej.validation.validate",Refresh:"ej.validation.refresh"},Page:{DocumentReady:"ej.page.documentready",LoadedFromCache:"ej.page.loadedfromcache"},SearchPassengers:{Validate:"ej.searchpassengers.validate"},LowestFares:{LoadGraphs:"ej.lowestfares.loadgraphs"},PickFlightsOptions:{ShowFlexiFaresRequest:"ej.pickflightsoptions.showflexifares",ResetExpiryTimer:"ej.pickflightsoptions.resetexpirytimer"},EqualHeight:{Refresh:"ej.equalheight.refresh"},SearchPod:{ValidateAsWorldwide:"ej.searchpod.validateasworldwide"},SimpleTemplate:{ModelRebuilt:"ej.simpletemplate.modelrebuilt"},UberKahuna:{RefreshBackgroundImage:"ej.uberkahuna.refreshbackgroundimage"}},t}();n.Events=t}(AngularEj||(AngularEj={})),function(n){var t=function(){function n(){}return n.OnStartup=function(n){n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";doT.templateSettings.varname="model"},n}();n.Startup=t;t.OnStartup.$inject=["$http"]}(AngularEj||(AngularEj={})),function(n){var t=function(){function n(){}return n.ApplyConfig=function(n,t,i,r){n.debugInfoEnabled(!1);t.config({ariaHidden:!1,ariaInvalid:!1,tabindex:!1,ariaRequired:!1});i.defaults.xsrfCookieName="RBK-XSRF";i.defaults.xsrfHeaderName="X-RBK-XSRF";$jq.fn.qtip.zindex=800;$jq.fn.qtip.modal_zindex=$jq.fn.qtip.zindex-10;angularEjModule.constant=function(n,t){if(n!==null&&typeof n=="object")throw new Error("Using .constant([object]) is not supported after bootstrapping");else r.constant(n,t);return angularEjModule};r.decorator("$q",["$delegate",function(n){return n.now=function(t){var i;return t===undefined?(i=n.defer(),i.resolve(),i.promise):(i=n.defer(),i.resolve(t),i.promise)},n}])},n}();n.Config=t;t.ApplyConfig.$inject=["$compileProvider","$ariaProvider","$httpProvider","$provide"]}(AngularEj||(AngularEj={})),function(n){var t=function(){function n(){}return n.CompareStrings=function(n,t){return n>t?1:n<t?-1:0},n}();n.SortComparers=t}(AngularEj||(AngularEj={})),function(n){var t=function(){function n(n){this.ControllerNameKey="ControllerName";this.DirectiveNameKey="DirectiveName";this.FactoryNameKey="FactoryName";this.FilterNameKey="FilterName";this.ServiceNameKey="ServiceName";this._module=n;this._registeredControllers=[];this._registeredDirectives=[];this._registeredFactories=[];this._registeredFilters=[];this._registeredServices=[];this.ProcessPreRegisteredComponents()}return n.RegisterModule=function(t){var i=new n(t);i.RegisterAll()},n.prototype.ProcessPreRegisteredComponents=function(){var n=this;this._module._invokeQueue.forEach(function(t){var i=t[2][0];t[0]=="$controllerProvider"?n._registeredControllers.push(i):t[0]=="$compileProvider"?t[1]=="directive"&&n._registeredDirectives.push(i):t[0]==="$filterProvider"?n._registeredFilters.push(i):t[0]=="$provide"&&(t[1]=="factory"?n._registeredFactories.push(i):t[1]=="service"&&n._registeredServices.push(i))})},n.prototype.RegisterAll=function(){var n=this;this.FindComponents(this._module.ControllersRoot,this.ControllerNameKey,function(t){return n.RegisterController(t)});this.FindComponents(this._module.DirectivesRoot,this.DirectiveNameKey,function(t){return n.RegisterDirective(t)});this.FindComponents(this._module.FactoriesRoot,this.FactoryNameKey,function(t){return n.RegisterFactory(t)});this.FindComponents(this._module.FiltersRoot,this.FilterNameKey,function(t){return n.RegisterFilter(t)});this.FindComponents(this._module.ServicesRoot,this.ServiceNameKey,function(t){return n.RegisterService(t)})},n.prototype.RegisterController=function(n){var t=n[this.ControllerNameKey];t&&(this._registeredControllers.indexOf(t)>-1?this.LogDuplicate("controller",t):(this._module.controller(t,n),this._registeredControllers.push(t),this.LogRegistration("controller",t)))},n.prototype.RegisterDirective=function(n){var t=n[this.DirectiveNameKey],i=n.Factory;t&&i&&(this._registeredDirectives.indexOf(t)>-1?this.LogDuplicate("directive",t):(this._module.directive(t,i),this._registeredDirectives.push(t),this.LogRegistration("directive",t)))},n.prototype.RegisterFactory=function(n){var t=n[this.FactoryNameKey],i=n.Factory;t&&i&&(this._registeredFactories.indexOf(t)>-1?this.LogDuplicate("factory",t):(this._module.factory(t,i),this._registeredFactories.push(t),this.LogRegistration("factory",t)))},n.prototype.RegisterFilter=function(n){var t=n[this.FilterNameKey],i=n.Factory;t&&i&&(this._registeredFilters.indexOf(t)>-1?this.LogDuplicate("filter",t):(this._module.filter(t,i),this._registeredFilters.push(t),this.LogRegistration("filter",t)))},n.prototype.RegisterService=function(n){var t=n[this.ServiceNameKey];t&&(this._registeredServices.indexOf(t)>-1?this.LogDuplicate("service",t):(this._module.service(t,n),this._registeredServices.push(t),this.LogRegistration("service",t)))},n.prototype.FindComponents=function(n,t,i){var f,r,u,e;if(n)for(f in n)r=n[f],r&&(u=typeof r,u=="object"?this.FindComponents(r,t,i):u=="function"&&(e=r[t],e&&i(r)))},n.prototype.LogDuplicate=function(n,t){console.warn("Registrar attempting to register a "+n+" that is already registered, name = "+t)},n.prototype.LogRegistration=function(){},n}();n.Registrar=t}(AngularEj||(AngularEj={}));typeof angular!="undefined"&&angular.module("AngularFixes",[]).config(["$provide",function(n){var t=["$$rAF",function(n){function u(n){i.push([].concat(n));r()}function r(){var o,u,e;if(i.length){for(o=[],u=0;u<i.length;u++)e=i[u],f(e),e.length&&o.push(e);i=o;t||n(function(){t||r()})}}function f(n){var t=n.shift();!t||t()}var i=[],t;return u.waitUntilQuiet=function(i){t&&t();t=n(function(){t=null;i();r()})},u}];n.decorator("$$jqLite",["$delegate",function(n){if(bowser.msie&&bowser.version<=8){var i=n.removeClass,r=n.addClass,t=function(){document.body.className=document.body.className};n.removeClass=function(n,r){i(n,r);t()};n.addClass=function(n,i){r(n,i);t()}}return n}]);n.factory("$$rAFScheduler",t)}]);typeof angular!="undefined"&&(window.angularEjSeatMapModule=angular.module("AngularEjSeatMap",[]),angularEjSeatMapModule.ControllersRoot=AngularEj.SeatMap.Controllers,angularEjSeatMapModule.DirectivesRoot=AngularEj.SeatMap.Directives,angularEjSeatMapModule.ServicesRoot=AngularEj.SeatMap.Services,AngularEj.Registrar.RegisterModule(angularEjSeatMapModule),AngularEj.DynamicDependency.RegisterModule(angularEjSeatMapModule),window.angularEjModule=angular.module("AngularEj",["ngAnimate","ngTouch","jQueryScrollbar","ng.shims.placeholder","AngularFixes","ngAria","AngularEjSeatMap","ngSanitize"]).animation(".anim-slide-rtr",AngularEj.Animations.Slides.RightToRightFactory).animation(".anim-slide-rtl",AngularEj.Animations.Slides.RightToLeftFactory).animation(".anim-slide-ltr",AngularEj.Animations.Slides.LeftToRightFactory).animation(".anim-blind",AngularEj.Animations.Blind.Factory).animation(".anim-fade",AngularEj.Animations.Fade.Factory).service("LegacyComponents_CookiePolicyPopup_CookiePolicyCookieManager",CookiePolicyCookieManager).run(AngularEj.Startup.OnStartup).config(AngularEj.Config.ApplyConfig),angularEjModule.ControllersRoot=AngularEj.Controllers,angularEjModule.DirectivesRoot=AngularEj.Directives,angularEjModule.FactoriesRoot=AngularEj.Factories,angularEjModule.FiltersRoot=AngularEj.Filters,angularEjModule.ServicesRoot=AngularEj.Services,AngularEj.Registrar.RegisterModule(angularEjModule),AngularEj.DynamicDependency.RegisterModule(angularEjModule))